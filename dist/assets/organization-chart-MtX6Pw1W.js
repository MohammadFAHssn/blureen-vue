import{U as oe,r as p,Y as ae,f as U,o as C,e as t,b as a,v,n as s,bq as re,am as N,M as W,bI as I,w as te,c as E,x as y,d as R,a2 as Q,F as G,i as Y,bx as T,y as le,cl as se,a1 as H,a7 as ne,bJ as ie,a as ue,m as de,Q as ce}from"./index-BLa7l-A_.js";import{V as $,b as q,c as F}from"./VCard-TiDRmG01.js";import{V as O}from"./VCardText-BdFJQOjq.js";import{V as me}from"./VAutocomplete-CDDNPvEv.js";import{V as fe}from"./VDialog-sFXkKhbt.js";import{V as X}from"./VSnackbar-DMIAQZI3.js";import{V as K}from"./VDivider-DyTxU-Wi.js";import{V as pe,a as ge}from"./VRow-Fubp2vBO.js";import{u as ve}from"./useAGGridTheme-CZ_PM4vS.js";import{u as B}from"./useApi-wYoMxalo.js";import{c as M}from"./createUrl-f0hm9zSJ.js";import{V as _e}from"./VLayout-Dw7eNUoQ.js";import"./createSimpleFunctional-DXSSxiVm.js";import"./VSelect-BCeheCvJ.js";import"./VTextField-DuLJrTHU.js";import"./autofocus-DrDz5aVi.js";import"./VCounter-D1LOcp_M.js";import"./VField-DHRx7IRv.js";import"./VOverlay-BtfhBX5a.js";import"./VList-BZTViMpw.js";import"./dialog-transition-Dn0iGl-1.js";import"./VMenu-DSNOJdVC.js";import"./VCheckboxBtn-zZeD6VIp.js";import"./filter-Di5jq38p.js";/* empty css              */import"./useLogout-D6I8nA1a.js";const Ve={__name:"AssignUserToPositionDialog",props:{isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","addUser"],setup(h,{emit:D}){const _=h,d=D;function m(i){d("update:isDialogVisible",i)}const f=oe("users",p([])),V=ae(()=>((f==null?void 0:f.value)||[]).filter(i=>i.active).map(i=>({title:`${i.first_name} ${i.last_name} (${i.personnel_code})`,value:{id:i.id,firstName:i.first_name,lastName:i.last_name,personnelCode:i.personnel_code}}))),c=p(null);function b(){d("addUser",c.value),c.value=null,m(!1)}return(i,g)=>(C(),U(fe,{"model-value":_.isDialogVisible,width:"500","onUpdate:modelValue":m},{default:t(()=>[a($,null,{default:t(()=>[a(q,null,{default:t(()=>[...g[1]||(g[1]=[v(" لطفاً کاربر مورد نظر خود را برای این سمت انتخاب کنید ",-1)])]),_:1}),a(O,null,{default:t(()=>[a(me,{modelValue:s(c),"onUpdate:modelValue":g[0]||(g[0]=A=>re(c)?c.value=A:null),label:"کاربر",items:s(V)},null,8,["modelValue","items"])]),_:1}),a(F,null,{default:t(()=>[a(N,{onClick:b},{default:t(()=>[...g[2]||(g[2]=[v(" تأیید ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},be={__name:"Positions",props:{costCenter:{type:Object,required:!0},orgPositions:{type:Array,required:!0},loading:{type:Boolean,default:!0}},emits:["save","cancel"],setup(h,{emit:D}){const _=h,d=D,m=I({hasError:!1,errorMessage:"",isAssignUserToPositionDialogVisible:!1}),f=p(_.costCenter),V=p(null),c=p(null);function b(n,r){return n.orgPositions.filter(l=>l.id===r.id)}function i(n){V.value=n,m.isAssignUserToPositionDialogVisible=!0}function g(n){const r=f.value.orgPositions;if(r.some(l=>l.user.id===n.id)){m.hasError=!0,m.errorMessage="کاربر انتخاب شده، در این مرکز هزینه دارای سمت می‌باشد";return}r.push({...V.value,user:n}),f.value.orgPositions=r}function A(n){n.preventDefault()}function S(n,r){c.value=r.id}function P(n,r){const l=n.relatedTarget;l&&n.currentTarget.contains(l)||c.value===r.id&&(c.value=null)}function x(n,r){const l=n.dataTransfer.getData("application/json"),u=JSON.parse(l),z={id:u.id,personnelCode:u.personnelCode,firstName:u.firstName,lastName:u.lastName};V.value=r,g(z),c.value=null}return te(()=>_.costCenter,n=>{f.value=n},{deep:!1}),(n,r)=>(C(),E(G,null,[a(X,{modelValue:s(m).hasError,"onUpdate:modelValue":r[0]||(r[0]=l=>s(m).hasError=l),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:t(()=>[v(y(s(m).errorMessage),1)]),_:1},8,["modelValue"]),a($,{class:"mb-3"},{default:t(()=>[a(q,null,{default:t(()=>[r[4]||(r[4]=R("span",{class:"ml-3"}," سمت‌های ",-1)),a(Q,{color:"info",class:"ml-3 mb-3"},{default:t(()=>[v(y(s(f).name),1)]),_:1})]),_:1}),a(K),a(O,{class:"pa-5",style:{"max-block-size":"25vh","overflow-y":"auto"}},{default:t(()=>[a(pe,null,{default:t(()=>[(C(!0),E(G,null,Y(_.orgPositions,l=>(C(),U(ge,{key:l.id,cols:"12",sm:"12",md:"5",lg:"5",xl:"3",xxl:"2"},{default:t(()=>[a($,{class:le({"drag-over":s(c)===l.id}),onDragover:A,onDragenter:T(u=>S(u,l),["prevent"]),onDragleave:T(u=>P(u,l),["prevent"]),onDrop:T(u=>x(u,l),["prevent"])},{default:t(()=>[a(q,null,{default:t(()=>[a(Q,{color:"primary"},{default:t(()=>[v(y(l.name),1)]),_:2},1024)]),_:2},1024),a(O,null,{default:t(()=>[(C(!0),E(G,null,Y(b(s(f),l),u=>(C(),U(se,{key:u.id,density:"compact",class:"overflow-hidden ml-1 mb-1"},{default:t(()=>[a(N,{color:"error",variant:"tonal",icon:"",class:"remove-position-holder-btn"},{default:t(()=>[a(H,{icon:"tabler-x"})]),_:1}),a(N,{class:"position-holder-label",disabled:"",variant:"outlined"},{default:t(()=>[v(y(u.user.firstName)+" "+y(u.user.lastName)+" ("+y(u.user.personnelCode)+") ",1)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024),a(F,null,{default:t(()=>[a(N,{block:"",onClick:u=>i(l)},{default:t(()=>[a(H,{size:"24",icon:"tabler-plus"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["class","onDragenter","onDragleave","onDrop"])]),_:2},1024))),128))]),_:1})]),_:1}),a(K),a(F,{class:"px-4 py-2"},{default:t(()=>[a(N,{color:"success",loading:h.loading,onClick:r[1]||(r[1]=l=>d("save"))},{default:t(()=>[...r[5]||(r[5]=[v(" ذخیره ",-1)])]),_:1},8,["loading"]),a(N,{color:"error",disabled:h.loading,onClick:r[2]||(r[2]=l=>d("cancel"))},{default:t(()=>[...r[6]||(r[6]=[v(" انصراف ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),a(Ve,{"is-dialog-visible":s(m).isAssignUserToPositionDialogVisible,"onUpdate:isDialogVisible":r[3]||(r[3]=l=>s(m).isAssignUserToPositionDialogVisible=l),onAddUser:g},null,8,["is-dialog-visible"])],64))}},Ce=W(be,[["__scopeId","data-v-50b82081"]]),we={style:{"block-size":"100%"}},ye={__name:"organization-chart",async setup(h){let D,_;const d=I({hasError:!1,errorMessage:""}),m=I({updateOrganizationChart:!1}),f=p([]),V=p([]),c=p([]),b=ne(null),i=p(null);ce("users",f);const{theme:g}=ve();function A(o){b.value=o.api,b.value.setGridOption("rowData",x())}const S=p([{headerName:"محل کار",field:"workplace",rowGroup:!0,hide:!0},{headerName:"منطقه کاری",field:"workArea",rowGroup:!0,hide:!0},{headerName:"مرکز هزینه",field:"costCenter",valueFormatter:o=>{var e;return(e=o.value)==null?void 0:e.name},rowGroup:!0,hide:!0},{headerName:"کد پرسنلی",field:"personnelCode",dndSource:o=>o.node.group===!1},{headerName:"نام",field:"firstName"},{headerName:"نام خانوادگی",field:"lastName"},{headerName:"وضعیت",field:"active",cellRenderer:"Active",cellStyle:{display:"flex","align-items":"center"},filterParams:{valueFormatter:o=>o.value===1?"فعال":"غیرفعال"}}]),P=p({mode:"singleRow",enableClickSelection:!0,selectAll:"filtered",isRowSelectable:o=>o.field==="costCenter"});function x(){var o;return(o=f.value)==null?void 0:o.map(e=>{var w,k,j,L,J;return{id:e.id,personnelCode:Number.parseInt(e.personnel_code),firstName:e.first_name,lastName:e.last_name,active:e.active,workplace:(k=(w=e.profile)==null?void 0:w.workplace)==null?void 0:k.name,workArea:(L=(j=e.profile)==null?void 0:j.work_area)==null?void 0:L.name,costCenter:(J=e.profile)==null?void 0:J.cost_center}})}const n=p({filter:"agGroupColumnFilter"});function r(){const o=b.value.getSelectedNodes()[0];i.value=o?{rayvarzId:o.groupValue.rayvarz_id,name:o.groupValue.name,orgPositions:c.value.filter(e=>e.cost_center_id===o.groupValue.rayvarz_id).map(e=>({id:e.org_position.id,name:e.org_position.name,level:e.org_position.level,user:{id:e.user.id,firstName:e.user.first_name,lastName:e.user.last_name,personnelCode:e.user.personnel_code}}))}:null}async function l(){var o;try{const{data:e,error:w}=await B(M("/base/user",{query:{"fields[users]":"id,first_name,last_name,personnel_code,active","fields[profiles]":"id,user_id,workplace_id,work_area_id,cost_center_id",include:"profile.workplace,profile.workArea,profile.costCenter"}}));if(w.value)throw w.value;f.value=e.value.data,(o=b.value)==null||o.setGridOption("rowData",x())}catch(e){console.error("Error fetching users:",e),d.hasError=!0,d.errorMessage=e.message||"خطا در دریافت کاربران"}}async function u(){try{const{data:o,error:e}=await B(M("/base/org-position"));if(e.value)throw e.value;V.value=o.value.data}catch(o){console.error("Error fetching organization positions:",o),d.hasError=!0,d.errorMessage=o.message||"خطا در دریافت سمت‌ها"}}async function z(){try{const{data:o,error:e}=await B(M("/base/cost-center-org-position",{query:{"fields[users]":"id,first_name,last_name,personnel_code,active",include:"orgPosition,user"}}));if(e.value)throw e.value;c.value=o.value.data}catch(o){console.error("Error fetching cost centers organization positions:",o),d.hasError=!0,d.errorMessage=o.message||"خطا در دریافت سمت‌های مرکز هزینه‌ها"}}function Z(){}function ee(){}return l(),u(),[D,_]=ie(()=>z()),await D,_(),(o,e)=>{const w=ue("AgGridVue");return C(),U(_e,{class:"app-layout"},{default:t(()=>[a(X,{modelValue:s(d).hasError,"onUpdate:modelValue":e[0]||(e[0]=k=>s(d).hasError=k),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:t(()=>[v(y(s(d).errorMessage),1)]),_:1},8,["modelValue"]),R("div",null,[s(i)?(C(),U(Ce,{key:0,"cost-center":s(i),"org-positions":s(V),loading:s(m).updateOrganizationChart,onSave:Z,onCancel:ee},null,8,["cost-center","org-positions","loading"])):de("",!0)]),R("section",we,[a(w,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":s(S),"get-row-id":k=>String(k.data.id),"enable-rtl":"","row-numbers":"",pagination:"","group-display-type":"multipleColumns","auto-group-column-def":s(n),"cell-selection":"","row-selection":s(P),theme:s(g),onGridReady:A,onSelectionChanged:r},null,8,["column-defs","get-row-id","auto-group-column-def","row-selection","theme"])])]),_:1})}}},He=W(ye,[["__scopeId","data-v-2def4b96"]]);export{He as default};
