import{_ as M}from"./AreYouSureDialog-CGhdLocu.js";import{$ as p}from"./api-BfURXrYl.js";import{M as N,bI as k,r as h,bH as D,f as x,o,e as r,b as l,c as n,m as w,n as i,v as _,x as V,bL as T,F as U,i as j,y as z,d as g,am as E}from"./index-CZmlrHzd.js";import{V as L}from"./VSnackbar-Ct1w5JDU.js";import{V as O}from"./VDialog-Cg8qUXxT.js";import{V as A,c as F}from"./VCard-CXSdIZn9.js";import{V as P}from"./VCardText-EPgXGG2q.js";import{V as H}from"./VLayout-Bm41112N.js";import"./useLogout-TzOCmm_3.js";import"./VOverlay-CjHKxBYJ.js";import"./dialog-transition-SmN9t4g1.js";import"./createSimpleFunctional-BoyP5ZpY.js";const J={key:0,class:"no-access-message"},R={key:1,class:"gift-grid-container"},q={key:0,class:"loading-container"},K={key:1,class:"gift-grid"},Q=["src","onClick"],W={class:"gift-info"},X={class:"gift-name"},Y={key:0,style:{color:"#5abe5f","font-size":"0.9rem","margin-top":"0.5rem"}},Z={key:2,class:"text-center"},ee=["src"],ae={__name:"birthday-user",async setup(te){let c,f;const t=k({hasError:!1,errorMessage:"",isBirthdayGiftChooseDialogVisible:!1,isImageDialogVisible:!1}),d=k({fetchingBirthdayGifts:!1,chooseBirthdayGift:!1}),y=h([]),m=h(null),b=h(null),v=h("");async function B(){var s;d.fetchingBirthdayGifts=!0;try{const a=await p("/birthday/gift/get-actives",{method:"GET"});y.value=((s=a==null?void 0:a.data)==null?void 0:s.birthdayGifts)||[]}catch(a){t.hasError=!0,t.errorMessage=a.message||"خطا در دریافت هدایا"}finally{d.fetchingBirthdayGifts=!1}}async function $(){var a;const s=(a=b.value)==null?void 0:a.id;if(s){d.chooseBirthdayGift=!0;try{await p("/birthday/user/choose/",{method:"POST",body:JSON.stringify({id:s}),onResponseError({response:e}){var u,G;t.hasError=!0,t.errorMessage=((u=e._data)==null?void 0:u.error)||Object.values(((G=e._data)==null?void 0:G.errors)||{}).flat().join(" | ")||"خطا در انتخاب هدیه"}})}catch(e){console.error(e)}finally{d.chooseBirthdayGift=!1,t.isBirthdayGiftChooseDialogVisible=!1,await B(),await C()}}}async function C(){try{const s=await p("/birthday/user/check",{method:"GET"});m.value=(s==null?void 0:s.data)??null}catch(s){t.hasError=!0,t.errorMessage=s.message||"خطا در بررسی دسترسی"}}function I(s){b.value=s,t.isBirthdayGiftChooseDialogVisible=!0}function S(s){v.value=`undefined/${s.image}`,t.isImageDialogVisible=!0}return[c,f]=D(()=>B()),await c,f(),[c,f]=D(()=>C()),await c,f(),(s,a)=>(o(),x(H,{class:"app-layout pa-4"},{default:r(()=>[l(L,{modelValue:i(t).hasError,"onUpdate:modelValue":a[0]||(a[0]=e=>i(t).hasError=e),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:r(()=>[_(V(i(t).errorMessage),1)]),_:1},8,["modelValue"]),i(m)===null?(o(),n("div",J," در حال حاضر شما اجازه مشاهده یا انتخاب هدیه را ندارید. ")):(o(),n("div",R,[i(d).fetchingBirthdayGifts?(o(),n("div",q,[l(T,{indeterminate:"",color:"primary",size:"64"})])):i(y).length?(o(),n("div",K,[(o(!0),n(U,null,j(i(y),e=>(o(),n("div",{key:e.id,class:z(["gift-card",{"selected-gift":i(m)===e.id}])},[g("img",{src:`${i(void 0)}/${e.image}`,alt:"gift image",class:"gift-image",onClick:u=>S(e)},null,8,Q),g("div",W,[g("p",X,V(e.name),1)]),l(E,{color:e.amount>0?"primary":"error",variant:"flat",disabled:e.amount<=0,onClick:u=>e.amount>0&&I(e)},{default:r(()=>[_(V(e.amount>0?"انتخاب هدیه":"ناموجود"),1)]),_:2},1032,["color","disabled","onClick"]),i(m)===e.id?(o(),n("span",Y," هدیه شما ")):w("",!0)],2))),128))])):(o(),n("p",Z," هیچ هدیه‌ای یافت نشد. "))])),i(t).isBirthdayGiftChooseDialogVisible?(o(),x(M,{key:2,"is-dialog-visible":i(t).isBirthdayGiftChooseDialogVisible,"onUpdate:isDialogVisible":a[1]||(a[1]=e=>i(t).isBirthdayGiftChooseDialogVisible=e),title:"آیا از انتخاب این هدیه اطمینان دارید؟",loading:i(d).chooseBirthdayGift,onConfirm:$},null,8,["is-dialog-visible","loading"])):w("",!0),l(O,{modelValue:i(t).isImageDialogVisible,"onUpdate:modelValue":a[3]||(a[3]=e=>i(t).isImageDialogVisible=e),width:"500",transition:"dialog-bottom-transition"},{default:r(()=>[l(A,null,{default:r(()=>[l(P,{class:"text-center"},{default:r(()=>[g("img",{src:i(v),alt:"gift preview",style:{"max-width":"100%","max-height":"70vh","border-radius":"8px"}},null,8,ee)]),_:1}),l(F,{class:"justify-center"},{default:r(()=>[l(E,{color:"primary",variant:"tonal",onClick:a[2]||(a[2]=e=>i(t).isImageDialogVisible=!1)},{default:r(()=>[...a[4]||(a[4]=[_(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ye=N(ae,[["__scopeId","data-v-1fb007e6"]]);export{ye as default};
