import{u as C}from"./useApi-CfEzs0X0.js";import{c as w}from"./createUrl-CwPShYg2.js";import{$ as E}from"./api-DyCbMmRA.js";import{V as I}from"./VSnackbar-De1DqqFm.js";import{V as m}from"./VCol-DQCttir7.js";import{V as v,b as B,c as M}from"./VCard-WE3Ogg5-.js";import{bL as y,r as _,c as u,o as a,b as l,e as r,v as c,x as k,n as s,f as p,F as S,i as $,am as V}from"./index-Bdnd2A8t.js";import{V as L}from"./VRow-Cblo0ezT.js";import"./useLogout-DYxf_kHt.js";import"./VOverlay-Hxmt-v-P.js";/* empty css              */import"./createSimpleFunctional-C8k8e6eJ.js";import"./VCardText-DwGQfbI3.js";const T={key:0},A={key:1},Q={__name:"survey",setup(F){const o=y({hasError:!1,errorMessage:""}),n=y({fetchSurveys:!1,participateInSurvey:!1}),f=_([]),d=_("");async function g(){n.fetchSurveys=!0;try{const{data:i,error:e}=await C(w("/survey/survey?filter[active]=1"));if(n.fetchSurveys=!1,e.value)throw e.value;f.value=i.value.data}catch(i){console.error("Error fetching surveys:",i),o.hasError=!0,o.errorMessage=i.message||"خطا در دریافت نظرسنجی‌ها"}}g();async function h(i){n.participateInSurvey=!0;try{const e=await E("/survey/survey/participate",{method:"POST",body:{porslineId:i},onResponseError({response:t}){n.participateInSurvey=!1,o.hasError=!0,o.errorMessage=t._data.message||"خطا در شرکت در نظرسنجی"}});n.participateInSurvey=!1,d.value=e.data}catch(e){console.error(e)}}function x(){window.open(d.value,"_blank","noopener,noreferrer")}return(i,e)=>(a(),u(S,null,[l(I,{modelValue:s(o).hasError,"onUpdate:modelValue":e[0]||(e[0]=t=>s(o).hasError=t),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:r(()=>[c(k(s(o).errorMessage),1)]),_:1},8,["modelValue"]),l(L,null,{default:r(()=>[s(f).length===0?(a(),p(m,{key:0},{default:r(()=>[l(v,{variant:"text"},{default:r(()=>[...e[1]||(e[1]=[c(" نظرسنجی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(a(!0),u(S,{key:1},$(s(f),t=>(a(),p(m,{key:t.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:r(()=>[l(v,null,{default:r(()=>[l(B,{class:"text-center mb-5 text-wrap"},{default:r(()=>[c(k(t.title),1)]),_:2},1024),l(M,{class:"justify-center"},{default:r(()=>[s(d)?(a(),p(V,{key:0,variant:"elevated",color:"success",onClick:b=>x(t.porsline_id)},{default:r(()=>[...e[2]||(e[2]=[c(" شروع ",-1)])]),_:1},8,["onClick"])):(a(),p(V,{key:1,variant:"elevated",disabled:s(n).participateInSurvey,onClick:b=>h(t.porsline_id)},{default:r(()=>[s(n).participateInSurvey?(a(),u("span",T,"در حال ساخت لینک")):(a(),u("span",A,"دریافت لینک نظرسنجی"))]),_:1},8,["disabled","onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))}};export{Q as default};
