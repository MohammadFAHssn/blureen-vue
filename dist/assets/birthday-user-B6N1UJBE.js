import{_ as N}from"./AreYouSureDialog-jIeKAaSO.js";import{$ as V}from"./api-CO1VIjge.js";import{V as T}from"./VSnackbar-qm4bQdaU.js";import{V as w}from"./VAlert-Yc1ekqV1.js";import{bL as k,r as y,bM as D,f as d,o as l,e as r,b as s,c as p,m as A,n as a,v as f,x as b,bN as L,F as O,i as U,d as F,bj as E,am as $}from"./index-B7SH6OAX.js";import{V as P}from"./VContainer-BB1WDi2y.js";import{V as R}from"./VRow-CTpNiLCW.js";import{V as z}from"./VCol-C_fnZ-g-.js";import{V as I,b as J,c as q}from"./VCard-DsBP3K4N.js";import{V as H}from"./VDialog-DMobG4VS.js";import{V as K}from"./VCardText-DotIUx_U.js";import{V as Q}from"./VLayout-C3sq5nEK.js";import"./useLogout-DgVxpQ-z.js";import"./VOverlay-CFzqsu9R.js";import"./createSimpleFunctional-BQbKiRrp.js";/* empty css              */import"./dialog-transition-B6fqg6uB.js";const W={key:1,class:"flex-grow-1 overflow-y-auto pb-8"},X={key:0,class:"d-flex justify-center align-center h-100"},Y={class:"d-flex flex-column justify-center align-center flex-grow-1 pa-3"},Ve={__name:"birthday-user",async setup(Z){let m,u;const x="https://blureen.afgc.ir/storage",i=k({hasError:!1,errorMessage:"",isBirthdayGiftChooseDialogVisible:!1,isImageDialogVisible:!1}),n=k({fetchingBirthdayGifts:!1,chooseBirthdayGift:!1}),g=y([]),c=y(null),C=y(null),_=y("");async function v(){var o;n.fetchingBirthdayGifts=!0;try{const t=await V("/birthday/gift/get-actives",{method:"GET"});g.value=((o=t==null?void 0:t.data)==null?void 0:o.birthdayGifts)||[]}catch(t){i.hasError=!0,i.errorMessage=t.message||"خطا در دریافت هدایا"}finally{n.fetchingBirthdayGifts=!1}}async function S(){var t;const o=(t=C.value)==null?void 0:t.id;if(o){n.chooseBirthdayGift=!0;try{await V("/birthday/user/choose/",{method:"POST",body:JSON.stringify({id:o}),onResponseError({response:e}){var h,G;i.hasError=!0,i.errorMessage=((h=e._data)==null?void 0:h.error)||Object.values(((G=e._data)==null?void 0:G.errors)||{}).flat().join(" | ")||"خطا در انتخاب هدیه"}})}catch(e){console.error(e)}finally{n.chooseBirthdayGift=!1,i.isBirthdayGiftChooseDialogVisible=!1,await v(),await B()}}}async function B(){try{const o=await V("/birthday/user/check",{method:"GET"});c.value=(o==null?void 0:o.data)??null}catch(o){i.hasError=!0,i.errorMessage=o.message||"خطا در بررسی دسترسی"}}function j(o){C.value=o,i.isBirthdayGiftChooseDialogVisible=!0}function M(o){_.value=`${x}/${o.image}`,i.isImageDialogVisible=!0}return[m,u]=D(()=>v()),await m,u(),[m,u]=D(()=>B()),await m,u(),(o,t)=>(l(),d(Q,{class:"pa-4 d-flex flex-column h-100"},{default:r(()=>[s(T,{modelValue:a(i).hasError,"onUpdate:modelValue":t[0]||(t[0]=e=>a(i).hasError=e),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:r(()=>[f(b(a(i).errorMessage),1)]),_:1},8,["modelValue"]),a(c)===null?(l(),d(w,{key:0,type:"error",variant:"tonal"},{default:r(()=>[...t[4]||(t[4]=[f(" در حال حاضر شما اجازه مشاهده یا انتخاب هدیه را ندارید. ",-1)])]),_:1})):(l(),p("div",W,[a(n).fetchingBirthdayGifts?(l(),p("div",X,[s(L,{indeterminate:"",color:"primary",size:"64"})])):a(g).length?(l(),d(P,{key:1,fluid:""},{default:r(()=>[s(R,null,{default:r(()=>[(l(!0),p(O,null,U(a(g),e=>(l(),d(z,{key:e.id,cols:"12",sm:"6",md:"4",lg:"2",class:"d-flex"},{default:r(()=>[s(I,{class:"d-flex flex-column text-center",width:"100%"},{default:r(()=>[s(E,{src:`${a(x)}/${e.image}`,cover:"",height:"200",class:"flex-sm-grow-0 flex-sm-shrink-0 cursor-pointer",width:"100%","min-width":"120",onClick:h=>M(e)},null,8,["src","onClick"]),F("div",Y,[s(J,{class:"text-center text-wrap mb-2"},{default:r(()=>[f(b(e.name),1)]),_:2},1024),s($,{color:e.id===a(c)?"success":e.amount>0?"primary":"error",variant:"flat",disabled:e.amount<=0||e.id===a(c),class:"mb-2",onClick:h=>e.amount>0&&j(e)},{default:r(()=>[f(b(e.id===a(c)?"هدیه شما":e.amount>0?"انتخاب هدیه":"ناموجود"),1)]),_:2},1032,["color","disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(l(),d(w,{key:2,type:"info",variant:"tonal",class:"text-center mt-8"},{default:r(()=>[...t[5]||(t[5]=[f(" هیچ هدیه‌ای یافت نشد. ",-1)])]),_:1}))])),a(i).isBirthdayGiftChooseDialogVisible?(l(),d(N,{key:2,"is-dialog-visible":a(i).isBirthdayGiftChooseDialogVisible,"onUpdate:isDialogVisible":t[1]||(t[1]=e=>a(i).isBirthdayGiftChooseDialogVisible=e),title:"آیا از انتخاب این هدیه اطمینان دارید؟",loading:a(n).chooseBirthdayGift,onConfirm:S},null,8,["is-dialog-visible","loading"])):A("",!0),s(H,{modelValue:a(i).isImageDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>a(i).isImageDialogVisible=e),width:"500",transition:"dialog-bottom-transition"},{default:r(()=>[s(I,null,{default:r(()=>[s(K,{class:"text-center"},{default:r(()=>[s(E,{src:a(_)},null,8,["src"])]),_:1}),s(q,{class:"justify-center"},{default:r(()=>[s($,{onClick:t[2]||(t[2]=e=>a(i).isImageDialogVisible=!1)},{default:r(()=>[...t[6]||(t[6]=[f(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ve as default};
