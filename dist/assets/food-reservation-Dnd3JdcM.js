import{bx as Ce,r as C,Y as Z,H as ze,a as Ue,c as R,o as d,b as e,f as y,m as w,e as t,n as r,v as i,x as o,d as l,bi as T,am as z,F as G,i as J,a2 as v,a1 as j,bs as De,B as ve,w as Se}from"./index-BRcc4XA0.js";import{_ as Fe}from"./DialogCloseBtn-BFlzakNo.js";import{j as Te}from"./index-H4fOOS_g.js";import{_ as Ye}from"./AreYouSureDialog-CCOIcmER.js";import{$ as q}from"./api-B9aYCsOm.js";import{V as we}from"./VSnackbar-CyP0ExQa.js";import{V as P}from"./VRow-DuNPxdKR.js";import{V as D}from"./VCol-BtPIBuv3.js";import{V as de,b as Pe}from"./VCard-a6caRL8S.js";import{V as ne}from"./VTextField-BcJf0Rxu.js";import{V as Ae}from"./VSelect-BbFfwrY5.js";import{a as $e,V as ee}from"./VRadioGroup-Cq11LI_9.js";import{V as Ge}from"./VAutocomplete-BMcnnftV.js";import{V as me}from"./VTable-CU3BKQ09.js";import{V as Re}from"./VSkeletonLoader-C3ebgbwC.js";import{V as oe,a as ue,b as ie,c as I}from"./VExpansionPanels-BD51b273.js";import{V as Ee}from"./VContainer-CK1SzMCJ.js";import{V as qe}from"./VCardText-CK9ceg1n.js";import{V as le}from"./VDivider-DM3liG56.js";import{V as Be}from"./VDialog-D6lwnvbS.js";import"./index-CvOPxmL5.js";import"./useLogout-C-eg2eyz.js";import"./VOverlay-Cmb_ffnQ.js";/* empty css              */import"./createSimpleFunctional-BiP4K-1P.js";import"./autofocus-Bh2WnONs.js";import"./VCounter-CjJtFXu-.js";import"./VField-MsHMmBuK.js";import"./VList-D-2k1QhF.js";import"./dialog-transition-DnuBdUzz.js";import"./VMenu-vuKKjGw3.js";import"./VCheckboxBtn-bc6JJRZY.js";import"./filter-CLTelndQ.js";const Oe={class:"ma-3 overflow-auto d-none d-md-block"},Ke={key:4,class:"text-center"},Le={class:"d-md-none pa-3"},Je={class:"d-flex flex-column w-100"},He={class:"d-flex justify-space-between align-center mb-1"},Ie={class:"font-weight-medium"},Qe={class:"d-flex justify-space-between align-center"},We={class:"d-flex justify-space-between align-center"},Xe={class:"pa-2"},Ze={class:"mt-2 text-center"},el={class:"d-flex flex-column w-100"},ll={class:"d-flex justify-space-between align-center mb-1"},tl={class:"font-weight-medium"},al={class:"d-flex justify-space-between align-center"},sl={class:"pa-2"},rl={class:"mb-2 d-flex justify-space-between align-start"},nl={style:{"max-width":"100%","white-space":"normal","overflow-wrap":"anywhere","word-break":"break-word","text-align":"right",flex:"1"}},ol={class:"mt-2 text-center"},ul={class:"d-flex flex-column w-100"},il={class:"d-flex justify-space-between align-center mb-1"},dl={class:"font-weight-medium"},cl={class:"d-flex justify-space-between align-center"},fl={class:"pa-2"},vl={class:"mb-2 d-flex justify-space-between align-start"},ml={style:{"max-width":"100%","white-space":"normal","overflow-wrap":"anywhere","word-break":"break-word","text-align":"right",flex:"1"}},pl={class:"mt-2 text-center"},yl={key:4,class:"text-center"},gl={style:{"white-space":"normal","overflow-wrap":"anywhere"}},_l={__name:"ReservationForGuestAndContractor",setup(je){const m=Ce({success:!1,successMessage:"",hasError:!1,errorMessage:"",isDeleteDialogVisible:!1,isDetailsDialogVisible:!1}),p=Ce({fetchingReservedMeals:!0,fetchingMeals:!1,fetchingContractors:!1,reserveMeal:!1,editReservedMeal:!1,deleteReservedMeal:!1}),b=C([]),S=C(""),se=C(null),ce=C([]),fe=C([]),L=C([]),Q=C([]),B=C([]),Y=C(null),h=C(null),_=C(null),E=C(null),A=C(null),H=C(null),N=C(null),V=C(null),xe=Z(()=>!b.value||b.value.length===0?"":Array.isArray(b.value)?b.value.join(" - "):b.value);function U(){return Array.isArray(b.value)?b.value.filter(Boolean):b.value?[b.value]:[]}function F(s){m.hasError=!0,m.errorMessage=s}async function be(){var u,a;const s=U();if(!s.length)return F("لطفاً حداقل یک تاریخ برای رزرو انتخاب کنید.");if(!h.value)return F("لطفاً وعده را انتخاب کنید.");if(V.value==="contractor"&&!Y.value)return F("لطفاً پیمانکار را انتخاب کنید.");if(!E.value)return F("لطفاً تعداد را وارد کنید.");if(V.value==="guest"&&!A.value)return F("لطفاً توضیحات را وارد کنید.");if(V.value==="guest"&&H.value==="serve_in_kitchen"&&!N.value)return F("لطفا ساعت حضور در رستوران را تعیین کنید.");for(const f of s){const[g,k,x]=String(f).split("/").map(Number);if(g*1e4+k*100+x<se.value){F("امکان رزرو غذا فقط برای زمان حال و آینده وجود دارد.");return}}p.reserveMeal=!0;const n=(a=(u=De("userData"))==null?void 0:u.value)==null?void 0:a.id;let M={date:b.value,meal_id:h.value,supervisor_id:n,reserve_type:V.value};V.value==="contractor"?M={...M,contractor:Y.value,quantity:E.value}:V.value==="guest"?M={...M,quantity:E.value,description:A.value,serve_place:H.value,...N.value?{attendance_hour:N.value}:{}}:V.value==="repairman"&&(M={...M,quantity:E.value,description:A.value});try{if(await q("/food/meal-reservation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M),onResponseError({response:f}){var g,k;if(m.hasError=!0,(g=f._data)!=null&&g.errors){const x=Object.values(f._data.errors).flat().join(" | ");m.errorMessage=x}else m.errorMessage=((k=f._data)==null?void 0:k.message)||"خطا در ایجاد"}}),m.hasError)return;m.success=!0,m.successMessage="رزرو با موفقیت انجام شد.",V.value==="contractor"?ae():V.value==="guest"?pe():V.value==="repairman"&&ye(),Y.value=null,h.value=null,E.value=null,A.value=null,N.value=null}catch(f){console.error("Error submitting reservation:",f)}finally{p.reserveMeal=!1}}function te(s){_.value=s,m.isDeleteDialogVisible=!0}async function ke(){if(_.value){p.deleteReservedMeal=!0;try{const s=await q(`/food/meal-reservation/${_.value.id}`,{method:"DELETE",onResponseError({response:n}){var M;F(((M=n._data)==null?void 0:M.message)||"خطا در حذف رزرو")}});if(m.hasError)return;m.isDeleteDialogVisible=!1,s!=null&&s.data?V.value==="contractor"?L.value=L.value.filter(n=>n.id!==_.value.id):V.value==="guest"?Q.value=Q.value.filter(n=>n.id!==_.value.id):V.value==="repairman"&&(B.value=B.value.filter(n=>n.id!==_.value.id)):(F("نمیتوان رزرو تحویل شده را حذف کرد"),V.value==="contractor"?ae():V.value==="guest"?pe():V.value==="repairman"&&ye())}catch(s){console.error(s)}finally{p.deleteReservedMeal=!1}}}function K(s){_.value=s,m.isDetailsDialogVisible=!0}async function ae(){L.value=[],p.fetchingReservedMeals=!0;try{const s=await q("/food/meal-reservation/get-for-contractor-on-date",{method:"GET",params:{"date[]":b.value}});L.value=(s.data||[]).flat()}catch(s){console.error("Error fetching reserved meals:",s),F("خطا در دریافت رزروها")}finally{p.fetchingReservedMeals=!1}}async function pe(){Q.value=[],p.fetchingReservedMeals=!0;try{const s=await q("/food/meal-reservation/get-for-guest-on-date",{method:"GET",params:{"date[]":b.value}});Q.value=(s.data||[]).flat()}catch(s){console.error("Error fetching reserved meals:",s),F("خطا در دریافت رزروها")}finally{p.fetchingReservedMeals=!1}}async function ye(){B.value=[],p.fetchingReservedMeals=!0;try{const s=await q("/food/meal-reservation/get-for-repairman-on-date",{method:"GET",params:{"date[]":b.value}});B.value=(s.data||[]).flat()}catch(s){console.error("Error fetching reserved meals:",s),F("خطا در دریافت رزروها")}finally{p.fetchingReservedMeals=!1}}async function Ve(){p.fetchingContractors=!0;try{const s=await q("/contractor/get-actives",{method:"GET"});fe.value=(s==null?void 0:s.data.contractors)||[]}catch(s){console.error("Error fetching contractors:",s),F(s.message||"خطا در دریافت پیمانکاران")}finally{p.fetchingContractors=!1}}async function Me(){p.fetchingMeals=!0;try{const s=await q("/food/meal/get-actives",{method:"GET"});ce.value=(s==null?void 0:s.data.meals)||[]}catch(s){console.error("Error fetching meals:",s),F(s.message||"خطا در دریافت وعده‌ها")}finally{p.fetchingMeals=!1}}function he(){E.value=null,Y.value=null,A.value=null,H.value="deliver",N.value=null,V.value==="contractor"?ae():V.value==="guest"?pe():V.value==="repairman"&&ye()}function ge(s){m.isDetailsDialogVisible=s,s||(_.value=null)}const W=Z(()=>[...L.value].sort((s,n)=>String(s.date).localeCompare(String(n.date)))),X=Z(()=>[...Q.value].sort((s,n)=>String(s.date).localeCompare(String(n.date)))),c=Z(()=>[...B.value].sort((s,n)=>String(s.date).localeCompare(String(n.date))));return ze(async()=>{V.value="contractor",H.value="deliver",await Promise.all([Me(),Ve()]);const s=new Date,n=new Date(s);n.setDate(n.getDate()+30);const[M,u]=[s,n].map(f=>Te.toJalaali(f.getFullYear(),f.getMonth()+1,f.getDate()));se.value=M.jy*1e4+M.jm*100+M.jd;const a=f=>`${f.jy}/${String(f.jm).padStart(2,"0")}/${String(f.jd).padStart(2,"0")}`;b.value=[a(M)],S.value=a(u),await ae()}),(s,n)=>{const M=Ue("PersianDatetimePicker"),u=Fe;return d(),R(G,null,[e(Ee,null,{default:t(()=>[e(we,{modelValue:r(m).hasError,"onUpdate:modelValue":n[0]||(n[0]=a=>r(m).hasError=a),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:t(()=>[i(o(r(m).errorMessage),1)]),_:1},8,["modelValue"]),e(we,{modelValue:r(m).success,"onUpdate:modelValue":n[1]||(n[1]=a=>r(m).success=a),timeout:2e3,location:"center",variant:"flat",color:"success"},{default:t(()=>[i(o(r(m).successMessage),1)]),_:1},8,["modelValue"]),e(P,{dense:""},{default:t(()=>[e(D,{cols:"12",md:"4",class:"d-flex justify-center mb-4 mb-md-0"},{default:t(()=>[n[16]||(n[16]=l("input",{id:"custom-input",style:{display:"none"}},null,-1)),e(M,{modelValue:r(b),"onUpdate:modelValue":n[2]||(n[2]=a=>T(b)?b.value=a:null),format:"jYYYY/jMM/jDD",inline:"",multiple:"",max:r(S),"custom-input":"#custom-input",onChange:he},null,8,["modelValue","max"])]),_:1}),e(D,{cols:"12",md:"8"},{default:t(()=>[e(de,{class:"mb-4"},{default:t(()=>[n[18]||(n[18]=l("label",{class:"font-weight-medium mb-2 mt-2 d-block text-center"}," جزئیات ",-1)),e(P,{class:"mb-4 px-4"},{default:t(()=>[e(D,{cols:"12",sm:"12",md:"12"},{default:t(()=>[e(ne,{"model-value":r(xe),label:"تاریخ رزرو",variant:"outlined",readonly:""},null,8,["model-value"])]),_:1}),e(D,{cols:"12",md:"12"},{default:t(()=>[e(Ae,{modelValue:r(h),"onUpdate:modelValue":n[3]||(n[3]=a=>T(h)?h.value=a:null),items:r(ce),"item-title":"name","item-value":"id",label:"وعده",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),e($e,{modelValue:r(V),"onUpdate:modelValue":n[4]||(n[4]=a=>T(V)?V.value=a:null),class:"mt-2",inline:"",onChange:he},{default:t(()=>[e(ee,{label:"پیمانکار",value:"contractor"}),e(ee,{label:"میهمان",value:"guest"}),e(ee,{label:"تعمیرکار",value:"repairman"})]),_:1},8,["modelValue"]),r(V)==="guest"?(d(),y(D,{key:0,cols:"12",class:"mb-3"},{default:t(()=>[e(ne,{modelValue:r(E),"onUpdate:modelValue":n[5]||(n[5]=a=>T(E)?E.value=a:null),label:"تعداد",type:"number",variant:"outlined"},null,8,["modelValue"]),e(ne,{modelValue:r(A),"onUpdate:modelValue":n[6]||(n[6]=a=>T(A)?A.value=a:null),label:"توضیحات",variant:"outlined"},null,8,["modelValue"]),e($e,{modelValue:r(H),"onUpdate:modelValue":n[7]||(n[7]=a=>T(H)?H.value=a:null),class:"mt-2",inline:"",onChange:n[8]||(n[8]=a=>N.value=null)},{default:t(()=>[e(ee,{label:"سرو در رستوران",value:"serve_in_kitchen"}),e(ee,{label:"تحویل(بیرون‌بر)",value:"deliver"})]),_:1},8,["modelValue"]),r(H)==="serve_in_kitchen"?(d(),y(D,{key:0,cols:"12",md:"12"},{default:t(()=>[e(M,{modelValue:r(N),"onUpdate:modelValue":n[9]||(n[9]=a=>T(N)?N.value=a:null),type:"time",label:"حضور","append-to":"body"},null,8,["modelValue"])]),_:1})):w("",!0)]),_:1})):r(V)==="contractor"?(d(),y(D,{key:1,cols:"12",sm:"12",md:"12"},{default:t(()=>[e(Ge,{modelValue:r(Y),"onUpdate:modelValue":n[10]||(n[10]=a=>T(Y)?Y.value=a:null),items:r(fe),"item-title":"fullName","item-value":"id",label:"پیمانکار",chips:"",clearable:"",variant:"outlined"},null,8,["modelValue","items"]),e(ne,{modelValue:r(E),"onUpdate:modelValue":n[11]||(n[11]=a=>T(E)?E.value=a:null),label:"تعداد",type:"number",variant:"outlined"},null,8,["modelValue"])]),_:1})):r(V)==="repairman"?(d(),y(D,{key:2,cols:"12",class:"mb-3"},{default:t(()=>[e(ne,{modelValue:r(E),"onUpdate:modelValue":n[12]||(n[12]=a=>T(E)?E.value=a:null),label:"تعداد",type:"number",variant:"outlined"},null,8,["modelValue"]),e(ne,{modelValue:r(A),"onUpdate:modelValue":n[13]||(n[13]=a=>T(A)?A.value=a:null),label:"توضیحات",variant:"outlined"},null,8,["modelValue"])]),_:1})):w("",!0)]),_:1}),e(P,{justify:"center",class:"mb-4"},{default:t(()=>[e(D,{cols:"auto"},{default:t(()=>[e(z,{color:"primary",loading:r(p).reserveMeal,disabled:r(p).reserveMeal,onClick:be},{default:t(()=>[...n[17]||(n[17]=[i(" ثبت ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),l("div",Oe,[e(de,{class:"pa-4"},{default:t(()=>[n[23]||(n[23]=l("label",{class:"font-weight-medium mb-4 d-block text-center"}," رزروهای تاریخ‌های انتخاب شده ",-1)),!r(p).fetchingReservedMeals&&r(V)==="contractor"&&r(W).length>0?(d(),y(me,{key:0},{default:t(()=>[n[19]||(n[19]=l("thead",null,[l("tr",null,[l("th",null,"ردیف"),l("th",null,"وعده"),l("th",null,"کد تحویل"),l("th",null,"وضعیت"),l("th",null,"تاریخ"),l("th",null,"پیمانکار"),l("th",null,"تعداد"),l("th",null,"عملیات")])],-1)),l("tbody",null,[(d(!0),R(G,null,J(r(W),(a,f)=>{var g,k;return d(),R("tr",{key:a.id},[l("td",null,o(f+1),1),l("td",null,o((g=a.meal)==null?void 0:g.name),1),l("td",null,[e(v,{color:"success"},{default:t(()=>[i(o(a.delivery_code),1)]),_:2},1024)]),l("td",null,[e(v,{color:a.status?"success":"error",size:"small"},{default:t(()=>[i(o(a.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])]),l("td",null,[e(v,null,{default:t(()=>[i(o(a.date),1)]),_:2},1024)]),l("td",null,[e(v,null,{default:t(()=>{var x,$;return[i(o(($=(x=a.details)==null?void 0:x[0])!=null&&$.contractor?`${a.details[0].contractor.first_name} ${a.details[0].contractor.last_name}`:"—"),1)]}),_:2},1024)]),l("td",null,o((k=a.details)==null?void 0:k.reduce((x,$)=>x+($.quantity||0),0)),1),l("td",null,[a.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:x=>te(a)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:x=>K(a)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])}),128))])]),_:1})):!r(p).fetchingReservedMeals&&r(V)==="guest"&&r(X).length>0?(d(),y(me,{key:1},{default:t(()=>[n[20]||(n[20]=l("thead",null,[l("tr",null,[l("th",null,"ردیف"),l("th",null,"وعده"),l("th",null,"کد تحویل"),l("th",null,"وضعیت"),l("th",null,"تاریخ"),l("th",null,"سرو غذا"),l("th",null,"تعداد"),l("th",null,"عملیات")])],-1)),l("tbody",null,[(d(!0),R(G,null,J(r(X),(a,f)=>{var g,k;return d(),R("tr",{key:a.id},[l("td",null,o(f+1),1),l("td",null,o((g=a.meal)==null?void 0:g.name),1),l("td",null,[e(v,{color:"success"},{default:t(()=>[i(o(a.delivery_code),1)]),_:2},1024)]),l("td",null,[e(v,{color:a.status?"success":"error",size:"small"},{default:t(()=>[i(o(a.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])]),l("td",null,[e(v,null,{default:t(()=>[i(o(a.date),1)]),_:2},1024)]),l("td",null,[e(v,{size:"small"},{default:t(()=>[i(o(a.serve_place==="serve_in_kitchen"?"سرو در رستوران":"تحویل(بیرون‌بر)"),1)]),_:2},1024)]),l("td",null,o((k=a.details)==null?void 0:k.reduce((x,$)=>x+($.quantity||0),0)),1),l("td",null,[a.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:x=>te(a)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:x=>K(a)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])}),128))])]),_:1})):!r(p).fetchingReservedMeals&&r(V)==="repairman"&&r(c).length>0?(d(),y(me,{key:2},{default:t(()=>[n[21]||(n[21]=l("thead",null,[l("tr",null,[l("th",null,"ردیف"),l("th",null,"وعده"),l("th",null,"کد تحویل"),l("th",null,"وضعیت"),l("th",null,"تاریخ"),l("th",null,"تعداد"),l("th",null,"عملیات")])],-1)),l("tbody",null,[(d(!0),R(G,null,J(r(c),(a,f)=>{var g,k;return d(),R("tr",{key:a.id},[l("td",null,o(f+1),1),l("td",null,o((g=a.meal)==null?void 0:g.name),1),l("td",null,[e(v,{color:"success"},{default:t(()=>[i(o(a.delivery_code),1)]),_:2},1024)]),l("td",null,[e(v,{color:a.status?"success":"error",size:"small"},{default:t(()=>[i(o(a.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])]),l("td",null,[e(v,null,{default:t(()=>[i(o(a.date),1)]),_:2},1024)]),l("td",null,o((k=a.details)==null?void 0:k.reduce((x,$)=>x+($.quantity||0),0)),1),l("td",null,[a.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:x=>te(a)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:x=>K(a)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])}),128))])]),_:1})):r(p).fetchingReservedMeals?(d(),y(Re,{key:3,type:"card"})):(d(),R("div",Ke,[e(v,{color:"error"},{default:t(()=>[...n[22]||(n[22]=[i(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))]),_:1})]),l("div",Le,[e(oe,{variant:"accordion"},{default:t(()=>[e(ue,null,{default:t(()=>[e(ie,{class:"font-weight-bold"},{default:t(()=>[...n[24]||(n[24]=[i(" رزروهای تاریخ‌های انتخاب شده ",-1)])]),_:1}),!r(p).fetchingReservedMeals&&r(V)==="contractor"&&r(W).length>0?(d(),y(I,{key:0},{default:t(()=>[e(oe,{variant:"accordion"},{default:t(()=>[(d(!0),R(G,null,J(r(W),a=>(d(),y(ue,{key:a.id,class:"mb-2"},{default:t(()=>[e(ie,null,{default:t(()=>{var f;return[l("div",Je,[l("div",He,[l("span",Ie,o((f=a.meal)==null?void 0:f.name),1),e(v,{size:"small"},{default:t(()=>[i(o(a.date),1)]),_:2},1024)]),l("div",Qe,[e(v,{color:"success"},{default:t(()=>[i(o(a.delivery_code),1)]),_:2},1024),e(v,{color:a.status?"success":"error",size:"small",label:""},{default:t(()=>[i(o(a.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])]),l("div",We,[e(v,null,{default:t(()=>{var g,k;return[i(o((k=(g=a.details)==null?void 0:g[0])!=null&&k.contractor?`${a.details[0].contractor.first_name} ${a.details[0].contractor.last_name}`:"—"),1)]}),_:2},1024)])])]}),_:2},1024),e(I,null,{default:t(()=>{var f;return[l("div",Xe,[l("div",null,[n[25]||(n[25]=l("strong",null,"تعداد:",-1)),i(" "+o((f=a.details)==null?void 0:f.reduce((g,k)=>g+(k.quantity||0),0)),1)]),l("div",Ze,[a.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:g=>te(a)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:g=>K(a)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):!r(p).fetchingReservedMeals&&r(V)==="guest"&&r(X).length>0?(d(),y(I,{key:1},{default:t(()=>[e(oe,{variant:"accordion"},{default:t(()=>[(d(!0),R(G,null,J(r(X),a=>(d(),y(ue,{key:a.id,class:"mb-2"},{default:t(()=>[e(ie,null,{default:t(()=>{var f;return[l("div",el,[l("div",ll,[l("span",tl,o((f=a.meal)==null?void 0:f.name),1),e(v,{size:"small"},{default:t(()=>[i(o(a.date),1)]),_:2},1024)]),l("div",al,[e(v,{color:"success"},{default:t(()=>[i(o(a.delivery_code),1)]),_:2},1024),e(v,{color:a.status?"success":"error",size:"small",label:""},{default:t(()=>[i(o(a.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])])])]}),_:2},1024),e(I,null,{default:t(()=>{var f;return[l("div",sl,[l("div",null,[n[26]||(n[26]=l("strong",null,"سرو غذا:",-1)),e(v,{size:"small"},{default:t(()=>[i(o(a.serve_place==="serve_in_kitchen"?"سرو در رستوران":"تحویل(بیرون‌بر)"),1)]),_:2},1024)]),l("div",null,[n[27]||(n[27]=l("strong",null,"تعداد:",-1)),i(" "+o((f=a.details)==null?void 0:f.reduce((g,k)=>g+(k.quantity||0),0)),1)]),l("div",rl,[n[28]||(n[28]=l("strong",{class:"me-2"},"توضیحات:",-1)),l("div",nl,o(a.description||"—"),1)]),l("div",ol,[a.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:g=>te(a)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:g=>K(a)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):!r(p).fetchingReservedMeals&&r(V)==="repairman"&&r(c).length>0?(d(),y(I,{key:2},{default:t(()=>[e(oe,{variant:"accordion"},{default:t(()=>[(d(!0),R(G,null,J(r(c),a=>(d(),y(ue,{key:a.id,class:"mb-2"},{default:t(()=>[e(ie,null,{default:t(()=>{var f;return[l("div",ul,[l("div",il,[l("span",dl,o((f=a.meal)==null?void 0:f.name),1),e(v,{size:"small"},{default:t(()=>[i(o(a.date),1)]),_:2},1024)]),l("div",cl,[e(v,{color:"success"},{default:t(()=>[i(o(a.delivery_code),1)]),_:2},1024),e(v,{color:a.status?"success":"error",size:"small",label:""},{default:t(()=>[i(o(a.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])])])]}),_:2},1024),e(I,null,{default:t(()=>{var f;return[l("div",fl,[l("div",null,[n[29]||(n[29]=l("strong",null,"تعداد:",-1)),i(" "+o((f=a.details)==null?void 0:f.reduce((g,k)=>g+(k.quantity||0),0)),1)]),l("div",vl,[n[30]||(n[30]=l("strong",{class:"me-2"},"توضیحات:",-1)),l("div",ml,o(a.description||"—"),1)]),l("div",pl,[a.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:g=>te(a)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:g=>K(a)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):r(p).fetchingReservedMeals?(d(),y(Re,{key:3,type:"card"})):(d(),R("div",yl,[e(v,{color:"error"},{default:t(()=>[...n[31]||(n[31]=[i(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),r(m).isDeleteDialogVisible?(d(),y(Ye,{key:0,"is-dialog-visible":r(m).isDeleteDialogVisible,"onUpdate:isDialogVisible":n[14]||(n[14]=a=>r(m).isDeleteDialogVisible=a),title:"آیا از حذف این رزرو اطمینان دارید؟",loading:r(p).deleteReservedMeal,onConfirm:ke},null,8,["is-dialog-visible","loading"])):w("",!0),r(_)?(d(),y(Be,{key:1,width:s.$vuetify.display.smAndDown?"auto":900,"model-value":r(m).isDetailsDialogVisible,"onUpdate:modelValue":ge},{default:t(()=>[e(u,{onClick:n[15]||(n[15]=a=>ge(!1))}),e(de,null,{default:t(()=>[e(Pe,{class:"text-h6"},{default:t(()=>[...n[32]||(n[32]=[i(" جزئیات ",-1)])]),_:1}),e(qe,null,{default:t(()=>[e(P,null,{default:t(()=>[e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[33]||(n[33]=l("strong",null,"رزرو کننده:",-1)),e(v,{color:"orange",size:"small"},{default:t(()=>[i(o(r(_).created_by?`${r(_).created_by.first_name} ${r(_).created_by.last_name}`:"—"),1)]),_:1})])]),_:1}),e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[34]||(n[34]=l("strong",null,"کد پرسنلی:",-1)),e(v,{color:"orange",size:"small"},{default:t(()=>[i(o(r(_).created_by?`${r(_).created_by.personnel_code}`:"—"),1)]),_:1})])]),_:1})]),_:1}),e(le,{class:"my-3"}),e(P,null,{default:t(()=>{var a,f;return[e(D,{cols:"12",sm:"6"},{default:t(()=>[n[35]||(n[35]=l("strong",null,"کد تحویل:",-1)),e(v,{color:"primary",size:"small"},{default:t(()=>[i(o(r(_).delivery_code),1)]),_:1})]),_:1}),e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[36]||(n[36]=l("strong",null,"وعده:",-1)),e(v,{color:"primary",size:"small"},{default:t(()=>{var g;return[i(o((g=r(_).meal)==null?void 0:g.name),1)]}),_:1})])]),_:1}),e(le,{class:"my-3"}),e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[37]||(n[37]=l("strong",null,"نوع رزرو:",-1)),e(v,{color:"cyan",size:"small"},{default:t(()=>[i(o({contractor:"پیمانکار",guest:"مهمان",repairman:"تعمیرکار"}[r(_).reserve_type]||""),1)]),_:1})])]),_:1}),(f=(a=r(_).details)==null?void 0:a[0])!=null&&f.contractor?(d(),y(D,{key:0,cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[38]||(n[38]=l("strong",null,"پیمانکار:",-1)),e(v,{color:"cyan",size:"small"},{default:t(()=>[i(o(`${r(_).details[0].contractor.first_name} ${r(_).details[0].contractor.last_name}`),1)]),_:1})])]),_:1})):w("",!0),r(_).reserve_type==="guest"?(d(),y(D,{key:1,cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[39]||(n[39]=l("strong",null,"نوع سرو:",-1)),e(v,{color:"cyan",size:"small"},{default:t(()=>[i(o({serve_in_kitchen:"سرو در رستوران",deliver:"تحویل(بیرون‌بر)"}[r(_).serve_place]||""),1)]),_:1}),r(_).serve_place==="serve_in_kitchen"?(d(),y(v,{key:0,size:"small"},{default:t(()=>[i(" ساعت حضور: "+o(r(_).attendance_hour),1)]),_:1})):w("",!0)])]),_:1})):w("",!0)]}),_:1}),e(le,{class:"my-3"}),e(P,null,{default:t(()=>[e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[40]||(n[40]=l("strong",null,"وضعیت:",-1)),e(v,{color:r(_).status?"success":"error",size:"small"},{default:t(()=>[i(o(r(_).status?"تحویل شده":"تحویل نشده"),1)]),_:1},8,["color"])])]),_:1}),e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[n[41]||(n[41]=l("strong",null,"تعداد:",-1)),e(v,{size:"small"},{default:t(()=>{var a;return[i(o((a=r(_).details)==null?void 0:a.reduce((f,g)=>f+(g.quantity||0),0)),1)]}),_:1})])]),_:1})]),_:1}),e(le,{class:"my-3"}),e(P,null,{default:t(()=>[r(_).description?(d(),y(D,{key:0,cols:"12",sm:"12"},{default:t(()=>[l("p",gl,[n[42]||(n[42]=l("strong",null,"توضیحات:",-1)),i(" "+o(r(_).description),1)])]),_:1})):w("",!0)]),_:1}),e(le,{class:"my-3"})]),_:1})]),_:1})]),_:1},8,["width","model-value"])):w("",!0)],64)}}},bl={class:"ma-3 overflow-auto d-none d-md-block"},kl={key:4,class:"text-center"},Vl={class:"d-md-none pa-3"},Ml={class:"d-flex justify-space-between w-100 align-center"},hl={class:"pa-2"},Dl={class:"mt-2 text-center"},Cl={class:"d-flex justify-space-between w-100 align-center"},wl={class:"pa-2"},$l={key:4,class:"text-center"},Rl={key:0},xl={key:1},zl={key:0},El={key:1},jl={__name:"ReservationForPersonnel",setup(je){const m=Ce({success:!1,successMessage:"",hasError:!1,errorMessage:"",isDeleteDialogVisible:!1,isDetailsDialogVisible:!1}),p=Ce({fetchingReservedMeals:!0,fetchingMeals:!1,reserveMeal:!1,deleteReservedMeal:!1}),b=C([]),S=C(""),se=C(null),ce=C([]),fe=C([]),L=C([]),Q=C([]),B=C([]),Y=C(null),h=C(null),_=C(null),E=De("userData"),A=Z(()=>!!ve("use","reserve-food")),H=Z(()=>{const c=b.value;return(Array.isArray(c)?c:c?[c]:[]).filter(Boolean).join("|")}),N=C(!1),V=Z(()=>!b.value||b.value.length===0?"":Array.isArray(b.value)?b.value.join(" - "):b.value);function xe(){return Array.isArray(b.value)?b.value.filter(Boolean):b.value?[b.value]:[]}function U(c){m.hasError=!0,m.errorMessage=c}async function F(){var n,M,u;const c=xe();if(!c.length){U("لطفاً حداقل یک تاریخ برای رزرو انتخاب کنید.");return}if(!Y.value)return U("لطفاً وعده را انتخاب کنید.");if(!((n=B.value)!=null&&n.length))return U("لطفاً حداقل یک نفر را انتخاب کنید.");for(const a of c){const[f,g,k]=String(a).split("/").map(Number);if(f*1e4+g*100+k<se.value){U("امکان رزرو غذا فقط برای زمان حال و آینده وجود دارد.");return}}p.reserveMeal=!0;const s={date:b.value,meal_id:Y.value,reserve_type:"personnel",supervisor_id:(u=(M=De("userData"))==null?void 0:M.value)==null?void 0:u.id,personnel:B.value};try{const a=await q("/food/meal-reservation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),onResponseError({response:$}){var O,re;if(m.hasError=!0,(O=$._data)!=null&&O.errors){const _e=Object.values($._data.errors).flat().join(" | ");m.errorMessage=_e}else m.errorMessage=((re=$._data)==null?void 0:re.message)||"خطا در ایجاد"}}),f=((a==null?void 0:a.data)||[]).flatMap($=>($==null?void 0:$.skippedPersonnel)||[]),g=((a==null?void 0:a.data)||[]).reduce(($,O)=>$+((O==null?void 0:O.createdPersonnel)||[]).length,0),k=new Map;for(const $ of f){const O=$==null?void 0:$.full_name,re=$==null?void 0:$.date;if(!O||!re)continue;const _e=String(re).replaceAll("\\/","/");k.has(O)||k.set(O,new Set),k.get(O).add(_e)}const x=Array.from(k.entries()).map(([$,O])=>{const re=Array.from(O).sort((_e,Ne)=>_e.localeCompare(Ne));return`برای ${$}: در: ${re.join(" و ")}`});x.length?U(g===0?`هیچ رزروی ایجاد نشد. ${x.join(" | ")}  - رزرو وجود دارد`:`برای بعضی از پرسنل رزرو انجام نشد: ${x.join(" | ")} - رزرو وجود دارد`):(m.success=!0,m.successMessage=(a==null?void 0:a.message)||"رزرو با موفقیت انجام شد."),_.value==="byYou"?K():ae(),B.value=[],Y.value=null}catch(a){console.error("Error submitting reservation:",a)}finally{p.reserveMeal=!1}}function be(c){h.value=c,m.isDeleteDialogVisible=!0}async function te(){if(h.value){p.deleteReservedMeal=!0;try{const c=await q(`/food/meal-reservation/${h.value.id}`,{method:"DELETE",onResponseError({response:s}){var n;U(((n=s._data)==null?void 0:n.message)||"خطا در حذف رزرو")}});if(m.hasError)return;m.isDeleteDialogVisible=!1,c!=null&&c.data?L.value=L.value.filter(s=>s.id!==h.value.id):(U("نمیتوان رزرو تحویل شده را حذف کرد"),K())}catch(c){console.error(c)}finally{p.deleteReservedMeal=!1}}}function ke(c){h.value=c,m.isDetailsDialogVisible=!0}async function K(){L.value=[],p.fetchingReservedMeals=!0;try{const c=await q("/food/meal-reservation/get-for-personnel-by-user-on-date",{method:"GET",params:{"date[]":b.value}});L.value=(c.data||[]).flat()}catch(c){console.error("Error fetching reserved meals:",c),U("خطا در دریافت رزروها")}finally{p.fetchingReservedMeals=!1}}async function ae(){Q.value=[],p.fetchingReservedMeals=!0;try{const c=await q("/food/meal-reservation/get-for-user-by-others-on-date",{method:"GET",params:{"date[]":b.value}});Q.value=(c.data||[]).flat()}catch(c){console.error("Error fetching reserved meals:",c),U("خطا در دریافت رزروها")}finally{p.fetchingReservedMeals=!1}}async function pe(){var c,s;try{const{data:n}=await q("/base/org-chart-node/user-subordinates",{method:"GET",params:{user_id:(s=(c=De("userData"))==null?void 0:c.value)==null?void 0:s.id}});ce.value=(n||[]).flat()}catch(n){console.error("Unexpected error fetching users:",n),U("خطای غیرمنتظره در دریافت کاربران")}}async function ye(){p.fetchingMeals=!0;try{const c=await q("/food/meal/get-actives",{method:"GET"});fe.value=(c==null?void 0:c.data.meals)||[]}catch(c){console.error("Error fetching meals:",c),U(c.message||"خطا در دریافت وعده‌ها")}finally{p.fetchingMeals=!1}}function Ve(){_.value==="byYou"?K():ae()}function Me(c){m.isDetailsDialogVisible=c,c||(h.value=null)}async function he(c){try{const s=await q(`/food/meal-reservation-detail/${c}`,{method:"DELETE",onResponseError({response:n}){var M;U(((M=n._data)==null?void 0:M.message)||"خطا در حذف")}});s!=null&&s.data?h.value.details=h.value.details.filter(n=>n.id!==c):(U("نمیتوان پرسنل رزرو تحویل شده را حذف کرد"),m.isDetailsDialogVisible=!1,K())}catch(s){console.error(s)}}Se(()=>{var c;return[(c=E.value)==null?void 0:c.id,A.value]},async([c,s])=>{if(c){if(!s){N.value=!1,ce.value=[],fe.value=[],B.value=[],Y.value=null;return}N.value||(N.value=!0,await Promise.all([ye(),pe()]))}},{immediate:!0});let ge="";Se(()=>{var c;return[(c=E.value)==null?void 0:c.id,A.value,H.value]},async([c,s,n])=>{if(!c||!n)return;const M=`${c}|${s}|${n}`;M!==ge&&(ge=M,_.value=s?"byYou":"forYou",s?await K():await ae())},{immediate:!0});const W=Z(()=>[...L.value].sort((c,s)=>String(c.date).localeCompare(String(s.date)))),X=Z(()=>[...Q.value].sort((c,s)=>{var n,M;return String(((n=c.reservation)==null?void 0:n.date)||"").localeCompare(String(((M=s.reservation)==null?void 0:M.date)||""))}));return ze(async()=>{const c=new Date,s=new Date(c);s.setDate(s.getDate()+30);const[n,M]=[c,s].map(a=>Te.toJalaali(a.getFullYear(),a.getMonth()+1,a.getDate()));se.value=n.jy*1e4+n.jm*100+n.jd;const u=a=>`${a.jy}/${String(a.jm).padStart(2,"0")}/${String(a.jd).padStart(2,"0")}`;b.value=[u(n)],S.value=u(M)}),(c,s)=>{const n=Ue("PersianDatetimePicker"),M=Fe;return d(),R(G,null,[e(Ee,null,{default:t(()=>[e(we,{modelValue:r(m).hasError,"onUpdate:modelValue":s[0]||(s[0]=u=>r(m).hasError=u),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:t(()=>[i(o(r(m).errorMessage),1)]),_:1},8,["modelValue"]),e(we,{modelValue:r(m).success,"onUpdate:modelValue":s[1]||(s[1]=u=>r(m).success=u),timeout:2e3,location:"center",variant:"flat",color:"success"},{default:t(()=>[i(o(r(m).successMessage),1)]),_:1},8,["modelValue"]),e(P,{dense:""},{default:t(()=>[e(D,{cols:"12",md:"4",class:"d-flex justify-center mb-4 mb-md-0"},{default:t(()=>[s[9]||(s[9]=l("input",{id:"custom-input",style:{display:"none"}},null,-1)),e(n,{modelValue:r(b),"onUpdate:modelValue":s[2]||(s[2]=u=>T(b)?b.value=u:null),format:"jYYYY/jMM/jDD",inline:"",multiple:"",max:r(S),"custom-input":"#custom-input"},null,8,["modelValue","max"])]),_:1}),e(D,{cols:"12",md:"8"},{default:t(()=>[r(ve)("read","Reserve-Meal")?(d(),y(de,{key:0,class:"mb-4"},{default:t(()=>[s[11]||(s[11]=l("label",{class:"font-weight-medium mb-2 mt-2 d-block text-center"}," جزئیات ",-1)),e(P,{class:"mb-4 px-4"},{default:t(()=>[e(D,{cols:"12",sm:"12",md:"12"},{default:t(()=>[e(ne,{"model-value":r(V),label:"تاریخ رزرو",variant:"outlined",readonly:""},null,8,["model-value"])]),_:1}),e(D,{cols:"12",md:"12"},{default:t(()=>[e(Ae,{modelValue:r(Y),"onUpdate:modelValue":s[3]||(s[3]=u=>T(Y)?Y.value=u:null),items:r(fe),"item-title":"name","item-value":"id",label:"وعده",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),e(D,{cols:"12",class:"mb-3"},{default:t(()=>[e(Ge,{modelValue:r(B),"onUpdate:modelValue":s[4]||(s[4]=u=>T(B)?B.value=u:null),items:r(ce),"item-title":u=>`${u.first_name} ${u.last_name} - ${u.personnel_code}`,"item-value":"id",label:"افراد",multiple:"",chips:"",clearable:"",variant:"outlined"},null,8,["modelValue","items","item-title"])]),_:1})]),_:1}),e(P,{justify:"center",class:"mb-4"},{default:t(()=>[e(D,{cols:"auto"},{default:t(()=>[e(z,{color:"primary",loading:r(p).reserveMeal,disabled:r(p).reserveMeal,onClick:F},{default:t(()=>[...s[10]||(s[10]=[i(" ثبت ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})):w("",!0),l("div",bl,[e(de,{class:"pa-4"},{default:t(()=>[s[15]||(s[15]=l("label",{class:"font-weight-medium mb-4 d-block text-center"}," رزروهای تاریخ‌های انتخاب شده ",-1)),r(ve)("read","Reserve-Meal")?(d(),y($e,{key:0,modelValue:r(_),"onUpdate:modelValue":s[5]||(s[5]=u=>T(_)?_.value=u:null),class:"mt-2",inline:"",onChange:Ve},{default:t(()=>[e(ee,{label:"توسط شما",value:"byYou"}),e(ee,{label:"برای شما",value:"forYou"})]),_:1},8,["modelValue"])):w("",!0),!r(p).fetchingReservedMeals&&r(_)==="byYou"&&r(W).length>0?(d(),y(me,{key:1},{default:t(()=>[s[12]||(s[12]=l("thead",null,[l("tr",null,[l("th",null,"ردیف"),l("th",null,"وعده"),l("th",null,"کد تحویل"),l("th",null,"وضعیت"),l("th",null,"تاریخ"),l("th",null,"تعداد"),l("th",null,"عملیات")])],-1)),l("tbody",null,[(d(!0),R(G,null,J(r(W),(u,a)=>{var f,g;return d(),R("tr",{key:u.id},[l("td",null,o(a+1),1),l("td",null,o((f=u.meal)==null?void 0:f.name),1),l("td",null,[e(v,{color:"success"},{default:t(()=>[i(o(u.delivery_code),1)]),_:2},1024)]),l("td",null,[e(v,{color:u.status?"success":"error",size:"small"},{default:t(()=>[i(o(u.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])]),l("td",null,[e(v,null,{default:t(()=>[i(o(u.date),1)]),_:2},1024)]),l("td",null,o((g=u.details)==null?void 0:g.reduce((k,x)=>k+(x.quantity||0),0)),1),l("td",null,[u.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:k=>be(u)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:k=>ke(u)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])}),128))])]),_:1})):!r(p).fetchingReservedMeals&&r(_)==="forYou"&&r(X).length>0?(d(),y(me,{key:2},{default:t(()=>[s[13]||(s[13]=l("thead",null,[l("tr",null,[l("th",null,"ردیف"),l("th",null,"وعده"),l("th",null,"تاریخ"),l("th",null,"رزرو شده توسط"),l("th",null,"کد پرسنلی"),l("th",null,"وضعیت")])],-1)),l("tbody",null,[(d(!0),R(G,null,J(r(X),(u,a)=>(d(),R("tr",{key:a},[l("td",null,o(a+1),1),l("td",null,o(u.reservation.mealName),1),l("td",null,[e(v,null,{default:t(()=>[i(o(u.reservation.date),1)]),_:2},1024)]),l("td",null,[e(v,{color:"primary"},{default:t(()=>[i(o(u.createdBy),1)]),_:2},1024)]),l("td",null,[e(v,null,{default:t(()=>[i(o(u.personnelCode),1)]),_:2},1024)]),l("td",null,[e(v,{color:u.deliveryStatus?"success":"error",size:"small"},{default:t(()=>[i(o(u.deliveryStatus?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])])]))),128))])]),_:1})):r(p).fetchingReservedMeals?(d(),y(Re,{key:3,type:"card"})):(d(),R("div",kl,[e(v,{color:"error"},{default:t(()=>[...s[14]||(s[14]=[i(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))]),_:1})]),l("div",Vl,[e(oe,{variant:"accordion"},{default:t(()=>[e(ue,null,{default:t(()=>[e(ie,{class:"font-weight-bold"},{default:t(()=>[...s[16]||(s[16]=[i(" رزروهای تاریخ‌های انتخاب شده ",-1)])]),_:1}),r(ve)("read","Reserve-Meal")?(d(),y($e,{key:0,modelValue:r(_),"onUpdate:modelValue":s[6]||(s[6]=u=>T(_)?_.value=u:null),class:"mt-2",inline:"",onChange:Ve},{default:t(()=>[e(ee,{label:"توسط شما",value:"byYou"}),e(ee,{label:"برای شما",value:"forYou"})]),_:1},8,["modelValue"])):w("",!0),!r(p).fetchingReservedMeals&&r(_)==="byYou"&&r(W).length>0?(d(),y(I,{key:1},{default:t(()=>[e(oe,{variant:"accordion"},{default:t(()=>[(d(!0),R(G,null,J(r(W),u=>(d(),y(ue,{key:u.id,class:"mb-2"},{default:t(()=>[e(ie,null,{default:t(()=>{var a;return[l("div",Ml,[l("span",null,o((a=u.meal)==null?void 0:a.name),1),e(v,{color:u.status?"success":"error",size:"small",label:""},{default:t(()=>[i(o(u.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])])]}),_:2},1024),e(I,null,{default:t(()=>{var a;return[l("div",hl,[l("div",null,[s[17]||(s[17]=l("strong",null,"کد تحویل:",-1)),e(v,{color:"success"},{default:t(()=>[i(o(u.delivery_code),1)]),_:2},1024)]),l("div",null,[s[18]||(s[18]=l("strong",null,"تاریخ:",-1)),e(v,null,{default:t(()=>[i(o(u.date),1)]),_:2},1024)]),l("div",null,[s[19]||(s[19]=l("strong",null,"تعداد:",-1)),i(" "+o((a=u.details)==null?void 0:a.reduce((f,g)=>f+(g.quantity||0),0)),1)]),l("div",Dl,[u.status?w("",!0):(d(),y(z,{key:0,color:"red",variant:"plain",size:"small",onClick:f=>be(u)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])),e(z,{color:"primary",variant:"plain",size:"small",onClick:f=>ke(u)},{default:t(()=>[e(j,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):!r(p).fetchingReservedMeals&&r(_)==="forYou"&&r(X).length>0?(d(),y(I,{key:2},{default:t(()=>[e(oe,{variant:"accordion"},{default:t(()=>[(d(!0),R(G,null,J(r(X),(u,a)=>(d(),y(ue,{key:a,class:"mb-2"},{default:t(()=>[e(ie,null,{default:t(()=>[l("div",Cl,[l("span",null,o(u.reservation.mealName),1),e(v,{color:u.deliveryStatus?"success":"error",size:"small"},{default:t(()=>[i(o(u.deliveryStatus?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])])]),_:2},1024),e(I,null,{default:t(()=>[l("div",wl,[l("div",null,[s[20]||(s[20]=l("strong",null,"تاریخ:",-1)),e(v,null,{default:t(()=>[i(o(u.reservation.date),1)]),_:2},1024)]),l("div",null,[s[21]||(s[21]=l("strong",null,"رزرو شده توسط:",-1)),e(v,{color:"primary"},{default:t(()=>[i(o(u.createdBy),1)]),_:2},1024)]),l("div",null,[s[22]||(s[22]=l("strong",null,"کد پرسنلی:",-1)),e(v,{color:"primary"},{default:t(()=>[i(o(u.personnelCode),1)]),_:2},1024)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):r(p).fetchingReservedMeals?(d(),y(Re,{key:3,type:"card"})):(d(),R("div",$l,[e(v,{color:"error"},{default:t(()=>[...s[23]||(s[23]=[i(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),r(m).isDeleteDialogVisible?(d(),y(Ye,{key:0,"is-dialog-visible":r(m).isDeleteDialogVisible,"onUpdate:isDialogVisible":s[7]||(s[7]=u=>r(m).isDeleteDialogVisible=u),title:"آیا از حذف این رزرو اطمینان دارید؟",loading:r(p).deleteReservedMeal,onConfirm:te},null,8,["is-dialog-visible","loading"])):w("",!0),r(h)?(d(),y(Be,{key:1,width:c.$vuetify.display.smAndDown?"auto":900,"model-value":r(m).isDetailsDialogVisible,"onUpdate:modelValue":Me},{default:t(()=>[e(M,{onClick:s[8]||(s[8]=u=>Me(!1))}),e(de,null,{default:t(()=>[e(Pe,{class:"text-h6"},{default:t(()=>[...s[24]||(s[24]=[i(" جزئیات ",-1)])]),_:1}),e(qe,null,{default:t(()=>[e(P,null,{default:t(()=>[e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[s[25]||(s[25]=l("strong",null,"رزرو کننده:",-1)),e(v,{color:"orange",size:"small"},{default:t(()=>[i(o(r(h).created_by?`${r(h).created_by.first_name} ${r(h).created_by.last_name}`:"—"),1)]),_:1})])]),_:1}),e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[s[26]||(s[26]=l("strong",null,"کد پرسنلی:",-1)),e(v,{color:"orange",size:"small"},{default:t(()=>[i(o(r(h).created_by?`${r(h).created_by.personnel_code}`:"—"),1)]),_:1})])]),_:1})]),_:1}),e(le,{class:"my-3"}),e(P,null,{default:t(()=>[e(D,{cols:"12",sm:"6"},{default:t(()=>[s[27]||(s[27]=l("strong",null,"کد تحویل:",-1)),e(v,{color:"primary",size:"small"},{default:t(()=>[i(o(r(h).delivery_code),1)]),_:1})]),_:1}),e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[s[28]||(s[28]=l("strong",null,"وعده:",-1)),e(v,{color:"primary",size:"small"},{default:t(()=>{var u;return[i(o((u=r(h).meal)==null?void 0:u.name),1)]}),_:1})])]),_:1})]),_:1}),e(le,{class:"my-3"}),e(P,null,{default:t(()=>[e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[s[29]||(s[29]=l("strong",null,"وضعیت:",-1)),e(v,{color:r(h).status?"success":"error",size:"small"},{default:t(()=>[i(o(r(h).status?"تحویل شده":"تحویل نشده"),1)]),_:1},8,["color"])])]),_:1}),e(D,{cols:"12",sm:"6"},{default:t(()=>[l("p",null,[s[30]||(s[30]=l("strong",null,"تعداد:",-1)),e(v,{size:"small"},{default:t(()=>{var u;return[i(o((u=r(h).details)==null?void 0:u.reduce((a,f)=>a+(f.quantity||0),0)),1)]}),_:1})])]),_:1})]),_:1}),e(le,{class:"my-3"}),l("div",null,[e(me,{density:"comfortable"},{default:t(()=>{var u;return[l("thead",null,[l("tr",null,[s[31]||(s[31]=l("th",null,"ردیف",-1)),s[32]||(s[32]=l("th",null,"نام",-1)),s[33]||(s[33]=l("th",null,"کد پرسنلی",-1)),!r(h).status&&(((u=r(h).details)==null?void 0:u.reduce((a,f)=>a+(f.quantity||0),0))||0)>1?(d(),R("th",Rl," عملیات ")):w("",!0),r(h).status?(d(),R("th",xl," وضعیت ")):w("",!0)])]),l("tbody",null,[(d(!0),R(G,null,J((r(h).details||[]).filter(a=>a.personnel),(a,f)=>{var g;return d(),R("tr",{key:a.id},[l("td",null,o(f+1),1),l("td",null,[e(v,null,{default:t(()=>[i(o(`${a.personnel.first_name} ${a.personnel.last_name}`),1)]),_:2},1024)]),l("td",null,[e(v,null,{default:t(()=>[i(o(a.personnel.personnel_code),1)]),_:2},1024)]),!r(h).status&&(((g=r(h).details)==null?void 0:g.reduce((k,x)=>k+(x.quantity||0),0))||0)>1?(d(),R("td",zl,[e(z,{color:"red",variant:"text",size:"small",onClick:k=>he(a.id)},{default:t(()=>[e(j,{icon:"tabler-trash",size:"20"})]),_:1},8,["onClick"])])):w("",!0),r(h).status?(d(),R("td",El,[e(v,{color:a.delivery_status?"success":"error",size:"small"},{default:t(()=>[i(o(a.delivery_status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])])):w("",!0)])}),128))])]}),_:1})]),e(le,{class:"my-3"})]),_:1})]),_:1})]),_:1},8,["width","model-value"])):w("",!0)],64)}}},ft={__name:"food-reservation",setup(je){const m=C(!0),p=C(!1);return ze(()=>{m.value=!0,p.value=!1}),(b,S)=>(d(),y(Ee,null,{default:t(()=>[e(P,{dense:""},{default:t(()=>[e(D,{cols:"12"},{default:t(()=>[e(de,{class:"mb-4 pa-8 text-center"},{default:t(()=>[e(P,{align:"center",justify:"center",class:"gap-4"},{default:t(()=>[r(ve)("read","Reserve-Food")?(d(),R(G,{key:0},[e(z,{density:"default",onClick:S[0]||(S[0]=se=>{m.value=!0,p.value=!1})},{default:t(()=>[...S[2]||(S[2]=[i(" پرسنل ",-1)])]),_:1}),e(z,{density:"default",onClick:S[1]||(S[1]=se=>{m.value=!1,p.value=!0})},{default:t(()=>[...S[3]||(S[3]=[i(" پیمانکار - مهمان - تعمیرکار ",-1)])]),_:1})],64)):w("",!0),r(ve)("read","Reserve-Food")?w("",!0):(d(),y(D,{key:1,cols:"auto"},{default:t(()=>[...S[4]||(S[4]=[l("div",{class:"text-h6 font-weight-bold text-primary-darken-3"}," رزرو شده برای شما ",-1)])]),_:1}))]),_:1})]),_:1})]),_:1}),m.value&&!p.value?(d(),y(jl,{key:0})):w("",!0),!m.value&&p.value?(d(),y(_l,{key:1})):w("",!0)]),_:1})]),_:1}))}};export{ft as default};
