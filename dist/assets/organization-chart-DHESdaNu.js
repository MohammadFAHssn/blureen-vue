import{u as G}from"./useAGGridTheme-Eu4N0l_n.js";import{u as C}from"./useApi-C0ILP3ma.js";import{c as V}from"./createUrl-CBlVGuLg.js";import{M as A,bK as x,r as s,a7 as S,bL as D,a as j,f as z,o as E,e as _,b as h,d as R,n as a,v as M,x as P}from"./index-BWe5EvMo.js";import{V as B}from"./VSnackbar-B-HVwLa1.js";import{V as F}from"./VLayout-Wv7ISQcm.js";import"./useLogout-CYcQlWMK.js";import"./VOverlay-C-gzr661.js";const U={style:{"block-size":"100%"}},I={__name:"organization-chart",async setup(L){let n,c;const i=x({hasError:!1,errorMessage:""}),u=s([]),l=S(null);s([]);const{theme:g}=G();function v(o){l.value=o.api,l.value.setGridOption("rowData",d())}const b=s([{headerName:"محل کار",field:"workplace",rowGroup:!0,hide:!0},{headerName:"منطقه کاری",field:"workArea",rowGroup:!0,hide:!0},{headerName:"مرکز هزینه",field:"costCenter",valueFormatter:o=>{var e;return(e=o.value)==null?void 0:e.name},rowGroup:!0,hide:!0},{headerName:"سمت شغلی",field:"jobPosition",valueFormatter:o=>{var e;return(e=o.value)==null?void 0:e.name},rowGroup:!0,hide:!0},{headerName:"کد پرسنلی",field:"personnelCode"},{headerName:"نام",field:"firstName"},{headerName:"نام خانوادگی",field:"lastName"}]),N=s({mode:"multiRow",enableClickSelection:!0,selectAll:"filtered",isRowSelectable:o=>o.field==="jobPosition"});function d(){var o;return(o=u.value)==null?void 0:o.map(e=>{var r,t,m,p,f,w;return{id:e.id,personnelCode:Number.parseInt(e.personnel_code),firstName:e.first_name,lastName:e.last_name,workplace:(t=(r=e.profile)==null?void 0:r.workplace)==null?void 0:t.name,workArea:(p=(m=e.profile)==null?void 0:m.work_area)==null?void 0:p.name,costCenter:(f=e.profile)==null?void 0:f.cost_center,jobPosition:(w=e.profile)==null?void 0:w.job_position}})}const k=s({filter:"agGroupColumnFilter"});async function y(){var o;try{const{data:e,error:r}=await C(V("/base/user",{query:{"fields[users]":"id,first_name,last_name,personnel_code","filter[active]":"1",include:"profile.workplace,profile.workArea,profile.costCenter,profile.jobPosition"}}));if(r.value)throw r.value;u.value=e.value.data,(o=l.value)==null||o.setGridOption("rowData",d())}catch(e){console.error("Error fetching users:",e),i.hasError=!0,i.errorMessage=e.message||"خطا در دریافت کاربران"}}return[n,c]=D(()=>y()),await n,c(),(o,e)=>{const r=j("AgGridVue");return E(),z(F,{class:"app-layout"},{default:_(()=>[h(B,{modelValue:a(i).hasError,"onUpdate:modelValue":e[0]||(e[0]=t=>a(i).hasError=t),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:_(()=>[M(P(a(i).errorMessage),1)]),_:1},8,["modelValue"]),R("section",U,[h(r,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":a(b),"get-row-id":t=>String(t.data.id),"enable-rtl":"","row-numbers":"",pagination:"","group-display-type":"multipleColumns","auto-group-column-def":a(k),"cell-selection":"","row-selection":a(N),theme:a(g),onGridReady:v},null,8,["column-defs","get-row-id","auto-group-column-def","row-selection","theme"])])]),_:1})}}},X=A(I,[["__scopeId","data-v-8ccf7fa0"]]);export{X as default};
