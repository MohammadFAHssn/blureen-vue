import{r as z,bx as fe,Y as te,H as Ye,a as Ke,c as F,o as c,d as t,b as e,f as S,m as O,e as l,v as s,x as o,n as a,am as J,bi as ne,F as ee,i as se,a2 as _,a1 as de,aY as Xe,ax as al,a6 as nl,bH as ol,a7 as Ge,al as rl,aP as sl,a8 as qe,w as De,Z as Ae,ab as ul,s as He,aO as Qe,bI as il,b2 as dl,b5 as Oe,bJ as cl,bK as fl,bL as ml,bB as el,B as $e,bp as Te,bM as xe,bC as vl,bo as pl,h as yl}from"./index-BRcc4XA0.js";import{_ as Pe}from"./DialogCloseBtn-BFlzakNo.js";import{j as Je}from"./index-H4fOOS_g.js";import{$ as oe}from"./api-B9aYCsOm.js";import{V as ye}from"./VSnackbar-CyP0ExQa.js";import{V as H}from"./VRow-DuNPxdKR.js";import{V as x}from"./VCol-BtPIBuv3.js";import{V as ce,b as Ze,c as gl}from"./VCard-a6caRL8S.js";import{V as pe,m as bl}from"./VTextField-BcJf0Rxu.js";import{V as _l}from"./VAutocomplete-BMcnnftV.js";import{V as Ve}from"./VTable-CU3BKQ09.js";import{V as Me}from"./VSkeletonLoader-C3ebgbwC.js";import{V as Ee,a as Ce,b as Fe,c as Re}from"./VExpansionPanels-BD51b273.js";import{V as Be}from"./VContainer-CK1SzMCJ.js";import{V as ke}from"./VCardText-CK9ceg1n.js";import{V as re}from"./VDivider-DM3liG56.js";import{V as we}from"./VDialog-D6lwnvbS.js";import{r as he}from"./validators-BQd4MaJQ.js";import{V as ll}from"./VTooltip-DN3py_RE.js";import{V as Vl}from"./VCheckbox-CI0w89mw.js";import{V as ze}from"./VSelect-BbFfwrY5.js";import{V as Ue}from"./VForm-DLEDyWgD.js";import"./index-CvOPxmL5.js";import"./useLogout-C-eg2eyz.js";import"./VOverlay-Cmb_ffnQ.js";/* empty css              */import"./createSimpleFunctional-BiP4K-1P.js";import"./autofocus-Bh2WnONs.js";import"./VCounter-CjJtFXu-.js";import"./VField-MsHMmBuK.js";import"./filter-CLTelndQ.js";import"./VList-D-2k1QhF.js";import"./VMenu-vuKKjGw3.js";import"./dialog-transition-DnuBdUzz.js";import"./VCheckboxBtn-bc6JJRZY.js";import"./helpers-CcX6MmOA.js";const kl={class:"ma-3 overflow-auto d-none d-md-block"},hl={class:"font-weight-medium mb-4 d-block text-center"},wl={key:2,class:"text-center"},Ml={class:"d-md-none pa-3"},Dl={class:"font-weight-medium mb-4 d-block text-center"},$l={class:"d-flex justify-space-between w-100 align-center"},xl={class:"pa-2"},El={class:"mt-2 text-center"},Cl={key:2,class:"text-center"},Fl={__name:"ContractorInvoice",emits:["back"],setup(E,{emit:ae}){const I=ae,G=z("root");function K(){G.value!=="root"?G.value="root":I("back")}const y=fe({success:!1,successMessage:"",hasError:!1,errorMessage:"",isDetailsDialogVisible:!1}),f=fe({fetchingReservedMeals:!1,fetchingContractors:!1}),h=z([]),g=z([]),$=z([]),D=z(null),R=z(null),j=te(()=>!h.value||h.value.length===0?"":Array.isArray(h.value)?h.value.join(" - "):h.value);function B(M){y.hasError=!0,y.errorMessage=M}function L(M){y.isDetailsDialogVisible=M,M||(D.value=null)}function W(M){D.value=M,y.isDetailsDialogVisible=!0}async function A(){if(!h.value[1]){B("تاریخ باید به صورت بازه‌ای باشد.");return}if(!R.value){B("یک پیمانکار انتخاب کنید.");return}$.value=[],f.fetchingReservedMeals=!0;try{const M=await oe("/food/meal-reservation/get-for-specific-contractor-on-date",{method:"GET",params:{contractor:R.value,"date[]":h.value}});$.value=(M.data||[]).flat()}catch(M){console.error("Error fetching reserved meals:",M),B("خطا در دریافت رزروها")}finally{f.fetchingReservedMeals=!1}}async function P(){f.fetchingContractors=!0;try{const M=await oe("/contractor/get-actives",{method:"GET"});g.value=(M==null?void 0:M.data.contractors)||[]}catch(M){console.error("Error fetching contractors:",M),B(M.message||"خطا در دریافت پیمانکاران")}finally{f.fetchingContractors=!1}}const p=te(()=>[...$.value].sort((M,d)=>String(M.date).localeCompare(String(d.date))));return Ye(async()=>{await Promise.all([P()]);const M=new Date,[d]=[M].map(v=>Je.toJalaali(v.getFullYear(),v.getMonth()+1,v.getDate())),u=v=>`${v.jy}/${String(v.jm).padStart(2,"0")}/${String(v.jd).padStart(2,"0")}`;h.value=[u(d)]}),(M,d)=>{const u=Ke("PersianDatetimePicker"),v=Pe;return c(),F(ee,null,[t("div",null,[e(J,{variant:"text","prepend-icon":"tabler-arrow-right",class:"mb-4",onClick:K},{default:l(()=>[s(o(a(G)==="root"?"آشپزخانه":"صفحه قبل"),1)]),_:1})]),e(Be,null,{default:l(()=>[e(ye,{modelValue:a(y).hasError,"onUpdate:modelValue":d[0]||(d[0]=n=>a(y).hasError=n),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[s(o(a(y).errorMessage),1)]),_:1},8,["modelValue"]),e(ye,{modelValue:a(y).success,"onUpdate:modelValue":d[1]||(d[1]=n=>a(y).success=n),timeout:2e3,location:"center",variant:"flat",color:"success"},{default:l(()=>[s(o(a(y).successMessage),1)]),_:1},8,["modelValue"]),e(H,{dense:""},{default:l(()=>[e(x,{cols:"12",md:"4",class:"d-flex justify-center mb-4 mb-md-0"},{default:l(()=>[d[5]||(d[5]=t("input",{id:"custom-input",style:{display:"none"}},null,-1)),e(u,{modelValue:a(h),"onUpdate:modelValue":d[2]||(d[2]=n=>ne(h)?h.value=n:null),format:"jYYYY/jMM/jDD",inline:"",range:"","custom-input":"#custom-input"},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"8"},{default:l(()=>[e(ce,{class:"mb-4"},{default:l(()=>[d[7]||(d[7]=t("label",{class:"font-weight-medium mb-2 mt-2 d-block text-center"}," جزئیات ",-1)),e(H,{class:"mb-4 px-4"},{default:l(()=>[e(x,{cols:"12",sm:"12",md:"12"},{default:l(()=>[e(pe,{"model-value":a(j),label:"بازه زمانی",variant:"outlined",readonly:""},null,8,["model-value"])]),_:1}),e(x,{cols:"12",sm:"12",md:"12"},{default:l(()=>[e(_l,{modelValue:a(R),"onUpdate:modelValue":d[3]||(d[3]=n=>ne(R)?R.value=n:null),items:a(g),"item-title":"fullName","item-value":"id",label:"پیمانکار",chips:"",clearable:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1})]),_:1}),e(H,{justify:"center",class:"mb-4"},{default:l(()=>[e(x,{cols:"auto"},{default:l(()=>[e(J,{color:"primary",loading:a(f).fetchingReservedMeals,disabled:a(f).fetchingReservedMeals,onClick:A},{default:l(()=>[...d[6]||(d[6]=[s(" جستجو ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),t("div",kl,[!a(f).fetchingReservedMeals&&a(p).length>0?(c(),S(ce,{key:0,class:"pa-4"},{default:l(()=>{var n,C,V,b;return[d[9]||(d[9]=t("label",{class:"font-weight-medium mb-4 d-block text-center"}," رزروهای تحویل شده ",-1)),t("label",hl," پیمانکار: "+o((b=(V=(C=(n=a(p))==null?void 0:n[0])==null?void 0:C.details)==null?void 0:V.find(m=>m.contractor))!=null&&b.contractor?`${a(p)[0].details.find(m=>m.contractor).contractor.first_name}
                  ${a(p)[0].details.find(m=>m.contractor).contractor.last_name}`:"—"),1),e(Ve,null,{default:l(()=>[d[8]||(d[8]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"وعده"),t("th",null,"تاریخ"),t("th",null,"تعداد"),t("th",null,"مبلغ"),t("th",null,"جزئیات")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se(a(p),(m,U)=>{var X,T;return c(),F("tr",{key:m.id},[t("td",null,o(U+1),1),t("td",null,o((X=m.meal)==null?void 0:X.name),1),t("td",null,[e(_,null,{default:l(()=>[s(o(m.date),1)]),_:2},1024)]),t("td",null,o((T=m.details)==null?void 0:T.reduce((le,w)=>le+(w.quantity||0),0)),1),t("td",null,[e(_,{color:"primary"},{default:l(()=>{var le;return[s(o(Number((le=m.details)==null?void 0:le.reduce((w,i)=>w+(i.quantity||0)*(i.food_price||0),0)).toLocaleString("fa-IR"))+" ریال ",1)]}),_:2},1024)]),t("td",null,[e(J,{color:"primary",variant:"text",size:"small",onClick:le=>W(m)},{default:l(()=>[e(de,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])}),128))])]),_:1})]}),_:1})):a(f).fetchingReservedMeals?(c(),S(Me,{key:1,type:"card"})):(c(),F("div",wl,[e(_,{color:"error"},{default:l(()=>[...d[10]||(d[10]=[s(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))]),t("div",Ml,[!a(f).fetchingReservedMeals&&a(p).length>0?(c(),S(Ee,{key:0,variant:"accordion"},{default:l(()=>[e(Ce,null,{default:l(()=>[e(Fe,{class:"font-weight-bold"},{default:l(()=>{var n,C,V,b;return[t("label",Dl," رزروهای تحویل شده پیمانکار: "+o((b=(V=(C=(n=a(p))==null?void 0:n[0])==null?void 0:C.details)==null?void 0:V.find(m=>m.contractor))!=null&&b.contractor?`${a(p)[0].details.find(m=>m.contractor).contractor.first_name}
                  ${a(p)[0].details.find(m=>m.contractor).contractor.last_name}`:"—"),1)]}),_:1}),e(Re,null,{default:l(()=>[e(Ee,{variant:"accordion"},{default:l(()=>[(c(!0),F(ee,null,se(a(p),n=>(c(),S(Ce,{key:n.id,class:"mb-2"},{default:l(()=>[e(Fe,null,{default:l(()=>{var C;return[t("div",$l,[t("span",null,o((C=n.meal)==null?void 0:C.name),1),t("span",null,[e(_,null,{default:l(()=>[s(o(n.date),1)]),_:2},1024)])])]}),_:2},1024),e(Re,null,{default:l(()=>{var C;return[t("div",xl,[t("div",null,[d[11]||(d[11]=t("strong",null,"تعداد:",-1)),s(" "+o((C=n.details)==null?void 0:C.reduce((V,b)=>V+(b.quantity||0),0)),1)]),t("div",null,[d[12]||(d[12]=t("strong",null,"مبلغ:",-1)),e(_,{color:"primary"},{default:l(()=>{var V;return[s(o(Number((V=n.details)==null?void 0:V.reduce((b,m)=>b+(m.quantity||0)*(m.food_price||0),0)).toLocaleString("fa-IR"))+" ریال ",1)]}),_:2},1024)]),t("div",El,[e(J,{color:"primary",variant:"text",size:"small",onClick:V=>W(n)},{default:l(()=>[e(de,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})):a(f).fetchingReservedMeals?(c(),S(Me,{key:1,type:"card"})):(c(),F("div",Cl,[e(_,{color:"error"},{default:l(()=>[...d[13]||(d[13]=[s(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))])]),_:1})]),_:1})]),_:1}),a(D)?(c(),S(we,{key:0,width:M.$vuetify.display.smAndDown?"auto":900,"model-value":a(y).isDetailsDialogVisible,"onUpdate:modelValue":L},{default:l(()=>[e(v,{onClick:d[4]||(d[4]=n=>L(!1))}),e(ce,null,{default:l(()=>[e(Ze,{class:"text-h6"},{default:l(()=>[...d[14]||(d[14]=[s(" جزئیات ",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[d[15]||(d[15]=t("strong",null,"رزرو کننده:",-1)),e(_,{color:"orange",size:"small"},{default:l(()=>[s(o(a(D).created_by?`${a(D).created_by.first_name} ${a(D).created_by.last_name}`:"—"),1)]),_:1})])]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[d[16]||(d[16]=t("strong",null,"کد پرسنلی:",-1)),e(_,{color:"orange",size:"small"},{default:l(()=>[s(o(a(D).created_by?`${a(D).created_by.personnel_code}`:"—"),1)]),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[d[17]||(d[17]=t("strong",null,"کد تحویل:",-1)),e(_,{color:"primary",size:"small"},{default:l(()=>[s(o(a(D).delivery_code),1)]),_:1})]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[d[18]||(d[18]=t("strong",null,"وعده:",-1)),e(_,{color:"primary",size:"small"},{default:l(()=>{var n;return[s(o((n=a(D).meal)==null?void 0:n.name),1)]}),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[d[19]||(d[19]=t("strong",null,"وضعیت:",-1)),e(_,{color:a(D).status?"success":"error",size:"small"},{default:l(()=>[s(o(a(D).status?"تحویل شده":"تحویل نشده"),1)]),_:1},8,["color"])])]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[d[20]||(d[20]=t("strong",null,"تاریخ:",-1)),e(_,{size:"small"},{default:l(()=>[s(o(a(D).date),1)]),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[d[21]||(d[21]=t("strong",null,"تعداد:",-1)),e(_,{size:"small"},{default:l(()=>{var n;return[s(o((n=a(D).details)==null?void 0:n.reduce((C,V)=>C+(V.quantity||0),0)),1)]}),_:1})])]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[d[22]||(d[22]=t("strong",null,"مبلغ:",-1)),e(_,{color:"success"},{default:l(()=>{var n;return[s(o(Number((n=a(D).details)==null?void 0:n.reduce((C,V)=>C+(V.quantity||0)*(V.food_price||0),0)).toLocaleString("fa-IR"))+" ریال ",1)]}),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),t("div",null,[e(Ve,{density:"comfortable"},{default:l(()=>[d[23]||(d[23]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"غذا"),t("th",null,"قیمت"),t("th",null,"تعداد"),t("th",null,"مبلغ کل")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se(a(D).details,(n,C)=>(c(),F("tr",{key:n.id},[t("td",null,o(C+1),1),t("td",null,[e(_,null,{default:l(()=>{var V;return[s(o((V=n.food)==null?void 0:V.name),1)]}),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(Number(n.food_price||0).toLocaleString("fa-IR"))+" ریال ",1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(n.quantity),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(Number((n.quantity||0)*(n.food_price||0)).toLocaleString("fa-IR"))+" ریال ",1)]),_:2},1024)])]))),128))])]),_:1})]),e(re,{class:"my-3"})]),_:1})]),_:1})]),_:1},8,["width","model-value"])):O("",!0)],64)}}},Rl=50,Pl=500;function Sl(E){let{toggleUpDown:ae}=E,I=-1,G=-1;Xe(y);function K(h){y(),f(h),window.addEventListener("pointerup",y),document.addEventListener("blur",y),I=window.setTimeout(()=>{G=window.setInterval(()=>f(h),Rl)},Pl)}function y(){window.clearTimeout(I),window.clearInterval(G),window.removeEventListener("pointerup",y),document.removeEventListener("blur",y)}Xe(y);function f(h){ae(h==="up")}return{holdStart:K,holdStop:y}}const Nl=nl({controlVariant:{type:String,default:"default"},inset:Boolean,hideInput:Boolean,modelValue:{type:Number,default:null},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},step:{type:Number,default:1},precision:{type:Number,default:0},minFractionDigits:{type:Number,default:null},decimalSeparator:{type:String,validator:E=>!E||E.length===1},...dl(bl(),["modelValue","validationValue"])},"VNumberInput"),Le=al()({name:"VNumberInput",props:{...Nl()},emits:{"update:focused":E=>!0,"update:modelValue":E=>!0},setup(E,ae){let{slots:I}=ae;const G=z(),{holdStart:K,holdStop:y}=Sl({toggleUpDown:m}),f=ol(E),h=te(()=>f.isDisabled.value||f.isReadonly.value),g=Ge(E.focused),{decimalSeparator:$}=rl(),D=te(()=>{var k;return((k=E.decimalSeparator)==null?void 0:k[0])||$.value});function R(k){let N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:E.precision,ie=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const ue=N==null?String(k):k.toFixed(N);if(g.value&&ie)return Number(ue).toString().replace(".",D.value);if(E.minFractionDigits===null||N!==null&&N<E.minFractionDigits)return ue.replace(".",D.value);let[me,ve]=ue.split(".");return ve=(ve??"").padEnd(E.minFractionDigits,"0").replace(new RegExp(`(?<=\\d{${E.minFractionDigits}})0+$`,"g"),""),[me,ve].filter(Boolean).join(D.value)}const j=sl(E,"modelValue",null,k=>k??null,k=>k==null?k??null:qe(Number(k),E.min,E.max)),B=Ge(null),L=Ge(null);De(j,k=>{var N;g.value&&!h.value&&Number((N=B.value)==null?void 0:N.replace(D.value,"."))===k||(k==null?(B.value=null,L.value=null):isNaN(k)||(B.value=R(k),L.value=Number(B.value.replace(D.value,"."))))},{immediate:!0});const W=te({get:()=>B.value,set(k){if(k===null||k===""){j.value=null,B.value=null,L.value=null;return}const N=Number(k.replace(D.value,"."));isNaN(N)||(B.value=k,L.value=N,N<=E.max&&N>=E.min&&(j.value=N))}}),A=te(()=>{var N;if(L.value===null)return!1;const k=Number((N=B.value)==null?void 0:N.replace(D.value,"."));return k!==qe(k,E.min,E.max)}),P=te(()=>h.value?!1:(j.value??0)+E.step<=E.max),p=te(()=>h.value?!1:(j.value??0)-E.step>=E.min),M=te(()=>E.hideInput?"stacked":E.controlVariant),d=Ae(()=>M.value==="split"?"$plus":"$collapse"),u=Ae(()=>M.value==="split"?"$minus":"$expand"),v=Ae(()=>M.value==="split"?"default":"small"),n=Ae(()=>M.value==="stacked"?"auto":"100%"),C={props:{onClick:T,onPointerup:le,onPointerdown:w,onPointercancel:le}},V={props:{onClick:T,onPointerup:le,onPointerdown:i,onPointercancel:le}};De(()=>E.precision,()=>r()),De(()=>E.minFractionDigits,()=>r()),Ye(()=>{Q()});function b(k){if(k==null)return 0;const N=k.toString(),ie=N.indexOf(".");return~ie?N.length-ie:0}function m(){let k=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(h.value)return;if(j.value==null){W.value=R(qe(0,E.min,E.max));return}let N=Math.max(b(j.value),b(E.step));E.precision!=null&&(N=Math.max(N,E.precision)),k?P.value&&(W.value=R(j.value+E.step,N)):p.value&&(W.value=R(j.value-E.step,N))}function U(k){var Se;if(!k.data)return;const N=k.target,{value:ie,selectionStart:ue,selectionEnd:me}=N??{},ve=ie?ie.slice(0,ue)+k.data+ie.slice(me):k.data,ge=cl(ve,E.precision,D.value);if(new RegExp(`^-?\\d*${fl(D.value)}?\\d*$`).test(ve)||(k.preventDefault(),N.value=ge,Oe(()=>W.value=ge)),E.precision!=null){if(((Se=ve.split(D.value)[1])==null?void 0:Se.length)>E.precision){k.preventDefault(),N.value=ge,Oe(()=>W.value=ge);const Ie=(ue??0)+k.data.length;N.setSelectionRange(Ie,Ie)}E.precision===0&&ve.endsWith(D.value)&&(k.preventDefault(),N.value=ge,Oe(()=>W.value=ge))}}async function X(k){["Enter","ArrowLeft","ArrowRight","Backspace","Delete","Tab"].includes(k.key)||k.ctrlKey||["ArrowDown","ArrowUp"].includes(k.key)&&(k.preventDefault(),k.stopPropagation(),Q(),await Oe(),k.key==="ArrowDown"?m(!1):m())}function T(k){k.stopPropagation()}function le(k){const N=k.currentTarget;N==null||N.releasePointerCapture(k.pointerId),k.preventDefault(),y()}function w(k){const N=k.currentTarget;N==null||N.setPointerCapture(k.pointerId),k.preventDefault(),k.stopPropagation(),K("up")}function i(k){const N=k.currentTarget;N==null||N.setPointerCapture(k.pointerId),k.preventDefault(),k.stopPropagation(),K("down")}function Q(){if(h.value||!G.value)return;const k=G.value.value,N=Number(k.replace(D.value,"."));k&&!isNaN(N)?W.value=R(qe(N,E.min,E.max)):W.value=null}function r(){h.value||(W.value=j.value!==null&&!isNaN(j.value)?R(j.value,E.precision,!1):null)}function q(){if(!h.value){if(j.value===null||isNaN(j.value)){W.value=null;return}W.value=j.value.toString().replace(".",D.value)}}function Y(){q()}function Z(){Q()}return ul(()=>{const{modelValue:k,type:N,...ie}=pe.filterProps(E);function ue(){return I.increment?e(Qe,{key:"increment-defaults",defaults:{VBtn:{disabled:!P.value,height:n.value,size:v.value,icon:d.value,variant:"text"}}},{default:()=>[I.increment(C)]}):e(J,{"aria-hidden":"true","data-testid":"increment",disabled:!P.value,height:n.value,icon:d.value,key:"increment-btn",onClick:T,onPointerdown:w,onPointerup:le,onPointercancel:le,size:v.value,variant:"text",tabindex:"-1"},null)}function me(){return I.decrement?e(Qe,{key:"decrement-defaults",defaults:{VBtn:{disabled:!p.value,height:n.value,size:v.value,icon:u.value,variant:"text"}}},{default:()=>[I.decrement(V)]}):e(J,{"aria-hidden":"true","data-testid":"decrement",disabled:!p.value,height:n.value,icon:u.value,key:"decrement-btn",onClick:T,onPointerdown:i,onPointerup:le,onPointercancel:le,size:v.value,variant:"text",tabindex:"-1"},null)}function ve(){return t("div",{class:"v-number-input__control"},[me(),e(re,{vertical:M.value!=="stacked"},null),ue()])}function ge(){return!E.hideInput&&!E.inset?e(re,{vertical:!0},null):void 0}const Se=M.value==="split"?t("div",{class:"v-number-input__control"},[e(re,{vertical:!0},null),ue()]):E.reverse||M.value==="hidden"?void 0:t(ee,null,[ge(),ve()]),Ie=I["append-inner"]||Se,We=M.value==="split"?t("div",{class:"v-number-input__control"},[me(),e(re,{vertical:!0},null)]):E.reverse&&M.value!=="hidden"?t(ee,null,[ve(),ge()]):void 0,tl=I["prepend-inner"]||We;return e(pe,He({ref:G},ie,{modelValue:W.value,"onUpdate:modelValue":be=>W.value=be,focused:g.value,"onUpdate:focused":be=>g.value=be,validationValue:j.value,error:A.value||void 0,onBeforeinput:U,onFocus:Y,onBlur:Z,onKeydown:X,class:["v-number-input",{"v-number-input--default":M.value==="default","v-number-input--hide-input":E.hideInput,"v-number-input--inset":E.inset,"v-number-input--reverse":E.reverse,"v-number-input--split":M.value==="split","v-number-input--stacked":M.value==="stacked"},E.class],style:E.style,inputmode:"decimal"}),{...I,"append-inner":Ie?function(){var je;for(var be=arguments.length,Ne=new Array(be),_e=0;_e<be;_e++)Ne[_e]=arguments[_e];return t(ee,null,[(je=I["append-inner"])==null?void 0:je.call(I,...Ne),Se])}:void 0,"prepend-inner":tl?function(){var je;for(var be=arguments.length,Ne=new Array(be),_e=0;_e<be;_e++)Ne[_e]=arguments[_e];return t(ee,null,[We,(je=I["prepend-inner"])==null?void 0:je.call(I,...Ne)])}:void 0})}),il({},G)}}),jl={class:"ma-3 overflow-auto d-none d-md-block"},zl={key:0,class:"text-center mb-4"},Tl={key:1},Bl={class:"py-2"},Ul={style:{"max-width":"420px","white-space":"normal","overflow-wrap":"anywhere"}},Il={key:2,class:"text-center"},ql={class:"d-md-none pa-3"},Al={key:0,class:"text-center mb-4"},Ol={class:"d-flex flex-column w-100"},Ll={class:"d-flex justify-space-between align-center mb-1"},Yl={class:"d-flex justify-space-between align-center"},Gl={class:"pa-2"},Kl={class:"mb-2 d-flex justify-space-between"},Hl={key:0,class:"mb-2 d-flex justify-space-between"},Jl={class:"mb-2 d-flex justify-space-between"},Zl={key:1,class:"mb-2 d-flex justify-space-between align-start"},Wl={style:{"max-width":"100%","white-space":"normal","overflow-wrap":"anywhere","word-break":"break-word","text-align":"right",flex:"1"}},Xl={class:"mt-2 text-center"},Ql={key:2,class:"text-center"},et={style:{"white-space":"normal","overflow-wrap":"anywhere"}},lt={key:0},tt={key:1},at={__name:"Delivery",emits:["back"],setup(E,{emit:ae}){const I=ae,G=z("root");function K(){G.value!=="root"?G.value="root":I("back")}const y=fe({success:!1,successMessage:"",hasError:!1,errorMessage:"",isDeliveryDialogVisible:!1}),f=fe({fetchingReservedMeals:!0,searchReservedMeal:!1,deliverReservedMeal:!1,fetchingFoods:!1}),h=z([]),g=z(null),$=z(null),D=z(null),R=z([]),j=te(()=>{var w,i;return((i=(w=g.value)==null?void 0:w.details)==null?void 0:i.reduce((Q,r)=>Q+(r.quantity||0),0))||0}),B=z(0);De(j,w=>{B.value=w},{immediate:!0});const L=z(0);De(B,w=>{L.value=w},{immediate:!0});const W=z([]),A=z(null),P=z(0),p=z(null),M=z(0),d=te(()=>Math.max(B.value-L.value,0)),u=te(()=>Math.max(B.value-L.value-P.value,0));De([B,L,P,M],()=>{L.value>B.value&&(L.value=B.value),P.value>d.value&&(P.value=d.value),d.value===0&&(A.value=null,P.value=0),M.value>u.value&&(M.value=u.value),u.value===0&&(p.value=null,M.value=0)});function v(w){y.hasError=!0,y.errorMessage=w}async function n(){if(!D.value){v("لطفاً ابتدا، کد تحویل را وارد کنید کنید.");return}f.searchReservedMeal=!0;try{const w=await oe("/food/delivery/find",{method:"GET",params:{date:$.value,delivery_code:D.value},onResponseError({response:Q}){var r;(r=Q._data)!=null&&r.errors?v("رزروی با این کد تحویل یافت نشد."):y.errorMessage="خطا در جستجو"}}),i=(w==null?void 0:w.data)??null;if(g.value=Array.isArray(i)?i[0]??null:i,!g.value){v("این رزرو، تحویل داده شده است یا در بازه تحویل قرار ندارد.");return}y.isDeliveryDialogVisible=!0}catch(w){console.error("Error fetching reserved meal:",w)}finally{f.searchReservedMeal=!1}}async function C(){h.value=[],f.fetchingReservedMeals=!0;try{const w=await oe("/food/delivery",{method:"GET",params:{date:$.value}});h.value=((w==null?void 0:w.data)||[]).flat()}catch(w){console.error("Error fetching reserved meals:",w),v("خطا در دریافت رزروها")}finally{f.fetchingReservedMeals=!1}}async function V(){f.fetchingFoods=!0;try{const w=await oe("/food/food/get-actives",{method:"GET"});W.value=(w==null?void 0:w.data.foods)||[]}catch(w){console.error("Error fetching foods:",w),v("خطا در دریافت غذاها")}finally{f.fetchingFoods=!1}}function b(w){y.isDeliveryDialogVisible=w,w||m()}function m(){g.value=null,D.value=null,R.value=[],A.value=null,P.value=0,p.value=null,M.value=0}async function U(){var w,i,Q;if(!g.value){v("رزروی انتخاب نشده است.");return}if(g.value.reserve_type==="personnel"){const q=(g.value.details||[]).filter(Y=>Y.personnel).map(Y=>Y.id);if(q.length>0&&R.value.length===q.length){v("نمیتوان گزینه تحویل نگرفت را برای تمام کاربران درخواست، انتخاب کرد");return}}if(g.value.reserve_type==="contractor"){const r=Number(B.value)||0,q=Number(L.value)||0,Y=Number(P.value)||0,Z=Number(M.value)||0;if(A.value&&Y<=0){v("برای غذای دوم، تعداد دریافتی را وارد کنید");return}if(p.value&&Z<=0){v("برای غذای سوم، تعداد دریافتی را وارد کنید");return}if(q+Y+Z!==r){v("مجموع دریافتی‌ها باید دقیقاً برابر تعداد دریافتی کل باشد");return}}f.deliverReservedMeal=!0;try{let r;g.value.reserve_type==="personnel"?r={type:"personnel",reserved_meal_id:g.value.id,...R.value.length>0?{noDeliveryFor:R.value}:{}}:g.value.reserve_type==="contractor"?r={type:"contractor",contractor:(Q=(i=(w=g.value.details)==null?void 0:w[0])==null?void 0:i.contractor)==null?void 0:Q.id,reserved_meal_id:g.value.id,received_count:B.value,today_food_count:L.value,...A.value?{second_food:A.value}:{},...A.value?{second_food_received_count:P.value}:{},...p.value?{third_food:p.value}:{},...p.value?{third_food_received_count:M.value}:{}}:g.value.reserve_type==="guest"&&(r={type:"guest",reserved_meal_id:g.value.id});const q=await oe("/food/delivery",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),onResponseError({response:Y}){var N;y.hasError=!0;const Z=(Y==null?void 0:Y._data)||{},k=(N=Z==null?void 0:Z.errors)==null?void 0:N.personnel;if((Z==null?void 0:Z.code)==="VALIDATION_ERROR"&&Array.isArray(k)&&k.length){const ie=k.map(ue=>{var me;return(me=String(ue).match(/(\d+)/g))==null?void 0:me.join(" - ")}).filter(Boolean);y.errorMessage=`برای پرسنل با کد/های پرسنلی زیر، ترددی ثبت نشده است. لطفا گزینه 'تحویل نگرفت' آن‌ها را علامت زده سپس، اقدام به تحویل نمایید:
${ie}`;return}if(Z!=null&&Z.errors){y.errorMessage=Object.values(Z.errors).flat().join(" | ");return}y.errorMessage=(Z==null?void 0:Z.message)||"خطا در تحویل"}});return await C(),y.isDeliveryDialogVisible=!1,m(),q}catch(r){if(console.error("Error deliver:",r),y.hasError&&y.errorMessage)return;v("خطا در تحویل اطلاعات")}finally{f.deliverReservedMeal=!1}}const X=te(()=>[...h.value].sort((w,i)=>{var Q,r;return String(((Q=w==null?void 0:w.meal)==null?void 0:Q.name)||"").localeCompare(String(((r=i==null?void 0:i.meal)==null?void 0:r.name)||""))})),T=te(()=>{var i,Q;const w={};for(const r of h.value){const q=((i=r.meal)==null?void 0:i.name)||"نامشخص",Y=((Q=r.details)==null?void 0:Q.reduce((Z,k)=>Z+(k.quantity||0),0))||0;w[q]||(w[q]=0),w[q]+=Y}return Object.entries(w).map(([r,q])=>({name:r,total:q}))}),le=te(()=>{var i,Q;const w={};for(const r of h.value){const q=`${((i=r.meal)==null?void 0:i.name)||"نامشخص"} تحویل نشده`,Y=((Q=r.details)==null?void 0:Q.reduce((Z,k)=>Z+(k.delivery_status?0:k.quantity||0),0))??0;w[q]||(w[q]=0),w[q]+=Y}return Object.entries(w).map(([r,q])=>({name:r,total:q}))});return Ye(async()=>{const w=new Date,i=Je.toJalaali(w.getFullYear(),w.getMonth()+1,w.getDate()),Q=r=>`${r.jy}/${String(r.jm).padStart(2,"0")}/${String(r.jd).padStart(2,"0")}`;$.value=Q(i),await C(),await V()}),(w,i)=>{const Q=Pe;return c(),F(ee,null,[t("div",null,[e(J,{variant:"text","prepend-icon":"tabler-arrow-right",class:"mb-4",onClick:K},{default:l(()=>[s(o(a(G)==="root"?"آشپزخانه":"صفحه قبل"),1)]),_:1})]),e(Be,null,{default:l(()=>[e(ye,{modelValue:a(y).hasError,"onUpdate:modelValue":i[0]||(i[0]=r=>a(y).hasError=r),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[s(o(a(y).errorMessage),1)]),_:1},8,["modelValue"]),e(ye,{modelValue:a(y).success,"onUpdate:modelValue":i[1]||(i[1]=r=>a(y).success=r),timeout:2e3,location:"center",variant:"flat",color:"success"},{default:l(()=>[s(o(a(y).successMessage),1)]),_:1},8,["modelValue"]),e(H,{dense:""},{default:l(()=>[e(x,{cols:"12",md:"12"},{default:l(()=>[e(ce,{class:"mb-4"},{default:l(()=>[i[12]||(i[12]=t("label",{class:"font-weight-medium mb-2 mt-2 d-block text-center"}," تحویل غذا ",-1)),e(H,{class:"mb-4 px-4"},{default:l(()=>[e(x,{cols:"12",sm:"12",md:"12"},{default:l(()=>[e(pe,{modelValue:a(D),"onUpdate:modelValue":i[2]||(i[2]=r=>ne(D)?D.value=r:null),label:"کد تحویل",variant:"outlined",type:"number",onKeydown:ml(n,["enter"])},null,8,["modelValue"])]),_:1})]),_:1}),e(H,{justify:"center",class:"mb-4"},{default:l(()=>[e(x,{cols:"auto"},{default:l(()=>[e(J,{color:"primary",loading:a(f).searchReservedMeal,disabled:a(f).searchReservedMeal,onClick:n},{default:l(()=>[...i[11]||(i[11]=[s(" جستجو ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),t("div",jl,[!a(f).fetchingReservedMeals&&a(X).length>0?(c(),S(ce,{key:0,class:"pa-4"},{default:l(()=>[i[15]||(i[15]=t("label",{class:"font-weight-medium mb-4 d-block text-center"}," رزروهای امروز ",-1)),a(X).length?(c(),F("div",zl,[(c(!0),F(ee,null,se(a(T),r=>(c(),S(_,{key:r.name,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:l(()=>[s(o(r.name)+": "+o(r.total),1)]),_:2},1024))),128)),(c(!0),F(ee,null,se(a(le),r=>(c(),S(_,{key:r.name,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:l(()=>[s(o(r.name)+": "+o(r.total),1)]),_:2},1024))),128))])):O("",!0),e(Ve,null,{default:l(()=>[i[14]||(i[14]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"وعده"),t("th",null,"رزرو کننده"),t("th",null,"کد پرسنلی"),t("th",null,"کد تحویل"),t("th",null,"نوع رزرو"),t("th",null,"وضعیت"),t("th",null,"پیمانکار"),t("th",null,"تعداد"),t("th",null,"توضیحات"),t("th",null,"عملیات")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se(a(X),(r,q)=>{var Y,Z,k,N,ie;return c(),F("tr",{key:r.id},[t("td",null,o(q+1),1),t("td",null,o((Y=r.meal)==null?void 0:Y.name),1),t("td",null,[e(_,null,{default:l(()=>[s(o(r.created_by?`${r.created_by.first_name} ${r.created_by.last_name}`:"—"),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(r.created_by?`${r.created_by.personnel_code}`:"—"),1)]),_:2},1024)]),t("td",null,[e(_,{color:"success"},{default:l(()=>[s(o(r.delivery_code),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o({personnel:"پرسنل",contractor:"پیمانکار",guest:"مهمان",repairman:"تعمیرکار"}[r.reserve_type]||""),1)]),_:2},1024)]),t("td",null,[e(_,{color:r.status?"success":"error",size:"small"},{default:l(()=>[s(o(r.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])]),t("td",null,[(k=(Z=r.details)==null?void 0:Z[0])!=null&&k.contractor?(c(),S(_,{key:0},{default:l(()=>[s(o(`${r.details[0].contractor.first_name} ${r.details[0].contractor.last_name}`),1)]),_:2},1024)):(c(),F("span",Tl,"—"))]),t("td",null,o((N=r.details)==null?void 0:N.reduce((ue,me)=>ue+(me.quantity||0),0)),1),t("td",Bl,[e(ll,{location:"top",disabled:!(((ie=r.description)==null?void 0:ie.length)>6)},{activator:l(({props:ue})=>[t("div",He({ref_for:!0},ue,{class:"text-truncate",style:{"max-width":"120px"}}),o(r.description||"—"),17)]),default:l(()=>[t("div",Ul,o(r.description),1)]),_:2},1032,["disabled"])]),t("td",null,[e(J,{color:"orange-darken-2",variant:"plain",onClick:ue=>{g.value=r,a(y).isDeliveryDialogVisible=!0}},{default:l(()=>[e(de,{icon:"tabler-circle-dashed-check",size:"20",start:""}),i[13]||(i[13]=s(" تحویل ",-1))]),_:1},8,["onClick"])])])}),128))])]),_:1})]),_:1})):a(f).fetchingReservedMeals?(c(),S(Me,{key:1,type:"card"})):(c(),F("div",Il,[e(_,{color:"error"},{default:l(()=>[...i[16]||(i[16]=[s(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))]),t("div",ql,[!a(f).fetchingReservedMeals&&a(X).length>0?(c(),S(Ee,{key:0,variant:"accordion"},{default:l(()=>[e(Ce,null,{default:l(()=>[e(Fe,{class:"font-weight-bold"},{default:l(()=>[i[17]||(i[17]=s(" رزروهای امروز ",-1)),a(X).length?(c(),F("div",Al,[(c(!0),F(ee,null,se(a(T),r=>(c(),S(_,{key:r.name,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:l(()=>[s(o(r.name)+": "+o(r.total),1)]),_:2},1024))),128)),(c(!0),F(ee,null,se(a(le),r=>(c(),S(_,{key:r.name,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:l(()=>[s(o(r.name)+": "+o(r.total),1)]),_:2},1024))),128))])):O("",!0)]),_:1}),e(Re,null,{default:l(()=>[e(Ee,{variant:"accordion"},{default:l(()=>[(c(!0),F(ee,null,se(a(X),r=>(c(),S(Ce,{key:r.id,class:"mb-2"},{default:l(()=>[e(Fe,null,{default:l(()=>{var q;return[t("div",Ol,[t("div",Ll,[t("span",null,o((q=r.meal)==null?void 0:q.name),1),e(_,null,{default:l(()=>[s(o(r.created_by?`${r.created_by.first_name} ${r.created_by.last_name}`:"—"),1)]),_:2},1024)]),t("div",Yl,[e(_,null,{default:l(()=>[s(o(r.created_by?`${r.created_by.personnel_code}`:"—"),1)]),_:2},1024),e(_,{color:"success"},{default:l(()=>[s(o(r.delivery_code),1)]),_:2},1024)])])]}),_:2},1024),e(Re,null,{default:l(()=>{var q;return[t("div",Gl,[t("div",Kl,[i[18]||(i[18]=t("strong",null,"نوع رزرو:",-1)),e(_,null,{default:l(()=>[s(o({personnel:"پرسنل",contractor:"پیمانکار",guest:"مهمان",repairman:"تعمیرکار"}[r.reserve_type]||""),1)]),_:2},1024)]),r.reserve_type==="contractor"?(c(),F("div",Hl,[i[19]||(i[19]=t("strong",null,"پیمانکار:",-1)),e(_,null,{default:l(()=>{var Y,Z;return[s(o((Z=(Y=r.details)==null?void 0:Y[0])!=null&&Z.contractor?`${r.details[0].contractor.first_name} ${r.details[0].contractor.last_name}`:"—"),1)]}),_:2},1024)])):O("",!0),t("div",Jl,[e(_,{color:r.status?"success":"error",size:"small"},{default:l(()=>[s(o(r.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"]),s(" "+o((q=r.details)==null?void 0:q.reduce((Y,Z)=>Y+(Z.quantity||0),0))+" عدد ",1)]),r.description?(c(),F("div",Zl,[i[20]||(i[20]=t("strong",{class:"me-2"},"توضیحات:",-1)),t("div",Wl,o(r.description||"—"),1)])):O("",!0),t("div",Xl,[e(J,{color:"orange-darken-2",variant:"plain",onClick:Y=>{g.value=r,a(y).isDeliveryDialogVisible=!0}},{default:l(()=>[e(de,{icon:"tabler-circle-dashed-check",size:"20",start:""}),i[21]||(i[21]=s(" تحویل ",-1))]),_:1},8,["onClick"])])])]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})):a(f).fetchingReservedMeals?(c(),S(Me,{key:1,type:"card"})):(c(),F("div",Ql,[e(_,{color:"error"},{default:l(()=>[...i[22]||(i[22]=[s(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))])]),_:1})]),_:1})]),_:1}),a(g)?(c(),S(we,{key:0,width:w.$vuetify.display.smAndDown?"auto":900,"model-value":a(y).isDeliveryDialogVisible,"onUpdate:modelValue":b},{default:l(()=>[e(Q,{onClick:i[3]||(i[3]=r=>b(!1))}),e(ce,null,{default:l(()=>[e(Ze,{class:"text-h6"},{default:l(()=>[...i[23]||(i[23]=[s(" تحویل غذا ",-1)])]),_:1}),e(gl,{class:"justify-end"},{default:l(()=>[e(J,{color:"green-darken-4",variant:"tonal",loading:a(f).deliverReservedMeal,disabled:a(f).deliverReservedMeal||a(g).status,onClick:U},{default:l(()=>[e(de,{icon:"tabler-circle-dashed-check",size:"20",start:""}),i[24]||(i[24]=s(" تحویل ",-1))]),_:1},8,["loading","disabled"])]),_:1}),e(ke,null,{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[25]||(i[25]=t("strong",null,"رزرو کننده:",-1)),e(_,{color:"orange",size:"small"},{default:l(()=>[s(o(a(g).created_by?`${a(g).created_by.first_name} ${a(g).created_by.last_name}`:"—"),1)]),_:1})])]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[26]||(i[26]=t("strong",null,"کد پرسنلی:",-1)),e(_,{color:"orange",size:"small"},{default:l(()=>[s(o(a(g).created_by?`${a(g).created_by.personnel_code}`:"—"),1)]),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>{var r,q;return[e(x,{cols:"12",sm:"6"},{default:l(()=>[i[27]||(i[27]=t("strong",null,"کد تحویل:",-1)),e(_,{color:"primary",size:"small"},{default:l(()=>[s(o(a(g).delivery_code),1)]),_:1})]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[28]||(i[28]=t("strong",null,"وعده:",-1)),e(_,{color:"primary",size:"small"},{default:l(()=>{var Y;return[s(o((Y=a(g).meal)==null?void 0:Y.name),1)]}),_:1})])]),_:1}),e(re,{class:"my-3"}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[29]||(i[29]=t("strong",null,"نوع رزرو:",-1)),e(_,{size:"small"},{default:l(()=>[s(o({personnel:"پرسنل",contractor:"پیمانکار",guest:"مهمان",repairman:"تعمیرکار"}[a(g).reserve_type]||""),1)]),_:1})])]),_:1}),(q=(r=a(g).details)==null?void 0:r[0])!=null&&q.contractor?(c(),S(x,{key:0,cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[30]||(i[30]=t("strong",null,"پیمانکار:",-1)),e(_,{size:"small"},{default:l(()=>[s(o(`${a(g).details[0].contractor.first_name} ${a(g).details[0].contractor.last_name}`),1)]),_:1})])]),_:1})):O("",!0),a(g).reserve_type==="guest"?(c(),S(x,{key:1,cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[31]||(i[31]=t("strong",null,"نوع سرو:",-1)),e(_,{color:"cyan",size:"small"},{default:l(()=>[s(o({serve_in_kitchen:"سرو در رستوران",deliver:"تحویل(بیرون‌بر)"}[a(g).serve_place]||""),1)]),_:1}),a(g).serve_place==="serve_in_kitchen"?(c(),S(_,{key:0,size:"small"},{default:l(()=>[s(" ساعت حضور: "+o(a(g).attendance_hour),1)]),_:1})):O("",!0)])]),_:1})):O("",!0)]}),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[32]||(i[32]=t("strong",null,"وضعیت:",-1)),e(_,{color:a(g).status?"success":"error",size:"small"},{default:l(()=>[s(o(a(g).status?"تحویل شده":"تحویل نشده"),1)]),_:1},8,["color"])])]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[i[33]||(i[33]=t("strong",null,"تعداد:",-1)),e(_,{size:"small"},{default:l(()=>{var r;return[s(o((r=a(g).details)==null?void 0:r.reduce((q,Y)=>q+(Y.quantity||0),0)),1)]}),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>[a(g).description?(c(),S(x,{key:0,cols:"12",sm:"12"},{default:l(()=>[t("p",et,[i[34]||(i[34]=t("strong",null,"توضیحات:",-1)),s(" "+o(a(g).description),1)])]),_:1})):O("",!0)]),_:1}),e(re,{class:"my-3"}),a(g).reserve_type==="personnel"?(c(),F("div",lt,[e(Ve,{density:"comfortable"},{default:l(()=>[i[35]||(i[35]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"نام"),t("th",null,"کد پرسنلی"),t("th",null,"تحویل نگرفت")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se((a(g).details||[]).filter(r=>r.personnel),(r,q)=>(c(),F("tr",{key:r.id},[t("td",null,o(q+1),1),t("td",null,o(`${r.personnel.first_name} ${r.personnel.last_name}`),1),t("td",null,o(r.personnel.personnel_code),1),t("td",null,[a(g).status?r.delivery_status?O("",!0):(c(),S(de,{key:1,icon:"tabler-square-check"})):(c(),S(Vl,{key:0,modelValue:a(R),"onUpdate:modelValue":i[4]||(i[4]=Y=>ne(R)?R.value=Y:null),value:r.id,"hide-details":"",color:"red"},null,8,["modelValue","value"]))])]))),128))])]),_:1})])):O("",!0),a(g).reserve_type==="contractor"?(c(),F("div",tt,[a(g).status?O("",!0):(c(),S(Be,{key:0},{default:l(()=>[e(H,null,{default:l(()=>[e(x,null,{default:l(()=>[i[36]||(i[36]=t("h5",null,"تعداد دریافتی کل",-1)),e(Le,{modelValue:a(B),"onUpdate:modelValue":i[5]||(i[5]=r=>ne(B)?B.value=r:null),min:1,max:a(j)},null,8,["modelValue","max"])]),_:1}),e(x,null,{default:l(()=>[i[37]||(i[37]=t("h5",null,"غذای روز",-1)),e(Le,{modelValue:a(L),"onUpdate:modelValue":i[6]||(i[6]=r=>ne(L)?L.value=r:null),min:1,max:a(B)},null,8,["modelValue","max"])]),_:1})]),_:1}),a(d)>0?(c(),S(H,{key:0},{default:l(()=>[e(x,{cols:"12",md:"12"},{default:l(()=>[e(ze,{modelValue:a(A),"onUpdate:modelValue":i[7]||(i[7]=r=>ne(A)?A.value=r:null),items:a(W),"item-title":"name","item-value":"id",label:"غذای دوم",variant:"outlined",clearable:"",rules:["requiredValidator"in w?w.requiredValidator:a(he)]},null,8,["modelValue","items","rules"])]),_:1}),a(A)?(c(),S(x,{key:0},{default:l(()=>[i[38]||(i[38]=t("h5",null,"تعداد دریافتی",-1)),e(Le,{modelValue:a(P),"onUpdate:modelValue":i[8]||(i[8]=r=>ne(P)?P.value=r:null),min:1,max:a(d)},null,8,["modelValue","max"])]),_:1})):O("",!0)]),_:1})):O("",!0),a(A)&&a(u)>0?(c(),S(H,{key:1},{default:l(()=>[e(x,{cols:"12",md:"12"},{default:l(()=>[e(ze,{modelValue:a(p),"onUpdate:modelValue":i[9]||(i[9]=r=>ne(p)?p.value=r:null),items:a(W).filter(r=>r.id!==a(A)),"item-title":"name","item-value":"id",label:"غذای سوم",variant:"outlined",clearable:"",rules:["requiredValidator"in w?w.requiredValidator:a(he)]},null,8,["modelValue","items","rules"])]),_:1}),a(p)?(c(),S(x,{key:0},{default:l(()=>[i[39]||(i[39]=t("h5",null,"تعداد دریافتی",-1)),e(Le,{modelValue:a(M),"onUpdate:modelValue":i[10]||(i[10]=r=>ne(M)?M.value=r:null),min:1,max:a(u)},null,8,["modelValue","max"])]),_:1})):O("",!0)]),_:1})):O("",!0)]),_:1}))])):O("",!0),a(g).reserve_type!=="guest"&&a(g).reserve_type==="contractor"&&!a(g).status?(c(),S(re,{key:2,class:"my-3"})):O("",!0)]),_:1})]),_:1})]),_:1},8,["width","model-value"])):O("",!0)],64)}}},nt={class:"d-flex justify-end gap-3 mb-3"},ot={key:0},rt={key:1},st={key:2,class:"text-center"},ut={class:"text-h5 text-center mb-2"},it={__name:"Foods",emits:["back"],async setup(E,{emit:ae}){let I,G;const K=ae,y=z("root"),f=fe({hasError:!1,errorMessage:"",isCreateFoodDialogVisible:!1,isEditFoodDialogVisible:!1}),h=fe({fetchingFoods:!0,createFood:!1,editFood:!1}),g=z([]),$=z(null),D=z(),R=z(null),j=z(null),B=[v=>/^\d+$/.test(String(v))?!0:"فقط باید عدد باشد!"];function L(){y.value!=="root"?y.value="root":K("back")}async function W(){var V;const v=await((V=D.value)==null?void 0:V.validate());if(!(v==null?void 0:v.valid))return;h.createFood=!0;const C=new FormData;C.append("name",R.value),C.append("price",Number(j.value||0));try{await oe("/food/food/",{method:"POST",body:C,onResponseError({response:b}){var m,U;if(f.hasError=!0,(m=b._data)!=null&&m.errors){const X=Object.values(b._data.errors).flat().join(" | ");f.errorMessage=X}else f.errorMessage=((U=b._data)==null?void 0:U.message)||"خطا در ایجاد"}}),f.hasError||(f.isCreateFoodDialogVisible=!1,d(),M())}catch(b){console.error(b)}finally{h.createFood=!1}}async function A(v){try{const C=(await oe(`/food/food/status/${v.id}`,{method:"POST",onResponseError({response:V}){f.hasError=!0,f.errorMessage=V._data.message||"خطا در تغییر وضعیت"}})).data;!f.hasError&&C&&(g.value=g.value.map(V=>V.id===C.id?C:V),f.isEditFoodDialogVisible=!1,d())}catch(n){console.error(n)}}function P(v){$.value=v,R.value=v.name,j.value=v.price,f.isEditFoodDialogVisible=!0}async function p(){var V;const v=await((V=D.value)==null?void 0:V.validate());if(!(v==null?void 0:v.valid))return;h.editFood=!0;const C=new FormData;C.append("name",R.value),C.append("price",Number(j.value||0));try{const m=(await oe(`/food/food/${$.value.id}`,{method:"POST",body:C,onResponseError({response:U}){var X,T;if(f.hasError=!0,(X=U._data)!=null&&X.errors){const le=Object.values(U._data.errors).flat().join(" | ");f.errorMessage=le}else f.errorMessage=((T=U._data)==null?void 0:T.message)||"خطا در ویرایش"}})).data;!f.hasError&&m&&(g.value=g.value.map(U=>U.id===m.id?m:U),f.isEditFoodDialogVisible=!1,d())}catch(b){console.error(b)}finally{h.editFood=!1}}async function M(){h.fetchingFoods=!0;try{const v=await oe("/food/food/",{method:"GET"});g.value=(v==null?void 0:v.data.foods)||[]}catch(v){console.error("Error fetching foods:",v),f.hasError=!0,f.errorMessage=v.message||"خطا در دریافت غذاها"}finally{h.fetchingFoods=!1}}[I,G]=el(()=>M()),await I,G();function d(){R.value=null,j.value=null}function u(v){v||(f.isCreateFoodDialogVisible=!1,f.isEditFoodDialogVisible=!1,d())}return(v,n)=>{const C=Pe;return c(),F(ee,null,[e(ye,{modelValue:a(f).hasError,"onUpdate:modelValue":n[0]||(n[0]=V=>a(f).hasError=V),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[s(o(a(f).errorMessage),1)]),_:1},8,["modelValue"]),t("div",null,[e(J,{variant:"text","prepend-icon":"tabler-arrow-right",class:"mb-4",onClick:L},{default:l(()=>[s(o(a(y)==="root"?"آشپزخانه":"صفحه قبل"),1)]),_:1})]),t("div",null,[t("div",nt,[a($e)("read","Kitchen")?(c(),S(J,{key:0,color:"primary",onClick:n[1]||(n[1]=V=>{a(f).isCreateFoodDialogVisible=!0})},{default:l(()=>[e(de,{icon:"tabler-plus",size:"24",style:{cursor:"pointer"}})]),_:1})):O("",!0)]),t("div",null,[!a(h).fetchingFoods&&a(g).length>0?(c(),S(Ve,{key:0},{default:l(()=>[n[10]||(n[10]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"نام"),t("th",null,"وضعیت"),t("th",null,"قیمت"),t("th",null,"ایجاد شده توسط"),t("th",null,"آخرین ویرایش توسط"),t("th",null,"عملیات")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se(a(g),(V,b)=>(c(),F("tr",{key:V.id},[t("td",null,o(b+1),1),t("td",null,o(V.name),1),V.id!==1?(c(),F("td",ot,[e(_,{color:V.status?"success":"error",size:"small"},{default:l(()=>[s(o(V.status?"فعال":"غیرفعال"),1)]),_:2},1032,["color"])])):O("",!0),V.id===1?(c(),F("td",rt,[e(_,{color:"success",size:"small"},{default:l(()=>[...n[9]||(n[9]=[s(" فعال ",-1)])]),_:1})])):O("",!0),t("td",null,[e(_,{color:"primary"},{default:l(()=>[s(o(Number(V.price).toLocaleString("fa-IR")),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(V.createdBy?`${V.createdBy.fullName} - ${V.createdBy.username}`:"—"),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(V.editedBy?`${V.editedBy.fullName} - ${V.editedBy.username}`:"—"),1)]),_:2},1024)]),t("td",null,[a($e)("edit","Food-Status")?(c(),S(de,{key:0,disabled:V.id===1,icon:"tabler-power",color:V.status?"red":"green",size:"24",onClick:m=>A(V)},null,8,["disabled","color","onClick"])):O("",!0),a($e)("edit","Food-Price")?(c(),S(de,{key:1,disabled:V.id===1,icon:"tabler-edit",color:"primary",size:"24",onClick:m=>P(V)},null,8,["disabled","onClick"])):O("",!0)])]))),128))])]),_:1})):a(h).fetchingFoods?(c(),S(Me,{key:1,type:"card"})):(c(),F("div",st,[e(_,{color:"error"},{default:l(()=>[...n[11]||(n[11]=[s(" غذایی برای نمایش وجود ندارد ",-1)])]),_:1})]))])]),e(we,{width:v.$vuetify.display.smAndDown?"auto":900,"model-value":a(f).isCreateFoodDialogVisible,"onUpdate:modelValue":u},{default:l(()=>[e(C,{onClick:n[2]||(n[2]=V=>u(!1))}),e(ce,null,{default:l(()=>[e(ke,null,{default:l(()=>[n[14]||(n[14]=t("h4",{class:"text-h5 text-center mb-2"}," افزودن غذا ",-1)),e(Ue,{ref_key:"refVForm",ref:D,class:"mt-6","validate-on":"submit lazy",onSubmit:Te(W,["prevent"])},{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",md:"6"},{default:l(()=>[e(xe,{disabled:a(h).createFood},{default:l(()=>[e(pe,{modelValue:a(R),"onUpdate:modelValue":n[3]||(n[3]=V=>ne(R)?R.value=V:null),rules:["requiredValidator"in v?v.requiredValidator:a(he)],disabled:a(h).createFood,simple:"",label:"نام"},null,8,["modelValue","rules","disabled"])]),_:1},8,["disabled"])]),_:1}),e(x,{cols:"12",md:"6"},{default:l(()=>[e(xe,null,{default:l(()=>[e(pe,{modelValue:a(j),"onUpdate:modelValue":n[4]||(n[4]=V=>ne(j)?j.value=V:null),rules:["requiredValidator"in v?v.requiredValidator:a(he),...B],disabled:a(h).createFood,simple:"",label:"قیمت"},null,8,["modelValue","rules","disabled"])]),_:1})]),_:1}),e(x,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(J,{type:"submit",disabled:a(h).createFood,loading:a(h).createFood},{default:l(()=>[...n[12]||(n[12]=[s(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),e(J,{color:"secondary",variant:"tonal",onClick:n[5]||(n[5]=V=>u(!1))},{default:l(()=>[...n[13]||(n[13]=[s(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"]),e(we,{width:v.$vuetify.display.smAndDown?"auto":450,"model-value":a(f).isEditFoodDialogVisible,"onUpdate:modelValue":u},{default:l(()=>[e(C,{onClick:n[6]||(n[6]=V=>u(!1))}),e(ce,null,{default:l(()=>[e(ke,null,{default:l(()=>{var V;return[t("h4",ut," ویرایش قیمت: "+o((V=a($))==null?void 0:V.name),1),e(Ue,{ref_key:"refVForm",ref:D,class:"mt-6","validate-on":"submit lazy",onSubmit:Te(p,["prevent"])},{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",md:"12"},{default:l(()=>[e(xe,null,{default:l(()=>[e(pe,{modelValue:a(j),"onUpdate:modelValue":n[7]||(n[7]=b=>ne(j)?j.value=b:null),rules:["requiredValidator"in v?v.requiredValidator:a(he),...B],disabled:a(h).editFood,simple:"",label:"قیمت"},null,8,["modelValue","rules","disabled"])]),_:1})]),_:1}),e(x,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(J,{type:"submit",disabled:a(h).editFood,loading:a(h).editFood},{default:l(()=>[...n[15]||(n[15]=[s(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),e(J,{color:"secondary",variant:"tonal",onClick:n[8]||(n[8]=b=>u(!1))},{default:l(()=>[...n[16]||(n[16]=[s(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1})]),_:1},8,["width","model-value"])],64)}}},dt={class:"pa-3"},ct={class:"d-flex justify-space-between w-100 align-center"},ft={class:"pa-2"},mt={class:"mt-2 text-center"},vt={key:2,class:"text-center"},pt={__name:"MealPlan",emits:["back"],setup(E,{emit:ae}){const I=ae,G=z("root"),K=fe({success:!1,successMessage:"",hasError:!1,errorMessage:"",isEditDialogVisible:!1}),y=fe({fetchingPlans:!0,fetchingMeals:!1,fetchingFoods:!1,createPlan:!1,editPlan:!1}),f=z([]),h=z([]),g=z([]),$=z(""),D=z({jy:null,jm:null,jd:null}),R=z(null),j=z(null),B=z(null),L=z(null),W=z();function A(b){K.hasError=!0,K.errorMessage=b}function P(){G.value!=="root"?G.value="root":I("back")}function p(b){K.isEditDialogVisible=b,M()}function M(){L.value=null,j.value=null,B.value=null}async function d(){if(!$.value)return A("تاریخ را انتخاب کنید.");if(!R.value)return A("وعده را انتخاب کنید.");if(!j.value)return A("غذا را انتخاب کنید.");y.createPlan=!0;try{const[b,m,U]=String($.value).split("/").map(Number),X=b*1e4+m*100+U,T=D.value.jy*1e4+D.value.jm*100+D.value.jd;if(X<T)return A("نمیتوان برای گذشته برنامه غذایی ثبت کرد.");const le={date:$.value,meal_id:R.value,food_id:j.value},w=await oe("/food/meal-plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(le),onResponseError({response:i}){var Q,r;if((Q=i._data)!=null&&Q.errors){const q=Object.values(i._data.errors).flat().join(" | ");A(q||"خطا در ایجاد.")}else A(((r=i._data)==null?void 0:r.message)||"خطا در ایجاد")}});return await n(),w}catch(b){console.error("Error create plan:",b)}finally{y.createPlan=!1,j.value=null,R.value=null}}async function u(b){const[m,U,X]=String($.value).split("/").map(Number),T=m*1e4+U*100+X,le=D.value.jy*1e4+D.value.jm*100+D.value.jd;if(T<le){A("نمیتوان برنامه غذایی گذشته را ویرایش کرد."),K.isEditDialogVisible=!1;return}let w=!1;try{const i=await oe("/food/meal-reservation/check-for-delivered",{method:"GET",params:{date:b.date,meal_id:b.meal.id}});w=!!(i!=null&&i.data)}catch(i){console.error("Error checking:",i)}if(w){A("درخواست تحویل داده شده وجود دارد. قابلیت ویرایش غیرفعال است.");return}L.value=b,B.value=b.food.id,K.isEditDialogVisible=!0}async function v(){var X;const b=await((X=W.value)==null?void 0:X.validate());if(!(b==null?void 0:b.valid))return;y.editPlan=!0;const U=new FormData;U.append("food_id",B.value),U.append("date",$.value);try{const le=(await oe(`/food/meal-plan/${L.value.id}`,{method:"POST",body:U,onResponseError({response:w}){var i,Q;if((i=w._data)!=null&&i.errors){const r=Object.values(w._data.errors).flat().join(" | ");A(r||"خطا در ویرایش")}else A(((Q=w._data)==null?void 0:Q.message)||"خطا در ویرایش")}})).data;!K.hasError&&le&&(K.isEditDialogVisible=!1,M(),n())}catch(T){console.error(T)}finally{y.editPlan=!1}}async function n(){var m;f.value=[],y.fetchingPlans=!0;const b=$.value;try{const U=await oe("/food/meal-plan/get-for-date",{method:"GET",params:{date:b}});f.value=((m=U==null?void 0:U.data)==null?void 0:m.mealPlans)||[]}catch(U){console.error("Error fetching meal plans:",U)}finally{y.fetchingPlans=!1}}async function C(){y.fetchingMeals=!0;try{const b=await oe("/food/meal/get-actives",{method:"GET"});h.value=(b==null?void 0:b.data.meals)||[]}catch(b){console.error("Error fetching meals:",b),A(b.message||"خطا در دریافت وعده‌ها")}finally{y.fetchingMeals=!1}}async function V(){y.fetchingFoods=!0;try{const b=await oe("/food/food/get-actives",{method:"GET"});g.value=(b==null?void 0:b.data.foods)||[]}catch(b){console.error("Error fetching foods:",b),A(b.message||"خطا در دریافت غذاها")}finally{y.fetchingFoods=!1}}return Ye(async()=>{await C(),await V();const b=new Date,m=Je.toJalaali(b.getFullYear(),b.getMonth()+1,b.getDate());D.value=m,$.value=`${m.jy}/${m.jm}/${m.jd}`,await n()}),(b,m)=>{const U=Ke("PersianDatetimePicker"),X=Pe;return c(),F(ee,null,[t("div",null,[e(J,{variant:"text","prepend-icon":"tabler-arrow-right",class:"mb-4",onClick:P},{default:l(()=>[s(o(a(G)==="root"?"آشپزخانه":"صفحه قبل"),1)]),_:1})]),e(Be,null,{default:l(()=>[e(ye,{modelValue:a(K).hasError,"onUpdate:modelValue":m[0]||(m[0]=T=>a(K).hasError=T),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[s(o(a(K).errorMessage),1)]),_:1},8,["modelValue"]),e(ye,{modelValue:a(K).success,"onUpdate:modelValue":m[1]||(m[1]=T=>a(K).success=T),timeout:2e3,location:"center",variant:"flat",color:"success"},{default:l(()=>[s(o(a(K).successMessage),1)]),_:1},8,["modelValue"]),e(H,{dense:""},{default:l(()=>[e(x,{cols:"12",md:"4",class:"d-flex justify-center mb-4 mb-md-0"},{default:l(()=>[m[9]||(m[9]=t("input",{id:"custom-input",style:{display:"none"}},null,-1)),e(U,{modelValue:a($),"onUpdate:modelValue":m[2]||(m[2]=T=>ne($)?$.value=T:null),format:"jYYYY/jMM/jDD",inline:"","custom-input":"#custom-input",onChange:n},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"8"},{default:l(()=>[e(ce,{class:"mb-4"},{default:l(()=>[m[11]||(m[11]=t("label",{class:"font-weight-medium mb-2 mt-2 d-block text-center"}," برنامه غذایی ",-1)),e(H,{class:"mb-4 px-4"},{default:l(()=>[e(x,{cols:"12",sm:"12",md:"12"},{default:l(()=>[e(pe,{modelValue:a($),"onUpdate:modelValue":m[3]||(m[3]=T=>ne($)?$.value=T:null),label:"تاریخ",variant:"outlined",readonly:""},null,8,["modelValue"])]),_:1}),e(x,{cols:"12",md:"12"},{default:l(()=>[e(ze,{modelValue:a(R),"onUpdate:modelValue":m[4]||(m[4]=T=>ne(R)?R.value=T:null),items:a(h),"item-title":"name","item-value":"id",label:"وعده",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1}),e(x,{cols:"12",md:"12"},{default:l(()=>[e(ze,{modelValue:a(j),"onUpdate:modelValue":m[5]||(m[5]=T=>ne(j)?j.value=T:null),items:a(g),"item-title":"name","item-value":"id",label:"غذا",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),e(H,{justify:"center",class:"mb-4"},{default:l(()=>[e(x,{cols:"auto"},{default:l(()=>[e(J,{color:"primary",disabled:a(y).createPlan,loading:a(y).createPlan,onClick:d},{default:l(()=>[...m[10]||(m[10]=[s(" ثبت ",-1)])]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1}),t("div",dt,[!a(y).fetchingPlans&&a(f).length>0?(c(),S(Ee,{key:0,variant:"accordion"},{default:l(()=>[e(Ce,null,{default:l(()=>[e(Fe,{class:"font-weight-bold"},{default:l(()=>[...m[12]||(m[12]=[s(" برنامه غذایی تاریخ انتخاب شده ",-1)])]),_:1}),e(Re,null,{default:l(()=>[e(Ee,{variant:"accordion"},{default:l(()=>[(c(!0),F(ee,null,se(a(f),(T,le)=>(c(),S(Ce,{key:le,class:"mb-2"},{default:l(()=>[e(Fe,null,{default:l(()=>[t("div",ct,[t("span",null,o(T.meal.name),1),e(_,null,{default:l(()=>[s(o(T.food.name),1)]),_:2},1024)])]),_:2},1024),e(Re,null,{default:l(()=>[t("div",ft,[t("div",null,[m[13]||(m[13]=t("strong",null,"ایجاد شده توسط:",-1)),s(" "+o(T.createdBy?`${T.createdBy.fullName} - ${T.createdBy.username}`:"—"),1)]),t("div",null,[m[14]||(m[14]=t("strong",null,"آخرین ویرایش توسط:",-1)),s(" "+o(T.editedBy?`${T.editedBy.fullName} - ${T.editedBy.username}`:"—"),1)]),t("div",mt,[e(J,{color:"orange",variant:"text",size:"small",onClick:w=>u(T)},{default:l(()=>[e(de,{icon:"tabler-edit",size:"20"})]),_:1},8,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})):a(y).fetchingPlans?(c(),S(Me,{key:1,type:"card"})):(c(),F("div",vt,[e(_,{color:"error"},{default:l(()=>[...m[15]||(m[15]=[s(" برنامه غذایی برای نمایش وجود ندارد ",-1)])]),_:1})]))])]),_:1})]),_:1})]),_:1}),e(we,{width:b.$vuetify.display.smAndDown?"auto":450,"model-value":a(K).isEditDialogVisible,"onUpdate:modelValue":p},{default:l(()=>[e(X,{onClick:m[6]||(m[6]=T=>p(!1))}),e(ce,null,{default:l(()=>[e(ke,null,{default:l(()=>[m[18]||(m[18]=t("h4",{class:"text-h5 text-center mb-2"}," ویرایش برنامه غذایی: ",-1)),e(Ue,{ref_key:"refVForm",ref:W,class:"mt-6","validate-on":"submit lazy",onSubmit:Te(v,["prevent"])},{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",md:"12"},{default:l(()=>[e(xe,{disabled:a(y).editPlan},{default:l(()=>[e(ze,{modelValue:a(B),"onUpdate:modelValue":m[7]||(m[7]=T=>ne(B)?B.value=T:null),items:a(g),"item-title":"name","item-value":"id",label:"غذا",variant:"outlined",clearable:"",rules:["requiredValidator"in b?b.requiredValidator:a(he)]},null,8,["modelValue","items","rules"])]),_:1},8,["disabled"])]),_:1}),e(x,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(J,{type:"submit",disabled:a(y).editPlan,loading:a(y).editPlan},{default:l(()=>[...m[16]||(m[16]=[s(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),e(J,{color:"secondary",variant:"tonal",onClick:m[8]||(m[8]=T=>p(!1))},{default:l(()=>[...m[17]||(m[17]=[s(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])],64)}}},yt={class:"d-flex justify-end gap-3 mb-3"},gt={key:1},bt={key:1,class:"text-center"},_t={class:"text-h5 text-center mb-2"},Vt={__name:"Meals",emits:["back"],async setup(E,{emit:ae}){let I,G;const K=ae,y=z("root"),f=fe({hasError:!1,errorMessage:"",isCreateMealDialogVisible:!1,isEditMealDialogVisible:!1}),h=fe({fetchingMeals:!0,createMeal:!1,editMeal:!1}),g=z([]),$=z(null),D=z(),R=z(null);function j(){y.value!=="root"?y.value="root":K("back")}async function B(){var n;const d=await((n=D.value)==null?void 0:n.validate());if(!(d==null?void 0:d.valid))return;h.createMeal=!0;const v=new FormData;v.append("name",R.value);try{await oe("/food/meal/",{method:"POST",body:v,onResponseError({response:C}){var V,b;if(f.hasError=!0,(V=C._data)!=null&&V.errors){const m=Object.values(C._data.errors).flat().join(" | ");f.errorMessage=m}else f.errorMessage=((b=C._data)==null?void 0:b.message)||"خطا در ایجاد"}}),f.hasError||(f.isCreateMealDialogVisible=!1,p(),P())}catch(C){console.error(C)}finally{h.createMeal=!1}}async function L(d){try{const v=(await oe(`/food/meal/status/${d.id}`,{method:"POST",onResponseError({response:n}){f.hasError=!0,f.errorMessage=n._data.message||"خطا در تغییر وضعیت"}})).data;!f.hasError&&v&&(g.value=g.value.map(n=>n.id===v.id?v:n),f.isEditMealDialogVisible=!1,p())}catch(u){console.error(u)}}function W(d){$.value=d,R.value=d.name,f.isEditMealDialogVisible=!0}async function A(){var n;const d=await((n=D.value)==null?void 0:n.validate());if(!(d==null?void 0:d.valid))return;h.editMeal=!0;const v=new FormData;v.append("name",R.value);try{const V=(await oe(`/food/meal/${$.value.id}`,{method:"POST",body:v,onResponseError({response:b}){var m,U;if(f.hasError=!0,(m=b._data)!=null&&m.errors){const X=Object.values(b._data.errors).flat().join(" | ");f.errorMessage=X}else f.errorMessage=((U=b._data)==null?void 0:U.message)||"خطا در ویرایش"}})).data;!f.hasError&&V&&(g.value=g.value.map(b=>b.id===V.id?V:b),f.isEditMealDialogVisible=!1,p())}catch(C){console.error(C)}finally{h.editMeal=!1}}async function P(){h.fetchingMeals=!0;try{const d=await oe("/food/meal/",{method:"GET"});g.value=(d==null?void 0:d.data.meals)||[]}catch(d){console.error("Error fetching meals:",d),f.hasError=!0,f.errorMessage=d.message||"خطا در دریافت وعده‌ها"}finally{h.fetchingMeals=!1}}[I,G]=el(()=>P()),await I,G();function p(){R.value=null}function M(d){d||(f.isCreateMealDialogVisible=!1,f.isEditMealDialogVisible=!1,p())}return(d,u)=>{const v=Pe;return c(),F(ee,null,[e(ye,{modelValue:a(f).hasError,"onUpdate:modelValue":u[0]||(u[0]=n=>a(f).hasError=n),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[s(o(a(f).errorMessage),1)]),_:1},8,["modelValue"]),t("div",null,[e(J,{variant:"text","prepend-icon":"tabler-arrow-right",class:"mb-4",onClick:j},{default:l(()=>[s(o(a(y)==="root"?"آشپزخانه":"صفحه قبل"),1)]),_:1})]),t("div",null,[t("div",yt,[e(J,{color:"primary",onClick:u[1]||(u[1]=n=>{a(f).isCreateMealDialogVisible=!0})},{default:l(()=>[e(de,{icon:"tabler-plus",size:"24",style:{cursor:"pointer"}})]),_:1})]),a(h).fetchingMeals?(c(),S(ce,{key:0,class:"text-center"},{default:l(()=>[e(ke,null,{default:l(()=>[e(vl,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(c(),F("div",gt,[a(g).length>0?(c(),S(Ve,{key:0},{default:l(()=>[u[8]||(u[8]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"نام"),t("th",null,"وضعیت"),t("th",null,"ایجاد شده توسط"),t("th",null,"آخرین ویرایش توسط"),t("th",null,"عملیات")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se(a(g),(n,C)=>(c(),F("tr",{key:n.id},[t("td",null,o(C+1),1),t("td",null,o(n.name),1),t("td",null,[e(_,{color:n.status?"success":"error",size:"small"},{default:l(()=>[s(o(n.status?"فعال":"غیرفعال"),1)]),_:2},1032,["color"])]),t("td",null,[e(_,null,{default:l(()=>[s(o(n.createdBy?`${n.createdBy.fullName} - ${n.createdBy.username}`:"—"),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(n.editedBy?`${n.editedBy.fullName} - ${n.editedBy.username}`:"—"),1)]),_:2},1024)]),t("td",null,[e(de,{icon:"tabler-power",color:n.status?"red":"green",size:"24",onClick:V=>L(n)},null,8,["color","onClick"]),e(de,{icon:"tabler-edit",color:"primary",size:"24",onClick:V=>W(n)},null,8,["onClick"])])]))),128))])]),_:1})):(c(),F("div",bt," وعده‌ای برای نمایش وجود ندارد "))]))]),e(we,{width:d.$vuetify.display.smAndDown?"auto":450,"model-value":a(f).isCreateMealDialogVisible,"onUpdate:modelValue":M},{default:l(()=>[e(v,{onClick:u[2]||(u[2]=n=>M(!1))}),e(ce,null,{default:l(()=>[e(ke,null,{default:l(()=>[u[11]||(u[11]=t("h4",{class:"text-h5 text-center mb-2"}," افزودن وعده ",-1)),e(Ue,{ref_key:"refVForm",ref:D,class:"mt-6","validate-on":"submit lazy",onSubmit:Te(B,["prevent"])},{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",md:"12"},{default:l(()=>[e(xe,{disabled:a(h).createMeal},{default:l(()=>[e(pe,{modelValue:a(R),"onUpdate:modelValue":u[3]||(u[3]=n=>ne(R)?R.value=n:null),rules:["requiredValidator"in d?d.requiredValidator:a(he)],disabled:a(h).createMeal,simple:"",label:"نام"},null,8,["modelValue","rules","disabled"])]),_:1},8,["disabled"])]),_:1}),e(x,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(J,{type:"submit",disabled:a(h).createMeal,loading:a(h).createMeal},{default:l(()=>[...u[9]||(u[9]=[s(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),e(J,{color:"secondary",variant:"tonal",onClick:u[4]||(u[4]=n=>M(!1))},{default:l(()=>[...u[10]||(u[10]=[s(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"]),e(we,{width:d.$vuetify.display.smAndDown?"auto":450,"model-value":a(f).isEditMealDialogVisible,"onUpdate:modelValue":M},{default:l(()=>[e(v,{onClick:u[5]||(u[5]=n=>M(!1))}),e(ce,null,{default:l(()=>[e(ke,null,{default:l(()=>{var n;return[t("h4",_t," ویرایش وعده: "+o((n=a($))==null?void 0:n.name),1),e(Ue,{ref_key:"refVForm",ref:D,class:"mt-6","validate-on":"submit lazy",onSubmit:Te(A,["prevent"])},{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",md:"12"},{default:l(()=>[e(xe,{disabled:a(h).editMeal},{default:l(()=>[e(pe,{modelValue:a(R),"onUpdate:modelValue":u[6]||(u[6]=C=>ne(R)?R.value=C:null),rules:["requiredValidator"in d?d.requiredValidator:a(he)],disabled:a(h).editMeal,simple:"",label:"نام"},null,8,["modelValue","rules","disabled"])]),_:1},8,["disabled"])]),_:1}),e(x,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:l(()=>[e(J,{type:"submit",disabled:a(h).editMeal,loading:a(h).editMeal},{default:l(()=>[...u[12]||(u[12]=[s(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),e(J,{color:"secondary",variant:"tonal",onClick:u[7]||(u[7]=C=>M(!1))},{default:l(()=>[...u[13]||(u[13]=[s(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]}),_:1})]),_:1})]),_:1},8,["width","model-value"])],64)}}},kt={class:"overflow-auto d-md-block"},ht={key:0,class:"text-center mb-4"},wt={key:1},Mt={class:"py-2"},Dt={style:{"max-width":"420px","white-space":"normal","overflow-wrap":"anywhere"}},$t={key:2,class:"text-center"},xt={style:{"white-space":"normal","overflow-wrap":"anywhere"}},Et={key:0},Ct={key:1},Ft={__name:"Statistics",emits:["back"],setup(E,{emit:ae}){const I=ae,G=z("root");function K(){G.value!=="root"?G.value="root":I("back")}const y=fe({success:!1,successMessage:"",hasError:!1,errorMessage:"",isDetailsDialogVisible:!1}),f=fe({fetchingReservedMeals:!1}),h=z([]),g=z(null),$=z(null);function D(P){y.hasError=!0,y.errorMessage=P}function R(P){y.isDetailsDialogVisible=P,P||($.value=null)}function j(P){$.value=P,y.isDetailsDialogVisible=!0}async function B(){if(!g.value){D("تاریخ را انتخاب کنید.");return}if(!g.value[1]){D("تاریخ باید به صورت بازه‌ای باشد.");return}h.value=[],f.fetchingReservedMeals=!0;try{const P=await oe("/food/meal-reservation/get-in-date-range",{method:"GET",params:{"date[]":g.value}});h.value=((P==null?void 0:P.data)||[]).flat()}catch(P){console.error("Error fetching reserved meals:",P),D("خطا در دریافت رزروهای بازه")}finally{f.fetchingReservedMeals=!1}}const L=te(()=>[...h.value].sort((P,p)=>{var M,d;return String(((M=P==null?void 0:P.meal)==null?void 0:M.name)||"").localeCompare(String(((d=p==null?void 0:p.meal)==null?void 0:d.name)||""))})),W=te(()=>{var p,M;const P={};for(const d of h.value){const u=((p=d.meal)==null?void 0:p.name)||"نامشخص",v=((M=d.details)==null?void 0:M.reduce((n,C)=>n+(C.quantity||0),0))||0;P[u]||(P[u]=0),P[u]+=v}return Object.entries(P).map(([d,u])=>({name:d,total:u}))}),A=te(()=>{var p,M;const P={};for(const d of h.value){const u=`${((p=d.meal)==null?void 0:p.name)||"نامشخص"} تحویل نشده`,v=((M=d.details)==null?void 0:M.reduce((n,C)=>n+(C.delivery_status?0:C.quantity||0),0))??0;P[u]||(P[u]=0),P[u]+=v}return Object.entries(P).map(([d,u])=>({name:d,total:u}))});return(P,p)=>{const M=Ke("PersianDatetimePicker"),d=Pe;return c(),F(ee,null,[t("div",null,[e(J,{variant:"text","prepend-icon":"tabler-arrow-right",class:"mb-4",onClick:K},{default:l(()=>[s(o(a(G)==="root"?"آشپزخانه":"صفحه قبل"),1)]),_:1})]),e(ye,{modelValue:a(y).hasError,"onUpdate:modelValue":p[0]||(p[0]=u=>a(y).hasError=u),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[s(o(a(y).errorMessage),1)]),_:1},8,["modelValue"]),e(ye,{modelValue:a(y).success,"onUpdate:modelValue":p[1]||(p[1]=u=>a(y).success=u),timeout:2e3,location:"center",variant:"flat",color:"success"},{default:l(()=>[s(o(a(y).successMessage),1)]),_:1},8,["modelValue"]),e(H,{dense:""},{default:l(()=>[e(x,null,{default:l(()=>[e(x,{class:"d-flex justify-center"},{default:l(()=>[e(M,{modelValue:a(g),"onUpdate:modelValue":p[2]||(p[2]=u=>ne(g)?g.value=u:null),format:"jYYYY/jMM/jDD",range:""},null,8,["modelValue"])]),_:1}),e(x,{class:"d-flex justify-center"},{default:l(()=>[e(J,{color:"primary",loading:a(f).fetchingReservedMeals,disabled:a(f).fetchingReservedMeals,onClick:B},{default:l(()=>[...p[4]||(p[4]=[s(" جستجو ",-1)])]),_:1},8,["loading","disabled"])]),_:1}),t("div",kt,[!a(f).fetchingReservedMeals&&a(L).length>0?(c(),S(x,{key:0,cols:"12",md:"12"},{default:l(()=>[p[6]||(p[6]=t("label",{class:"font-weight-medium mb-4 d-block text-center"}," رزروهای بازه ",-1)),a(L).length?(c(),F("div",ht,[(c(!0),F(ee,null,se(a(W),u=>(c(),S(_,{key:u.name,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:l(()=>[s(o(u.name)+": "+o(u.total),1)]),_:2},1024))),128)),(c(!0),F(ee,null,se(a(A),u=>(c(),S(_,{key:u.name,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:l(()=>[s(o(u.name)+": "+o(u.total),1)]),_:2},1024))),128))])):O("",!0),e(Ve,null,{default:l(()=>[p[5]||(p[5]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"وعده"),t("th",null,"رزرو کننده"),t("th",null,"کد پرسنلی"),t("th",null,"تاریخ"),t("th",null,"کد تحویل"),t("th",null,"نوع رزرو"),t("th",null,"وضعیت"),t("th",null,"پیمانکار"),t("th",null,"تعداد"),t("th",null,"توضیحات"),t("th",null,"جزئیات")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se(a(L),(u,v)=>{var n,C,V,b,m;return c(),F("tr",{key:u.id},[t("td",null,o(v+1),1),t("td",null,o((n=u.meal)==null?void 0:n.name),1),t("td",null,[e(_,{color:"primary"},{default:l(()=>[s(o(u.created_by?`${u.created_by.first_name} ${u.created_by.last_name}`:"—"),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(u.created_by?`${u.created_by.personnel_code}`:"—"),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(u.date),1)]),_:2},1024)]),t("td",null,[e(_,{color:"success"},{default:l(()=>[s(o(u.delivery_code),1)]),_:2},1024)]),t("td",null,[e(_,{color:"orange"},{default:l(()=>[s(o({personnel:"پرسنل",contractor:"پیمانکار",guest:"مهمان",repairman:"تعمیرکار"}[u.reserve_type]||""),1)]),_:2},1024)]),t("td",null,[e(_,{color:u.status?"success":"error",size:"small"},{default:l(()=>[s(o(u.status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])]),t("td",null,[(V=(C=u.details)==null?void 0:C[0])!=null&&V.contractor?(c(),S(_,{key:0},{default:l(()=>[s(o(`${u.details[0].contractor.first_name} ${u.details[0].contractor.last_name}`),1)]),_:2},1024)):(c(),F("span",wt,"—"))]),t("td",null,o((b=u.details)==null?void 0:b.reduce((U,X)=>U+(X.quantity||0),0)),1),t("td",Mt,[e(ll,{location:"top",disabled:!(((m=u.description)==null?void 0:m.length)>6)},{activator:l(({props:U})=>[t("div",He({ref_for:!0},U,{class:"text-truncate",style:{"max-width":"120px"}}),o(u.description||"—"),17)]),default:l(()=>[t("div",Dt,o(u.description),1)]),_:2},1032,["disabled"])]),t("td",null,[e(J,{color:"primary",variant:"text",size:"small",onClick:U=>j(u)},{default:l(()=>[e(de,{icon:"tabler-file-description",size:"20"})]),_:1},8,["onClick"])])])}),128))])]),_:1})]),_:1})):a(f).fetchingReservedMeals?(c(),S(Me,{key:1,type:"card"})):(c(),F("div",$t,[e(_,{color:"error"},{default:l(()=>[...p[7]||(p[7]=[s(" رزروی برای نمایش وجود ندارد ",-1)])]),_:1})]))])]),_:1})]),_:1}),a($)?(c(),S(we,{key:0,width:P.$vuetify.display.smAndDown?"auto":900,"model-value":a(y).isDetailsDialogVisible,"onUpdate:modelValue":R},{default:l(()=>[e(d,{onClick:p[3]||(p[3]=u=>R(!1))}),e(ce,null,{default:l(()=>[e(Ze,{class:"text-h6"},{default:l(()=>[...p[8]||(p[8]=[s(" جزئیات ",-1)])]),_:1}),e(ke,null,{default:l(()=>[e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[9]||(p[9]=t("strong",null,"رزرو کننده:",-1)),e(_,{color:"orange",size:"small"},{default:l(()=>[s(o(a($).created_by?`${a($).created_by.first_name} ${a($).created_by.last_name}`:"—"),1)]),_:1})])]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[10]||(p[10]=t("strong",null,"کد پرسنلی:",-1)),e(_,{color:"orange",size:"small"},{default:l(()=>[s(o(a($).created_by?`${a($).created_by.personnel_code}`:"—"),1)]),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>{var u,v;return[e(x,{cols:"12",sm:"6"},{default:l(()=>[p[11]||(p[11]=t("strong",null,"کد تحویل:",-1)),e(_,{color:"primary",size:"small"},{default:l(()=>[s(o(a($).delivery_code),1)]),_:1})]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[12]||(p[12]=t("strong",null,"وعده:",-1)),e(_,{color:"primary",size:"small"},{default:l(()=>{var n;return[s(o((n=a($).meal)==null?void 0:n.name),1)]}),_:1})])]),_:1}),e(re,{class:"my-3"}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[13]||(p[13]=t("strong",null,"نوع رزرو:",-1)),e(_,{size:"small"},{default:l(()=>[s(o({personnel:"پرسنل",contractor:"پیمانکار",guest:"مهمان",repairman:"تعمیرکار"}[a($).reserve_type]||""),1)]),_:1})])]),_:1}),(v=(u=a($).details)==null?void 0:u[0])!=null&&v.contractor?(c(),S(x,{key:0,cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[14]||(p[14]=t("strong",null,"پیمانکار:",-1)),e(_,null,{default:l(()=>[s(o(`${a($).details[0].contractor.first_name} ${a($).details[0].contractor.last_name}`),1)]),_:1})])]),_:1})):O("",!0),a($).reserve_type==="guest"?(c(),S(x,{key:1,cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[15]||(p[15]=t("strong",null,"نوع سرو:",-1)),e(_,{color:"cyan",size:"small"},{default:l(()=>[s(o({serve_in_kitchen:"سرو در رستوران",deliver:"تحویل(بیرون‌بر)"}[a($).serve_place]||""),1)]),_:1}),a($).serve_place==="serve_in_kitchen"?(c(),S(_,{key:0,size:"small"},{default:l(()=>[s(" ساعت حضور: "+o(a($).attendance_hour),1)]),_:1})):O("",!0)])]),_:1})):O("",!0)]}),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>[e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[16]||(p[16]=t("strong",null,"وضعیت:",-1)),e(_,{color:a($).status?"success":"error",size:"small"},{default:l(()=>[s(o(a($).status?"تحویل شده":"تحویل نشده"),1)]),_:1},8,["color"])])]),_:1}),e(x,{cols:"12",sm:"6"},{default:l(()=>[t("p",null,[p[17]||(p[17]=t("strong",null,"تعداد:",-1)),e(_,{size:"small"},{default:l(()=>{var u;return[s(o((u=a($).details)==null?void 0:u.reduce((v,n)=>v+(n.quantity||0),0)),1)]}),_:1})])]),_:1})]),_:1}),e(re,{class:"my-3"}),e(H,null,{default:l(()=>[a($).description?(c(),S(x,{key:0,cols:"12",sm:"12"},{default:l(()=>[t("p",xt,[p[18]||(p[18]=t("strong",null,"توضیحات:",-1)),s(" "+o(a($).description),1)])]),_:1})):O("",!0)]),_:1}),e(re,{class:"my-3"}),a($).reserve_type==="personnel"?(c(),F("div",Et,[e(Ve,{density:"comfortable"},{default:l(()=>[p[19]||(p[19]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"نام"),t("th",null,"کد پرسنلی"),t("th",null,"وضعیت")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se((a($).details||[]).filter(u=>u.personnel),(u,v)=>(c(),F("tr",{key:u.id},[t("td",null,o(v+1),1),t("td",null,o(`${u.personnel.first_name} ${u.personnel.last_name}`),1),t("td",null,o(u.personnel.personnel_code),1),t("td",null,[e(_,{color:u.delivery_status?"success":"error",size:"small"},{default:l(()=>[s(o(u.delivery_status?"تحویل شده":"تحویل نشده"),1)]),_:2},1032,["color"])])]))),128))])]),_:1})])):O("",!0),a($).reserve_type==="contractor"?(c(),F("div",Ct,[e(Ve,{density:"comfortable"},{default:l(()=>[p[20]||(p[20]=t("thead",null,[t("tr",null,[t("th",null,"ردیف"),t("th",null,"غذا"),t("th",null,"قیمت"),t("th",null,"تعداد"),t("th",null,"مبلغ کل")])],-1)),t("tbody",null,[(c(!0),F(ee,null,se(a($).details,(u,v)=>(c(),F("tr",{key:u.id},[t("td",null,o(v+1),1),t("td",null,[e(_,null,{default:l(()=>{var n;return[s(o((n=u.food)==null?void 0:n.name),1)]}),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(Number(u.food_price||0).toLocaleString("fa-IR"))+" ریال ",1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(u.quantity),1)]),_:2},1024)]),t("td",null,[e(_,null,{default:l(()=>[s(o(Number((u.quantity||0)*(u.food_price||0)).toLocaleString("fa-IR"))+" ریال ",1)]),_:2},1024)])]))),128))])]),_:1})])):O("",!0),a($).reserve_type!=="guest"&&a($).reserve_type==="contractor"&&!a($).status?(c(),S(re,{key:2,class:"my-3"})):O("",!0)]),_:1})]),_:1})]),_:1},8,["width","model-value"])):O("",!0)],64)}}},Rt={key:0},Pt={class:"font-weight-medium"},pa={__name:"kitchen",setup(E){const ae=z("root"),I=te(()=>!!$e("read","Kitchen")),G=te(()=>!!$e("edit","Food-Price")),K=te(()=>!!$e("read","Contractor-Invoice")),y=[{key:"foods",label:"غذاها",icon:"tabler-meat",show:()=>I.value||G.value},{key:"meals",label:"وعده‌های غذایی",icon:"tabler-bowl-chopsticks",show:()=>I.value},{key:"mealPlan",label:"برنامه غذایی",icon:"tabler-calendar-time",show:()=>I.value},{key:"statistics",label:"آمار",icon:"tabler-report-analytics",show:()=>I.value},{key:"contractorInvoice",label:"حساب پیمانکار",icon:"tabler-cash-register",show:()=>I.value||K.value},{key:"delivery",label:"تحویل غذا",icon:"tabler-checklist",show:()=>I.value}],f=te(()=>y.filter(D=>{var R;return((R=D.show)==null?void 0:R.call(D))!==!1})),h={foods:it,mealPlan:pt,meals:Vt,statistics:Ft,contractorInvoice:Fl,delivery:at};function g(){ae.value="root"}function $(D){ae.value=D}return(D,R)=>(c(),S(Be,null,{default:l(()=>[a(ae)==="root"?(c(),F("div",Rt,[e(H,null,{default:l(()=>[(c(!0),F(ee,null,se(a(f),j=>(c(),S(x,{key:j.key,cols:"6",sm:"4",md:"3",class:"text-center"},{default:l(()=>[e(ce,{class:"pa-4 d-flex flex-column align-center justify-center",variant:"outlined",rounded:"xl",onClick:B=>$(j.key)},{default:l(()=>[e(pl,{variant:"tonal",color:"primary",size:"56",class:"mb-2"},{default:l(()=>[e(de,{icon:j.icon,size:"32"},null,8,["icon"])]),_:2},1024),t("span",Pt,o(j.label),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})])):O("",!0),h[a(ae)]?(c(),S(yl(h[a(ae)]),{key:1,onBack:g},null,32)):O("",!0)]),_:1}))}};export{pa as default};
