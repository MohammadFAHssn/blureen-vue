import{av as p,a6 as Q,al as de,aQ as le,aD as ce,Y as w,a8 as me,ar as fe,a7 as ne,by as ve,ab as J,b as l,d as h,F as P,J as K,y as q,aV as oe,aW as W,bH as ge,bI as be,ad as Y,bF as ee,s as ye,am as M,v as I,az as he,aR as Ve,ax as _e,aC as xe,aq as ke,b1 as Ee,be as Ce,a$ as H,a9 as O,bJ as Se,at as Te,as as we,a_ as Ie,M as Be,r as j,w as Re,f as N,o as S,e as i,a1 as Me,x as _,c as R,i as z,n as r,m as ie,bq as Pe,bK as L,bL as qe,H as Le}from"./index-BkbZDJsl.js";import{V as D,c as se,b as Ne}from"./VCard-C25xtgcG.js";import{V as De}from"./VCardText-C_kcHw9D.js";import{V as $e}from"./VContainer-Lum6mYEk.js";import{V as U,a as A}from"./VRow-pGFvvUuj.js";import{V as Oe}from"./VDivider-9pUodcKy.js";import{V as re}from"./VDialog-CSbebj_D.js";import{u as ae}from"./useApi-Bz718zVT.js";import{c as te}from"./createUrl-BkhqE6Lj.js";import{$ as Ae}from"./api-8hJccXN2.js";import{V as Fe}from"./VSnackbar-DqziNmke.js";import{V as He}from"./VSpacer-CV65cJQJ.js";import"./createSimpleFunctional-V_pJsafn.js";/* empty css              */import"./VOverlay-B-Ee9g9p.js";import"./dialog-transition-j7pwnRAQ.js";import"./useLogout-DF8hDxpD.js";const je=Q({name:String,itemAriaLabel:{type:String,default:"$vuetify.rating.ariaLabel.item"},activeColor:String,color:String,clearable:Boolean,disabled:Boolean,emptyIcon:{type:ee,default:"$ratingEmpty"},fullIcon:{type:ee,default:"$ratingFull"},halfIncrements:Boolean,hover:Boolean,length:{type:[Number,String],default:5},readonly:Boolean,modelValue:{type:[Number,String],default:0},itemLabels:Array,itemLabelPosition:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},ripple:Boolean,...Y(),...be(),...ge(),...W(),...oe()},"VRating"),ze=p()({name:"VRating",props:je(),emits:{"update:modelValue":e=>!0},setup(e,T){let{slots:a}=T;const{t:u}=de(),{themeClasses:g}=le(e),b=ce(e,"modelValue"),x=w(()=>me(parseFloat(b.value),0,Number(e.length))),E=w(()=>fe(Number(e.length),1)),k=w(()=>E.value.flatMap(n=>e.halfIncrements?[n-.5,n]:[n])),c=ne(-1),f=w(()=>k.value.map(n=>{const t=e.hover&&c.value>-1,d=x.value>=n,m=c.value>=n,B=(t?m:d)?e.fullIcon:e.emptyIcon,F=e.activeColor??e.color,$=d||m?F:e.color;return{isFilled:d,isHovered:m,icon:B,color:$}})),v=w(()=>[0,...k.value].map(n=>{function t(){c.value=n}function d(){c.value=-1}function m(){e.disabled||e.readonly||(b.value=x.value===n&&e.clearable?0:n)}return{onMouseenter:e.hover?t:void 0,onMouseleave:e.hover?d:void 0,onClick:m}})),V=ve(),y=w(()=>e.name??`v-rating-${V}`);function s(n){var X,Z;let{value:t,index:d,showStar:m=!0}=n;const{onMouseenter:C,onMouseleave:B,onClick:F}=v.value[d+1],$=`${y.value}-${String(t).replace(".","-")}`,G={color:(X=f.value[d])==null?void 0:X.color,density:e.density,disabled:e.disabled,icon:(Z=f.value[d])==null?void 0:Z.icon,ripple:e.ripple,size:e.size,variant:"plain"};return h(P,null,[h("label",{for:$,class:q({"v-rating__item--half":e.halfIncrements&&t%1>0,"v-rating__item--full":e.halfIncrements&&t%1===0}),onMouseenter:C,onMouseleave:B,onClick:F},[h("span",{class:"v-rating__hidden"},[u(e.itemAriaLabel,t,e.length)]),m?a.item?a.item({...f.value[d],props:G,value:t,index:d,rating:x.value}):l(M,ye({"aria-label":u(e.itemAriaLabel,t,e.length)},G),null):void 0]),h("input",{class:"v-rating__hidden",name:y.value,id:$,type:"radio",value:t,checked:x.value===t,tabindex:-1,readonly:e.readonly,disabled:e.disabled},null)])}function o(n){return a["item-label"]?a["item-label"](n):n.label?h("span",null,[n.label]):h("span",null,[I(" ")])}return J(()=>{var t;const n=!!((t=e.itemLabels)!=null&&t.length)||a["item-label"];return l(e.tag,{class:q(["v-rating",{"v-rating--hover":e.hover,"v-rating--readonly":e.readonly},g.value,e.class]),style:K(e.style)},{default:()=>[l(s,{value:0,index:-1,showStar:!1},null),E.value.map((d,m)=>{var C,B;return h("div",{class:"v-rating__wrapper"},[n&&e.itemLabelPosition==="top"?o({value:d,index:m,label:(C=e.itemLabels)==null?void 0:C[m]}):void 0,h("div",{class:"v-rating__item"},[e.halfIncrements?h(P,null,[l(s,{value:d-.5,index:m*2},null),l(s,{value:d,index:m*2+1},null)]):l(s,{value:d,index:m},null)]),n&&e.itemLabelPosition==="bottom"?o({value:d,index:m,label:(B=e.itemLabels)==null?void 0:B[m]}):void 0])})]})}),{}}}),Ue=Q({text:String,...Y(),...W()},"VToolbarTitle"),ue=p()({name:"VToolbarTitle",props:Ue(),setup(e,T){let{slots:a}=T;return J(()=>{const u=!!(a.default||a.text||e.text);return l(e.tag,{class:q(["v-toolbar-title",e.class]),style:K(e.style)},{default:()=>{var g;return[u&&h("div",{class:"v-toolbar-title__placeholder"},[a.text?a.text():e.text,(g=a.default)==null?void 0:g.call(a)])]}})}),{}}}),pe=[null,"prominent","default","comfortable","compact"],Qe=Q({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>pe.includes(e)},extended:{type:Boolean,default:null},extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...Ie(),...Y(),...we(),...Te(),...W({tag:"header"}),...oe()},"VToolbar"),Je=p()({name:"VToolbar",props:Qe(),setup(e,T){var y;let{slots:a}=T;const{backgroundColorClasses:u,backgroundColorStyles:g}=he(()=>e.color),{borderClasses:b}=Ve(e),{elevationClasses:x}=_e(e),{roundedClasses:E}=xe(e),{themeClasses:k}=le(e),{rtlClasses:c}=ke(),f=ne(e.extended===null?!!((y=a.extension)!=null&&y.call(a)):e.extended),v=w(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),V=w(()=>f.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return Ee({VBtn:{variant:"text"}}),J(()=>{var t;const s=!!(e.title||a.title),o=!!(a.image||e.image),n=(t=a.extension)==null?void 0:t.call(a);return f.value=e.extended===null?!!n:e.extended,l(e.tag,{class:q(["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},u.value,b.value,x.value,E.value,k.value,c.value,e.class]),style:K([g.value,e.style])},{default:()=>[o&&h("div",{key:"image",class:"v-toolbar__image"},[a.image?l(H,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},a.image):l(Ce,{key:"image-img",cover:!0,src:e.image},null)]),l(H,{defaults:{VTabs:{height:O(v.value)}}},{default:()=>{var d,m,C;return[h("div",{class:"v-toolbar__content",style:{height:O(v.value)}},[a.prepend&&h("div",{class:"v-toolbar__prepend"},[(d=a.prepend)==null?void 0:d.call(a)]),s&&l(ue,{key:"title",text:e.title},{text:a.title}),(m=a.default)==null?void 0:m.call(a),a.append&&h("div",{class:"v-toolbar__append"},[(C=a.append)==null?void 0:C.call(a)])])]}}),l(H,{defaults:{VTabs:{height:O(V.value)}}},{default:()=>[l(Se,null,{default:()=>[f.value&&h("div",{class:"v-toolbar__extension",style:{height:O(V.value)}},[n])]})]})]})}),{contentHeight:v,extensionHeight:V}}}),Ke={class:"text-h6 font-weight-bold mb-4 text-primary"},We={class:"text-body-1 mb-3"},Ye={class:"d-flex align-center justify-start"},Ge={key:0,class:"mr-3 text-body-2 font-weight-medium"},Xe={__name:"EvaluationDialog",props:{modelValue:{type:Boolean,required:!0},evaluatee:{type:Object,required:!0},questions:{type:Array,required:!0},loading:{type:Boolean,default:!1},initialRatings:{type:Object,default:null}},emits:["update:modelValue","save"],setup(e,{emit:T}){const a=e,u=T,g=w({get:()=>a.modelValue,set:f=>u("update:modelValue",f)}),b=j({});function x(){const f={};a.questions&&a.questions.length>0&&a.questions.forEach(v=>{v.questions.forEach(V=>{var o;const y=V.id,s=((o=a.initialRatings)==null?void 0:o[y])??0;f[y]=s})}),b.value=f}Re([()=>a.questions,()=>a.initialRatings],()=>{x()},{immediate:!0});const E=w(()=>Object.values(b.value).every(f=>f>0));function k(){const f=[];Object.entries(b.value).forEach(([v,V])=>{f.push({evaluatee_id:a.evaluatee.id,question_id:Number(v),score:V})}),u("save",f)}function c(){x(),g.value=!1}return(f,v)=>(S(),N(re,{modelValue:r(g),"onUpdate:modelValue":v[0]||(v[0]=V=>Pe(g)?g.value=V:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:i(()=>[l(D,null,{default:i(()=>[l(Je,{color:"primary",dark:""},{default:i(()=>[l(M,{icon:"",dark:"",onClick:c},{default:i(()=>[l(Me,null,{default:i(()=>[...v[1]||(v[1]=[I("mdi-close",-1)])]),_:1})]),_:1}),l(ue,null,{default:i(()=>[I(_(e.evaluatee.user.personnel_code)+" - "+_(e.evaluatee.user.first_name)+" "+_(e.evaluatee.user.last_name)+" ("+_(e.evaluatee.user.profile.cost_center.name)+") ",1)]),_:1})]),_:1}),l(De,{class:"pa-6"},{default:i(()=>[l($e,null,{default:i(()=>[l(U,null,{default:i(()=>[l(A,{cols:"12"},{default:i(()=>[(S(!0),R(P,null,z(e.questions,V=>(S(),R("div",{key:V.id,class:"mb-8"},[h("div",Ke,_(V.name),1),l(U,null,{default:i(()=>[(S(!0),R(P,null,z(V.questions,y=>(S(),N(A,{key:y.id,cols:"12",md:"6"},{default:i(()=>[l(D,{variant:"outlined",class:q(["pa-4",{"border-success":r(b)[y.id]>0}])},{default:i(()=>[h("div",We,_(y.question_text),1),h("div",Ye,[l(ze,{modelValue:r(b)[y.id],"onUpdate:modelValue":s=>r(b)[y.id]=s,length:10,color:"amber","active-color":"amber",size:23,hover:""},null,8,["modelValue","onUpdate:modelValue"]),r(b)[y.id]>0?(S(),R("span",Ge,_(r(b)[y.id])+"/10 ",1)):ie("",!0)])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),l(Oe),l(se,{class:"pa-4 justify-end"},{default:i(()=>[l(M,{variant:"outlined",color:"error",disabled:e.loading,onClick:c},{default:i(()=>[...v[2]||(v[2]=[I(" انصراف ",-1)])]),_:1},8,["disabled"]),l(M,{variant:"elevated",color:"success",loading:e.loading,disabled:!r(E)||e.loading,onClick:k},{default:i(()=>[...v[3]||(v[3]=[I(" ذخیره ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Ze=Be(Xe,[["__scopeId","data-v-5ac0cccb"]]),ya={__name:"participate-evaluation",async setup(e){let T,a;const u=L({hasError:!1,errorMessage:"",dialog:!1}),g=L({fetchEvaluatees:!1,fetchQuestions:!1,evaluate:!1}),b=j([]),x=j([]),E=L({}),k=L({}),c=L({isOpen:!1,selectedEvaluatee:null});async function f(){g.fetchEvaluatees=!0;try{const{data:s,error:o}=await ae(te("/evaluation/evaluatee/by-evaluator"));if(g.fetchEvaluatees=!1,o.value)throw o.value;b.value=s.value.data,b.value.forEach(n=>{n&&typeof n.id<"u"&&(Object.prototype.hasOwnProperty.call(n,"is_evaluated")?E[n.id]=!!n.is_evaluated:E[n.id]===void 0&&(E[n.id]=!1))})}catch(s){console.error("Error fetching evaluatees:",s),u.hasError=!0,u.errorMessage=s.message||"خطا در دریافت ارزیابی‌شونده‌ها"}}async function v(){g.fetchQuestions=!0;try{const{data:s,error:o}=await ae(te("/evaluation/evaluation-question/actives"));if(g.fetchQuestions=!1,o.value)throw o.value;x.value=s.value.data}catch(s){console.error("Error fetching questions:",s),u.hasError=!0,u.errorMessage=s.message||"خطا در دریافت سوالات ارزیابی"}}async function V(s){var o,n;g.evaluate=!0;try{let t=!1;if(await Ae("/evaluation/evaluation-score/create",{method:"POST",body:{results:s},onResponseError({response:d}){u.hasError=!0,u.errorMessage=d._data.message||"خطا در ارزیابی",t=!0}}),!t){if(((o=c.selectedEvaluatee)==null?void 0:o.id)!==void 0&&(E[c.selectedEvaluatee.id]=!0),((n=c.selectedEvaluatee)==null?void 0:n.id)!==void 0){const d=c.selectedEvaluatee.id,m={};s.forEach(C=>{m[C.question_id]=C.score}),k[d]=m}c.isOpen=!1,c.selectedEvaluatee=null}}catch(t){console.error(t),u.hasError=!0,u.errorMessage=(t==null?void 0:t.message)||"خطا در ارزیابی"}finally{g.evaluate=!1}}function y(s){c.selectedEvaluatee=s,c.isOpen=!0}return[T,a]=qe(()=>f()),await T,a(),v(),Le(()=>{u.dialog=!0}),(s,o)=>{var n;return S(),R(P,null,[l(Fe,{modelValue:r(u).hasError,"onUpdate:modelValue":o[0]||(o[0]=t=>r(u).hasError=t),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:i(()=>[I(_(r(u).errorMessage),1)]),_:1},8,["modelValue"]),l(re,{modelValue:r(u).dialog,"onUpdate:modelValue":o[2]||(o[2]=t=>r(u).dialog=t),"max-width":"400",persistent:""},{default:i(()=>[l(D,{"prepend-icon":"mdi-map-marker",text:"در صورت خروج از صفحه، موارد ارزیابی‌شده ثبت نهایی شده و از لیست حذف می‌شوند!",title:"توجه"},{actions:i(()=>[l(He),l(M,{onClick:o[1]||(o[1]=t=>r(u).dialog=!1)},{default:i(()=>[...o[4]||(o[4]=[I(" باشه ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(c).selectedEvaluatee?(S(),N(Ze,{key:0,modelValue:r(c).isOpen,"onUpdate:modelValue":o[3]||(o[3]=t=>r(c).isOpen=t),evaluatee:r(c).selectedEvaluatee,questions:r(x),"initial-ratings":r(k)[(n=r(c).selectedEvaluatee)==null?void 0:n.id]||null,loading:r(g).evaluate,onSave:V},null,8,["modelValue","evaluatee","questions","initial-ratings","loading"])):ie("",!0),l(U,null,{default:i(()=>[r(b).length===0?(S(),N(A,{key:0},{default:i(()=>[l(D,{variant:"text"},{default:i(()=>[...o[5]||(o[5]=[I(" ارزیابی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(S(!0),R(P,{key:1},z(r(b),t=>(S(),N(A,{key:t.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:i(()=>[l(D,{class:q({"border-success":!!r(k)[t.id]})},{default:i(()=>[l(Ne,{class:"text-center mb-5 text-wrap"},{default:i(()=>[I(_(t.user.personnel_code)+" - "+_(t.user.first_name)+" "+_(t.user.last_name)+" ("+_(t.user.profile.cost_center.name)+") ",1)]),_:2},1024),l(se,{class:"justify-center"},{default:i(()=>[l(M,{variant:"elevated",color:r(k)[t.id]?"warning":"success",onClick:d=>y(t)},{default:i(()=>[I(_(r(k)[t.id]?"ویرایش ارزیابی":"شروع ارزیابی"),1)]),_:2},1032,["color","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})],64)}}};export{ya as default};
