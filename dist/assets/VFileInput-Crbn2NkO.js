import{V as L,m as he}from"./VField-TV_egTmW.js";import{a6 as W,Y as m,ax as ge,al as be,aF as Fe,bU as K,aG as ke,bV as O,r as S,Z as we,a7 as Ce,w as Ie,ab as De,aI as Ve,aH as G,b as k,d as h,F as A,s as B,y as Se,a2 as Ae,aJ as Be,aK as Pe,aw as Re,bW as Te}from"./index-Cs98bBAa.js";import{V as ze}from"./VCounter-Ct9RHeX4.js";function $e(){function e(o){var l,n;return[...((l=o.dataTransfer)==null?void 0:l.items)??[]].filter(u=>u.kind==="file").map(u=>u.webkitGetAsEntry()).filter(Boolean).length>0||[...((n=o.dataTransfer)==null?void 0:n.files)??[]].length>0}async function r(o){var n,u;const s=[],l=[...((n=o.dataTransfer)==null?void 0:n.items)??[]].filter(i=>i.kind==="file").map(i=>i.webkitGetAsEntry()).filter(Boolean);if(l.length)for(const i of l){const d=await U(i,H(".",i));s.push(...d.map(y=>y.file))}else s.push(...((u=o.dataTransfer)==null?void 0:u.files)??[]);return s}return{handleDrop:r,hasFilesOrFolders:e}}function U(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((o,s)=>{e.isFile?e.file(n=>o([{file:n,path:r}]),s):e.isDirectory&&e.createReader().readEntries(async n=>{const u=[];for(const i of n)u.push(...await U(i,H(r,i)));o(u)})})}function H(e,r){return r.isDirectory?`${e}/${r.name}`:e}const xe=W({filterByType:String},"file-accept");function Ee(e){const r=m(()=>e.filterByType?Ne(e.filterByType):null);function o(s){if(r.value){const l=s.filter(r.value);return{accepted:l,rejected:s.filter(n=>!l.includes(n))}}return{accepted:s,rejected:[]}}return{filterAccepted:o}}function Ne(e){const r=e.split(",").map(n=>n.trim().toLowerCase()),o=r.filter(n=>n.startsWith(".")),s=r.filter(n=>n.endsWith("/*")),l=r.filter(n=>!o.includes(n)&&!s.includes(n));return n=>{var d,y;const u=((d=n.name.split(".").at(-1))==null?void 0:d.toLowerCase())??"",i=((y=n.type.split("/").at(0))==null?void 0:y.toLowerCase())??"";return l.includes(n.type)||o.includes(`.${u}`)||s.includes(`${i}/*`)}}const je=W({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},truncateLength:{type:[Number,String],default:22},...Pe({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>K(e).every(r=>r!=null&&typeof r=="object")},...xe(),...he({clearable:!0})},"VFileInput"),Ge=ge()({name:"VFileInput",inheritAttrs:!1,props:je(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,rejected:e=>!0},setup(e,r){let{attrs:o,emit:s,slots:l}=r;const{t:n}=be(),{filterAccepted:u}=Ee(e),i=Fe(e,"modelValue",e.modelValue,t=>K(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:d,focus:y,blur:J}=ke(e),P=m(()=>typeof e.showSize!="boolean"?e.showSize:void 0),R=m(()=>(i.value??[]).reduce((t,a)=>{let{size:f=0}=a;return t+f},0)),T=m(()=>O(R.value,P.value)),w=m(()=>(i.value??[]).map(t=>{const{name:a="",size:f=0}=t,v=ne(a);return e.showSize?`${v} (${O(f,P.value)})`:v})),Y=m(()=>{var a;const t=((a=i.value)==null?void 0:a.length)??0;return e.showSize?n(e.counterSizeString,t,T.value):n(e.counterString,t)}),z=S(),$=S(),c=S(),Z=we(()=>d.value||e.active),x=m(()=>["plain","underlined"].includes(e.variant)),b=Ce(!1),{handleDrop:_,hasFilesOrFolders:q}=$e();function C(){var t;c.value!==document.activeElement&&((t=c.value)==null||t.focus()),d.value||y()}function Q(t){var a;(a=c.value)==null||a.click()}function X(t){s("mousedown:control",t)}function ee(t){var a;(a=c.value)==null||a.click(),s("click:control",t)}function te(t){t.stopPropagation(),C(),Re(()=>{i.value=[],Te(e["onClick:clear"],t)})}function ne(t){if(t.length<Number(e.truncateLength))return t;const a=Math.floor((Number(e.truncateLength)-1)/2);return`${t.slice(0,a)}â€¦${t.slice(t.length-a)}`}function ae(t){t.preventDefault(),t.stopImmediatePropagation(),b.value=!0}function le(t){t.preventDefault(),b.value=!1}async function ie(t){if(t.preventDefault(),t.stopImmediatePropagation(),b.value=!1,!c.value||!q(t))return;const a=await _(t);E(a)}function re(t){if(!(!t.target||t.repack))if(e.filterByType)E([...t.target.files]);else{const a=t.target;i.value=[...a.files??[]]}}function E(t){const a=new DataTransfer,{accepted:f,rejected:v}=u(t);v.length&&s("rejected",v);for(const D of f)a.items.add(D);c.value.files=a.files,i.value=[...a.files];const I=new Event("change",{bubbles:!0});I.repack=!0,c.value.dispatchEvent(I)}return Ie(i,t=>{(!Array.isArray(t)||!t.length)&&c.value&&(c.value.value="")}),De(()=>{const t=!!(l.counter||e.counter),a=!!(t||l.details),[f,v]=Ve(o),{modelValue:I,...D}=G.filterProps(e),oe={...L.filterProps(e),"onClick:clear":te},se=o.webkitdirectory!==void 0&&o.webkitdirectory!==!1,ue=o.accept?String(o.accept):void 0,ce=se?void 0:e.filterByType??ue;return k(G,B({ref:z,modelValue:e.multiple?i.value:i.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":b.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":x.value},e.class],style:e.style,"onClick:prepend":Q},f,D,{centerAffix:!x.value,focused:d.value}),{...l,default:V=>{let{id:F,isDisabled:g,isDirty:N,isReadonly:j,isValid:de,hasDetails:fe}=V;return k(L,B({ref:$,prependIcon:e.prependIcon,onMousedown:X,onClick:ee,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},oe,{id:F.value,active:Z.value||N.value,dirty:N.value||e.dirty,disabled:g.value,focused:d.value,details:fe.value,error:de.value===!1,onDragover:ae,onDrop:ie}),{...l,default:ve=>{var M;let{props:{class:pe,...me},controlRef:ye}=ve;return h(A,null,[h("input",B({ref:p=>c.value=ye.value=p,type:"file",accept:ce,readonly:j.value,disabled:g.value,multiple:e.multiple,name:e.name,onClick:p=>{p.stopPropagation(),j.value&&p.preventDefault(),C()},onChange:re,onDragleave:le,onFocus:C,onBlur:J},me,v),null),h("div",{class:Se(pe)},[!!((M=i.value)!=null&&M.length)&&!e.hideInput&&(l.selection?l.selection({fileNames:w.value,totalBytes:R.value,totalBytesReadable:T.value}):e.chips?w.value.map(p=>k(Ae,{key:p,size:"small",text:p},null)):w.value.join(", "))])])}})},details:a?V=>{var F,g;return h(A,null,[(F=l.details)==null?void 0:F.call(l,V),t&&h(A,null,[h("span",null,null),k(ze,{active:!!((g=i.value)!=null&&g.length),value:Y.value,disabled:e.disabled},l.counter)])])}:void 0})}),Be({},z,$,c)}});export{Ge as V};
