import{r as de}from"./validators-CT5dUf4l.js";import{au as ke,a5 as Ie,cf as ce,aC as Ce,Y as M,r as h,a6 as Re,a$ as Fe,H as Me,w as z,aY as Ae,aa as De,bc as Ue,b as t,d as V,F as A,s as ee,K as me,cg as Ee,y as ge,at as te,a8 as $e,a7 as Ne,bH as He,bZ as fe,bb as ze,c as O,o as v,f as q,m as K,n,b_ as Oe,i as oe,e as l,A as qe,am as pe,an as ve,M as Be,j as Ge,k as Le,bJ as Ve,bL as Qe,aD as je,v as m,x as y,a2 as ae,bv as Ye,ch as Je,bw as Ke,al as Ze,a1 as We}from"./index-D1NhewP6.js";import{V as ne}from"./VLabel-DFkEwyF-.js";import{u as Xe}from"./VTextField-CC9Mu_Cm.js";import{V as et}from"./VCounter-3lKjCAoH.js";import{V as be,m as tt}from"./VField-DvAT9Lz_.js";import{V as xe,m as at}from"./VInput-DoszqaNj.js";import{u as lt}from"./form-CXkrWuCp.js";import{f as ot}from"./forwardRefs-BYSXgJht.js";import{_ as nt}from"./AppTextField-BU-A_sAT.js";import{$ as rt}from"./api-jsS1BgXB.js";import{u as st}from"./useApi-B51wk2Wg.js";import{c as ut}from"./createUrl-CBcA-yvw.js";import{V as ye}from"./VSnackbar-CLUkz1No.js";import{V as R}from"./VCol-DA3NXQeu.js";import{V as B}from"./VRow-BWetKUzG.js";import{V as it,a as dt,b as ct,d as mt}from"./VList-0JoHiHtU.js";import{V as le,a as ft,b as pt}from"./VCard-CwkXv6FN.js";import{V as F}from"./VCardText-CvEv_GAf.js";import{a as _e,V as J}from"./VRadioGroup-CtqteLD-.js";import{V as vt}from"./VDivider-DM4ew276.js";import{V as Vt}from"./VForm-COO9Nrxn.js";import"./helpers-4BKJjDfb.js";import"./useLogout-BJR2fKtY.js";import"./VOverlay-DPABkZfC.js";/* empty css              */import"./createSimpleFunctional-6j82DH8l.js";import"./VSelectionControl-DfnA1HN2.js";const bt=Ie({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...at(),...tt()},"VTextarea"),xt=ke()({name:"VTextarea",directives:{vIntersect:ce},inheritAttrs:!1,props:bt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,I){let{attrs:_,emit:b,slots:c}=I;const i=Ce(e,"modelValue"),{isFocused:p,focus:D,blur:U}=lt(e),{onIntersect:d}=Xe(e),f=M(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),G=M(()=>{if(_.maxlength)return _.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),L=h(),E=h(),Q=Re(""),$=h(),w=M(()=>e.persistentPlaceholder||p.value||e.active);function r(){var s;$.value!==document.activeElement&&((s=$.value)==null||s.focus()),p.value||D()}function a(s){r(),b("click:control",s)}function x(s){b("mousedown:control",s)}function S(s){s.stopPropagation(),r(),te(()=>{i.value="",He(e["onClick:clear"],s)})}function o(s){var T;const g=s.target;if(i.value=g.value,(T=e.modelModifiers)!=null&&T.trim){const H=[g.selectionStart,g.selectionEnd];te(()=>{g.selectionStart=H[0],g.selectionEnd=H[1]})}}const u=h(),C=h(Number(e.rows)),Z=M(()=>["plain","underlined"].includes(e.variant));Fe(()=>{e.autoGrow||(C.value=Number(e.rows))});function N(){e.autoGrow&&te(()=>{if(!u.value||!E.value)return;const s=getComputedStyle(u.value),g=getComputedStyle(E.value.$el),T=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),H=u.value.scrollHeight,j=parseFloat(s.lineHeight),W=Math.max(parseFloat(e.rows)*j+T,parseFloat(g.getPropertyValue("--v-input-control-height"))),X=parseFloat(e.maxRows)*j+T||1/0,k=Ne(H??0,W,X);C.value=Math.floor((k-T)/j),Q.value=$e(k)})}Me(N),z(i,N),z(()=>e.rows,N),z(()=>e.maxRows,N),z(()=>e.density,N),z(C,s=>{b("update:rows",s)});let P;return z(u,s=>{s?(P=new ResizeObserver(N),P.observe(u.value)):P==null||P.disconnect()}),Ae(()=>{P==null||P.disconnect()}),De(()=>{const s=!!(c.counter||e.counter||e.counterValue),g=!!(s||c.details),[T,H]=Ue(_),{modelValue:j,...W}=xe.filterProps(e),X=be.filterProps(e);return t(xe,ee({ref:L,modelValue:i.value,"onUpdate:modelValue":k=>i.value=k,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":Z.value},e.class],style:e.style},T,W,{centerAffix:C.value===1&&!Z.value,focused:p.value}),{...c,default:k=>{let{id:Y,isDisabled:re,isDirty:se,isReadonly:he,isValid:we,hasDetails:Se}=k;return t(be,ee({ref:E,style:{"--v-textarea-control-height":Q.value},onClick:a,onMousedown:x,"onClick:clear":S,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},X,{id:Y.value,active:w.value||se.value,centerAffix:C.value===1&&!Z.value,dirty:se.value||e.dirty,disabled:re.value,focused:p.value,details:Se.value,error:we.value===!1}),{...c,default:Pe=>{let{props:{class:ue,...ie}}=Pe;return V(A,null,[e.prefix&&V("span",{class:"v-text-field__prefix"},[e.prefix]),me(V("textarea",ee({ref:$,class:ue,value:i.value,onInput:o,autofocus:e.autofocus,readonly:he.value,disabled:re.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:r,onBlur:U},ie,H),null),[[ce,{handler:d},null,{once:!0}]]),e.autoGrow&&me(V("textarea",{class:ge([ue,"v-textarea__sizer"]),id:`${ie.id}-sizer`,"onUpdate:modelValue":Te=>i.value=Te,ref:u,readonly:!0,"aria-hidden":"true"},null),[[Ee,i.value]]),e.suffix&&V("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:g?k=>{var Y;return V(A,null,[(Y=c.details)==null?void 0:Y.call(c,k),s&&V(A,null,[V("span",null,null),t(et,{active:e.persistentCounter||p.value,value:f.value,max:G.value,disabled:e.disabled},c.counter)])])}:void 0})}),ot({},L,E,$)}}),yt=Object.assign({name:"AppTextarea",inheritAttrs:!1},{__name:"AppTextarea",setup(e){const I=M(()=>{const c=fe().id,i=ze();return c?`app-textarea-${c}`:i}),_=M(()=>fe().label);return(b,c)=>(v(),O("div",{class:ge(["app-textarea flex-grow-1",b.$attrs.class])},[n(_)?(v(),q(ne,{key:0,for:n(I),class:"mb-1 text-body-2",text:n(_)},null,8,["for","text"])):K("",!0),t(xt,pe(ve({...b.$attrs,class:null,label:void 0,variant:"outlined",id:n(I)})),Oe({_:2},[oe(b.$slots,(i,p)=>({name:p,fn:l(D=>[qe(b.$slots,p,pe(ve(D||{})))])}))]),1040)],2))}}),_t={key:0,class:"layout-page-content"},gt={class:"text-wrap mb-2"},ht={class:"text-h6"},wt={__name:"[token]",async setup(e){let I,_;const b=Ge(),c=Le(),i=h(null),p=h(null),D=h([]),U=h(0),d=Ve({hasError:!1,errorMessage:"",isSuccessful:!1,HaveTenderBidsBeenSent:[],isSendTenderBidPending:[]}),f=Ve({paymentTerms:"cash",creditDescription:"",invoiceType:"taxInvoice"});let G=null;function L(){U.value=Math.max(0,i.value.tenderExpiresAt-Math.floor(Date.now()/1e3)),G=setInterval(()=>{U.value--,U.value<=0&&c.replace({name:"login-supplier"})},1e3)}function E(r,a){return a<=1?"#28a745":`hsl(${120-r/(a-1)*120}, 100%, 50%)`}async function Q(r){const{id:a,bidPrice:x,bidQuantity:S,bidDescription:o}=r;if(!(!x||!S)){d.isSendTenderBidPending[a]=!0;try{await rt("/commerce/tender/submit-bid",{method:"POST",body:{id:a,bid_price:x,bid_quantity:S,bid_description:o||"",payment_terms:f.paymentTerms,payment_terms_description:f.paymentTerms==="credit"?f.creditDescription:"",invoice_type:f.invoiceType},onResponseError({response:u}){d.hasError=!0,d.errorMessage=u._data.message||"خطا در ارسال پیشنهاد"}}),d.HaveTenderBidsBeenSent[a]=!0,d.isSuccessful=!0}catch(u){console.error(u)}finally{d.isSendTenderBidPending[a]=!1}}}async function $(){try{const{data:r,error:a}=await st(ut(`/commerce/tender/get-by-token?token=${b.params.token}`));if(a.value)throw a.value;i.value=r.value.data,p.value=r.value.data.supplier,D.value=r.value.data.tenderBids||[],L()}catch(r){d.hasError=!0,d.errorMessage=r.message||"خطا در دریافت اطلاعات مناقصه",setTimeout(()=>{c.replace({name:"login-supplier"})},2e3)}}[I,_]=Qe(()=>$()),await I,_();const w=M(()=>{const r=U.value,a=Math.floor(r/86400),x=Math.floor(r%86400/3600),S=Math.floor(r%3600/60),o=r%60;return{days:a,hours:x.toString().padStart(2,"0"),minutes:S.toString().padStart(2,"0"),seconds:o.toString().padStart(2,"0")}});return je(()=>{clearInterval(G)}),(r,a)=>{const x=nt,S=yt;return v(),O(A,null,[t(ye,{modelValue:n(d).hasError,"onUpdate:modelValue":a[0]||(a[0]=o=>n(d).hasError=o),timeout:"2000",location:"center",variant:"flat",color:"error"},{default:l(()=>[m(y(n(d).errorMessage)+"، در حال انتقال به پنل تأمین‌کننده ... ",1)]),_:1},8,["modelValue"]),t(ye,{modelValue:n(d).isSuccessful,"onUpdate:modelValue":a[1]||(a[1]=o=>n(d).isSuccessful=o),timeout:"1500",location:"center",variant:"flat",color:"success"},{default:l(()=>a[5]||(a[5]=[m(" ارسال شد! ",-1)])),_:1,__:[5]},8,["modelValue"]),n(i)?(v(),O("main",_t,[t(B,null,{default:l(()=>[t(R,null,{default:l(()=>[V("div",gt,[a[6]||(a[6]=m(" مدیریت محترم شرکت/فروشگاه ",-1)),V("span",ht,y(n(p).name),1)]),a[7]||(a[7]=V("div",{class:"text-body-1"}," لیست کالاهای مورد نیاز مجموعه کارخانجات شیشه اردکان به شرح زیر می‌باشد. ",-1)),a[8]||(a[8]=V("div",{class:"text-body-1"}," لطفاً قیمت‌های پیشنهادی خود را ارائه دهید. ",-1))]),_:1,__:[7,8]})]),_:1}),t(B,null,{default:l(()=>[t(it,{style:{"background-color":"rgb(var(--v-theme-background))"}},{default:l(()=>[t(dt,null,{prepend:l(()=>[t(Ye,{color:"warning",variant:"tonal",rounded:"",icon:"tabler-stopwatch"})]),default:l(()=>[t(ct,{class:"font-weight-medium"},{default:l(()=>a[9]||(a[9]=[m(" مدت زمان باقی‌مانده تا پایان مناقصه: ",-1)])),_:1,__:[9]}),t(mt,{class:"text-body-1"},{default:l(()=>[n(w).days>0?(v(),q(ae,{key:0},{default:l(()=>[m(y(n(w).days)+" روز و "+y(n(w).hours)+" ساعت ",1)]),_:1})):(v(),q(ae,{key:1},{default:l(()=>[m(y(n(w).hours)+":"+y(n(w).minutes)+":"+y(n(w).seconds),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(R,{cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(F,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>a[10]||(a[10]=[m(" شرایط پرداخت ",-1)])),_:1,__:[10]}),t(_e,{modelValue:n(f).paymentTerms,"onUpdate:modelValue":a[2]||(a[2]=o=>n(f).paymentTerms=o),inline:""},{default:l(()=>[t(J,{label:"نقدی",value:"cash"}),t(J,{label:"شرایطی",value:"credit"})]),_:1},8,["modelValue"]),n(f).paymentTerms==="credit"?(v(),q(x,{key:0,modelValue:n(f).creditDescription,"onUpdate:modelValue":a[3]||(a[3]=o=>n(f).creditDescription=o),type:"text",placeholder:"توضیحات"},null,8,["modelValue"])):K("",!0)]),_:1}),t(vt),t(F,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>a[11]||(a[11]=[m(" نوع فاکتور ",-1)])),_:1,__:[11]}),t(_e,{modelValue:n(f).invoiceType,"onUpdate:modelValue":a[4]||(a[4]=o=>n(f).invoiceType=o),inline:""},{default:l(()=>[t(J,{label:"فاکتور رسمی",value:"taxInvoice"}),t(J,{label:"فاکتور فروشگاهی",value:"commercialInvoice"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(Je,{group:""},{default:l(()=>[(v(!0),O(A,null,oe(n(D).filter(o=>!n(d).HaveTenderBidsBeenSent[o.id]),o=>(v(),q(R,{key:o.id,cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(ft,null,{default:l(()=>[t(pt,{class:"custom-v-card-title"},{default:l(()=>[m(y(o.tenderProduct.product.name)+" ",1),o.tenderProduct.brand?(v(),O(A,{key:0},[m(" ("+y(o.tenderProduct.brand.name)+") ",1)],64)):K("",!0)]),_:2},1024)]),_:2},1024),t(F,null,{default:l(()=>[m(y(o.tenderProduct.purchaseExpertDescription),1)]),_:2},1024),t(F,null,{default:l(()=>[t(le,{variant:"outlined"},{default:l(()=>[t(F,null,{default:l(()=>a[12]||(a[12]=[m(" قیمت‌های پیشنهادی از سایر تأمین‌کنندگان (تومان): ",-1)])),_:1,__:[12]}),t(F,{class:"d-flex flex-wrap gap-x-4 gap-y-2"},{default:l(()=>[(v(!0),O(A,null,oe(o.bidOfOtherSuppliers,(u,C)=>(v(),q(ae,{key:u.supplierId,variant:u.supplierId===n(p).id?"flat":"outlined",color:E(C,o.bidOfOtherSuppliers.length)},{default:l(()=>[m(y(u.bidPrice),1)]),_:2},1032,["variant","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),t(F,null,{default:l(()=>[t(Vt,{"validate-on":"submit lazy",onSubmit:Ke(u=>Q(o),["prevent"])},{default:l(()=>[t(B,null,{default:l(()=>[t(R,{cols:"12"},{default:l(()=>[t(x,{modelValue:o.bidPrice,"onUpdate:modelValue":u=>o.bidPrice=u,label:"قیمت",type:"number","prepend-inner-icon":"tabler-coin",suffix:"تومان",rules:["requiredValidator"in r?r.requiredValidator:n(de)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(R,{cols:"12"},{default:l(()=>[t(x,{modelValue:o.bidQuantity,"onUpdate:modelValue":u=>o.bidQuantity=u,label:"تعداد",type:"number","prepend-inner-icon":"tabler-scale",suffix:o.tenderProduct.product.counting_unit.UntName,placeholder:`مقدار مورد نیاز: ${o.tenderProduct.quantityRequired}`,rules:["requiredValidator"in r?r.requiredValidator:n(de)]},null,8,["modelValue","onUpdate:modelValue","suffix","placeholder","rules"])]),_:2},1024),t(R,{cols:"12"},{default:l(()=>[t(S,{modelValue:o.bidDescription,"onUpdate:modelValue":u=>o.bidDescription=u,label:"توضیحات",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(R,{cols:"12"},{default:l(()=>[t(Ze,{type:"submit",loading:n(d).isSendTenderBidPending[o.id],disabled:!o.bidPrice||!o.bidQuantity},{default:l(()=>[t(We,{icon:"tabler-send"}),a[13]||(a[13]=m("ارسال ",-1))]),_:2,__:[13]},1032,["loading","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):K("",!0)],64)}}},Wt=Be(wt,[["__scopeId","data-v-15becc96"]]);export{Wt as default};
