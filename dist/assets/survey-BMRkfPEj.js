import{u as w}from"./useApi-DN9i30c_.js";import{c as E}from"./createUrl-B9dXP-wO.js";import{$ as B}from"./api-D2_rp70I.js";import{V as I}from"./VSnackbar-a39j922X.js";import{V as m}from"./VCol-CwoNo7fg.js";import{V as v,b as M,c as $}from"./VCard-BINdyafU.js";import{bx as y,r as _,c as u,o as i,b as l,e as a,v as p,x as S,n as o,f as d,F as k,i as N,m as V,am as g}from"./index-DzCC95Er.js";import{V as T}from"./VRow-Co3Onx6h.js";import"./useLogout-xN87bSl9.js";import"./index-CvOPxmL5.js";import"./VOverlay-BlzuVrCJ.js";/* empty css              */import"./createSimpleFunctional-DY0Ih4bm.js";import"./VCardText-BK2CGyIH.js";const A={key:0},F={key:1},X={__name:"survey",setup(L){const n=y({hasError:!1,errorMessage:""}),s=y({fetchSurveys:!1,participateInSurvey:[]}),f=_([]),c=_([]);async function h(){s.fetchSurveys=!0;try{const{data:e,error:r}=await w(E("/survey/survey?filter[active]=1"));if(s.fetchSurveys=!1,r.value)throw r.value;f.value=e.value.data}catch(e){console.error("Error fetching surveys:",e),n.hasError=!0,n.errorMessage=e.message||"خطا در دریافت نظرسنجی‌ها"}}h();async function x(e){s.participateInSurvey[e]=!0;try{const r=await B("/survey/survey/participate",{method:"POST",body:{porslineId:e},onResponseError({response:t}){s.participateInSurvey[e]=!1,n.hasError=!0,n.errorMessage=t._data.message||"خطا در شرکت در نظرسنجی"}});s.participateInSurvey[e]=!1,c.value[e]=r.data}catch(r){console.error(r)}}function C(e){window.open(c.value[e],"_blank","noopener,noreferrer")}return(e,r)=>(i(),u(k,null,[l(I,{modelValue:o(n).hasError,"onUpdate:modelValue":r[0]||(r[0]=t=>o(n).hasError=t),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:a(()=>[p(S(o(n).errorMessage),1)]),_:1},8,["modelValue"]),l(T,null,{default:a(()=>[o(f).length===0?(i(),d(m,{key:0},{default:a(()=>[l(v,{variant:"text"},{default:a(()=>[...r[1]||(r[1]=[p(" نظرسنجی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(i(!0),u(k,{key:1},N(o(f),t=>(i(),d(m,{key:t.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:a(()=>[l(v,null,{default:a(()=>[l(M,{class:"text-center mb-5 text-wrap"},{default:a(()=>[p(S(t.title),1)]),_:2},1024),l($,{class:"justify-center"},{default:a(()=>[o(c)[t.porsline_id]?(i(),d(g,{key:0,variant:"elevated",color:"success",onClick:b=>C(t.porsline_id)},{default:a(()=>[...r[2]||(r[2]=[p(" شروع ",-1)])]),_:1},8,["onClick"])):o(c)[t.porsline_id]?V("",!0):(i(),d(g,{key:1,variant:"elevated",disabled:o(s).participateInSurvey[t.porsline_id],onClick:b=>x(t.porsline_id)},{default:a(()=>[o(s).participateInSurvey[t.porsline_id]?(i(),u("span",A,"در حال ساخت لینک")):o(s).participateInSurvey[t.porsline_id]?V("",!0):(i(),u("span",F,"دریافت لینک نظرسنجی"))]),_:2},1032,["disabled","onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))}};export{X as default};
