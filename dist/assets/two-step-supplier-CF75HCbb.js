import{au as ee,a5 as te,aM as ae,aC as oe,ak as le,Y as B,r as y,a_ as ne,cy as se,cz as re,a$ as ue,w as P,aX as ie,Z as S,at as H,aa as de,bc as ce,d as i,J as fe,b as l,F as K,y as J,s as j,be as pe,co as me,aT as ve,cc as E,M as he,bA as A,j as ge,k as ye,a as be,c as Ve,o as we,e as c,v as L,x as R,n as s,bq as q,O as $,I as z,bw as _e,al as xe}from"./index-s0RY1Vh3.js";import{V as N}from"./VNodeRenderer-Bs-3-vQ_.js";import{u as ke}from"./useAbility-v2Eyvqtt.js";import{$ as Ce}from"./api-DmXPaD3K.js";import{V as Se}from"./VSnackbar-Bs99S9L5.js";import{a as Ae,b as Ie,V as Re}from"./VCard-Bv1t2-PZ.js";import{V as U}from"./VCardText-Bt9r9Lfo.js";import{V as Fe}from"./VForm-D86k0UEF.js";import{V as Be,a as F}from"./VRow-CuiommJz.js";import{V as De,m as Te}from"./VField-D0InP9x9.js";import{V as Pe}from"./VOverlay-C-ORRKTC.js";import{u as Ne,m as Oe}from"./form-CYgMbtoI.js";import"./useLogout-C4sbuR-f.js";import"./createSimpleFunctional-BiI6uwdY.js";/* empty css              */import"./VLabel-0aTGfkIp.js";const Me=`<svg width="180" height="180" viewBox="0 0 181 181" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="1.30469" y="1.44312" width="178" height="178" rx="19" stroke="currentColor" stroke-opacity="0.16" stroke-width="2" stroke-dasharray="8 8" />\r
<rect x="22.8047" y="22.9431" width="135" height="135" rx="10" fill="currentColor" fill-opacity="0.08" />\r
</svg>\r
`,je=`<svg width="239" height="234" viewBox="0 0 239 234" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="88.5605" y="0.700195" width="149" height="149" rx="19.5" stroke="currentColor" stroke-opacity="0.16" />\r
<rect x="0.621094" y="33.761" width="200" height="200" rx="10" fill="currentColor" fill-opacity="0.08" />\r
</svg>\r
`,Ee=te({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...ve(),...Oe(),...me(Te({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Le=ee()({name:"VOtpInput",props:Ee(),emits:{finish:t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,_){let{attrs:b,emit:D,slots:m}=_;const{dimensionStyles:V}=ae(t),{isFocused:x,focus:k,blur:C}=Ne(t),f=oe(t,"modelValue","",e=>e==null?[]:String(e).split(""),e=>e.join("")),{t:I}=le(),h=B(()=>Number(t.length)),d=B(()=>Array(h.value).fill(0)),a=y(-1),v=y(),u=y([]),w=B(()=>u.value[a.value]);let T=!1;ne(()=>t.autofocus,()=>{const e=se();e.run(()=>{const{intersectionRef:o,isIntersecting:r}=re();ue(()=>{o.value=u.value[0]}),P(r,p=>{var n;p&&((n=o.value)==null||n.focus(),e.stop())})})});function O(){if(M(w.value.value)){w.value.value="";return}if(T)return;const e=f.value.slice(),o=w.value.value;e[a.value]=o;let r=null;a.value>f.value.length?r=f.value.length+1:a.value+1!==h.value&&(r="next"),f.value=e,r&&E(v.value,r)}function X(){T=!1,O()}function Y(e){const o=f.value.slice(),r=a.value;let p=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(e.key)&&(e.preventDefault(),e.key==="ArrowLeft"?p="prev":e.key==="ArrowRight"?p="next":["Backspace","Delete"].includes(e.key)&&(o[a.value]="",f.value=o,a.value>0&&e.key==="Backspace"?p="prev":requestAnimationFrame(()=>{var n;(n=u.value[r])==null||n.select()})),requestAnimationFrame(()=>{p!=null&&E(v.value,p)}))}function Z(e,o){var n,g;o.preventDefault(),o.stopPropagation();const r=((n=o==null?void 0:o.clipboardData)==null?void 0:n.getData("Text").trim().slice(0,h.value))??"",p=r.length-1===-1?e:r.length-1;M(r)||(f.value=r.split(""),(g=u.value)==null||g[p].focus())}function G(){f.value=[]}function Q(e,o){k(),a.value=o}function W(){C(),a.value=-1}function M(e){return t.type==="number"&&/[^0-9]/g.test(e)}return ie({VField:{color:S(()=>t.color),bgColor:S(()=>t.color),baseColor:S(()=>t.baseColor),disabled:S(()=>t.disabled),error:S(()=>t.error),variant:S(()=>t.variant)}},{scoped:!0}),P(f,e=>{e.length===h.value&&(a.value=h.value-1,D("finish",e.join("")))},{deep:!0}),P(a,e=>{e<0||H(()=>{var o;(o=u.value[e])==null||o.select()})}),de(()=>{var r;const[e,o]=ce(b);return i("div",j({class:["v-otp-input",{"v-otp-input--divided":!!t.divider},t.class],style:[t.style]},e),[i("div",{ref:v,class:"v-otp-input__content",style:fe([V.value])},[d.value.map((p,n)=>i(K,null,[t.divider&&n!==0&&i("span",{class:"v-otp-input__divider"},[t.divider]),l(De,{focused:x.value&&t.focusAll||a.value===n,key:n},{...m,loader:void 0,default:()=>i("input",{ref:g=>u.value[n]=g,"aria-label":I(t.label,n+1),autofocus:n===0&&t.autofocus,autocomplete:"one-time-code",class:J(["v-otp-input__field"]),disabled:t.disabled,inputmode:t.type==="number"?"numeric":"text",min:t.type==="number"?0:void 0,maxlength:n===0?h.value:"1",placeholder:t.placeholder,type:t.type==="number"?"text":t.type,value:f.value[n],onInput:O,onFocus:g=>Q(g,n),onBlur:W,onKeydown:Y,onCompositionstart:()=>T=!0,onCompositionend:X,onPaste:g=>Z(n,g)},null)})])),i("input",j({class:"v-otp-input-input",type:"hidden"},o,{value:f.value.join("")}),null),l(Pe,{contained:!0,contentClass:"v-otp-input__loader",modelValue:!!t.loading,persistent:!0},{default:()=>{var p;return[((p=m.loader)==null?void 0:p.call(m))??l(pe,{color:typeof t.loading=="boolean"?void 0:t.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(r=m.default)==null?void 0:r.call(m)])])}),{blur:()=>{var e;(e=u.value)==null||e.some(o=>o.blur())},focus:()=>{var e;(e=u.value)==null||e[0].focus()},reset:G,isFocused:x}}}),qe={class:"auth-wrapper d-flex align-center justify-center pa-4"},$e={class:"position-relative my-sm-16"},ze={class:"app-logo"},Ue={class:"app-logo-title"},He={class:"d-flex justify-center align-center flex-wrap"},Ke={class:"me-1"},Je=Object.assign({beforeRouteEnter(t,_,b){if(A("otpExpiresAt").value<Math.floor(Date.now()/1e3))return b({name:"login-supplier"});b()}},{__name:"two-step-supplier",setup(t){const _=ge(),b=ye(),D=ke(),m=y(""),V=y(!1),x=y({other:void 0}),k=y(!1),C=y(A("otpExpiresAt").value-Math.floor(Date.now()/1e3)),f=setInterval(()=>{C.value-=1,C.value<=0&&(clearInterval(f),C.value=0,b.replace("/login-supplier"))},1e3),I=B(()=>{const d=C.value,a=Math.floor(d%3600/60),v=d%60;return{minutes:a.toString().padStart(2,"0"),seconds:v.toString().padStart(2,"0")}});async function h(){V.value=!0;try{const d=await Ce("/verify-supplier-otp",{method:"POST",body:{mobileNumber:_.query.mobileNumber,otpCode:m.value},onResponseError({response:w}){V.value=!1,w._data.errors?x.value=w._data.errors:(x.value.other=w._data.message,k.value=!0)}}),{accessToken:a,userData:v,userAbilityRules:u}=d;A("userAbilityRules").value=u,D.update(u),A("userData").value=v,A("accessToken").value=a,await H(()=>{b.replace(_.query.to?String(_.query.to):"/")})}catch(d){console.error(d)}}return(d,a)=>{const v=be("RouterLink");return we(),Ve(K,null,[l(Se,{modelValue:s(k),"onUpdate:modelValue":a[0]||(a[0]=u=>q(k)?k.value=u:null),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:c(()=>[L(R(s(x).other),1)]),_:1},8,["modelValue"]),i("div",qe,[i("div",$e,[l(s(N),{nodes:("h"in d?d.h:s($))("div",{innerHTML:s(je)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),l(s(N),{nodes:("h"in d?d.h:s($))("div",{innerHTML:s(Me)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),l(Re,{class:J(["auth-card",d.$vuetify.display.smAndUp?"pa-6":"pa-0"]),"max-width":"460"},{default:c(()=>[l(Ae,{class:"justify-center"},{default:c(()=>[l(Ie,null,{default:c(()=>[l(v,{to:"/"},{default:c(()=>[i("div",ze,[l(s(N),{nodes:s(z).app.logo},null,8,["nodes"]),i("h1",Ue,R(s(z).app.title),1)])]),_:1})]),_:1})]),_:1}),l(U,null,{default:c(()=>[...a[2]||(a[2]=[i("h4",{class:"text-h4 mb-1"}," احراز هویت دو مرحله‌ای ",-1),i("p",{class:"mb-1"}," کد تأیید به تلفن همراه شما ارسال شد. لطفاً کد دریافتی را در کادر زیر وارد کنید ",-1)])]),_:1}),l(U,null,{default:c(()=>[l(Fe,{onSubmit:_e(()=>{},["prevent"])},{default:c(()=>[l(Be,null,{default:c(()=>[l(F,{cols:"12"},{default:c(()=>[l(Le,{modelValue:s(m),"onUpdate:modelValue":a[1]||(a[1]=u=>q(m)?m.value=u:null),style:{direction:"ltr"},disabled:s(V),type:"number",class:"pa-0",onFinish:h},null,8,["modelValue","disabled"])]),_:1}),l(F,{cols:"12"},{default:c(()=>[l(xe,{loading:s(V),disabled:s(V),block:"",type:"submit"},{default:c(()=>[...a[3]||(a[3]=[L(" تأیید ",-1)])]),_:1},8,["loading","disabled"])]),_:1}),l(F,null,{default:c(()=>[l(F,{cols:"12"},{default:c(()=>[i("div",He,[i("span",Ke,R(s(I).minutes)+":"+R(s(I).seconds),1),a[4]||(a[4]=i("span",{class:"me-1"},"تا درخواست دوباره",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])],64)}}}),dt=he(Je,[["__scopeId","data-v-5ae98224"]]);export{dt as default};
