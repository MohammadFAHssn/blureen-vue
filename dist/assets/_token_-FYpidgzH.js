import{r as N}from"./validators-DkGyzL9w.js";import{Y as E,ce as O,bD as X,c as x,o as u,f as T,m as $,b as e,n as l,a3 as R,cf as Z,i as q,e as t,A as ee,an as F,ao as Q,y as te,M as ae,j as re,k as le,r as h,bL as z,bM as oe,aN as se,v as i,x as m,d as D,a2 as M,bB as ne,bK as ie,F as U,bC as ue,am as de,a1 as me}from"./index-Bodr_hfD.js";import{V as pe}from"./VTextarea-kGCklaFm.js";import{_ as ce}from"./AppTextField-BKA6cKjg.js";import{$ as fe}from"./api-Csf549wX.js";import{u as be}from"./useApi-CBCtVh3D.js";import{c as Ve}from"./createUrl-8TzKjpIf.js";import{V as H}from"./VSnackbar-C-xXOV7P.js";import{V as f}from"./VCol-CM-kCSZl.js";import{V as P}from"./VRow-BKEV0oZi.js";import{V as ve,a as _e,b as ye,d as ge}from"./VList-CL6Liqgk.js";import{V as A,a as xe,b as Te}from"./VCard-C4XhZLFG.js";import{V as b}from"./VCardText-G410WQ2m.js";import{a as j,V as C}from"./VRadioGroup-Ch1urmGh.js";import{V as Se}from"./VDivider-DJMffoU2.js";import{V as ke}from"./VForm-ff7bmQvP.js";import"./helpers-4BKJjDfb.js";import"./autofocus-B7577uoF.js";import"./VCounter-B_GhA2Q4.js";import"./VField-DBpaim4o.js";import"./VOverlay-87kGH8oR.js";import"./VTextField-DVITFpn5.js";import"./useLogout-CF3v8XAM.js";/* empty css              */import"./createSimpleFunctional-CmzEFTRr.js";const Pe=Object.assign({name:"AppTextarea",inheritAttrs:!1},{__name:"AppTextarea",setup(B){const S=E(()=>{const V=O().id,v=X();return V?`app-textarea-${V}`:v}),k=E(()=>O().label);return(c,V)=>(u(),x("div",{class:te(["app-textarea flex-grow-1",c.$attrs.class])},[l(k)?(u(),T(R,{key:0,for:l(S),class:"mb-1 text-body-2",text:l(k)},null,8,["for","text"])):$("",!0),e(pe,F(Q({...c.$attrs,class:null,label:void 0,variant:"outlined",id:l(S)})),Z({_:2},[q(c.$slots,(v,_)=>({name:_,fn:t(I=>[ee(c.$slots,_,F(Q(I||{})))])}))]),1040)],2))}}),Ie={key:0,class:"layout-page-content"},we={class:"text-wrap mb-2"},he={class:"text-h6"},De={__name:"[token]",async setup(B){let S,k;const c=re(),V=le(),v=h(null),_=h(null),I=h([]),w=h(0),s=z({hasError:!1,errorMessage:"",isSuccessful:!1,HaveTenderBidsBeenSent:[],isSendTenderBidPending:[]}),d=z({paymentTerms:"cash",creditDescription:"",invoiceType:"taxInvoice"});let L=null;function G(){w.value=Math.max(0,v.value.tenderExpiresAt-Math.floor(Date.now()/1e3)),L=setInterval(()=>{w.value--,w.value<=0&&V.replace({name:"login-supplier"})},1e3)}function K(o,a){return a<=1?"#28a745":`hsl(${120-o/(a-1)*120}, 100%, 50%)`}async function Y(o){const{id:a,bidPrice:p,bidQuantity:g,bidDescription:r}=o;if(!(!p||!g)){s.isSendTenderBidPending[a]=!0;try{await fe("/commerce/tender/submit-bid",{method:"POST",body:{id:a,bid_price:p,bid_quantity:g,bid_description:r||"",payment_terms:d.paymentTerms,payment_terms_description:d.paymentTerms==="credit"?d.creditDescription:"",invoice_type:d.invoiceType},onResponseError({response:n}){s.hasError=!0,s.errorMessage=n._data.message||"خطا در ارسال پیشنهاد"}}),s.HaveTenderBidsBeenSent[a]=!0,s.isSuccessful=!0}catch(n){console.error(n)}finally{s.isSendTenderBidPending[a]=!1}}}async function J(){try{const{data:o,error:a}=await be(Ve(`/commerce/tender/get-by-token?token=${c.params.token}`));if(a.value)throw a.value;v.value=o.value.data,_.value=o.value.data.supplier,I.value=o.value.data.tenderBids||[],G()}catch(o){s.hasError=!0,s.errorMessage=o.message||"خطا در دریافت اطلاعات مناقصه",setTimeout(()=>{V.replace({name:"login-supplier"})},2e3)}}[S,k]=oe(()=>J()),await S,k();const y=E(()=>{const o=w.value,a=Math.floor(o/86400),p=Math.floor(o%86400/3600),g=Math.floor(o%3600/60),r=o%60;return{days:a,hours:p.toString().padStart(2,"0"),minutes:g.toString().padStart(2,"0"),seconds:r.toString().padStart(2,"0")}});return se(()=>{clearInterval(L)}),(o,a)=>{const p=ce,g=Pe;return u(),x(U,null,[e(H,{modelValue:l(s).hasError,"onUpdate:modelValue":a[0]||(a[0]=r=>l(s).hasError=r),timeout:"2000",location:"center",variant:"flat",color:"error"},{default:t(()=>[i(m(l(s).errorMessage)+"، در حال انتقال به پنل تأمین‌کننده ... ",1)]),_:1},8,["modelValue"]),e(H,{modelValue:l(s).isSuccessful,"onUpdate:modelValue":a[1]||(a[1]=r=>l(s).isSuccessful=r),timeout:"1500",location:"center",variant:"flat",color:"success"},{default:t(()=>[...a[5]||(a[5]=[i(" ارسال شد! ",-1)])]),_:1},8,["modelValue"]),l(v)?(u(),x("main",Ie,[e(P,null,{default:t(()=>[e(f,null,{default:t(()=>[D("div",we,[a[6]||(a[6]=i(" مدیریت محترم شرکت/فروشگاه ",-1)),D("span",he,m(l(_).name),1)]),a[7]||(a[7]=D("div",{class:"text-body-1"}," لیست کالاهای مورد نیاز مجموعه کارخانجات شیشه اردکان به شرح زیر می‌باشد. ",-1)),a[8]||(a[8]=D("div",{class:"text-body-1"}," لطفاً قیمت‌های پیشنهادی خود را ارائه دهید. ",-1))]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(ve,{style:{"background-color":"rgb(var(--v-theme-background))"}},{default:t(()=>[e(_e,null,{prepend:t(()=>[e(ne,{color:"warning",variant:"tonal",rounded:"",icon:"tabler-stopwatch"})]),default:t(()=>[e(ye,{class:"font-weight-medium"},{default:t(()=>[...a[9]||(a[9]=[i(" مدت زمان باقی‌مانده تا پایان مناقصه: ",-1)])]),_:1}),e(ge,{class:"text-body-1"},{default:t(()=>[l(y).days>0?(u(),T(M,{key:0},{default:t(()=>[i(m(l(y).days)+" روز و "+m(l(y).hours)+" ساعت ",1)]),_:1})):(u(),T(M,{key:1},{default:t(()=>[i(m(l(y).hours)+":"+m(l(y).minutes)+":"+m(l(y).seconds),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(f,{cols:"12",md:"6",lg:"4"},{default:t(()=>[e(A,null,{default:t(()=>[e(b,{class:"custom-v-card-text"},{default:t(()=>[e(R,{class:"mb-2"},{default:t(()=>[...a[10]||(a[10]=[i(" شرایط پرداخت ",-1)])]),_:1}),e(j,{modelValue:l(d).paymentTerms,"onUpdate:modelValue":a[2]||(a[2]=r=>l(d).paymentTerms=r),inline:""},{default:t(()=>[e(C,{label:"نقدی",value:"cash"}),e(C,{label:"شرایطی",value:"credit"})]),_:1},8,["modelValue"]),l(d).paymentTerms==="credit"?(u(),T(p,{key:0,modelValue:l(d).creditDescription,"onUpdate:modelValue":a[3]||(a[3]=r=>l(d).creditDescription=r),type:"text",placeholder:"توضیحات"},null,8,["modelValue"])):$("",!0)]),_:1}),e(Se),e(b,{class:"custom-v-card-text"},{default:t(()=>[e(R,{class:"mb-2"},{default:t(()=>[...a[11]||(a[11]=[i(" نوع فاکتور ",-1)])]),_:1}),e(j,{modelValue:l(d).invoiceType,"onUpdate:modelValue":a[4]||(a[4]=r=>l(d).invoiceType=r),inline:""},{default:t(()=>[e(C,{label:"فاکتور رسمی",value:"taxInvoice"}),e(C,{label:"فاکتور فروشگاهی",value:"commercialInvoice"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(ie,{group:""},{default:t(()=>[(u(!0),x(U,null,q(l(I).filter(r=>!l(s).HaveTenderBidsBeenSent[r.id]),r=>(u(),T(f,{key:r.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(A,null,{default:t(()=>[e(xe,null,{default:t(()=>[e(Te,{class:"custom-v-card-title"},{default:t(()=>[i(m(r.tenderProduct.product.name)+" ",1),r.tenderProduct.brand?(u(),x(U,{key:0},[i(" ("+m(r.tenderProduct.brand.name)+") ",1)],64)):$("",!0)]),_:2},1024)]),_:2},1024),e(b,null,{default:t(()=>[i(m(r.tenderProduct.purchaseExpertDescription),1)]),_:2},1024),e(b,null,{default:t(()=>[e(A,{variant:"outlined"},{default:t(()=>[e(b,null,{default:t(()=>[...a[12]||(a[12]=[i(" قیمت‌های پیشنهادی از سایر تأمین‌کنندگان (تومان): ",-1)])]),_:1}),e(b,{class:"d-flex flex-wrap gap-x-4 gap-y-2"},{default:t(()=>[(u(!0),x(U,null,q(r.bidOfOtherSuppliers,(n,W)=>(u(),T(M,{key:n.supplierId,variant:n.supplierId===l(_).id?"flat":"outlined",color:K(W,r.bidOfOtherSuppliers.length)},{default:t(()=>[i(m(n.bidPrice),1)]),_:2},1032,["variant","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(b,null,{default:t(()=>[e(ke,{"validate-on":"submit lazy",onSubmit:ue(n=>Y(r),["prevent"])},{default:t(()=>[e(P,null,{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[e(p,{modelValue:r.bidPrice,"onUpdate:modelValue":n=>r.bidPrice=n,label:"قیمت",type:"number","prepend-inner-icon":"tabler-coin",suffix:"تومان",rules:["requiredValidator"in o?o.requiredValidator:l(N)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(f,{cols:"12"},{default:t(()=>[e(p,{modelValue:r.bidQuantity,"onUpdate:modelValue":n=>r.bidQuantity=n,label:"تعداد",type:"number","prepend-inner-icon":"tabler-scale",suffix:r.tenderProduct.product.counting_unit.UntName,placeholder:`مقدار مورد نیاز: ${r.tenderProduct.quantityRequired}`,rules:["requiredValidator"in o?o.requiredValidator:l(N)]},null,8,["modelValue","onUpdate:modelValue","suffix","placeholder","rules"])]),_:2},1024),e(f,{cols:"12"},{default:t(()=>[e(g,{modelValue:r.bidDescription,"onUpdate:modelValue":n=>r.bidDescription=n,label:"توضیحات",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(f,{cols:"12"},{default:t(()=>[e(de,{type:"submit",loading:l(s).isSendTenderBidPending[r.id],disabled:!r.bidPrice||!r.bidQuantity},{default:t(()=>[e(me,{icon:"tabler-send"}),a[13]||(a[13]=i("ارسال ",-1))]),_:1},8,["loading","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):$("",!0)],64)}}},tt=ae(De,[["__scopeId","data-v-15becc96"]]);export{tt as default};
