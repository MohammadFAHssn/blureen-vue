import{u as b}from"./useApi-jnKEpwZA.js";import{c as w}from"./createUrl-BEzvRIlS.js";import{$ as E}from"./api-CctPY7dA.js";import{V as I}from"./VSnackbar-zL0lJxOR.js";import{a as m,V as B}from"./VRow-BLJT9SWy.js";import{V as v,b as M,c as $}from"./VCard-CX4UpRmD.js";import{bH as y,r as _,c as u,o as a,b as i,e as r,v as c,x as S,n as s,f as p,m as N,F as k,i as T,am as V}from"./index-CxBCniRz.js";import"./useLogout-CUJN8KZ_.js";import"./VOverlay-CLFRDIcR.js";/* empty css              */import"./createSimpleFunctional-BbzySe_P.js";import"./VCardText-BVXiE7iR.js";const A={key:0},F={key:1},Q={__name:"survey",setup(L){const o=y({hasError:!1,errorMessage:""}),n=y({fetchSurveys:!1,participateInSurvey:!1}),d=_([]),f=_("");async function g(){n.fetchSurveys=!0;try{const{data:l,error:e}=await b(w("/survey/survey?filter[active]=1"));if(n.fetchSurveys=!1,e.value)throw e.value;d.value=l.value.data}catch(l){console.error("Error fetching surveys:",l),o.hasError=!0,o.errorMessage=l.message||"خطا در دریافت نظرسنجی‌ها"}}g();async function h(l){n.participateInSurvey=!0;try{const e=await E("/survey/survey/participate",{method:"POST",body:{porslineId:l},onResponseError({response:t}){n.participateInSurvey=!1,o.hasError=!0,o.errorMessage=t._data.message||"خطا در شرکت در نظرسنجی"}});n.participateInSurvey=!1,f.value=e.data}catch(e){console.error(e)}}function x(){window.open(f.value,"_blank","noopener,noreferrer")}return(l,e)=>(a(),u(k,null,[i(I,{modelValue:s(o).hasError,"onUpdate:modelValue":e[0]||(e[0]=t=>s(o).hasError=t),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:r(()=>[c(S(s(o).errorMessage),1)]),_:1},8,["modelValue"]),i(B,null,{default:r(()=>[i(m,null,{default:r(()=>[s(d).length===0?(a(),p(v,{key:0,variant:"text"},{default:r(()=>[...e[1]||(e[1]=[c(" نظرسنجی فعالی وجود ندارد. ",-1)])]),_:1})):N("",!0)]),_:1}),(a(!0),u(k,null,T(s(d),t=>(a(),p(m,{key:t.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:r(()=>[i(v,null,{default:r(()=>[i(M,{class:"text-center mb-5 text-wrap"},{default:r(()=>[c(S(t.title),1)]),_:2},1024),i($,{class:"justify-center"},{default:r(()=>[s(f)?(a(),p(V,{key:0,variant:"elevated",color:"success",onClick:C=>x(t.porsline_id)},{default:r(()=>[...e[2]||(e[2]=[c(" شروع ",-1)])]),_:2},1032,["onClick"])):(a(),p(V,{key:1,variant:"elevated",disabled:s(n).participateInSurvey,onClick:C=>h(t.porsline_id)},{default:r(()=>[s(n).participateInSurvey?(a(),u("span",A,"در حال ساخت لینک")):(a(),u("span",F,"دریافت لینک نظرسنجی"))]),_:2},1032,["disabled","onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))}};export{Q as default};
