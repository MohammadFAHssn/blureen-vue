import{M,bG as n,j as N,k as A,r as p,Y as F,aN as j,a as B,c as D,o as O,b as e,d as r,e as a,v as C,x as v,n as t,bv as k,O as S,I as x,bC as L,am as U,y as $,F as q,aw as H}from"./index-Bodr_hfD.js";import{a as P,b as z}from"./auth-v1-top-shape-CBN9aWIG.js";import{V as y}from"./VNodeRenderer-D3A81rpH.js";import{u as G}from"./useAbility-Carql7PI.js";import{$ as Y}from"./api-Csf549wX.js";import{V as J}from"./VSnackbar-C-xXOV7P.js";import{a as K,b as Q,V as W}from"./VCard-C4XhZLFG.js";import{V as R}from"./VCardText-G410WQ2m.js";import{V as X}from"./VForm-ff7bmQvP.js";import{V as Z}from"./VRow-BKEV0oZi.js";import{V as b}from"./VCol-CM-kCSZl.js";import{V as ee}from"./VOtpInput-BEznlZUY.js";import"./useLogout-CF3v8XAM.js";import"./VOverlay-87kGH8oR.js";import"./createSimpleFunctional-CmzEFTRr.js";/* empty css              */import"./VField-DBpaim4o.js";const te={class:"auth-wrapper d-flex align-center justify-center pa-4"},oe={class:"position-relative my-sm-16"},ae={class:"app-logo"},se={class:"app-logo-title"},re={class:"d-flex justify-center align-center flex-wrap"},le={class:"me-1"},ne=Object.assign({beforeRouteEnter(I,h,i){if(n("otpExpiresAt").value<Math.floor(Date.now()/1e3))return i({name:"forgot-password"});i()}},{__name:"two-step-forgot-password",setup(I){const h=N(),i=A(),T=G(),m=p(""),u=p(!1),V=p({other:void 0}),c=p(!1),f=p(n("otpExpiresAt").value-Math.floor(Date.now()/1e3)),g=setInterval(()=>{f.value-=1,f.value<=0&&(clearInterval(g),f.value=0,i.replace("/forgot-password"))},1e3),w=F(()=>{const s=f.value,o=Math.floor(s%3600/60),d=s%60;return{minutes:o.toString().padStart(2,"0"),seconds:d.toString().padStart(2,"0")}});async function E(){u.value=!0;try{const s=await Y("/verify-user-otp",{method:"POST",body:{mobileNumber:n("mobileNumber").value,otpCode:m.value},onResponseError({response:_}){u.value=!1,_._data.errors?V.value=_._data.errors:(V.value.other=_._data.message,c.value=!0)}}),{accessToken:o,userData:d,userAbilityRules:l}=s;n("userAbilityRules").value=l,T.update(l),n("userData").value=d,n("accessToken").value=o,await H(()=>{i.replace(h.query.to?String(h.query.to):"/reset-password")})}catch(s){console.error(s)}}return j(()=>{clearInterval(g)}),(s,o)=>{const d=B("RouterLink");return O(),D(q,null,[e(J,{modelValue:t(c),"onUpdate:modelValue":o[0]||(o[0]=l=>k(c)?c.value=l:null),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:a(()=>[C(v(t(V).other),1)]),_:1},8,["modelValue"]),r("div",te,[r("div",oe,[e(t(y),{nodes:("h"in s?s.h:t(S))("div",{innerHTML:t(P)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),e(t(y),{nodes:("h"in s?s.h:t(S))("div",{innerHTML:t(z)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),e(W,{class:$(["auth-card",s.$vuetify.display.smAndUp?"pa-6":"pa-0"]),"max-width":"460"},{default:a(()=>[e(K,{class:"justify-center"},{default:a(()=>[e(Q,null,{default:a(()=>[e(d,{to:"/"},{default:a(()=>[r("div",ae,[e(t(y),{nodes:t(x).app.logo},null,8,["nodes"]),r("h1",se,v(t(x).app.title),1)])]),_:1})]),_:1})]),_:1}),e(R,null,{default:a(()=>[...o[2]||(o[2]=[r("h4",{class:"text-h6 mb-1"}," احراز هویت دو مرحله‌ای ",-1),r("p",{class:"mb-1"}," کد تأیید به تلفن همراه شما ارسال شد. لطفاً کد دریافتی را در کادر زیر وارد کنید ",-1)])]),_:1}),e(R,null,{default:a(()=>[e(X,{onSubmit:L(()=>{},["prevent"])},{default:a(()=>[e(Z,null,{default:a(()=>[e(b,{cols:"12"},{default:a(()=>[e(ee,{modelValue:t(m),"onUpdate:modelValue":o[1]||(o[1]=l=>k(m)?m.value=l:null),style:{direction:"ltr"},disabled:t(u),type:"number",class:"pa-0",onFinish:E},null,8,["modelValue","disabled"])]),_:1}),e(b,{cols:"12"},{default:a(()=>[e(U,{loading:t(u),disabled:t(u),block:"",type:"submit"},{default:a(()=>[...o[3]||(o[3]=[C(" تأیید ",-1)])]),_:1},8,["loading","disabled"])]),_:1}),e(b,null,{default:a(()=>[e(b,{cols:"12"},{default:a(()=>[r("div",re,[r("span",le,v(t(w).minutes)+":"+v(t(w).seconds),1),o[4]||(o[4]=r("span",{class:"me-1"},"تا درخواست دوباره",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])],64)}}}),Se=M(ne,[["__scopeId","data-v-2676a67a"]]);export{Se as default};
