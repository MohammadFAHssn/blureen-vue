import{ax as F,a6 as J,ab as L,b as t,d as _,J as Y,y as j,a_ as Z,ad as G,aB as ee,aV as ae,az as te,aE as le,aU as se,ar as oe,a7 as ne,Y as O,b5 as ie,bj as re,b3 as U,a9 as N,bM as ue,aZ as de,av as ce,au as me,b2 as fe,M as ve,r as I,w as ge,f as T,o as y,e as l,am as P,a1 as be,v as x,x as V,c as w,F as D,i as $,n as o,m as H,bv as Ve,bJ as q,bN as ye,H as he}from"./index-BjDbercT.js";import{V as R,c as K,b as _e}from"./VCard-DLNXAE8v.js";import{V as xe}from"./VCardText-DJrV3pWu.js";import{V as pe}from"./VContainer-HZBIHNoZ.js";import{V as A}from"./VRow-LLRdI7I1.js";import{V as M}from"./VCol-qg2p72EP.js";import{V as Ee}from"./VRating-b6mFlcj1.js";import{V as ke}from"./VDivider-CY0uTSDO.js";import{V as W}from"./VDialog-TeVeCvfX.js";import{u as Q}from"./useApi-DXH5Gn3K.js";import{c as z}from"./createUrl-z7xFz3yT.js";import{$ as Ce}from"./api-DjFw6eZH.js";import{V as Te}from"./VSnackbar-CHSK6Bj4.js";import{V as we}from"./VSpacer-BRv_zkJu.js";import"./createSimpleFunctional-BP7hpzsR.js";/* empty css              */import"./VOverlay-BlrRlgQ7.js";import"./dialog-transition-BfqVmbQh.js";import"./useLogout-kPLI9xuP.js";import"./index-CvOPxmL5.js";const Be=J({text:String,...G(),...Z()},"VToolbarTitle"),X=F()({name:"VToolbarTitle",props:Be(),setup(e,p){let{slots:a}=p;return L(()=>{const i=!!(a.default||a.text||e.text);return t(e.tag,{class:j(["v-toolbar-title",e.class]),style:Y(e.style)},{default:()=>{var c;return[i&&_("div",{class:"v-toolbar-title__placeholder"},[a.text?a.text():e.text,(c=a.default)==null?void 0:c.call(a)])]}})}),{}}}),Se=[null,"prominent","default","comfortable","compact"],qe=J({absolute:Boolean,collapse:Boolean,collapsePosition:{type:String,default:"start"},color:String,density:{type:String,default:"default",validator:e=>Se.includes(e)},extended:{type:Boolean,default:null},extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...fe(),...G(),...me(),...ce(),...Z({tag:"header"}),...de()},"VToolbar"),Pe=F()({name:"VToolbar",props:qe(),setup(e,p){var b;let{slots:a}=p;const{backgroundColorClasses:i,backgroundColorStyles:c}=ee(()=>e.color),{borderClasses:m}=ae(e),{elevationClasses:k}=te(e),{roundedClasses:E}=le(e),{themeClasses:h}=se(e),{rtlClasses:u}=oe(),f=ne(e.extended===null?!!((b=a.extension)!=null&&b.call(a)):e.extended),d=O(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),g=O(()=>f.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return ie({VBtn:{variant:"text"}}),L(()=>{var s;const r=!!(e.title||a.title),n=!!(a.image||e.image),v=(s=a.extension)==null?void 0:s.call(a);return f.value=e.extended===null?!!v:e.extended,t(e.tag,{class:j(["v-toolbar",`v-toolbar--collapse-${e.collapsePosition}`,{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},i.value,m.value,k.value,E.value,h.value,u.value,e.class]),style:Y([c.value,e.style])},{default:()=>[n&&_("div",{key:"image",class:"v-toolbar__image"},[a.image?t(U,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},a.image):t(re,{key:"image-img",cover:!0,src:e.image},null)]),t(U,{defaults:{VTabs:{height:N(d.value)}}},{default:()=>{var C,B,S;return[_("div",{class:"v-toolbar__content",style:{height:N(d.value)}},[a.prepend&&_("div",{class:"v-toolbar__prepend"},[(C=a.prepend)==null?void 0:C.call(a)]),r&&t(X,{key:"title",text:e.title},{text:a.title}),(B=a.default)==null?void 0:B.call(a),a.append&&_("div",{class:"v-toolbar__append"},[(S=a.append)==null?void 0:S.call(a)])])]}}),t(U,{defaults:{VTabs:{height:N(g.value)}}},{default:()=>[t(ue,null,{default:()=>[f.value&&_("div",{class:"v-toolbar__extension",style:{height:N(g.value)}},[v])]})]})]})}),{contentHeight:d,extensionHeight:g}}}),Re={class:"text-h6 font-weight-bold mb-4 text-primary"},Ne={class:"text-body-1 mb-3"},Oe={class:"d-flex align-center justify-start"},De={key:0,class:"mr-3 text-body-2 font-weight-medium"},Me={__name:"EvaluationDialog",props:{modelValue:{type:Boolean,required:!0},evaluatee:{type:Object,required:!0},questions:{type:Array,required:!0},loading:{type:Boolean,default:!1},initialRatings:{type:Object,default:null}},emits:["update:modelValue","save"],setup(e,{emit:p}){const a=e,i=p,c=O({get:()=>a.modelValue,set:f=>i("update:modelValue",f)}),m=I({});function k(){const f={};a.questions&&a.questions.length>0&&a.questions.forEach(d=>{d.questions.forEach(g=>{var n;const b=g.id,r=((n=a.initialRatings)==null?void 0:n[b])??0;f[b]=r})}),m.value=f}ge([()=>a.questions,()=>a.initialRatings],()=>{k()},{immediate:!0});const E=O(()=>Object.values(m.value).every(f=>f>0));function h(){const f=[];Object.entries(m.value).forEach(([d,g])=>{f.push({evaluatee_id:a.evaluatee.id,question_id:Number(d),score:g})}),i("save",f)}function u(){k(),c.value=!1}return(f,d)=>(y(),T(W,{modelValue:o(c),"onUpdate:modelValue":d[0]||(d[0]=g=>Ve(c)?c.value=g:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:l(()=>[t(R,null,{default:l(()=>[t(Pe,{color:"primary",dark:""},{default:l(()=>[t(P,{icon:"",dark:"",onClick:u},{default:l(()=>[t(be,null,{default:l(()=>[...d[1]||(d[1]=[x("mdi-close",-1)])]),_:1})]),_:1}),t(X,null,{default:l(()=>[x(V(e.evaluatee.user.personnel_code)+" - "+V(e.evaluatee.user.first_name)+" "+V(e.evaluatee.user.last_name)+" ("+V(e.evaluatee.user.profile.cost_center.name)+") ",1)]),_:1})]),_:1}),t(xe,{class:"pa-6"},{default:l(()=>[t(pe,null,{default:l(()=>[t(A,null,{default:l(()=>[t(M,{cols:"12"},{default:l(()=>[(y(!0),w(D,null,$(e.questions,g=>(y(),w("div",{key:g.id,class:"mb-8"},[_("div",Re,V(g.name),1),t(A,null,{default:l(()=>[(y(!0),w(D,null,$(g.questions,b=>(y(),T(M,{key:b.id,cols:"12",md:"6"},{default:l(()=>[t(R,{variant:"outlined",class:j(["pa-4",{"border-success":o(m)[b.id]>0}])},{default:l(()=>[_("div",Ne,V(b.question_text),1),_("div",Oe,[t(Ee,{modelValue:o(m)[b.id],"onUpdate:modelValue":r=>o(m)[b.id]=r,length:10,color:"amber","active-color":"amber",size:23,hover:""},null,8,["modelValue","onUpdate:modelValue"]),o(m)[b.id]>0?(y(),w("span",De,V(o(m)[b.id])+"/10 ",1)):H("",!0)])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(ke),t(K,{class:"pa-4 justify-end"},{default:l(()=>[t(P,{variant:"outlined",color:"error",disabled:e.loading,onClick:u},{default:l(()=>[...d[2]||(d[2]=[x(" انصراف ",-1)])]),_:1},8,["disabled"]),t(P,{variant:"elevated",color:"success",loading:e.loading,disabled:!o(E)||e.loading,onClick:h},{default:l(()=>[...d[3]||(d[3]=[x(" ذخیره ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},je=ve(Me,[["__scopeId","data-v-5ac0cccb"]]),sa={__name:"peer-evaluation",async setup(e){let p,a;const i=q({hasError:!1,errorMessage:"",dialog:!1}),c=q({fetchEvaluatees:!1,fetchQuestions:!1,evaluate:!1}),m=I([]),k=I([]),E=q({}),h=q({}),u=q({isOpen:!1,selectedEvaluatee:null});async function f(){c.fetchEvaluatees=!0;try{const{data:r,error:n}=await Q(z("/evaluation/evaluatee/by-evaluator"));if(c.fetchEvaluatees=!1,n.value)throw n.value;m.value=r.value.data,m.value.forEach(v=>{v&&typeof v.id<"u"&&(Object.prototype.hasOwnProperty.call(v,"is_evaluated")?E[v.id]=!!v.is_evaluated:E[v.id]===void 0&&(E[v.id]=!1))})}catch(r){console.error("Error fetching evaluatees:",r),i.hasError=!0,i.errorMessage=r.message||"خطا در دریافت ارزیابی‌شونده‌ها"}}async function d(){c.fetchQuestions=!0;try{const{data:r,error:n}=await Q(z("/evaluation/evaluation-question/actives"));if(c.fetchQuestions=!1,n.value)throw n.value;k.value=r.value.data}catch(r){console.error("Error fetching questions:",r),i.hasError=!0,i.errorMessage=r.message||"خطا در دریافت سوالات ارزیابی"}}async function g(r){var n,v;c.evaluate=!0;try{let s=!1;if(await Ce("/evaluation/evaluation-score/create",{method:"POST",body:{results:r},onResponseError({response:C}){i.hasError=!0,i.errorMessage=C._data.message||"خطا در ارزیابی",s=!0}}),!s){if(((n=u.selectedEvaluatee)==null?void 0:n.id)!==void 0&&(E[u.selectedEvaluatee.id]=!0),((v=u.selectedEvaluatee)==null?void 0:v.id)!==void 0){const C=u.selectedEvaluatee.id,B={};r.forEach(S=>{B[S.question_id]=S.score}),h[C]=B}u.isOpen=!1,u.selectedEvaluatee=null}}catch(s){console.error(s),i.hasError=!0,i.errorMessage=(s==null?void 0:s.message)||"خطا در ارزیابی"}finally{c.evaluate=!1}}function b(r){u.selectedEvaluatee=r,u.isOpen=!0}return[p,a]=ye(()=>f()),await p,a(),d(),he(()=>{i.dialog=!0}),(r,n)=>{var v;return y(),w(D,null,[t(Te,{modelValue:o(i).hasError,"onUpdate:modelValue":n[0]||(n[0]=s=>o(i).hasError=s),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[x(V(o(i).errorMessage),1)]),_:1},8,["modelValue"]),o(m).length!==0?(y(),T(W,{key:0,modelValue:o(i).dialog,"onUpdate:modelValue":n[2]||(n[2]=s=>o(i).dialog=s),"max-width":"400",persistent:""},{default:l(()=>[t(R,{"prepend-icon":"mdi-map-marker",text:"در صورت خروج از صفحه، موارد ارزیابی‌شده ثبت نهایی شده و از لیست حذف می‌شوند!",title:"توجه"},{actions:l(()=>[t(we),t(P,{onClick:n[1]||(n[1]=s=>o(i).dialog=!1)},{default:l(()=>[...n[4]||(n[4]=[x(" باشه ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])):H("",!0),o(u).selectedEvaluatee?(y(),T(je,{key:1,modelValue:o(u).isOpen,"onUpdate:modelValue":n[3]||(n[3]=s=>o(u).isOpen=s),evaluatee:o(u).selectedEvaluatee,questions:o(k),"initial-ratings":o(h)[(v=o(u).selectedEvaluatee)==null?void 0:v.id]||null,loading:o(c).evaluate,onSave:g},null,8,["modelValue","evaluatee","questions","initial-ratings","loading"])):H("",!0),t(A,null,{default:l(()=>[o(m).length===0?(y(),T(M,{key:0},{default:l(()=>[t(R,{variant:"text"},{default:l(()=>[...n[5]||(n[5]=[x(" ارزیابی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(y(!0),w(D,{key:1},$(o(m),s=>(y(),T(M,{key:s.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:l(()=>[t(R,{class:j({"border-success":!!o(h)[s.id]})},{default:l(()=>[t(_e,{class:"text-center mb-5 text-wrap"},{default:l(()=>[x(V(s.user.personnel_code)+" - "+V(s.user.first_name)+" "+V(s.user.last_name)+" ("+V(s.user.profile.cost_center.name)+") ",1)]),_:2},1024),t(K,{class:"justify-center"},{default:l(()=>[t(P,{variant:"elevated",color:o(h)[s.id]?"warning":"success",onClick:C=>b(s)},{default:l(()=>[x(V(o(h)[s.id]?"ویرایش ارزیابی":"شروع ارزیابی"),1)]),_:2},1032,["color","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})],64)}}};export{sa as default};
