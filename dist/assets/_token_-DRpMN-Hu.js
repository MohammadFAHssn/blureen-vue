import{r as ce}from"./validators-9V7Nl4tn.js";import{an as he,a2 as Se,aw as Pe,Y as M,r as f,a3 as ke,aV as Ie,G as Ce,w as z,aS as Re,a7 as Te,b6 as Fe,b as t,q as ee,b2 as te,a5 as Me,a4 as Ue,F as D,J as fe,as as Ae,c2 as $e,c3 as De,bK as me,bL as Ee,c as G,o as x,f as $,l as oe,m as u,bM as Ne,h as ne,e as o,z as ze,bN as ve,bO as pe,x as Oe,i as qe,j as He,bY as Ge,ax as Le,t as m,v as g,bk as O,d as q,c4 as Qe,bp as je,ah as Ye,$ as Je}from"./index-BQwBCqnc.js";import{u as Ke,V as re}from"./form-Ce5jQ8k_.js";import{a as We}from"./VTextField-D2tDtDp3.js";import{f as Xe,m as Ze,V as Be}from"./VField-Cpe-sLAx.js";import{V as Ve,m as et}from"./VInput-JyjKDZn_.js";import{f as tt}from"./VOverlay-C5GJB83j.js";import{I as at}from"./VImg-DOQac6K6.js";import{_ as lt}from"./AppTextField-Cr_DlVWz.js";import{$ as ot}from"./api-6RQJ6j22.js";import{u as nt}from"./useApi-DPFPo0gI.js";import{c as rt}from"./createUrl-CxuPOZoh.js";import{_ as ut}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as xe}from"./VSnackbar-Cz5Qhycw.js";import{V as T}from"./VCol-Yvtte_hb.js";import{V as H}from"./VRow-BgUrbQC7.js";import{V as st,a as it,b as dt,d as ct}from"./VList-CZIGQjc5.js";import{V as ae}from"./VChip-BOrRsrwa.js";import{V as ft}from"./VAvatar-q4JzDBzS.js";import{V as le,a as mt,b as vt}from"./VCard-CzoRWDbu.js";import{V as F}from"./VCardText-CXtRmRJq.js";import{a as be,V as J}from"./VRadioGroup-BKca1mud.js";import{V as pt}from"./VDivider-CM7mOxbb.js";import{V as Vt}from"./VForm-B4wDZIff.js";import"./index-9rIf2CJL.js";/* empty css              */import"./createSimpleFunctional-40exrBac.js";import"./VSelectionControl-DSj8oPSk.js";const xt=Se({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...et(),...Ze()},"VTextarea"),bt=he()({name:"VTextarea",directives:{Intersect:at},inheritAttrs:!1,props:xt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,y){let{attrs:_,emit:b,slots:c}=y;const i=Pe(e,"modelValue"),{isFocused:v,focus:P,blur:U}=Ke(e),L=M(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),E=M(()=>{if(_.maxlength)return _.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function Q(n,a){var s,V;!e.autofocus||!n||(V=(s=a[0].target)==null?void 0:s.focus)==null||V.call(s)}const w=f(),h=f(),C=ke(""),R=f(),N=M(()=>e.persistentPlaceholder||v.value||e.active);function A(){var n;R.value!==document.activeElement&&((n=R.value)==null||n.focus()),v.value||P()}function K(n){A(),b("click:control",n)}function W(n){b("mousedown:control",n)}function X(n){n.stopPropagation(),A(),te(()=>{i.value="",De(e["onClick:clear"],n)})}function k(n){var s;const a=n.target;if(i.value=a.value,(s=e.modelModifiers)!=null&&s.trim){const V=[a.selectionStart,a.selectionEnd];te(()=>{a.selectionStart=V[0],a.selectionEnd=V[1]})}}const S=f(),p=f(+e.rows),r=M(()=>["plain","underlined"].includes(e.variant));Ie(()=>{e.autoGrow||(p.value=+e.rows)});function l(){e.autoGrow&&te(()=>{if(!S.value||!h.value)return;const n=getComputedStyle(S.value),a=getComputedStyle(h.value.$el),s=parseFloat(n.getPropertyValue("--v-field-padding-top"))+parseFloat(n.getPropertyValue("--v-input-padding-top"))+parseFloat(n.getPropertyValue("--v-field-padding-bottom")),V=S.value.scrollHeight,j=parseFloat(n.lineHeight),Z=Math.max(parseFloat(e.rows)*j+s,parseFloat(a.getPropertyValue("--v-input-control-height"))),B=parseFloat(e.maxRows)*j+s||1/0,I=Ue(V??0,Z,B);p.value=Math.floor((I-s)/j),C.value=Me(I)})}Ce(l),z(i,l),z(()=>e.rows,l),z(()=>e.maxRows,l),z(()=>e.density,l);let d;return z(S,n=>{n?(d=new ResizeObserver(l),d.observe(S.value)):d==null||d.disconnect()}),Re(()=>{d==null||d.disconnect()}),Te(()=>{const n=!!(c.counter||e.counter||e.counterValue),a=!!(n||c.details),[s,V]=Fe(_),{modelValue:j,...Z}=Ve.filterProps(e),B=Xe(e);return t(Ve,ee({ref:w,modelValue:i.value,"onUpdate:modelValue":I=>i.value=I,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":r.value},e.class],style:e.style},s,Z,{centerAffix:p.value===1&&!r.value,focused:v.value}),{...c,default:I=>{let{id:Y,isDisabled:ue,isDirty:se,isReadonly:ge,isValid:ye}=I;return t(Be,ee({ref:h,style:{"--v-textarea-control-height":C.value},onClick:K,onMousedown:W,"onClick:clear":X,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},B,{id:Y.value,active:N.value||se.value,centerAffix:p.value===1&&!r.value,dirty:se.value||e.dirty,disabled:ue.value,focused:v.value,error:ye.value===!1}),{...c,default:_e=>{let{props:{class:ie,...de}}=_e;return t(D,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),fe(t("textarea",ee({ref:R,class:ie,value:i.value,onInput:k,autofocus:e.autofocus,readonly:ge.value,disabled:ue.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:A,onBlur:U},de,V),null),[[Ae("intersect"),{handler:Q},null,{once:!0}]]),e.autoGrow&&fe(t("textarea",{class:[ie,"v-textarea__sizer"],id:`${de.id}-sizer`,"onUpdate:modelValue":we=>i.value=we,ref:S,readonly:!0,"aria-hidden":"true"},null),[[$e,i.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:a?I=>{var Y;return t(D,null,[(Y=c.details)==null?void 0:Y.call(c,I),n&&t(D,null,[t("span",null,null),t(We,{active:e.persistentCounter||v.value,value:L.value,max:E.value,disabled:e.disabled},c.counter)])])}:void 0})}),tt({},w,h,R)}}),gt=Object.assign({name:"AppTextarea",inheritAttrs:!1},{__name:"AppTextarea",setup(e){const y=M(()=>{const c=me().id,i=Ee();return c?`app-textarea-${c}`:i}),_=M(()=>me().label);return(b,c)=>(x(),G("div",{class:Oe(["app-textarea flex-grow-1",b.$attrs.class])},[u(_)?(x(),$(re,{key:0,for:u(y),class:"mb-1 text-body-2",text:u(_)},null,8,["for","text"])):oe("",!0),t(bt,ve(pe({...b.$attrs,class:null,label:void 0,variant:"outlined",id:u(y)})),Ne({_:2},[ne(b.$slots,(i,v)=>({name:v,fn:o(P=>[ze(b.$slots,v,ve(pe(P||{})))])}))]),1040)],2))}}),yt={key:0,class:"layout-page-content"},_t={class:"text-wrap mb-2"},wt={class:"text-h6"},ht={__name:"[token]",async setup(e){let y,_;const b=qe(),c=He(),i=f(!1),v=f(""),P=f(!1),U=f(0);let L,E;const Q=f([]),w=f("cash"),h=f(""),C=f("taxInvoice"),R=f([]),N=f([]);let A=null;const K=()=>{U.value=Math.max(0,L.tenderExpiresAt-Math.floor(Date.now()/1e3)),A=setInterval(()=>{U.value-=1,U.value===0&&c.replace({name:"login-supplier"})},1e3)},W=(r,l)=>{if(l<=1)return"success";const d=r/(l-1),n=Math.round(255*d),a=Math.round(255*(1-d));return`#${n.toString(16).padStart(2,"0")}${a.toString(16).padStart(2,"0")}00`},X=async r=>{if(!(!r.bidPrice||!r.bidQuantity)){N.value[r.id]=!0;try{await ot("/commerce/tender/submit-bid",{method:"POST",body:{id:r.id,bid_price:r.bidPrice,bid_quantity:r.bidQuantity,bid_description:r.bidDescription||"",payment_terms:w.value,payment_terms_description:w.value==="credit"?h.value:"",invoice_type:C.value},onResponseError({response:l}){i.value=!0,v.value=l._data.message||"خطا در ارسال پیشنهاد."}}),R.value[r.id]=!0,P.value=!0}catch(l){console.error(l)}finally{N.value[r.id]=!1}}},{data:k,error:S}=([y,_]=Ge(()=>nt(rt("/commerce/tender/get-by-token?token="+b.params.token))),y=await y,_(),y);S.value&&(i.value=!0,v.value=S.value.message||"خطا در دریافت اطلاعات مناقصه.",setTimeout(()=>{c.replace({name:"login-supplier"})},2e3)),k.value&&(L=k.value.data,E={id:k.value.data.supplier.id,name:k.value.data.supplier.name},Q.value=k.value.data.tenderBids||[],K());const p=M(()=>{const r=U.value,l=Math.floor(r/86400),d=Math.floor(r%86400/3600),n=Math.floor(r%3600/60),a=r%60;return{days:l,hours:d.toString().padStart(2,"0"),minutes:n.toString().padStart(2,"0"),seconds:a.toString().padStart(2,"0")}});return Le(()=>{clearInterval(A)}),(r,l)=>{const d=lt,n=gt;return x(),G(D,null,[t(xe,{modelValue:u(i),"onUpdate:modelValue":l[0]||(l[0]=a=>O(i)?i.value=a:null),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:o(()=>[m(g(u(v))+" ، در حال انتقال به پنل تأمین‌کننده ... ",1)]),_:1},8,["modelValue"]),t(xe,{modelValue:u(P),"onUpdate:modelValue":l[1]||(l[1]=a=>O(P)?P.value=a:null),timeout:2e3,location:"center",variant:"flat",color:"success"},{default:o(()=>l[5]||(l[5]=[m(" ارسال شد ")])),_:1},8,["modelValue"]),u(k)?(x(),G("main",yt,[q("div",null,[t(H,null,{default:o(()=>[t(T,null,{default:o(()=>[q("div",_t,[l[6]||(l[6]=m(" مدیریت محترم شرکت/فروشگاه ")),q("span",wt,g(u(E).name),1)]),l[7]||(l[7]=q("div",{class:"text-wrap text-body-1"}," لیست کالاهای مورد نیاز مجموعه کارخانجات شیشه اردکان به شرح زیر می‌باشد. ",-1)),l[8]||(l[8]=q("div",{class:"text-wrap text-body-1"}," لطفاً قیمت‌های پیشنهادی خود را ارائه دهید. ",-1))]),_:1})]),_:1}),t(H,null,{default:o(()=>[t(st,{style:{"background-color":"rgb(var(--v-theme-background))"}},{default:o(()=>[t(it,null,{prepend:o(()=>[t(ft,{color:"warning",variant:"tonal",rounded:"",icon:"tabler-stopwatch"})]),default:o(()=>[t(dt,{class:"font-weight-medium"},{default:o(()=>l[9]||(l[9]=[m(" مدت زمان باقی‌مانده تا پایان مناقصه: ")])),_:1}),t(ct,{class:"text-wrap text-body-1"},{default:o(()=>[u(p).days>0?(x(),$(ae,{key:0},{default:o(()=>[m(g(u(p).days)+" روز و "+g(u(p).hours)+" ساعت ",1)]),_:1})):(x(),$(ae,{key:1},{default:o(()=>[m(g(u(p).hours)+":"+g(u(p).minutes)+":"+g(u(p).seconds),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(H,null,{default:o(()=>[t(T,{cols:"12",md:"6",lg:"4"},{default:o(()=>[t(le,null,{default:o(()=>[t(F,{class:"custom-v-card-text"},{default:o(()=>[t(re,{class:"mb-2"},{default:o(()=>l[10]||(l[10]=[m(" شرایط پرداخت ")])),_:1}),t(be,{modelValue:u(w),"onUpdate:modelValue":l[2]||(l[2]=a=>O(w)?w.value=a:null),inline:""},{default:o(()=>[t(J,{label:"نقدی",value:"cash"}),t(J,{label:"شرایطی",value:"credit"})]),_:1},8,["modelValue"]),u(w)==="credit"?(x(),$(d,{key:0,modelValue:u(h),"onUpdate:modelValue":l[3]||(l[3]=a=>O(h)?h.value=a:null),type:"text",placeholder:"توضیحات"},null,8,["modelValue"])):oe("",!0)]),_:1}),t(pt),t(F,{class:"custom-v-card-text"},{default:o(()=>[t(re,{class:"mb-2"},{default:o(()=>l[11]||(l[11]=[m(" نوع فاکتور ")])),_:1}),t(be,{modelValue:u(C),"onUpdate:modelValue":l[4]||(l[4]=a=>O(C)?C.value=a:null),inline:""},{default:o(()=>[t(J,{label:"فاکتور رسمی",value:"taxInvoice"}),t(J,{label:"فاکتور فروشگاهی",value:"commercialInvoice"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(H,null,{default:o(()=>[t(Qe,{group:""},{default:o(()=>[(x(!0),G(D,null,ne(u(Q).filter(a=>!u(R)[a.id]),a=>(x(),$(T,{key:a.id,cols:"12",md:"6",lg:"4"},{default:o(()=>[t(le,null,{default:o(()=>[t(mt,null,{default:o(()=>[t(vt,{class:"custom-v-card-title"},{default:o(()=>[m(g(a.tenderProduct.product.name+(a.tenderProduct.brand?` (${a.tenderProduct.brand.name})`:"")),1)]),_:2},1024)]),_:2},1024),t(F,null,{default:o(()=>[m(g(a.tenderProduct.purchaseExpertDescription),1)]),_:2},1024),t(F,null,{default:o(()=>[t(le,{variant:"outlined"},{default:o(()=>[t(F,null,{default:o(()=>l[12]||(l[12]=[m(" قیمت‌های پیشنهادی از سایر تأمین‌کنندگان (تومان): ")])),_:1}),t(F,{class:"d-flex flex-wrap gap-x-4 gap-y-2"},{default:o(()=>[(x(!0),G(D,null,ne(a.bidOfOtherSuppliers,(s,V)=>(x(),$(ae,{key:s.supplierId,variant:s.supplierId===u(E).id?"flat":"outlined",color:W(V,a.bidOfOtherSuppliers.length)},{default:o(()=>[m(g(s.bidPrice),1)]),_:2},1032,["variant","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),t(F,null,{default:o(()=>[t(Vt,{"validate-on":"submit lazy",onSubmit:je(s=>X(a),["prevent"])},{default:o(()=>[t(H,null,{default:o(()=>[t(T,{cols:"12"},{default:o(()=>[t(d,{modelValue:a.bidPrice,"onUpdate:modelValue":s=>a.bidPrice=s,label:"قیمت",type:"number","prepend-inner-icon":"tabler-coin",suffix:"تومان",rules:["requiredValidator"in r?r.requiredValidator:u(ce)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(T,{cols:"12"},{default:o(()=>[t(d,{modelValue:a.bidQuantity,"onUpdate:modelValue":s=>a.bidQuantity=s,label:"تعداد",type:"number","prepend-inner-icon":"tabler-scale",suffix:a.tenderProduct.product.counting_unit.UntName,placeholder:`مقدار مورد نیاز: ${a.tenderProduct.quantityRequired}`,rules:["requiredValidator"in r?r.requiredValidator:u(ce)]},null,8,["modelValue","onUpdate:modelValue","suffix","placeholder","rules"])]),_:2},1024),t(T,{cols:"12"},{default:o(()=>[t(n,{modelValue:a.bidDescription,"onUpdate:modelValue":s=>a.bidDescription=s,label:"توضیحات",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(T,{cols:"12"},{default:o(()=>[t(Ye,{type:"submit",loading:u(N)[a.id]},{default:o(()=>[t(Je,{icon:"tabler-send"}),l[13]||(l[13]=m(" ارسال "))]),_:2},1032,["loading"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])):oe("",!0)],64)}}},Zt=ut(ht,[["__scopeId","data-v-04605880"]]);export{Zt as default};
