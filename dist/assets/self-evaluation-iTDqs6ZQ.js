import{u as $}from"./useApi-CiWJdktC.js";import{c as I}from"./createUrl-CwWpbz3p.js";import{$ as H}from"./api-CjiLJf85.js";import{M as J,bL as g,r as K,Y as x,bM as W,c as u,o,b as l,e as i,v as p,x as _,n as r,d as m,bN as z,f as v,m as k,F as V,i as w,y as X,a2 as Z,am as q}from"./index-DfzFnyP4.js";import{V as R}from"./VSnackbar-Cxm6tJmI.js";import{V as j}from"./VRow-J48OAN-Z.js";import{V as N}from"./VCol-BQVLmpnM.js";import{V as E,b as ee}from"./VCard-B2To7LZL.js";import{V as T}from"./VDivider-CtqfMG3C.js";import{V as te}from"./VCardText-DmBvFHAg.js";import{V as B}from"./VAlert-DlV1MGPm.js";import{V as ae}from"./VRating-vW7aCOb2.js";import{a as se,V as re}from"./VRadioGroup-BDx6M1Sj.js";import{V as le}from"./VCheckbox-D7k5I8bd.js";import{V as oe}from"./VTextarea-Cjcc4Oki.js";import{V as ie}from"./VContainer-CED4vxmJ.js";import"./useLogout-C2yF_buD.js";import"./VOverlay-BYHp-TxC.js";/* empty css              */import"./createSimpleFunctional-vt8nh-BB.js";import"./VCheckboxBtn-DDO-NtVh.js";import"./autofocus-DMHXo3yt.js";import"./VCounter-B1csrdo2.js";import"./VField-DEqlJnLv.js";const ne={class:"text-center"},de={key:0,class:"d-flex justify-center py-10"},ue={key:1,class:"text-center py-10 text-medium-emphasis"},ce={key:2},me={class:"d-flex align-center mb-4 flex-wrap gap-3"},fe={class:"d-flex align-center justify-space-between flex-wrap gap-3 mb-3"},pe={class:"text-body-1 font-weight-medium"},_e={key:0,class:"question-input d-flex align-center flex-wrap gap-4"},ye={key:1,class:"question-input"},ve={key:2,class:"question-input"},Ve={class:"d-flex flex-column gap-2"},he={key:3,class:"question-input"},be={key:4,class:"text-error text-caption mt-3 mb-0"},ge={class:"d-flex flex-wrap gap-4 align-center justify-space-between"},xe={class:"text-body-2 text-medium-emphasis"},we="سوالات عمومی",ke={__name:"self-evaluation",async setup(Ee){let C,M;const d=g({hasError:!1,errorMessage:"",hasSuccess:!1,successMessage:""}),y=g({fetchQuestions:!1,evaluate:!1}),h=g({submitted:!1}),f=K([]),n=g({}),F=x(()=>{const t=new Map;return f.value.forEach(e=>{var s;const a=((s=e==null?void 0:e.category)==null?void 0:s.name)||we;t.has(a)||t.set(a,[]),t.get(a).push(e)}),Array.from(t.entries()).map(([e,a])=>({name:e,questions:a}))}),S=x(()=>f.value.reduce((t,e)=>t+(b(e)?1:0),0)),A=x(()=>f.value.length?Math.round(S.value/f.value.length*100):0),U=x(()=>f.value.length?f.value.every(t=>b(t)):!1);function P(t=[]){Object.keys(n).forEach(e=>{delete n[e]}),t.forEach(e=>{e.question_type_id===3?n[e.id]=[]:e.question_type_id===2||e.question_type_id===1?n[e.id]=null:n[e.id]=""})}function b(t){const e=n[t.id];switch(t.question_type_id){case 1:return typeof e=="number"&&e>=1&&e<=10;case 2:return typeof e=="number"&&e>0;case 3:return Array.isArray(e)&&e.length>0;default:return!!e}}function G(t){return h.submitted&&!b(t)}function L(){return f.value.map(t=>{const e={question_id:t.id,question_type_id:t.question_type_id},a=n[t.id];return t.question_type_id===1?e.score=a:t.question_type_id===2?e.option_id=a:t.question_type_id===3?e.option_ids=a:e.answer=a,e})}async function O(){if(h.submitted=!0,!U.value)return;const t={answers:L()};await D(t)&&(d.hasSuccess=!0,d.successMessage="خودارزیابی شما با موفقیت ثبت شد.",h.submitted=!1)}async function Q(){var t;y.fetchQuestions=!0;try{const{data:e,error:a}=await $(I("/evaluation/evaluation-question/self-evaluation"));if(a.value)throw a.value;const s=((t=e.value)==null?void 0:t.data)||[];f.value=s,P(s)}catch(e){console.error("Error fetching questions:",e),d.hasError=!0,d.errorMessage=e.message||"خطا در دریافت سوالات خودارزیابی"}finally{y.fetchQuestions=!1}}async function D(t){y.evaluate=!0;let e=!1;try{return await H("/evaluation/self-evaluation/create",{method:"POST",body:t,onResponseError({response:a}){var s;e=!0,d.hasError=!0,d.errorMessage=((s=a==null?void 0:a._data)==null?void 0:s.message)||"خطا در ثبت خودارزیابی"}}),Q(),!e}catch(a){return console.error(a),d.hasError=!0,d.errorMessage=(a==null?void 0:a.message)||"خطا در ثبت خودارزیابی",!1}finally{y.evaluate=!1}}return[C,M]=W(()=>Q()),await C,M(),(t,e)=>(o(),u(V,null,[l(R,{modelValue:r(d).hasError,"onUpdate:modelValue":e[0]||(e[0]=a=>r(d).hasError=a),timeout:2500,location:"center",variant:"flat",color:"error"},{default:i(()=>[p(_(r(d).errorMessage),1)]),_:1},8,["modelValue"]),l(R,{modelValue:r(d).hasSuccess,"onUpdate:modelValue":e[1]||(e[1]=a=>r(d).hasSuccess=a),timeout:2500,location:"center",variant:"flat",color:"success"},{default:i(()=>[p(_(r(d).successMessage),1)]),_:1},8,["modelValue"]),l(ie,{class:"py-6"},{default:i(()=>[l(j,{justify:"center"},{default:i(()=>[l(N,{cols:"12",md:"11",lg:"10",xl:"8"},{default:i(()=>[l(E,{class:"elevation-2"},{default:i(()=>[l(ee,{class:"d-flex align-center justify-space-between flex-wrap gap-4"},{default:i(()=>[e[3]||(e[3]=m("div",null,[m("div",{class:"text-h6 font-weight-semibold mb-1"}," فرم خودارزیابی "),m("div",{class:"text-body-2 text-medium-emphasis text-wrap"}," لطفاً به تمام سوالات زیر با دقت و صداقت پاسخ دهید. ")],-1)),m("div",ne,[e[2]||(e[2]=m("div",{class:"text-caption text-medium-emphasis mb-1"}," درصد تکمیل ",-1)),l(z,{size:64,width:6,color:"primary","model-value":r(A)},{default:i(()=>[p(_(r(A))+"% ",1)]),_:1},8,["model-value"])])]),_:1}),l(T),l(te,null,{default:i(()=>[l(B,{type:"info",variant:"tonal",border:"start",class:"mb-6"},{default:i(()=>[...e[4]||(e[4]=[p(" پاسخ‌های شما فقط برای بهبود شرایط کاری و شناخت بهتر نیازهای کارکنان شرکت استفاده می‌شود. نمره کامل این بخش با تکمیل کامل فرم برای شما ثبت خواهد شد. تمامی نظرات شما محرمانه هستند و در اختیار سرشیفت، سرپرست یا مدیر قرار نخواهند گرفت. ",-1)])]),_:1}),r(y).fetchQuestions?(o(),u("div",de,[l(z,{color:"primary",indeterminate:"",size:"56"})])):r(f).length?(o(),u("div",ce,[(o(!0),u(V,null,w(r(F),a=>(o(),u("div",{key:a.name,class:"mb-8"},[m("div",me,[l(E,{class:"text-subtitle-1 font-weight-bold pa-2",color:"primary",variant:"tonal"},{default:i(()=>[p(_(a.name),1)]),_:2},1024),l(T,{class:"flex-grow-1"})]),l(j,null,{default:i(()=>[(o(!0),u(V,null,w(a.questions,s=>(o(),v(N,{key:s.id,cols:"12"},{default:i(()=>[l(E,{class:X(["mb-4 pa-4 question-card",{"border-success":b(s)}]),variant:"outlined"},{default:i(()=>[m("div",fe,[m("div",pe,_(s.question_text),1)]),s.question_type_id===1?(o(),u("div",_e,[l(ae,{modelValue:r(n)[s.id],"onUpdate:modelValue":c=>r(n)[s.id]=c,length:10,color:"amber","active-color":"amber",size:21,density:"comfortable",hover:""},null,8,["modelValue","onUpdate:modelValue"]),r(n)[s.id]?(o(),v(Z,{key:0,variant:"flat",color:"warning",size:"small"},{default:i(()=>[p(_(r(n)[s.id])+"/10 ",1)]),_:2},1024)):k("",!0)])):s.question_type_id===2?(o(),u("div",ye,[l(se,{modelValue:r(n)[s.id],"onUpdate:modelValue":c=>r(n)[s.id]=c,"hide-details":""},{default:i(()=>[(o(!0),u(V,null,w(s.options,c=>(o(),v(re,{key:c.id,label:c.option_title,value:c.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):s.question_type_id===3?(o(),u("div",ve,[m("div",Ve,[(o(!0),u(V,null,w(s.options,c=>(o(),v(le,{key:c.id,modelValue:r(n)[s.id],"onUpdate:modelValue":Y=>r(n)[s.id]=Y,label:c.option_title,value:c.id,"hide-details":""},null,8,["modelValue","onUpdate:modelValue","label","value"]))),128))])])):(o(),u("div",he,[l(oe,{modelValue:r(n)[s.id],"onUpdate:modelValue":c=>r(n)[s.id]=c,rows:"3","auto-grow":"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),G(s)?(o(),u("p",be," لطفاً به این سوال پاسخ دهید. ")):k("",!0)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:2},1024)]))),128)),r(h).submitted&&!r(U)?(o(),v(B,{key:0,type:"error",variant:"tonal",border:"start",class:"mb-4"},{default:i(()=>[...e[5]||(e[5]=[p(" لطفاً قبل از ثبت، به تمام سوالات پاسخ دهید. ",-1)])]),_:1})):k("",!0),m("div",ge,[m("div",xe,_(r(S))+" از "+_(r(f).length)+" سوال پاسخ داده شده است. ",1),l(q,{color:"primary",size:"large",loading:r(y).evaluate,disabled:r(y).evaluate,onClick:O},{default:i(()=>[...e[6]||(e[6]=[p(" ثبت خودارزیابی ",-1)])]),_:1},8,["loading","disabled"])])])):(o(),u("div",ue," در حال حاضر سوالی برای پاسخگویی وجود ندارد. "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})],64))}},We=J(ke,[["__scopeId","data-v-e204c1d1"]]);export{We as default};
