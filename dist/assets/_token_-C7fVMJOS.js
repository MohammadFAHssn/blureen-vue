import{r as O}from"./validators-DkGyzL9w.js";import{Y as M,c8 as N,by as X,c as x,o as u,f as T,m as C,b as e,n as l,a3 as R,c9 as Z,i as q,e as t,A as ee,an as F,ao as H,y as te,M as ae,j as re,k as le,r as h,bI as Q,bJ as oe,aJ as se,v as i,x as m,d as U,a2 as A,bw as ne,bH as ie,F as D,bx as ue,am as de,a1 as me}from"./index-CY0Y0c6D.js";import{V as pe}from"./VTextarea-ph25tU-5.js";import{_ as ce}from"./AppTextField-CWfV3kMB.js";import{$ as fe}from"./api-CiwGY9v2.js";import{u as be}from"./useApi-w38YToCq.js";import{c as Ve}from"./createUrl-C5Ro_S0F.js";import{V as z}from"./VSnackbar-DwylMrDs.js";import{V as f}from"./VCol-BtVxdUVV.js";import{V as I}from"./VRow-CV1Bbpgn.js";import{V as ve,a as _e,b as ye,d as ge}from"./VList-C7wdgU5o.js";import{V as E,a as xe,b as Te}from"./VCard-DoLjC1VF.js";import{V as b}from"./VCardText-coBVvMvJ.js";import{a as j,V as $}from"./VRadioGroup-COczioSj.js";import{V as Se}from"./VDivider-DygC9j9m.js";import{V as ke}from"./VForm-DfoB6xVD.js";import"./helpers-4BKJjDfb.js";import"./autofocus-DrDz5aVi.js";import"./VCounter-CsCYXF64.js";import"./VField-wtea99XA.js";import"./VOverlay-GlsK9sl7.js";import"./VTextField-B_JY4hGL.js";import"./useLogout-YHY7wFDu.js";/* empty css              */import"./createSimpleFunctional-QtFC9XJV.js";const Ie=Object.assign({name:"AppTextarea",inheritAttrs:!1},{__name:"AppTextarea",setup(J){const S=M(()=>{const V=N().id,v=X();return V?`app-textarea-${V}`:v}),k=M(()=>N().label);return(c,V)=>(u(),x("div",{class:te(["app-textarea flex-grow-1",c.$attrs.class])},[l(k)?(u(),T(R,{key:0,for:l(S),class:"mb-1 text-body-2",text:l(k)},null,8,["for","text"])):C("",!0),e(pe,F(H({...c.$attrs,class:null,label:void 0,variant:"outlined",id:l(S)})),Z({_:2},[q(c.$slots,(v,_)=>({name:_,fn:t(P=>[ee(c.$slots,_,F(H(P||{})))])}))]),1040)],2))}}),Pe={key:0,class:"layout-page-content"},we={class:"text-wrap mb-2"},he={class:"text-h6"},Ue={__name:"[token]",async setup(J){let S,k;const c=re(),V=le(),v=h(null),_=h(null),P=h([]),w=h(0),s=Q({hasError:!1,errorMessage:"",isSuccessful:!1,HaveTenderBidsBeenSent:[],isSendTenderBidPending:[]}),d=Q({paymentTerms:"cash",creditDescription:"",invoiceType:"taxInvoice"});let L=null;function G(){w.value=Math.max(0,v.value.tenderExpiresAt-Math.floor(Date.now()/1e3)),L=setInterval(()=>{w.value--,w.value<=0&&V.replace({name:"login-supplier"})},1e3)}function Y(o,a){return a<=1?"#28a745":`hsl(${120-o/(a-1)*120}, 100%, 50%)`}async function B(o){const{id:a,bidPrice:p,bidQuantity:g,bidDescription:r}=o;if(!(!p||!g)){s.isSendTenderBidPending[a]=!0;try{await fe("/commerce/tender/submit-bid",{method:"POST",body:{id:a,bid_price:p,bid_quantity:g,bid_description:r||"",payment_terms:d.paymentTerms,payment_terms_description:d.paymentTerms==="credit"?d.creditDescription:"",invoice_type:d.invoiceType},onResponseError({response:n}){s.hasError=!0,s.errorMessage=n._data.message||"خطا در ارسال پیشنهاد"}}),s.HaveTenderBidsBeenSent[a]=!0,s.isSuccessful=!0}catch(n){console.error(n)}finally{s.isSendTenderBidPending[a]=!1}}}async function K(){try{const{data:o,error:a}=await be(Ve(`/commerce/tender/get-by-token?token=${c.params.token}`));if(a.value)throw a.value;v.value=o.value.data,_.value=o.value.data.supplier,P.value=o.value.data.tenderBids||[],G()}catch(o){s.hasError=!0,s.errorMessage=o.message||"خطا در دریافت اطلاعات مناقصه",setTimeout(()=>{V.replace({name:"login-supplier"})},2e3)}}[S,k]=oe(()=>K()),await S,k();const y=M(()=>{const o=w.value,a=Math.floor(o/86400),p=Math.floor(o%86400/3600),g=Math.floor(o%3600/60),r=o%60;return{days:a,hours:p.toString().padStart(2,"0"),minutes:g.toString().padStart(2,"0"),seconds:r.toString().padStart(2,"0")}});return se(()=>{clearInterval(L)}),(o,a)=>{const p=ce,g=Ie;return u(),x(D,null,[e(z,{modelValue:l(s).hasError,"onUpdate:modelValue":a[0]||(a[0]=r=>l(s).hasError=r),timeout:"2000",location:"center",variant:"flat",color:"error"},{default:t(()=>[i(m(l(s).errorMessage)+"، در حال انتقال به پنل تأمین‌کننده ... ",1)]),_:1},8,["modelValue"]),e(z,{modelValue:l(s).isSuccessful,"onUpdate:modelValue":a[1]||(a[1]=r=>l(s).isSuccessful=r),timeout:"1500",location:"center",variant:"flat",color:"success"},{default:t(()=>[...a[5]||(a[5]=[i(" ارسال شد! ",-1)])]),_:1},8,["modelValue"]),l(v)?(u(),x("main",Pe,[e(I,null,{default:t(()=>[e(f,null,{default:t(()=>[U("div",we,[a[6]||(a[6]=i(" مدیریت محترم شرکت/فروشگاه ",-1)),U("span",he,m(l(_).name),1)]),a[7]||(a[7]=U("div",{class:"text-body-1"}," لیست کالاهای مورد نیاز مجموعه کارخانجات شیشه اردکان به شرح زیر می‌باشد. ",-1)),a[8]||(a[8]=U("div",{class:"text-body-1"}," لطفاً قیمت‌های پیشنهادی خود را ارائه دهید. ",-1))]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(ve,{style:{"background-color":"rgb(var(--v-theme-background))"}},{default:t(()=>[e(_e,null,{prepend:t(()=>[e(ne,{color:"warning",variant:"tonal",rounded:"",icon:"tabler-stopwatch"})]),default:t(()=>[e(ye,{class:"font-weight-medium"},{default:t(()=>[...a[9]||(a[9]=[i(" مدت زمان باقی‌مانده تا پایان مناقصه: ",-1)])]),_:1}),e(ge,{class:"text-body-1"},{default:t(()=>[l(y).days>0?(u(),T(A,{key:0},{default:t(()=>[i(m(l(y).days)+" روز و "+m(l(y).hours)+" ساعت ",1)]),_:1})):(u(),T(A,{key:1},{default:t(()=>[i(m(l(y).hours)+":"+m(l(y).minutes)+":"+m(l(y).seconds),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(f,{cols:"12",md:"6",lg:"4"},{default:t(()=>[e(E,null,{default:t(()=>[e(b,{class:"custom-v-card-text"},{default:t(()=>[e(R,{class:"mb-2"},{default:t(()=>[...a[10]||(a[10]=[i(" شرایط پرداخت ",-1)])]),_:1}),e(j,{modelValue:l(d).paymentTerms,"onUpdate:modelValue":a[2]||(a[2]=r=>l(d).paymentTerms=r),inline:""},{default:t(()=>[e($,{label:"نقدی",value:"cash"}),e($,{label:"شرایطی",value:"credit"})]),_:1},8,["modelValue"]),l(d).paymentTerms==="credit"?(u(),T(p,{key:0,modelValue:l(d).creditDescription,"onUpdate:modelValue":a[3]||(a[3]=r=>l(d).creditDescription=r),type:"text",placeholder:"توضیحات"},null,8,["modelValue"])):C("",!0)]),_:1}),e(Se),e(b,{class:"custom-v-card-text"},{default:t(()=>[e(R,{class:"mb-2"},{default:t(()=>[...a[11]||(a[11]=[i(" نوع فاکتور ",-1)])]),_:1}),e(j,{modelValue:l(d).invoiceType,"onUpdate:modelValue":a[4]||(a[4]=r=>l(d).invoiceType=r),inline:""},{default:t(()=>[e($,{label:"فاکتور رسمی",value:"taxInvoice"}),e($,{label:"فاکتور فروشگاهی",value:"commercialInvoice"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(ie,{group:""},{default:t(()=>[(u(!0),x(D,null,q(l(P).filter(r=>!l(s).HaveTenderBidsBeenSent[r.id]),r=>(u(),T(f,{key:r.id,cols:"12",md:"6",lg:"4"},{default:t(()=>[e(E,null,{default:t(()=>[e(xe,null,{default:t(()=>[e(Te,{class:"custom-v-card-title"},{default:t(()=>[i(m(r.tenderProduct.product.name)+" ",1),r.tenderProduct.brand?(u(),x(D,{key:0},[i(" ("+m(r.tenderProduct.brand.name)+") ",1)],64)):C("",!0)]),_:2},1024)]),_:2},1024),e(b,null,{default:t(()=>[i(m(r.tenderProduct.purchaseExpertDescription),1)]),_:2},1024),e(b,null,{default:t(()=>[e(E,{variant:"outlined"},{default:t(()=>[e(b,null,{default:t(()=>[...a[12]||(a[12]=[i(" قیمت‌های پیشنهادی از سایر تأمین‌کنندگان (تومان): ",-1)])]),_:1}),e(b,{class:"d-flex flex-wrap gap-x-4 gap-y-2"},{default:t(()=>[(u(!0),x(D,null,q(r.bidOfOtherSuppliers,(n,W)=>(u(),T(A,{key:n.supplierId,variant:n.supplierId===l(_).id?"flat":"outlined",color:Y(W,r.bidOfOtherSuppliers.length)},{default:t(()=>[i(m(n.bidPrice),1)]),_:2},1032,["variant","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),e(b,null,{default:t(()=>[e(ke,{"validate-on":"submit lazy",onSubmit:ue(n=>B(r),["prevent"])},{default:t(()=>[e(I,null,{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[e(p,{modelValue:r.bidPrice,"onUpdate:modelValue":n=>r.bidPrice=n,label:"قیمت",type:"number","prepend-inner-icon":"tabler-coin",suffix:"تومان",rules:["requiredValidator"in o?o.requiredValidator:l(O)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),e(f,{cols:"12"},{default:t(()=>[e(p,{modelValue:r.bidQuantity,"onUpdate:modelValue":n=>r.bidQuantity=n,label:"تعداد",type:"number","prepend-inner-icon":"tabler-scale",suffix:r.tenderProduct.product.counting_unit.UntName,placeholder:`مقدار مورد نیاز: ${r.tenderProduct.quantityRequired}`,rules:["requiredValidator"in o?o.requiredValidator:l(O)]},null,8,["modelValue","onUpdate:modelValue","suffix","placeholder","rules"])]),_:2},1024),e(f,{cols:"12"},{default:t(()=>[e(g,{modelValue:r.bidDescription,"onUpdate:modelValue":n=>r.bidDescription=n,label:"توضیحات",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(f,{cols:"12"},{default:t(()=>[e(de,{type:"submit",loading:l(s).isSendTenderBidPending[r.id],disabled:!r.bidPrice||!r.bidQuantity},{default:t(()=>[e(me,{icon:"tabler-send"}),a[13]||(a[13]=i("ارسال ",-1))]),_:2},1032,["loading","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):C("",!0)],64)}}},tt=ae(Ue,[["__scopeId","data-v-15becc96"]]);export{tt as default};
