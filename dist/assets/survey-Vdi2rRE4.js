import{u as C}from"./useApi-2LpbBpsg.js";import{c as w}from"./createUrl-BnHnVfKg.js";import{$ as E}from"./api-D6e_gXUc.js";import{V as I}from"./VSnackbar-1YovjG9a.js";import{a as m,V as B}from"./VRow-QXWW5x_p.js";import{V as v,b as M,c as $}from"./VCard-B1raw7bO.js";import{bK as y,r as _,c as u,o as a,b as l,e as r,v as c,x as k,n as s,f as p,F as S,i as T,am as V}from"./index-BQ-Oy6YV.js";import"./useLogout-A74ztCrQ.js";import"./VOverlay-DVoP5bKD.js";/* empty css              */import"./createSimpleFunctional-C6TOLI3j.js";import"./VCardText-CbP9NDv4.js";const A={key:0},F={key:1},J={__name:"survey",setup(L){const o=y({hasError:!1,errorMessage:""}),n=y({fetchSurveys:!1,participateInSurvey:!1}),d=_([]),f=_("");async function g(){n.fetchSurveys=!0;try{const{data:i,error:e}=await C(w("/survey/survey?filter[active]=1"));if(n.fetchSurveys=!1,e.value)throw e.value;d.value=i.value.data}catch(i){console.error("Error fetching surveys:",i),o.hasError=!0,o.errorMessage=i.message||"خطا در دریافت نظرسنجی‌ها"}}g();async function h(i){n.participateInSurvey=!0;try{const e=await E("/survey/survey/participate",{method:"POST",body:{porslineId:i},onResponseError({response:t}){n.participateInSurvey=!1,o.hasError=!0,o.errorMessage=t._data.message||"خطا در شرکت در نظرسنجی"}});n.participateInSurvey=!1,f.value=e.data}catch(e){console.error(e)}}function x(){window.open(f.value,"_blank","noopener,noreferrer")}return(i,e)=>(a(),u(S,null,[l(I,{modelValue:s(o).hasError,"onUpdate:modelValue":e[0]||(e[0]=t=>s(o).hasError=t),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:r(()=>[c(k(s(o).errorMessage),1)]),_:1},8,["modelValue"]),l(B,null,{default:r(()=>[s(d).length===0?(a(),p(m,{key:0},{default:r(()=>[l(v,{variant:"text"},{default:r(()=>[...e[1]||(e[1]=[c(" نظرسنجی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(a(!0),u(S,{key:1},T(s(d),t=>(a(),p(m,{key:t.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:r(()=>[l(v,null,{default:r(()=>[l(M,{class:"text-center mb-5 text-wrap"},{default:r(()=>[c(k(t.title),1)]),_:2},1024),l($,{class:"justify-center"},{default:r(()=>[s(f)?(a(),p(V,{key:0,variant:"elevated",color:"success",onClick:b=>x(t.porsline_id)},{default:r(()=>[...e[2]||(e[2]=[c(" شروع ",-1)])]),_:2},1032,["onClick"])):(a(),p(V,{key:1,variant:"elevated",disabled:s(n).participateInSurvey,onClick:b=>h(t.porsline_id)},{default:r(()=>[s(n).participateInSurvey?(a(),u("span",A,"در حال ساخت لینک")):(a(),u("span",F,"دریافت لینک نظرسنجی"))]),_:2},1032,["disabled","onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))}};export{J as default};
