import{ax as z,a6 as L,ab as G,b as t,d as x,J,y as M,aH as Y,ad as K,az as ee,aA as ae,aC as te,aF as le,ay as se,aQ as oe,a7 as ne,Y as N,aS as ie,b6 as re,aO as j,a9 as O,bA as ue,aG as de,aI as ce,aL as me,aN as fe,M as ve,r as U,w as ge,f as T,o as V,e as l,am as P,a1 as be,v as _,x as y,c as w,F as D,i as A,n as o,m as H,bi as ye,bx as q,bB as Ve,H as he}from"./index-DzCC95Er.js";import{V as R,c as W,b as xe}from"./VCard-BINdyafU.js";import{V as _e}from"./VCardText-BK2CGyIH.js";import{V as pe}from"./VContainer-DdeKJNEt.js";import{V as $}from"./VRow-Co3Onx6h.js";import{V as I}from"./VCol-CwoNo7fg.js";import{V as Ee}from"./VRating-CGP_2qin.js";import{V as ke}from"./VDivider-0jTcSOfZ.js";import{V as X}from"./VDialog-BLEVB7a4.js";import{u as Q}from"./useApi-DN9i30c_.js";import{c as F}from"./createUrl-B9dXP-wO.js";import{$ as Ce}from"./api-D2_rp70I.js";import{V as Te}from"./VSnackbar-a39j922X.js";import{V as we}from"./VSpacer-gHfiXVlZ.js";import"./createSimpleFunctional-DY0Ih4bm.js";/* empty css              */import"./VOverlay-BlzuVrCJ.js";import"./dialog-transition-Bc68gbu0.js";import"./useLogout-xN87bSl9.js";import"./index-CvOPxmL5.js";const Se=L({text:String,...K(),...Y()},"VToolbarTitle"),Z=z()({name:"VToolbarTitle",props:Se(),setup(e,p){let{slots:a}=p;return G(()=>{const i=!!(a.default||a.text||e.text);return t(e.tag,{class:M(["v-toolbar-title",e.class]),style:J(e.style)},{default:()=>{var c;return[i&&x("div",{class:"v-toolbar-title__placeholder"},[a.text?a.text():e.text,(c=a.default)==null?void 0:c.call(a)])]}})}),{}}}),Be=[null,"prominent","default","comfortable","compact"],qe=L({absolute:Boolean,collapse:Boolean,collapsePosition:{type:String,default:"start"},color:String,density:{type:String,default:"default",validator:e=>Be.includes(e)},extended:{type:Boolean,default:null},extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...fe(),...K(),...me(),...ce(),...Y({tag:"header"}),...de()},"VToolbar"),Pe=z()({name:"VToolbar",props:qe(),setup(e,p){var b;let{slots:a}=p;const{backgroundColorClasses:i,backgroundColorStyles:c}=ee(()=>e.color),{borderClasses:m}=ae(e),{elevationClasses:k}=te(e),{roundedClasses:E}=le(e),{themeClasses:h}=se(e),{rtlClasses:u}=oe(),f=ne(e.extended===null?!!((b=a.extension)!=null&&b.call(a)):e.extended),d=N(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),g=N(()=>f.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return ie({VBtn:{variant:"text"}}),G(()=>{var s;const r=!!(e.title||a.title),n=!!(a.image||e.image),v=(s=a.extension)==null?void 0:s.call(a);return f.value=e.extended===null?!!v:e.extended,t(e.tag,{class:M(["v-toolbar",`v-toolbar--collapse-${e.collapsePosition}`,{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},i.value,m.value,k.value,E.value,h.value,u.value,e.class]),style:J([c.value,e.style])},{default:()=>[n&&x("div",{key:"image",class:"v-toolbar__image"},[a.image?t(j,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},a.image):t(re,{key:"image-img",cover:!0,src:e.image},null)]),t(j,{defaults:{VTabs:{height:O(d.value)}}},{default:()=>{var C,S,B;return[x("div",{class:"v-toolbar__content",style:{height:O(d.value)}},[a.prepend&&x("div",{class:"v-toolbar__prepend"},[(C=a.prepend)==null?void 0:C.call(a)]),r&&t(Z,{key:"title",text:e.title},{text:a.title}),(S=a.default)==null?void 0:S.call(a),a.append&&x("div",{class:"v-toolbar__append"},[(B=a.append)==null?void 0:B.call(a)])])]}}),t(j,{defaults:{VTabs:{height:O(g.value)}}},{default:()=>[t(ue,null,{default:()=>[f.value&&x("div",{class:"v-toolbar__extension",style:{height:O(g.value)}},[v])]})]})]})}),{contentHeight:d,extensionHeight:g}}}),Re={class:"text-h6 font-weight-bold mb-4 text-primary"},Oe={class:"text-body-1 mb-3"},Ne={class:"d-flex align-center justify-start"},De={key:0,class:"mr-3 text-body-2 font-weight-medium"},Ie={__name:"EvaluationDialog",props:{modelValue:{type:Boolean,required:!0},evaluatee:{type:Object,required:!0},questions:{type:Array,required:!0},loading:{type:Boolean,default:!1},initialRatings:{type:Object,default:null}},emits:["update:modelValue","save"],setup(e,{emit:p}){const a=e,i=p,c=N({get:()=>a.modelValue,set:f=>i("update:modelValue",f)}),m=U({});function k(){const f={};a.questions&&a.questions.length>0&&a.questions.forEach(d=>{d.questions.forEach(g=>{var n;const b=g.id,r=((n=a.initialRatings)==null?void 0:n[b])??0;f[b]=r})}),m.value=f}ge([()=>a.questions,()=>a.initialRatings],()=>{k()},{immediate:!0});const E=N(()=>Object.values(m.value).every(f=>f>0));function h(){const f=[];Object.entries(m.value).forEach(([d,g])=>{f.push({evaluatee_id:a.evaluatee.id,question_id:Number(d),score:g})}),i("save",f)}function u(){k(),c.value=!1}return(f,d)=>(V(),T(X,{modelValue:o(c),"onUpdate:modelValue":d[0]||(d[0]=g=>ye(c)?c.value=g:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:l(()=>[t(R,null,{default:l(()=>[t(Pe,{color:"primary",dark:""},{default:l(()=>[t(P,{icon:"",dark:"",onClick:u},{default:l(()=>[t(be,null,{default:l(()=>[...d[1]||(d[1]=[_("mdi-close",-1)])]),_:1})]),_:1}),t(Z,null,{default:l(()=>[_(y(e.evaluatee.user.personnel_code)+" - "+y(e.evaluatee.user.first_name)+" "+y(e.evaluatee.user.last_name)+" ("+y(e.evaluatee.user.profile.cost_center.name)+") ",1)]),_:1})]),_:1}),t(_e,{class:"pa-6"},{default:l(()=>[t(pe,null,{default:l(()=>[t($,null,{default:l(()=>[t(I,{cols:"12"},{default:l(()=>[(V(!0),w(D,null,A(e.questions,g=>(V(),w("div",{key:g.id,class:"mb-8"},[x("div",Re,y(g.name),1),t($,null,{default:l(()=>[(V(!0),w(D,null,A(g.questions,b=>(V(),T(I,{key:b.id,cols:"12",md:"6"},{default:l(()=>[t(R,{variant:"outlined",class:M(["pa-4",{"border-success":o(m)[b.id]>0}])},{default:l(()=>[x("div",Oe,y(b.question_text),1),x("div",Ne,[t(Ee,{modelValue:o(m)[b.id],"onUpdate:modelValue":r=>o(m)[b.id]=r,length:10,color:"amber","active-color":"amber",size:23,hover:""},null,8,["modelValue","onUpdate:modelValue"]),o(m)[b.id]>0?(V(),w("span",De,y(o(m)[b.id])+"/10 ",1)):H("",!0)])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(ke),t(W,{class:"pa-4 justify-end"},{default:l(()=>[t(P,{variant:"outlined",color:"error",disabled:e.loading,onClick:u},{default:l(()=>[...d[2]||(d[2]=[_(" انصراف ",-1)])]),_:1},8,["disabled"]),t(P,{variant:"elevated",color:"success",loading:e.loading,disabled:!o(E)||e.loading,onClick:h},{default:l(()=>[...d[3]||(d[3]=[_(" ذخیره ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},Me=ve(Ie,[["__scopeId","data-v-5ac0cccb"]]),sa={__name:"peer-evaluation",async setup(e){let p,a;const i=q({hasError:!1,errorMessage:"",dialog:!1}),c=q({fetchEvaluatees:!1,fetchQuestions:!1,evaluate:!1}),m=U([]),k=U([]),E=q({}),h=q({}),u=q({isOpen:!1,selectedEvaluatee:null});async function f(){c.fetchEvaluatees=!0;try{const{data:r,error:n}=await Q(F("/evaluation/evaluatee/by-evaluator"));if(c.fetchEvaluatees=!1,n.value)throw n.value;m.value=r.value.data,m.value.forEach(v=>{v&&typeof v.id<"u"&&(Object.prototype.hasOwnProperty.call(v,"is_evaluated")?E[v.id]=!!v.is_evaluated:E[v.id]===void 0&&(E[v.id]=!1))})}catch(r){console.error("Error fetching evaluatees:",r),i.hasError=!0,i.errorMessage=r.message||"خطا در دریافت ارزیابی‌شونده‌ها"}}async function d(){c.fetchQuestions=!0;try{const{data:r,error:n}=await Q(F("/evaluation/evaluation-question/actives"));if(c.fetchQuestions=!1,n.value)throw n.value;k.value=r.value.data}catch(r){console.error("Error fetching questions:",r),i.hasError=!0,i.errorMessage=r.message||"خطا در دریافت سوالات ارزیابی"}}async function g(r){var n,v;c.evaluate=!0;try{let s=!1;if(await Ce("/evaluation/evaluation-score/create",{method:"POST",body:{results:r},onResponseError({response:C}){i.hasError=!0,i.errorMessage=C._data.message||"خطا در ارزیابی",s=!0}}),!s){if(((n=u.selectedEvaluatee)==null?void 0:n.id)!==void 0&&(E[u.selectedEvaluatee.id]=!0),((v=u.selectedEvaluatee)==null?void 0:v.id)!==void 0){const C=u.selectedEvaluatee.id,S={};r.forEach(B=>{S[B.question_id]=B.score}),h[C]=S}u.isOpen=!1,u.selectedEvaluatee=null}}catch(s){console.error(s),i.hasError=!0,i.errorMessage=(s==null?void 0:s.message)||"خطا در ارزیابی"}finally{c.evaluate=!1}}function b(r){u.selectedEvaluatee=r,u.isOpen=!0}return[p,a]=Ve(()=>f()),await p,a(),d(),he(()=>{i.dialog=!0}),(r,n)=>{var v;return V(),w(D,null,[t(Te,{modelValue:o(i).hasError,"onUpdate:modelValue":n[0]||(n[0]=s=>o(i).hasError=s),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[_(y(o(i).errorMessage),1)]),_:1},8,["modelValue"]),o(m).length!==0?(V(),T(X,{key:0,modelValue:o(i).dialog,"onUpdate:modelValue":n[2]||(n[2]=s=>o(i).dialog=s),"max-width":"400",persistent:""},{default:l(()=>[t(R,{"prepend-icon":"mdi-map-marker",text:"در صورت خروج از صفحه، موارد ارزیابی‌شده ثبت نهایی شده و از لیست حذف می‌شوند!",title:"توجه"},{actions:l(()=>[t(we),t(P,{onClick:n[1]||(n[1]=s=>o(i).dialog=!1)},{default:l(()=>[...n[4]||(n[4]=[_(" باشه ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])):H("",!0),o(u).selectedEvaluatee?(V(),T(Me,{key:1,modelValue:o(u).isOpen,"onUpdate:modelValue":n[3]||(n[3]=s=>o(u).isOpen=s),evaluatee:o(u).selectedEvaluatee,questions:o(k),"initial-ratings":o(h)[(v=o(u).selectedEvaluatee)==null?void 0:v.id]||null,loading:o(c).evaluate,onSave:g},null,8,["modelValue","evaluatee","questions","initial-ratings","loading"])):H("",!0),t($,null,{default:l(()=>[o(m).length===0?(V(),T(I,{key:0},{default:l(()=>[t(R,{variant:"text"},{default:l(()=>[...n[5]||(n[5]=[_(" ارزیابی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(V(!0),w(D,{key:1},A(o(m),s=>(V(),T(I,{key:s.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:l(()=>[t(R,{class:M({"border-success":!!o(h)[s.id]})},{default:l(()=>[t(xe,{class:"text-center mb-5 text-wrap"},{default:l(()=>[_(y(s.user.personnel_code)+" - "+y(s.user.first_name)+" "+y(s.user.last_name)+" ("+y(s.user.profile.cost_center.name)+") ",1)]),_:2},1024),t(W,{class:"justify-center"},{default:l(()=>[t(P,{variant:"elevated",color:o(h)[s.id]?"warning":"success",onClick:C=>b(s)},{default:l(()=>[_(y(o(h)[s.id]?"ویرایش ارزیابی":"شروع ارزیابی"),1)]),_:2},1032,["color","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})],64)}}};export{sa as default};
