import{_ as j}from"./AreYouSureDialog-BIkm7EIj.js";import{$ as V}from"./api-DaMb6zTV.js";import{V as M}from"./VSnackbar-DfykUzvg.js";import{V as w}from"./VAlert-DF51oUuy.js";import{bK as k,r as y,bL as D,f as d,o as l,e as o,b as r,c as p,m as A,n as a,v as f,x as b,bN as L,F as O,i as U,d as F,be as E,am as $}from"./index-BJq0lCVq.js";import{V as P}from"./VContainer-CoMzCVs5.js";import{V as R,a as z}from"./VRow-R8m_E2Un.js";import{V as I,b as J,c as K}from"./VCard-CuvUO_xw.js";import{V as q}from"./VDialog-Cmg0sNuD.js";import{V as H}from"./VCardText-DKOYcGnG.js";import{V as Q}from"./VLayout-oZZoItqN.js";import"./useLogout-EWuSbbc1.js";import"./VOverlay-DgFhY9SS.js";import"./createSimpleFunctional-BtVJ6Wxi.js";/* empty css              */import"./dialog-transition-ZK4tNrnz.js";const W={key:1,class:"flex-grow-1 overflow-y-auto pb-8"},X={key:0,class:"d-flex justify-center align-center h-100"},Y={class:"d-flex flex-column justify-center align-center flex-grow-1 pa-3"},ge={__name:"birthday-user",async setup(Z){let m,u;const x="https://blureen.afgc.ir/storage",i=k({hasError:!1,errorMessage:"",isBirthdayGiftChooseDialogVisible:!1,isImageDialogVisible:!1}),n=k({fetchingBirthdayGifts:!1,chooseBirthdayGift:!1}),g=y([]),c=y(null),C=y(null),_=y("");async function v(){var s;n.fetchingBirthdayGifts=!0;try{const t=await V("/birthday/gift/get-actives",{method:"GET"});g.value=((s=t==null?void 0:t.data)==null?void 0:s.birthdayGifts)||[]}catch(t){i.hasError=!0,i.errorMessage=t.message||"خطا در دریافت هدایا"}finally{n.fetchingBirthdayGifts=!1}}async function S(){var t;const s=(t=C.value)==null?void 0:t.id;if(s){n.chooseBirthdayGift=!0;try{await V("/birthday/user/choose/",{method:"POST",body:JSON.stringify({id:s}),onResponseError({response:e}){var h,G;i.hasError=!0,i.errorMessage=((h=e._data)==null?void 0:h.error)||Object.values(((G=e._data)==null?void 0:G.errors)||{}).flat().join(" | ")||"خطا در انتخاب هدیه"}})}catch(e){console.error(e)}finally{n.chooseBirthdayGift=!1,i.isBirthdayGiftChooseDialogVisible=!1,await v(),await B()}}}async function B(){try{const s=await V("/birthday/user/check",{method:"GET"});c.value=(s==null?void 0:s.data)??null}catch(s){i.hasError=!0,i.errorMessage=s.message||"خطا در بررسی دسترسی"}}function N(s){C.value=s,i.isBirthdayGiftChooseDialogVisible=!0}function T(s){_.value=`${x}/${s.image}`,i.isImageDialogVisible=!0}return[m,u]=D(()=>v()),await m,u(),[m,u]=D(()=>B()),await m,u(),(s,t)=>(l(),d(Q,{class:"pa-4 d-flex flex-column h-100"},{default:o(()=>[r(M,{modelValue:a(i).hasError,"onUpdate:modelValue":t[0]||(t[0]=e=>a(i).hasError=e),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:o(()=>[f(b(a(i).errorMessage),1)]),_:1},8,["modelValue"]),a(c)===null?(l(),d(w,{key:0,type:"error",variant:"tonal"},{default:o(()=>[...t[4]||(t[4]=[f(" در حال حاضر شما اجازه مشاهده یا انتخاب هدیه را ندارید. ",-1)])]),_:1})):(l(),p("div",W,[a(n).fetchingBirthdayGifts?(l(),p("div",X,[r(L,{indeterminate:"",color:"primary",size:"64"})])):a(g).length?(l(),d(P,{key:1,fluid:""},{default:o(()=>[r(R,null,{default:o(()=>[(l(!0),p(O,null,U(a(g),e=>(l(),d(z,{key:e.id,cols:"12",sm:"6",md:"4",lg:"2",class:"d-flex"},{default:o(()=>[r(I,{class:"d-flex flex-column text-center",width:"100%"},{default:o(()=>[r(E,{src:`${a(x)}/${e.image}`,cover:"",height:"200",class:"flex-sm-grow-0 flex-sm-shrink-0 cursor-pointer",width:"100%","min-width":"120",onClick:h=>T(e)},null,8,["src","onClick"]),F("div",Y,[r(J,{class:"text-center text-wrap mb-2"},{default:o(()=>[f(b(e.name),1)]),_:2},1024),r($,{color:e.id===a(c)?"success":e.amount>0?"primary":"error",variant:"flat",disabled:e.amount<=0||e.id===a(c),class:"mb-2",onClick:h=>e.amount>0&&N(e)},{default:o(()=>[f(b(e.id===a(c)?"هدیه شما":e.amount>0?"انتخاب هدیه":"ناموجود"),1)]),_:2},1032,["color","disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(l(),d(w,{key:2,type:"info",variant:"tonal",class:"text-center mt-8"},{default:o(()=>[...t[5]||(t[5]=[f(" هیچ هدیه‌ای یافت نشد. ",-1)])]),_:1}))])),a(i).isBirthdayGiftChooseDialogVisible?(l(),d(j,{key:2,"is-dialog-visible":a(i).isBirthdayGiftChooseDialogVisible,"onUpdate:isDialogVisible":t[1]||(t[1]=e=>a(i).isBirthdayGiftChooseDialogVisible=e),title:"آیا از انتخاب این هدیه اطمینان دارید؟",loading:a(n).chooseBirthdayGift,onConfirm:S},null,8,["is-dialog-visible","loading"])):A("",!0),r(q,{modelValue:a(i).isImageDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>a(i).isImageDialogVisible=e),width:"500",transition:"dialog-bottom-transition"},{default:o(()=>[r(I,null,{default:o(()=>[r(H,{class:"text-center"},{default:o(()=>[r(E,{src:a(_)},null,8,["src"])]),_:1}),r(K,{class:"justify-center"},{default:o(()=>[r($,{onClick:t[2]||(t[2]=e=>a(i).isImageDialogVisible=!1)},{default:o(()=>[...t[6]||(t[6]=[f(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{ge as default};
