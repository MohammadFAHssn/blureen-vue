import{_ as T}from"./AreYouSureDialog-BSqtLnNS.js";import{$ as V}from"./api-DZmGq4fK.js";import{V as M}from"./VSnackbar-CzOWhY_q.js";import{V as k}from"./VCol-CYTsFGTJ.js";import{V as p,b as O,c as A}from"./VCard-K9BHVGCI.js";import{bJ as D,r as y,bN as E,f,o as l,e as o,b as r,c as b,m as U,n as a,v as c,x,bO as F,F as J,i as L,d as P,bj as $,am as I}from"./index-R5XC2zxM.js";import{V as R}from"./VContainer-DrLpLzrE.js";import{V as z}from"./VRow-CpItaJSS.js";import{V as q}from"./VAlert-B64v_QnH.js";import{V as H}from"./VDialog-Dv2sGniz.js";import{V as K}from"./VCardText-Bg1XIWD6.js";import{V as Q}from"./VLayout-CQDFkKGp.js";import"./useLogout-ItYmr0pI.js";import"./VOverlay-HZsPw1vt.js";/* empty css              */import"./createSimpleFunctional-7Cpngkv3.js";import"./dialog-transition-UrFuyb7g.js";const W={key:1,class:"flex-grow-1 overflow-y-auto pb-8"},X={key:0,class:"d-flex justify-center align-center h-100"},Y={class:"d-flex flex-column justify-center align-center flex-grow-1 pa-3"},Ve={__name:"birthday-user",async setup(Z){let u,m;const _="https://blureen.afgc.ir/storage",i=D({hasError:!1,errorMessage:"",isBirthdayGiftChooseDialogVisible:!1,isImageDialogVisible:!1}),n=D({fetchingBirthdayGifts:!1,chooseBirthdayGift:!1}),g=y([]),d=y(null),v=y(null),C=y("");async function B(){var s;n.fetchingBirthdayGifts=!0;try{const t=await V("/birthday/gift/get-actives",{method:"GET"});g.value=((s=t==null?void 0:t.data)==null?void 0:s.birthdayGifts)||[]}catch(t){i.hasError=!0,i.errorMessage=t.message||"خطا در دریافت هدایا"}finally{n.fetchingBirthdayGifts=!1}}async function S(){var t;const s=(t=v.value)==null?void 0:t.id;if(s){n.chooseBirthdayGift=!0;try{await V("/birthday/user/choose/",{method:"POST",body:JSON.stringify({id:s}),onResponseError({response:e}){var h,w;i.hasError=!0,i.errorMessage=((h=e._data)==null?void 0:h.error)||Object.values(((w=e._data)==null?void 0:w.errors)||{}).flat().join(" | ")||"خطا در انتخاب هدیه"}})}catch(e){console.error(e)}finally{n.chooseBirthdayGift=!1,i.isBirthdayGiftChooseDialogVisible=!1,await B(),await G()}}}async function G(){try{const s=await V("/birthday/user/check",{method:"GET"});d.value=(s==null?void 0:s.data)??null}catch(s){i.hasError=!0,i.errorMessage=s.message||"خطا در بررسی دسترسی"}}function j(s){v.value=s,i.isBirthdayGiftChooseDialogVisible=!0}function N(s){C.value=`${_}/${s.image}`,i.isImageDialogVisible=!0}return[u,m]=E(()=>G()),await u,m(),d.value!==null&&([u,m]=E(()=>B()),await u,m()),(s,t)=>(l(),f(Q,{class:"pa-4 d-flex flex-column h-100"},{default:o(()=>[r(M,{modelValue:a(i).hasError,"onUpdate:modelValue":t[0]||(t[0]=e=>a(i).hasError=e),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:o(()=>[c(x(a(i).errorMessage),1)]),_:1},8,["modelValue"]),a(d)===null?(l(),f(k,{key:0},{default:o(()=>[r(p,{variant:"text"},{default:o(()=>[...t[4]||(t[4]=[c(" در حال حاضر شما اجازه مشاهده یا انتخاب هدیه را ندارید. ",-1)])]),_:1})]),_:1})):(l(),b("div",W,[a(n).fetchingBirthdayGifts?(l(),b("div",X,[r(F,{indeterminate:"",color:"primary",size:"64"})])):a(g).length?(l(),f(R,{key:1,fluid:""},{default:o(()=>[r(z,null,{default:o(()=>[(l(!0),b(J,null,L(a(g),e=>(l(),f(k,{key:e.id,cols:"12",sm:"6",md:"4",lg:"2",class:"d-flex"},{default:o(()=>[r(p,{class:"d-flex flex-column text-center",width:"100%"},{default:o(()=>[r($,{src:`${a(_)}/${e.image}`,cover:"",height:"200",class:"flex-sm-grow-0 flex-sm-shrink-0 cursor-pointer",width:"100%","min-width":"120",onClick:h=>N(e)},null,8,["src","onClick"]),P("div",Y,[r(O,{class:"text-center text-wrap mb-2"},{default:o(()=>[c(x(e.name),1)]),_:2},1024),r(I,{color:e.id===a(d)?"success":e.amount>0?"primary":"error",variant:"flat",disabled:e.amount<=0||e.id===a(d),class:"mb-2",onClick:h=>e.amount>0&&j(e)},{default:o(()=>[c(x(e.id===a(d)?"هدیه شما":e.amount>0?"انتخاب هدیه":"ناموجود"),1)]),_:2},1032,["color","disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(l(),f(q,{key:2,type:"info",variant:"tonal",class:"text-center mt-8"},{default:o(()=>[...t[5]||(t[5]=[c(" هیچ هدیه‌ای یافت نشد. ",-1)])]),_:1}))])),a(i).isBirthdayGiftChooseDialogVisible?(l(),f(T,{key:2,"is-dialog-visible":a(i).isBirthdayGiftChooseDialogVisible,"onUpdate:isDialogVisible":t[1]||(t[1]=e=>a(i).isBirthdayGiftChooseDialogVisible=e),title:"آیا از انتخاب این هدیه اطمینان دارید؟",loading:a(n).chooseBirthdayGift,onConfirm:S},null,8,["is-dialog-visible","loading"])):U("",!0),r(H,{modelValue:a(i).isImageDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>a(i).isImageDialogVisible=e),width:"500",transition:"dialog-bottom-transition"},{default:o(()=>[r(p,null,{default:o(()=>[r(K,{class:"text-center"},{default:o(()=>[r($,{src:a(C)},null,8,["src"])]),_:1}),r(A,{class:"justify-center"},{default:o(()=>[r(I,{onClick:t[2]||(t[2]=e=>a(i).isImageDialogVisible=!1)},{default:o(()=>[...t[6]||(t[6]=[c(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Ve as default};
