import{_ as A}from"./AreYouSureDialog-pupLtsO0.js";import{r as $}from"./validators-CT5dUf4l.js";import{U as R,r as c,a as Y,f as h,o as B,e as r,b as o,d as j,bx as S,aF as U,bq as w,n as t,am as N,v as C,M as q,bI as k,bJ as M,Y as I,m as E,x as z,bK as G}from"./index-_IiSVPhg.js";import{_ as H}from"./DialogCloseBtn-BOnQNNn5.js";import{V as T}from"./VCard-B3ZhIaNV.js";import{V as L}from"./VCardText-0ivyJ8VI.js";import{V as J}from"./VForm-CveHZqBw.js";import{V as K,a as _}from"./VRow-DAAu7XVc.js";import{V as O}from"./VFileInput-Bq0S40x3.js";import{V as X}from"./VDialog-DVs3vz_I.js";import{u as Z}from"./useAGGridTheme-BYcg4FW-.js";import{u as Q}from"./useApi-BLWPoEv_.js";import{c as W}from"./createUrl-CCPE5VeV.js";import{$ as F}from"./api-B4U705-K.js";import{V as ee}from"./VSnackbar-CVznse6i.js";import{V as ae}from"./VFab-Ct8vNvdN.js";import{V as le}from"./VLayout-Aezbznw0.js";import"./helpers-4BKJjDfb.js";import"./createSimpleFunctional-C82waqi2.js";/* empty css              */import"./VField-CtMptzRL.js";import"./VOverlay-fhuCrj5Q.js";import"./VCounter-C10V-WP2.js";import"./dialog-transition-BCIt3nKb.js";import"./useLogout-fz2XWH2G.js";const te={__name:"PayrollBatchCreateDialog",props:{isDialogVisible:{type:Boolean,required:!0},loading:{type:Boolean,required:!0}},emits:["submit","update:isDialogVisible"],setup(d,{emit:l}){const i=d,s=l,f=R("constants"),m=c(null),y=c(),p=c(null),D=[a=>{const e=a.name.split(".").pop().toLowerCase();return e!=="xlsx"&&e!=="xls"?"لطفا یک فایل اکسل معتبر انتخاب کنید!":a.size>f.MAX_FILE_SIZE?"حجم فایل باید کمتر از 5 مگابایت باشد!":!0}],v=[()=>!!m.value||"لطفا دوره فیش را انتخاب کنید!"];function V(){var a;(a=y.value)==null||a.validate().then(({valid:e})=>{e&&s("submit",{payrollBatchDate:m.value,payrollBatchFile:p.value})})}function P(){s("update:isDialogVisible",!1)}function b(a){s("update:isDialogVisible",a)}return(a,e)=>{const u=H,n=Y("PersianDatetimePicker");return B(),h(X,{width:a.$vuetify.display.smAndDown?"auto":900,"model-value":i.isDialogVisible,"onUpdate:modelValue":b},{default:r(()=>[o(u,{onClick:e[0]||(e[0]=g=>b(!1))}),o(T,null,{default:r(()=>[o(L,null,{default:r(()=>[e[6]||(e[6]=j("h4",{class:"text-h5 text-center mb-2"}," افزودن فیش حقوقی جدید ",-1)),o(J,{ref_key:"refVForm",ref:y,class:"mt-6","validate-on":"submit lazy",onSubmit:S(V,["prevent"])},{default:r(()=>[o(K,null,{default:r(()=>[o(_,{cols:"12",md:"6"},{default:r(()=>[o(U,{rules:v,disabled:d.loading},{default:r(()=>[o(n,{modelValue:t(m),"onUpdate:modelValue":e[1]||(e[1]=g=>w(m)?m.value=g:null),disabled:d.loading,type:"year-month",simple:"",label:"دوره فیش"},null,8,["modelValue","disabled"])]),_:1},8,["disabled"])]),_:1}),o(_,{cols:"12",md:"6"},{default:r(()=>[o(O,{modelValue:t(p),"onUpdate:modelValue":e[2]||(e[2]=g=>w(p)?p.value=g:null),disabled:d.loading,label:"فایل اکسل",accept:".xlsx, .xls",rules:["requiredValidator"in a?a.requiredValidator:t($),...D]},null,8,["modelValue","disabled","rules"])]),_:1}),o(_,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:r(()=>[o(N,{type:"submit",disabled:d.loading,loading:d.loading,onClick:e[3]||(e[3]=g=>{var x;return(x=t(y))==null?void 0:x.validate()})},{default:r(()=>[...e[4]||(e[4]=[C(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),o(N,{color:"secondary",variant:"tonal",onClick:P},{default:r(()=>[...e[5]||(e[5]=[C(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},oe={style:{"block-size":"100%"}},re={__name:"payroll-batches-management",setup(d){const l=k({hasError:!1,errorMessage:"",isPayrollBatchDeleteDialogVisible:!1,isPayrollBatchCreateDialogVisible:!1}),i=k({createPayrollBatch:!1,fetchingPayrollBatches:!1,deletePayrollBatches:!1}),s=c([]),f=c([]),m=c(null),{theme:y}=Z();function p(a){m.value=a.api}const D=c([{headerName:"ماه",field:"monthName"},{headerName:"سال",field:"year"},{headerName:"بارگذاری توسط",field:"uploadedBy"},{headerName:"تاریخ بارگذاری",field:"createdAt",valueFormatter:a=>M(a.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"نام فایل بارگذاری شده",field:"fileName"},{headerName:"عملیات",field:"actions",cellRendererSelector:a=>({component:"Actions",params:{onDeleteClick:e=>{f.value=[e],l.isPayrollBatchDeleteDialogVisible=!0}}})}]),v=I(()=>{var a;return(a=s.value)==null?void 0:a.map(e=>({id:e.id,monthName:e.month_name,year:e.year,uploadedBy:`${e.uploaded_by.first_name} ${e.uploaded_by.last_name}`,createdAt:M(e.created_at).format("jYYYY-jMM-jDD HH:mm:ss"),fileName:e.filename,actions:{deletable:!0}}))});async function V(){i.fetchingPayrollBatches=!0;try{const{data:a,error:e}=await Q(W("/payroll/payroll-batch",{query:{"fields[uploaded_bies]":"id,first_name,last_name",include:"uploadedBy"}}));if(i.fetchingPayrollBatches=!1,e.value)throw e.value;s.value=a.value.data}catch(a){console.error("Error fetching payrollBatches:",a),l.hasError=!0,l.errorMessage=a.message||"خطا در دریافت فیش‌های حقوقی"}}V();async function P(a){const e=new FormData;e.append("month",Number(a.payrollBatchDate.split("/")[1])),e.append("year",Number(a.payrollBatchDate.split("/")[0])),e.append("file",a.payrollBatchFile),i.createPayrollBatch=!0;try{await F("/payroll/payroll-batch/create",{method:"POST",body:e,onResponseError({response:u}){l.hasError=!0,l.errorMessage=u._data.message||"خطا در ایجاد فیش حقوقی"}}),l.isPayrollBatchCreateDialogVisible=!1}catch(u){console.error(u)}finally{i.createPayrollBatch=!1,V()}}async function b(){i.deletePayrollBatches=!0;try{await F("/payroll/payroll-batch",{method:"DELETE",body:{ids:[f.value[0].data.id]},onResponseError({response:a}){i.deletePayrollBatches=!1,l.hasError=!0,l.errorMessage=a._data.message||"خطا در حذف فیش حقوقی"}}),i.deletePayrollBatches=!1,l.isPayrollBatchDeleteDialogVisible=!1,s.value=s.value.filter(a=>a.id!==f.value[0].data.id)}catch(a){console.error(a)}}return(a,e)=>{const u=Y("AgGridVue");return B(),h(le,{class:"app-layout"},{default:r(()=>[o(ee,{modelValue:t(l).hasError,"onUpdate:modelValue":e[0]||(e[0]=n=>t(l).hasError=n),timeout:2e3,location:"center",variant:"outlined",color:"error"},{default:r(()=>[C(z(t(l).errorMessage),1)]),_:1},8,["modelValue"]),j("section",oe,[o(u,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":t(D),"row-data":t(v),loading:t(i).fetchingPayrollBatches,"enable-rtl":"","row-numbers":"",pagination:"",theme:t(y),onGridReady:p},null,8,["column-defs","row-data","loading","theme"])]),t(l).isPayrollBatchCreateDialogVisible?(B(),h(te,{key:0,"is-dialog-visible":t(l).isPayrollBatchCreateDialogVisible,"onUpdate:isDialogVisible":e[1]||(e[1]=n=>t(l).isPayrollBatchCreateDialogVisible=n),loading:t(i).createPayrollBatch,onSubmit:P},null,8,["is-dialog-visible","loading"])):E("",!0),t(l).isPayrollBatchDeleteDialogVisible?(B(),h(A,{key:1,"is-dialog-visible":t(l).isPayrollBatchDeleteDialogVisible,"onUpdate:isDialogVisible":e[2]||(e[2]=n=>t(l).isPayrollBatchDeleteDialogVisible=n),title:"آیا از حذف این فیش اطمینان دارید؟",loading:t(i).deletePayrollBatches,onConfirm:b},null,8,["is-dialog-visible","loading"])):E("",!0),o(G,null,{default:r(()=>[o(ae,{app:"",icon:"tabler-plus",size:"x-large",onClick:e[3]||(e[3]=n=>t(l).isPayrollBatchCreateDialogVisible=!0)})]),_:1})]),_:1})}}},Ee=q(re,[["__scopeId","data-v-0de73b66"]]);export{Ee as default};
