import{r as de}from"./validators-DkGyzL9w.js";import{av as ke,a6 as Ie,cd as ce,aD as Ce,aE as Fe,Y as M,r as w,a7 as Re,b5 as Me,H as Ue,w as z,b2 as Ae,ab as De,bT as Ee,aF as fe,b as t,d as V,F as U,s as ee,K as me,ce as $e,y as _e,aG as Ne,aH as He,au as te,a9 as ze,a8 as Oe,bU as qe,c8 as pe,by as Be,c as O,o as v,f as q,m as Y,n as o,a3 as ne,c9 as Ge,i as oe,e as l,A as Le,an as ve,ao as Ve,M as Qe,j as je,k as Je,bK as be,bL as Ke,aJ as Ye,v as f,x as y,a2 as ae,bw as We,bJ as Xe,bx as Ze,am as et,a1 as tt}from"./index-CxtEVLme.js";import{u as at}from"./VTextField-CAB5eozq.js";import{V as lt}from"./VCounter-msjUmVI_.js";import{V as xe,m as nt}from"./VField-1lmidL2o.js";import{_ as ot}from"./AppTextField-P_hRCp7c.js";import{$ as rt}from"./api-DMMDYZ5h.js";import{u as st}from"./useApi-CdnAf49y.js";import{c as ut}from"./createUrl-CaFoMd_I.js";import{V as ye}from"./VSnackbar-BhBQZOws.js";import{a as F,V as B}from"./VRow-BoioOJX-.js";import{V as it,a as dt,b as ct,d as ft}from"./VList-Bs2-_tmD.js";import{V as le,a as mt,b as pt}from"./VCard-CAj0IxTG.js";import{V as R}from"./VCardText-szmlBmPY.js";import{a as ge,V as K}from"./VRadioGroup-Dw1DtiHW.js";import{V as vt}from"./VDivider-MkJT5pgW.js";import{V as Vt}from"./VForm-BYXY989h.js";import"./helpers-4BKJjDfb.js";import"./VOverlay-CkNJbiEA.js";import"./useLogout-V483GzsL.js";/* empty css              */import"./createSimpleFunctional-D7eOwQdC.js";const bt=Ie({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...He(),...nt()},"VTextarea"),xt=ke()({name:"VTextarea",directives:{vIntersect:ce},inheritAttrs:!1,props:bt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,I){let{attrs:g,emit:b,slots:c}=I;const i=Ce(e,"modelValue"),{isFocused:p,focus:A,blur:D}=Fe(e),{onIntersect:d}=at(e),m=M(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),G=M(()=>{if(g.maxlength)return g.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),L=w(),E=w(),Q=Re(""),$=w(),h=M(()=>e.persistentPlaceholder||p.value||e.active);function r(){var s;$.value!==document.activeElement&&((s=$.value)==null||s.focus()),p.value||A()}function a(s){r(),b("click:control",s)}function x(s){b("mousedown:control",s)}function S(s){s.stopPropagation(),r(),te(()=>{i.value="",qe(e["onClick:clear"],s)})}function n(s){var P;const _=s.target;if(i.value=_.value,(P=e.modelModifiers)!=null&&P.trim){const H=[_.selectionStart,_.selectionEnd];te(()=>{_.selectionStart=H[0],_.selectionEnd=H[1]})}}const u=w(),C=w(Number(e.rows)),W=M(()=>["plain","underlined"].includes(e.variant));Me(()=>{e.autoGrow||(C.value=Number(e.rows))});function N(){e.autoGrow&&te(()=>{if(!u.value||!E.value)return;const s=getComputedStyle(u.value),_=getComputedStyle(E.value.$el),P=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),H=u.value.scrollHeight,j=parseFloat(s.lineHeight),X=Math.max(parseFloat(e.rows)*j+P,parseFloat(_.getPropertyValue("--v-input-control-height"))),Z=parseFloat(e.maxRows)*j+P||1/0,k=Oe(H??0,X,Z);C.value=Math.floor((k-P)/j),Q.value=ze(k)})}Ue(N),z(i,N),z(()=>e.rows,N),z(()=>e.maxRows,N),z(()=>e.density,N),z(C,s=>{b("update:rows",s)});let T;return z(u,s=>{s?(T=new ResizeObserver(N),T.observe(u.value)):T==null||T.disconnect()}),Ae(()=>{T==null||T.disconnect()}),De(()=>{const s=!!(c.counter||e.counter||e.counterValue),_=!!(s||c.details),[P,H]=Ee(g),{modelValue:j,...X}=fe.filterProps(e),Z={...xe.filterProps(e),"onClick:clear":S};return t(fe,ee({ref:L,modelValue:i.value,"onUpdate:modelValue":k=>i.value=k,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":W.value},e.class],style:e.style},P,X,{centerAffix:C.value===1&&!W.value,focused:p.value}),{...c,default:k=>{let{id:J,isDisabled:re,isDirty:se,isReadonly:we,isValid:he,hasDetails:Se}=k;return t(xe,ee({ref:E,style:{"--v-textarea-control-height":Q.value},onClick:a,onMousedown:x,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Z,{id:J.value,active:h.value||se.value,centerAffix:C.value===1&&!W.value,dirty:se.value||e.dirty,disabled:re.value,focused:p.value,details:Se.value,error:he.value===!1}),{...c,default:Te=>{let{props:{class:ue,...ie}}=Te;return V(U,null,[e.prefix&&V("span",{class:"v-text-field__prefix"},[e.prefix]),me(V("textarea",ee({ref:$,class:ue,value:i.value,onInput:n,autofocus:e.autofocus,readonly:we.value,disabled:re.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:r,onBlur:D},ie,H),null),[[ce,{handler:d},null,{once:!0}]]),e.autoGrow&&me(V("textarea",{class:_e([ue,"v-textarea__sizer"]),id:`${ie.id}-sizer`,"onUpdate:modelValue":Pe=>i.value=Pe,ref:u,readonly:!0,"aria-hidden":"true"},null),[[$e,i.value]]),e.suffix&&V("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:_?k=>{var J;return V(U,null,[(J=c.details)==null?void 0:J.call(c,k),s&&V(U,null,[V("span",null,null),t(lt,{active:e.persistentCounter||p.value,value:m.value,max:G.value,disabled:e.disabled},c.counter)])])}:void 0})}),Ne({},L,E,$)}}),yt=Object.assign({name:"AppTextarea",inheritAttrs:!1},{__name:"AppTextarea",setup(e){const I=M(()=>{const c=pe().id,i=Be();return c?`app-textarea-${c}`:i}),g=M(()=>pe().label);return(b,c)=>(v(),O("div",{class:_e(["app-textarea flex-grow-1",b.$attrs.class])},[o(g)?(v(),q(ne,{key:0,for:o(I),class:"mb-1 text-body-2",text:o(g)},null,8,["for","text"])):Y("",!0),t(xt,ve(Ve({...b.$attrs,class:null,label:void 0,variant:"outlined",id:o(I)})),Ge({_:2},[oe(b.$slots,(i,p)=>({name:p,fn:l(A=>[Le(b.$slots,p,ve(Ve(A||{})))])}))]),1040)],2))}}),gt={key:0,class:"layout-page-content"},_t={class:"text-wrap mb-2"},wt={class:"text-h6"},ht={__name:"[token]",async setup(e){let I,g;const b=je(),c=Je(),i=w(null),p=w(null),A=w([]),D=w(0),d=be({hasError:!1,errorMessage:"",isSuccessful:!1,HaveTenderBidsBeenSent:[],isSendTenderBidPending:[]}),m=be({paymentTerms:"cash",creditDescription:"",invoiceType:"taxInvoice"});let G=null;function L(){D.value=Math.max(0,i.value.tenderExpiresAt-Math.floor(Date.now()/1e3)),G=setInterval(()=>{D.value--,D.value<=0&&c.replace({name:"login-supplier"})},1e3)}function E(r,a){return a<=1?"#28a745":`hsl(${120-r/(a-1)*120}, 100%, 50%)`}async function Q(r){const{id:a,bidPrice:x,bidQuantity:S,bidDescription:n}=r;if(!(!x||!S)){d.isSendTenderBidPending[a]=!0;try{await rt("/commerce/tender/submit-bid",{method:"POST",body:{id:a,bid_price:x,bid_quantity:S,bid_description:n||"",payment_terms:m.paymentTerms,payment_terms_description:m.paymentTerms==="credit"?m.creditDescription:"",invoice_type:m.invoiceType},onResponseError({response:u}){d.hasError=!0,d.errorMessage=u._data.message||"خطا در ارسال پیشنهاد"}}),d.HaveTenderBidsBeenSent[a]=!0,d.isSuccessful=!0}catch(u){console.error(u)}finally{d.isSendTenderBidPending[a]=!1}}}async function $(){try{const{data:r,error:a}=await st(ut(`/commerce/tender/get-by-token?token=${b.params.token}`));if(a.value)throw a.value;i.value=r.value.data,p.value=r.value.data.supplier,A.value=r.value.data.tenderBids||[],L()}catch(r){d.hasError=!0,d.errorMessage=r.message||"خطا در دریافت اطلاعات مناقصه",setTimeout(()=>{c.replace({name:"login-supplier"})},2e3)}}[I,g]=Ke(()=>$()),await I,g();const h=M(()=>{const r=D.value,a=Math.floor(r/86400),x=Math.floor(r%86400/3600),S=Math.floor(r%3600/60),n=r%60;return{days:a,hours:x.toString().padStart(2,"0"),minutes:S.toString().padStart(2,"0"),seconds:n.toString().padStart(2,"0")}});return Ye(()=>{clearInterval(G)}),(r,a)=>{const x=ot,S=yt;return v(),O(U,null,[t(ye,{modelValue:o(d).hasError,"onUpdate:modelValue":a[0]||(a[0]=n=>o(d).hasError=n),timeout:"2000",location:"center",variant:"flat",color:"error"},{default:l(()=>[f(y(o(d).errorMessage)+"، در حال انتقال به پنل تأمین‌کننده ... ",1)]),_:1},8,["modelValue"]),t(ye,{modelValue:o(d).isSuccessful,"onUpdate:modelValue":a[1]||(a[1]=n=>o(d).isSuccessful=n),timeout:"1500",location:"center",variant:"flat",color:"success"},{default:l(()=>[...a[5]||(a[5]=[f(" ارسال شد! ",-1)])]),_:1},8,["modelValue"]),o(i)?(v(),O("main",gt,[t(B,null,{default:l(()=>[t(F,null,{default:l(()=>[V("div",_t,[a[6]||(a[6]=f(" مدیریت محترم شرکت/فروشگاه ",-1)),V("span",wt,y(o(p).name),1)]),a[7]||(a[7]=V("div",{class:"text-body-1"}," لیست کالاهای مورد نیاز مجموعه کارخانجات شیشه اردکان به شرح زیر می‌باشد. ",-1)),a[8]||(a[8]=V("div",{class:"text-body-1"}," لطفاً قیمت‌های پیشنهادی خود را ارائه دهید. ",-1))]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(it,{style:{"background-color":"rgb(var(--v-theme-background))"}},{default:l(()=>[t(dt,null,{prepend:l(()=>[t(We,{color:"warning",variant:"tonal",rounded:"",icon:"tabler-stopwatch"})]),default:l(()=>[t(ct,{class:"font-weight-medium"},{default:l(()=>[...a[9]||(a[9]=[f(" مدت زمان باقی‌مانده تا پایان مناقصه: ",-1)])]),_:1}),t(ft,{class:"text-body-1"},{default:l(()=>[o(h).days>0?(v(),q(ae,{key:0},{default:l(()=>[f(y(o(h).days)+" روز و "+y(o(h).hours)+" ساعت ",1)]),_:1})):(v(),q(ae,{key:1},{default:l(()=>[f(y(o(h).hours)+":"+y(o(h).minutes)+":"+y(o(h).seconds),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(F,{cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(R,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>[...a[10]||(a[10]=[f(" شرایط پرداخت ",-1)])]),_:1}),t(ge,{modelValue:o(m).paymentTerms,"onUpdate:modelValue":a[2]||(a[2]=n=>o(m).paymentTerms=n),inline:""},{default:l(()=>[t(K,{label:"نقدی",value:"cash"}),t(K,{label:"شرایطی",value:"credit"})]),_:1},8,["modelValue"]),o(m).paymentTerms==="credit"?(v(),q(x,{key:0,modelValue:o(m).creditDescription,"onUpdate:modelValue":a[3]||(a[3]=n=>o(m).creditDescription=n),type:"text",placeholder:"توضیحات"},null,8,["modelValue"])):Y("",!0)]),_:1}),t(vt),t(R,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>[...a[11]||(a[11]=[f(" نوع فاکتور ",-1)])]),_:1}),t(ge,{modelValue:o(m).invoiceType,"onUpdate:modelValue":a[4]||(a[4]=n=>o(m).invoiceType=n),inline:""},{default:l(()=>[t(K,{label:"فاکتور رسمی",value:"taxInvoice"}),t(K,{label:"فاکتور فروشگاهی",value:"commercialInvoice"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(Xe,{group:""},{default:l(()=>[(v(!0),O(U,null,oe(o(A).filter(n=>!o(d).HaveTenderBidsBeenSent[n.id]),n=>(v(),q(F,{key:n.id,cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(mt,null,{default:l(()=>[t(pt,{class:"custom-v-card-title"},{default:l(()=>[f(y(n.tenderProduct.product.name)+" ",1),n.tenderProduct.brand?(v(),O(U,{key:0},[f(" ("+y(n.tenderProduct.brand.name)+") ",1)],64)):Y("",!0)]),_:2},1024)]),_:2},1024),t(R,null,{default:l(()=>[f(y(n.tenderProduct.purchaseExpertDescription),1)]),_:2},1024),t(R,null,{default:l(()=>[t(le,{variant:"outlined"},{default:l(()=>[t(R,null,{default:l(()=>[...a[12]||(a[12]=[f(" قیمت‌های پیشنهادی از سایر تأمین‌کنندگان (تومان): ",-1)])]),_:1}),t(R,{class:"d-flex flex-wrap gap-x-4 gap-y-2"},{default:l(()=>[(v(!0),O(U,null,oe(n.bidOfOtherSuppliers,(u,C)=>(v(),q(ae,{key:u.supplierId,variant:u.supplierId===o(p).id?"flat":"outlined",color:E(C,n.bidOfOtherSuppliers.length)},{default:l(()=>[f(y(u.bidPrice),1)]),_:2},1032,["variant","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),t(R,null,{default:l(()=>[t(Vt,{"validate-on":"submit lazy",onSubmit:Ze(u=>Q(n),["prevent"])},{default:l(()=>[t(B,null,{default:l(()=>[t(F,{cols:"12"},{default:l(()=>[t(x,{modelValue:n.bidPrice,"onUpdate:modelValue":u=>n.bidPrice=u,label:"قیمت",type:"number","prepend-inner-icon":"tabler-coin",suffix:"تومان",rules:["requiredValidator"in r?r.requiredValidator:o(de)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(F,{cols:"12"},{default:l(()=>[t(x,{modelValue:n.bidQuantity,"onUpdate:modelValue":u=>n.bidQuantity=u,label:"تعداد",type:"number","prepend-inner-icon":"tabler-scale",suffix:n.tenderProduct.product.counting_unit.UntName,placeholder:`مقدار مورد نیاز: ${n.tenderProduct.quantityRequired}`,rules:["requiredValidator"in r?r.requiredValidator:o(de)]},null,8,["modelValue","onUpdate:modelValue","suffix","placeholder","rules"])]),_:2},1024),t(F,{cols:"12"},{default:l(()=>[t(S,{modelValue:n.bidDescription,"onUpdate:modelValue":u=>n.bidDescription=u,label:"توضیحات",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(F,{cols:"12"},{default:l(()=>[t(et,{type:"submit",loading:o(d).isSendTenderBidPending[n.id],disabled:!n.bidPrice||!n.bidQuantity},{default:l(()=>[t(tt,{icon:"tabler-send"}),a[13]||(a[13]=f("ارسال ",-1))]),_:2},1032,["loading","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):Y("",!0)],64)}}},Qt=Qe(ht,[["__scopeId","data-v-15becc96"]]);export{Qt as default};
