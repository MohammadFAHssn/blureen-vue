import{V as ee,a as Ie,b as Ae,d as Re}from"./VCard-BD-uXPNx.js";import{f as S,o as x,e as m,b as r,d as V,x as ae,al as _,v as I,au as te,a5 as le,ak as $e,aC as oe,bF as ie,Y as g,bG as O,r as D,Z as Y,a6 as ne,w as Ee,aa as re,bc as ze,F as T,s as z,y as se,a2 as Me,at as Ne,bH as Te,U as je,a as ue,bw as Ye,bq as J,n as y,a9 as Ue,a_ as qe,b4 as He,a$ as Le,K as Ge,L as Oe,bE as Je,J as Ke,bC as Ze,aS as Xe,b6 as Qe,bx as We,bI as ea,M as aa,bJ as K,bK as Z,bL as ta,m as X,bM as la}from"./index-BePJ13DU.js";import{V as de}from"./VDialog-Iah8-La3.js";import{r as oa}from"./validators-CT5dUf4l.js";import{_ as ia}from"./DialogCloseBtn-Dyb-dOYm.js";import{V as na}from"./VCardText-vfN3Dkqy.js";import{V as ra}from"./VForm-DR7q3IL1.js";import{V as sa}from"./VRow-Ba-yhQoo.js";import{V as j}from"./VCol-BMYWpBcx.js";import{V as U,m as ua}from"./VInput-DlYtPafm.js";import{V as Q,m as da}from"./VField-tM_PP-9B.js";import{u as ca}from"./form-CnNK_xE0.js";import{f as fa}from"./forwardRefs-BYSXgJht.js";import{V as ma}from"./VCounter-DmpxRV8G.js";import{u as pa,V as va}from"./VLayout-cc_Aqwfx.js";import{u as ya}from"./useApi-Bjy_GR_z.js";import{c as ba}from"./createUrl-DObl0LIU.js";import{$ as W}from"./api-O_nLipHr.js";import{V as ga}from"./VSnackbar-ajxQpJPX.js";import"./createSimpleFunctional-DeQgyvr1.js";import"./VOverlay-D8wLC9uD.js";import"./dialog-transition-CR17GCsx.js";import"./helpers-4BKJjDfb.js";/* empty css              */import"./VLabel-COcaJzWg.js";import"./useLogout-B7qAviJD.js";const ha={class:"text-h6 mb-2 text-wrap"},Va={__name:"AreYouSureDialog",props:{isDialogVisible:{type:Boolean,required:!0},title:{type:String,required:!0},loading:{type:Boolean,required:!0}},emits:["update:isDialogVisible","confirm"],setup(e,{emit:c}){const f=e,o=c;function i(n){o("update:isDialogVisible",n)}return(n,t)=>(x(),S(de,{"model-value":f.isDialogVisible,width:n.$vuetify.display.smAndDown?"auto":400,"onUpdate:modelValue":i},{default:m(()=>[r(ee,null,{default:m(()=>[r(Ie,{class:"text-center"},{default:m(()=>[r(Ae,null,{default:m(()=>[V("h6",ha,ae(f.title),1)]),_:1})]),_:1}),r(Re,{class:"justify-center"},{default:m(()=>[r(_,{loading:f.loading,color:"success",variant:"text",onClick:t[0]||(t[0]=s=>o("confirm"))},{default:m(()=>t[2]||(t[2]=[I(" بله ",-1)])),_:1,__:[2]},8,["loading"]),r(_,{color:"secondary",variant:"text",onClick:t[1]||(t[1]=s=>n.$emit("update:isDialogVisible",!1))},{default:m(()=>t[3]||(t[3]=[I(" خیر ",-1)])),_:1,__:[3]})]),_:1})]),_:1})]),_:1},8,["model-value","width"]))}};function Da(){function e(f){var i,n;return[...((i=f.dataTransfer)==null?void 0:i.items)??[]].filter(t=>t.kind==="file").map(t=>t.webkitGetAsEntry()).filter(Boolean).length>0||[...((n=f.dataTransfer)==null?void 0:n.files)??[]].length>0}async function c(f){var n,t;const o=[],i=[...((n=f.dataTransfer)==null?void 0:n.items)??[]].filter(s=>s.kind==="file").map(s=>s.webkitGetAsEntry()).filter(Boolean);if(i.length)for(const s of i){const B=await ce(s,fe(".",s));o.push(...B.map(P=>P.file))}else o.push(...((t=f.dataTransfer)==null?void 0:t.files)??[]);return o}return{handleDrop:c,hasFilesOrFolders:e}}function ce(e){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((f,o)=>{e.isFile?e.file(n=>f([{file:n,path:c}]),o):e.isDirectory&&e.createReader().readEntries(async n=>{const t=[];for(const s of n)t.push(...await ce(s,fe(c,s)));f(t)})})}function fe(e,c){return c.isDirectory?`${e}/${c.name}`:e}const Ba=le({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...ua({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>ie(e).every(c=>c!=null&&typeof c=="object")},...da({clearable:!0})},"VFileInput"),Pa=te()({name:"VFileInput",inheritAttrs:!1,props:Ba(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,c){let{attrs:f,emit:o,slots:i}=c;const{t:n}=$e(),t=oe(e,"modelValue",e.modelValue,l=>ie(l),l=>!e.multiple&&Array.isArray(l)?l[0]:l),{isFocused:s,focus:B,blur:P}=ca(e),C=g(()=>typeof e.showSize!="boolean"?e.showSize:void 0),p=g(()=>(t.value??[]).reduce((l,v)=>{let{size:w=0}=v;return l+w},0)),u=g(()=>O(p.value,C.value)),a=g(()=>(t.value??[]).map(l=>{const{name:v="",size:w=0}=l;return e.showSize?`${v} (${O(w,C.value)})`:v})),d=g(()=>{var v;const l=((v=t.value)==null?void 0:v.length)??0;return e.showSize?n(e.counterSizeString,l,u.value):n(e.counterString,l)}),h=D(),A=D(),b=D(),R=Y(()=>s.value||e.active),q=g(()=>["plain","underlined"].includes(e.variant)),$=ne(!1),{handleDrop:me,hasFilesOrFolders:pe}=Da();function M(){var l;b.value!==document.activeElement&&((l=b.value)==null||l.focus()),s.value||B()}function ve(l){var v;(v=b.value)==null||v.click()}function ye(l){o("mousedown:control",l)}function be(l){var v;(v=b.value)==null||v.click(),o("click:control",l)}function ge(l){l.stopPropagation(),M(),Ne(()=>{t.value=[],Te(e["onClick:clear"],l)})}function he(l){l.preventDefault(),l.stopImmediatePropagation(),$.value=!0}function Ve(l){l.preventDefault(),$.value=!1}async function De(l){if(l.preventDefault(),l.stopImmediatePropagation(),$.value=!1,!b.value||!pe(l))return;const v=new DataTransfer;for(const w of await me(l))v.items.add(w);b.value.files=v.files,b.value.dispatchEvent(new Event("change",{bubbles:!0}))}return Ee(t,l=>{(!Array.isArray(l)||!l.length)&&b.value&&(b.value.value="")}),re(()=>{const l=!!(i.counter||e.counter),v=!!(l||i.details),[w,Be]=ze(f),{modelValue:Sa,...Pe}=U.filterProps(e),Ce=Q.filterProps(e);return r(U,z({ref:h,modelValue:e.multiple?t.value:t.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":$.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":q.value},e.class],style:e.style,"onClick:prepend":ve},w,Pe,{centerAffix:!q.value,focused:s.value}),{...i,default:N=>{let{id:E,isDisabled:F,isDirty:H,isReadonly:L,isValid:ke,hasDetails:we}=N;return r(Q,z({ref:A,prependIcon:e.prependIcon,onMousedown:ye,onClick:be,"onClick:clear":ge,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Ce,{id:E.value,active:R.value||H.value,dirty:H.value||e.dirty,disabled:F.value,focused:s.value,details:we.value,error:ke.value===!1,onDragover:he,onDrop:De}),{...i,default:_e=>{var G;let{props:{class:Fe,...Se}}=_e;return V(T,null,[V("input",z({ref:b,type:"file",readonly:L.value,disabled:F.value,multiple:e.multiple,name:e.name,onClick:k=>{k.stopPropagation(),L.value&&k.preventDefault(),M()},onChange:k=>{if(!k.target)return;const xe=k.target;t.value=[...xe.files??[]]},onDragleave:Ve,onFocus:M,onBlur:P},Se,Be),null),V("div",{class:se(Fe)},[!!((G=t.value)!=null&&G.length)&&!e.hideInput&&(i.selection?i.selection({fileNames:a.value,totalBytes:p.value,totalBytesReadable:u.value}):e.chips?a.value.map(k=>r(Me,{key:k,size:"small",text:k},null)):a.value.join(", "))])])}})},details:v?N=>{var E,F;return V(T,null,[(E=i.details)==null?void 0:E.call(i,N),l&&V(T,null,[V("span",null,null),r(ma,{active:!!((F=t.value)!=null&&F.length),value:d.value,disabled:e.disabled},i.counter)])])}:void 0})}),fa({},h,A,b)}}),Ca={__name:"PayrollBatchCreateDialog",props:{isDialogVisible:{type:Boolean,required:!0},loading:{type:Boolean,required:!0}},emits:["submit","update:isDialogVisible"],setup(e,{emit:c}){const f=e,o=c,i=je("constants"),n=D(null),t=D(),s=D(null),B=[a=>{if(!a.length)return!0;const d=a[0].name.split(".").pop().toLowerCase();return d!=="xlsx"&&d!=="xls"?"لطفا یک فایل اکسل معتبر انتخاب کنید!":a[0].size>i.MAX_FILE_SIZE?"حجم فایل باید کمتر از 5 مگابایت باشد!":!0}],P=[()=>!!n.value||"لطفا دوره فیش را انتخاب کنید!"];function C(){var a;(a=t.value)==null||a.validate().then(({valid:d})=>{d&&o("submit",{payrollBatchDate:n.value,payrollBatchFile:s.value})})}function p(){o("update:isDialogVisible",!1)}function u(a){o("update:isDialogVisible",a)}return(a,d)=>{const h=ia,A=ue("PersianDatetimePicker");return x(),S(de,{width:a.$vuetify.display.smAndDown?"auto":900,"model-value":f.isDialogVisible,"onUpdate:modelValue":u},{default:m(()=>[r(h,{onClick:d[0]||(d[0]=b=>u(!1))}),r(ee,null,{default:m(()=>[r(na,null,{default:m(()=>[d[6]||(d[6]=V("h4",{class:"text-h5 text-center mb-2"}," افزودن فیش حقوقی جدید ",-1)),r(ra,{ref_key:"refVForm",ref:t,class:"mt-6","validate-on":"submit lazy",onSubmit:Ye(C,["prevent"])},{default:m(()=>[r(sa,null,{default:m(()=>[r(j,{cols:"12",md:"6"},{default:m(()=>[r(U,{rules:P,disabled:e.loading},{default:m(()=>[r(A,{modelValue:y(n),"onUpdate:modelValue":d[1]||(d[1]=b=>J(n)?n.value=b:null),disabled:e.loading,type:"year-month",simple:"",label:"دوره فیش"},null,8,["modelValue","disabled"])]),_:1},8,["disabled"])]),_:1}),r(j,{cols:"12",md:"6"},{default:m(()=>[r(Pa,{modelValue:y(s),"onUpdate:modelValue":d[2]||(d[2]=b=>J(s)?s.value=b:null),disabled:e.loading,label:"فایل اکسل",accept:".xlsx, .xls",rules:["requiredValidator"in a?a.requiredValidator:y(oa),...B]},null,8,["modelValue","disabled","rules"])]),_:1}),r(j,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:m(()=>[r(_,{type:"submit",disabled:e.loading,loading:e.loading,onClick:d[3]||(d[3]=b=>{var R;return(R=y(t))==null?void 0:R.validate()})},{default:m(()=>d[4]||(d[4]=[I(" ذخیره ",-1)])),_:1,__:[4]},8,["disabled","loading"]),r(_,{color:"secondary",variant:"tonal",onClick:p},{default:m(()=>d[5]||(d[5]=[I(" انصراف ",-1)])),_:1,__:[5]})]),_:1})]),_:1})]),_:1},512)]),_:1,__:[6]})]),_:1})]),_:1},8,["width","model-value"])}}},ka=le({app:Boolean,appear:Boolean,extended:Boolean,layout:Boolean,offset:Boolean,modelValue:{type:Boolean,default:!0},...We(ea({active:!0}),["location"]),...Qe(),...Xe(),...Ze({transition:"fab-transition"})},"VFab"),wa=te()({name:"VFab",props:ka(),emits:{"update:modelValue":e=>!0},setup(e,c){let{slots:f}=c;const o=oe(e,"modelValue"),i=ne(56),n=D(),{resizeRef:t}=Ue(p=>{p.length&&(i.value=p[0].target.clientHeight)}),s=Y(()=>e.app||e.absolute),B=g(()=>{var p;return s.value?((p=e.location)==null?void 0:p.split(" ").shift())??"bottom":!1}),P=g(()=>{var p;return s.value?((p=e.location)==null?void 0:p.split(" ")[1])??"end":!1});qe(()=>e.app,()=>{const p=He({id:e.name,order:g(()=>parseInt(e.order,10)),position:B,layoutSize:g(()=>e.layout?i.value+24:0),elementSize:g(()=>i.value+24),active:g(()=>e.app&&o.value),absolute:Y(()=>e.absolute)});Le(()=>{n.value=p.layoutItemStyles.value})});const C=D();return re(()=>{const p=_.filterProps(e);return V("div",{ref:C,class:se(["v-fab",{"v-fab--absolute":e.absolute,"v-fab--app":!!e.app,"v-fab--extended":e.extended,"v-fab--offset":e.offset,[`v-fab--${B.value}`]:s.value,[`v-fab--${P.value}`]:s.value},e.class]),style:Ke([e.app?{...n.value}:{height:e.absolute?"100%":"inherit"},e.style])},[V("div",{class:"v-fab__container"},[r(Je,{appear:e.appear,transition:e.transition},{default:()=>[Ge(r(_,z({ref:t},p,{active:void 0,location:void 0}),f),[[Oe,e.active]])]})])])}),{}}}),_a={style:{"block-size":"100%"}},Fa={__name:"payroll-batches-management",async setup(e){let c,f;const o=K({hasError:!1,errorMessage:"",isPayrollBatchDeleteDialogVisible:!1}),i=K({createPayrollBatch:!1,fetchingPayrollBatches:!1,deletePayrollBatches:!1}),n=D([]),t=D([]),{theme:s}=pa(),B=D([{headerName:"ماه",field:"monthName",flex:1},{headerName:"سال",field:"year",flex:1},{headerName:"بارگذاری توسط",field:"uploadedBy",flex:2},{headerName:"تاریخ بارگذاری",field:"createdAt",flex:2,valueFormatter:u=>Z(u.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"نام فایل بارگذاری شده",field:"fileName",flex:2},{headerName:"عملیات",field:"actions",cellRendererSelector:u=>({component:"Actions",params:{onDeleteClick:a=>{t.value=[a],o.isPayrollBatchDeleteDialogVisible=!0}}}),flex:1}]),P=g(()=>{var u;return(u=n.value)==null?void 0:u.map(a=>({id:a.id,monthName:a.month_name,year:a.year,uploadedBy:`${a.uploaded_by.first_name} ${a.uploaded_by.last_name}`,createdAt:Z(a.created_at).format("jYYYY-jMM-jDD HH:mm:ss"),fileName:a.filename,actions:{deletable:!0}}))});i.fetchingPayrollBatches=!0;try{const{data:u,error:a}=([c,f]=ta(()=>ya(ba("/payroll/payroll-batch",{query:{"fields[uploaded_bies]":"id,first_name,last_name",include:"uploadedBy"}}))),c=await c,f(),c);if(i.fetchingPayrollBatches=!1,a.value)throw a.value;n.value=u.value.data}catch(u){console.error("Error fetching payrollBatches:",u),o.hasError=!0,o.errorMessage=u.message||"خطا در دریافت فیش‌های حقوقی"}async function C(u){const a=new FormData;a.append("month",Number(u.payrollBatchDate.split("/")[1])),a.append("year",Number(u.payrollBatchDate.split("/")[0])),a.append("file",u.payrollBatchFile),i.createPayrollBatch=!0;try{await W("/payroll/payroll-batch/create",{method:"POST",body:a,onResponseError({response:d}){i.createPayrollBatch=!1,o.hasError=!0,o.errorMessage=d._data.message||"خطا در ایجاد فیش حقوقی"}}),i.createPayrollBatch=!1,o.isPayrollBatchCreateDialogVisible=!1}catch(d){console.error(d)}}async function p(){i.deletePayrollBatches=!0;try{await W("/payroll/payroll-batch",{method:"DELETE",body:{ids:[t.value[0].data.id]},onResponseError({response:u}){i.deletePayrollBatches=!1,o.hasError=!0,o.errorMessage=u._data.message||"خطا در حذف فیش حقوقی"}}),i.deletePayrollBatches=!1,o.isPayrollBatchDeleteDialogVisible=!1,n.value=n.value.filter(u=>u.id!==t.value[0].data.id)}catch(u){console.error(u)}}return(u,a)=>{const d=ue("AgGridVue");return x(),S(va,{class:"app-layout"},{default:m(()=>[r(ga,{modelValue:y(o).hasError,"onUpdate:modelValue":a[0]||(a[0]=h=>y(o).hasError=h),timeout:2e3,location:"center",variant:"outlined",color:"error"},{default:m(()=>[I(ae(y(o).errorMessage),1)]),_:1},8,["modelValue"]),V("section",_a,[r(d,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":y(B),"row-data":y(P),"enable-rtl":"","row-numbers":"",pagination:"",theme:y(s)},null,8,["column-defs","row-data","theme"])]),y(o).isPayrollBatchCreateDialogVisible?(x(),S(Ca,{key:0,"is-dialog-visible":y(o).isPayrollBatchCreateDialogVisible,"onUpdate:isDialogVisible":a[1]||(a[1]=h=>y(o).isPayrollBatchCreateDialogVisible=h),loading:y(i).createPayrollBatch,onSubmit:C},null,8,["is-dialog-visible","loading"])):X("",!0),y(o).isPayrollBatchDeleteDialogVisible?(x(),S(Va,{key:1,"is-dialog-visible":y(o).isPayrollBatchDeleteDialogVisible,"onUpdate:isDialogVisible":a[2]||(a[2]=h=>y(o).isPayrollBatchDeleteDialogVisible=h),title:"آیا از حذف این فیش اطمینان دارید؟",loading:y(i).deletePayrollBatches,onConfirm:p},null,8,["is-dialog-visible","loading"])):X("",!0),r(la,null,{default:m(()=>[r(wa,{app:"",icon:"tabler-plus",size:"x-large",onClick:a[3]||(a[3]=h=>y(o).isPayrollBatchCreateDialogVisible=!0)})]),_:1})]),_:1})}}},tt=aa(Fa,[["__scopeId","data-v-24a2ae2c"]]);export{tt as default};
