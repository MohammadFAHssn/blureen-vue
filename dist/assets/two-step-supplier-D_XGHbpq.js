import{M,bC as d,j as A,k as N,r as p,Y as j,aJ as B,a as D,c as F,o as O,b as e,d as l,e as o,v as S,x as b,n as t,bq as k,O as x,I as w,bx as q,am as L,y as U,F as $,au as H}from"./index-CxBCniRz.js";import{a as z,b as J}from"./auth-v1-top-shape-CBN9aWIG.js";import{V as y}from"./VNodeRenderer-iQJZDhZS.js";import{u as P}from"./useAbility-Cg9gpIGs.js";import{$ as Y}from"./api-CctPY7dA.js";import{V as G}from"./VSnackbar-zL0lJxOR.js";import{a as K,b as Q,V as W}from"./VCard-CX4UpRmD.js";import{V as R}from"./VCardText-BVXiE7iR.js";import{V as X}from"./VForm-D74zTOld.js";import{V as Z,a as h}from"./VRow-BLJT9SWy.js";import{V as ee}from"./VOtpInput-D8sDOPN0.js";import"./useLogout-CUJN8KZ_.js";import"./VOverlay-CLFRDIcR.js";import"./createSimpleFunctional-BbzySe_P.js";/* empty css              */import"./VField-DxRj1cN5.js";const te={class:"auth-wrapper d-flex align-center justify-center pa-4"},ae={class:"position-relative my-sm-16"},oe={class:"app-logo"},se={class:"app-logo-title"},le={class:"d-flex justify-center align-center flex-wrap"},re={class:"me-1"},ne=Object.assign({beforeRouteEnter(I,m,n){if(d("otpExpiresAt").value<Math.floor(Date.now()/1e3))return n({name:"login-supplier"});n()}},{__name:"two-step-supplier",setup(I){const m=A(),n=N(),T=P(),c=p(""),i=p(!1),V=p({other:void 0}),f=p(!1),v=p(d("otpExpiresAt").value-Math.floor(Date.now()/1e3)),g=setInterval(()=>{v.value-=1,v.value<=0&&(clearInterval(g),v.value=0,n.replace("/login-supplier"))},1e3),C=j(()=>{const s=v.value,a=Math.floor(s%3600/60),u=s%60;return{minutes:a.toString().padStart(2,"0"),seconds:u.toString().padStart(2,"0")}});async function E(){i.value=!0;try{const s=await Y("/verify-supplier-otp",{method:"POST",body:{mobileNumber:m.query.mobileNumber,otpCode:c.value},onResponseError({response:_}){i.value=!1,_._data.errors?V.value=_._data.errors:(V.value.other=_._data.message,f.value=!0)}}),{accessToken:a,userData:u,userAbilityRules:r}=s;d("userAbilityRules").value=r,T.update(r),d("userData").value=u,d("accessToken").value=a,await H(()=>{n.replace(m.query.to?String(m.query.to):"/")})}catch(s){console.error(s)}}return B(()=>{clearInterval(g)}),(s,a)=>{const u=D("RouterLink");return O(),F($,null,[e(G,{modelValue:t(f),"onUpdate:modelValue":a[0]||(a[0]=r=>k(f)?f.value=r:null),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:o(()=>[S(b(t(V).other),1)]),_:1},8,["modelValue"]),l("div",te,[l("div",ae,[e(t(y),{nodes:("h"in s?s.h:t(x))("div",{innerHTML:t(z)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),e(t(y),{nodes:("h"in s?s.h:t(x))("div",{innerHTML:t(J)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),e(W,{class:U(["auth-card",s.$vuetify.display.smAndUp?"pa-6":"pa-0"]),"max-width":"460"},{default:o(()=>[e(K,{class:"justify-center"},{default:o(()=>[e(Q,null,{default:o(()=>[e(u,{to:"/"},{default:o(()=>[l("div",oe,[e(t(y),{nodes:t(w).app.logo},null,8,["nodes"]),l("h1",se,b(t(w).app.title),1)])]),_:1})]),_:1})]),_:1}),e(R,null,{default:o(()=>[...a[2]||(a[2]=[l("h4",{class:"text-h4 mb-1"}," احراز هویت دو مرحله‌ای ",-1),l("p",{class:"mb-1"}," کد تأیید به تلفن همراه شما ارسال شد. لطفاً کد دریافتی را در کادر زیر وارد کنید ",-1)])]),_:1}),e(R,null,{default:o(()=>[e(X,{onSubmit:q(()=>{},["prevent"])},{default:o(()=>[e(Z,null,{default:o(()=>[e(h,{cols:"12"},{default:o(()=>[e(ee,{modelValue:t(c),"onUpdate:modelValue":a[1]||(a[1]=r=>k(c)?c.value=r:null),style:{direction:"ltr"},disabled:t(i),type:"number",class:"pa-0",onFinish:E},null,8,["modelValue","disabled"])]),_:1}),e(h,{cols:"12"},{default:o(()=>[e(L,{loading:t(i),disabled:t(i),block:"",type:"submit"},{default:o(()=>[...a[3]||(a[3]=[S(" تأیید ",-1)])]),_:1},8,["loading","disabled"])]),_:1}),e(h,null,{default:o(()=>[e(h,{cols:"12"},{default:o(()=>[l("div",le,[l("span",re,b(t(C).minutes)+":"+b(t(C).seconds),1),a[4]||(a[4]=l("span",{class:"me-1"},"تا درخواست دوباره",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])],64)}}}),ke=M(ne,[["__scopeId","data-v-68ff88f3"]]);export{ke as default};
