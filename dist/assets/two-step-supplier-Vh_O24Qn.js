import{au as Q,a5 as W,aM as ee,aC as te,ak as ae,Y as B,r as y,a_ as oe,cw as le,cx as ne,a$ as se,w as T,aX as re,Z as S,at as z,aa as ue,bc as ie,d as i,J as de,b as l,F as U,y as H,s as O,be as ce,co as fe,aT as pe,c9 as M,M as me,bA as A,j as ve,k as he,a as ge,c as ye,o as be,e as c,v as j,x as R,n as s,bq as E,O as L,I as q,bw as Ve,al as _e}from"./index-D1NhewP6.js";import{V as P}from"./VNodeRenderer-DGQvJROF.js";import{u as we}from"./useAbility-C3E83y0Z.js";import{$ as xe}from"./api-jsS1BgXB.js";import{V as ke}from"./VSnackbar-CLUkz1No.js";import{a as Ce,b as Se,V as Ae}from"./VCard-CwkXv6FN.js";import{V as $}from"./VCardText-CvEv_GAf.js";import{V as Ie}from"./VForm-COO9Nrxn.js";import{V as Re}from"./VRow-BWetKUzG.js";import{V as F}from"./VCol-DA3NXQeu.js";import{V as Fe,m as Be}from"./VField-DvAT9Lz_.js";import{V as De}from"./VOverlay-DPABkZfC.js";import{u as Te,m as Pe}from"./form-CXkrWuCp.js";import"./useLogout-BJR2fKtY.js";import"./forwardRefs-BYSXgJht.js";import"./createSimpleFunctional-6j82DH8l.js";/* empty css              */import"./VLabel-DFkEwyF-.js";const Ne=`<svg width="180" height="180" viewBox="0 0 181 181" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="1.30469" y="1.44312" width="178" height="178" rx="19" stroke="currentColor" stroke-opacity="0.16" stroke-width="2" stroke-dasharray="8 8" />\r
<rect x="22.8047" y="22.9431" width="135" height="135" rx="10" fill="currentColor" fill-opacity="0.08" />\r
</svg>\r
`,Oe=`<svg width="239" height="234" viewBox="0 0 239 234" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="88.5605" y="0.700195" width="149" height="149" rx="19.5" stroke="currentColor" stroke-opacity="0.16" />\r
<rect x="0.621094" y="33.761" width="200" height="200" rx="10" fill="currentColor" fill-opacity="0.08" />\r
</svg>\r
`,Me=W({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...pe(),...Pe(),...fe(Be({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),je=Q()({name:"VOtpInput",props:Me(),emits:{finish:t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,w){let{attrs:b,emit:D,slots:m}=w;const{dimensionStyles:V}=ee(t),{isFocused:x,focus:k,blur:C}=Te(t),f=te(t,"modelValue","",e=>e==null?[]:String(e).split(""),e=>e.join("")),{t:I}=ae(),h=B(()=>Number(t.length)),d=B(()=>Array(h.value).fill(0)),a=y(-1),v=y(),u=y([]),_=B(()=>u.value[a.value]);oe(()=>t.autofocus,()=>{const e=le();e.run(()=>{const{intersectionRef:o,isIntersecting:r}=ne();se(()=>{o.value=u.value[0]}),T(r,p=>{var n;p&&((n=o.value)==null||n.focus(),e.stop())})})});function K(){if(N(_.value.value)){_.value.value="";return}const e=f.value.slice(),o=_.value.value;e[a.value]=o;let r=null;a.value>f.value.length?r=f.value.length+1:a.value+1!==h.value&&(r="next"),f.value=e,r&&M(v.value,r)}function J(e){const o=f.value.slice(),r=a.value;let p=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(e.key)&&(e.preventDefault(),e.key==="ArrowLeft"?p="prev":e.key==="ArrowRight"?p="next":["Backspace","Delete"].includes(e.key)&&(o[a.value]="",f.value=o,a.value>0&&e.key==="Backspace"?p="prev":requestAnimationFrame(()=>{var n;(n=u.value[r])==null||n.select()})),requestAnimationFrame(()=>{p!=null&&M(v.value,p)}))}function X(e,o){var n,g;o.preventDefault(),o.stopPropagation();const r=((n=o==null?void 0:o.clipboardData)==null?void 0:n.getData("Text").trim().slice(0,h.value))??"",p=r.length-1===-1?e:r.length-1;N(r)||(f.value=r.split(""),(g=u.value)==null||g[p].focus())}function Y(){f.value=[]}function Z(e,o){k(),a.value=o}function G(){C(),a.value=-1}function N(e){return t.type==="number"&&/[^0-9]/g.test(e)}return re({VField:{color:S(()=>t.color),bgColor:S(()=>t.color),baseColor:S(()=>t.baseColor),disabled:S(()=>t.disabled),error:S(()=>t.error),variant:S(()=>t.variant)}},{scoped:!0}),T(f,e=>{e.length===h.value&&(a.value=h.value-1,D("finish",e.join("")))},{deep:!0}),T(a,e=>{e<0||z(()=>{var o;(o=u.value[e])==null||o.select()})}),ue(()=>{var r;const[e,o]=ie(b);return i("div",O({class:["v-otp-input",{"v-otp-input--divided":!!t.divider},t.class],style:[t.style]},e),[i("div",{ref:v,class:"v-otp-input__content",style:de([V.value])},[d.value.map((p,n)=>i(U,null,[t.divider&&n!==0&&i("span",{class:"v-otp-input__divider"},[t.divider]),l(Fe,{focused:x.value&&t.focusAll||a.value===n,key:n},{...m,loader:void 0,default:()=>i("input",{ref:g=>u.value[n]=g,"aria-label":I(t.label,n+1),autofocus:n===0&&t.autofocus,autocomplete:"one-time-code",class:H(["v-otp-input__field"]),disabled:t.disabled,inputmode:t.type==="number"?"numeric":"text",min:t.type==="number"?0:void 0,maxlength:n===0?h.value:"1",placeholder:t.placeholder,type:t.type==="number"?"text":t.type,value:f.value[n],onInput:K,onFocus:g=>Z(g,n),onBlur:G,onKeydown:J,onPaste:g=>X(n,g)},null)})])),i("input",O({class:"v-otp-input-input",type:"hidden"},o,{value:f.value.join("")}),null),l(De,{contained:!0,contentClass:"v-otp-input__loader",modelValue:!!t.loading,persistent:!0},{default:()=>{var p;return[((p=m.loader)==null?void 0:p.call(m))??l(ce,{color:typeof t.loading=="boolean"?void 0:t.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(r=m.default)==null?void 0:r.call(m)])])}),{blur:()=>{var e;(e=u.value)==null||e.some(o=>o.blur())},focus:()=>{var e;(e=u.value)==null||e[0].focus()},reset:Y,isFocused:x}}}),Ee={class:"auth-wrapper d-flex align-center justify-center pa-4"},Le={class:"position-relative my-sm-16"},qe={class:"app-logo"},$e={class:"app-logo-title"},ze={class:"d-flex justify-center align-center flex-wrap"},Ue={class:"me-1"},He=Object.assign({beforeRouteEnter(t,w,b){if(A("otpExpiresAt").value<Math.floor(Date.now()/1e3))return b({name:"login-supplier"});b()}},{__name:"two-step-supplier",setup(t){const w=ve(),b=he(),D=we(),m=y(""),V=y(!1),x=y({other:void 0}),k=y(!1),C=y(A("otpExpiresAt").value-Math.floor(Date.now()/1e3)),f=setInterval(()=>{C.value-=1,C.value<=0&&(clearInterval(f),C.value=0,b.replace("/login-supplier"))},1e3),I=B(()=>{const d=C.value,a=Math.floor(d%3600/60),v=d%60;return{minutes:a.toString().padStart(2,"0"),seconds:v.toString().padStart(2,"0")}});async function h(){V.value=!0;try{const d=await xe("/verify-supplier-otp",{method:"POST",body:{mobileNumber:w.query.mobileNumber,otpCode:m.value},onResponseError({response:_}){V.value=!1,_._data.errors?x.value=_._data.errors:(x.value.other=_._data.message,k.value=!0)}}),{accessToken:a,userData:v,userAbilityRules:u}=d;A("userAbilityRules").value=u,D.update(u),A("userData").value=v,A("accessToken").value=a,await z(()=>{b.replace(w.query.to?String(w.query.to):"/")})}catch(d){console.error(d)}}return(d,a)=>{const v=ge("RouterLink");return be(),ye(U,null,[l(ke,{modelValue:s(k),"onUpdate:modelValue":a[0]||(a[0]=u=>E(k)?k.value=u:null),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:c(()=>[j(R(s(x).other),1)]),_:1},8,["modelValue"]),i("div",Ee,[i("div",Le,[l(s(P),{nodes:("h"in d?d.h:s(L))("div",{innerHTML:s(Oe)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),l(s(P),{nodes:("h"in d?d.h:s(L))("div",{innerHTML:s(Ne)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),l(Ae,{class:H(["auth-card",d.$vuetify.display.smAndUp?"pa-6":"pa-0"]),"max-width":"460"},{default:c(()=>[l(Ce,{class:"justify-center"},{default:c(()=>[l(Se,null,{default:c(()=>[l(v,{to:"/"},{default:c(()=>[i("div",qe,[l(s(P),{nodes:s(q).app.logo},null,8,["nodes"]),i("h1",$e,R(s(q).app.title),1)])]),_:1})]),_:1})]),_:1}),l($,null,{default:c(()=>a[2]||(a[2]=[i("h4",{class:"text-h4 mb-1"}," احراز هویت دو مرحله‌ای ",-1),i("p",{class:"mb-1"}," کد تأیید به تلفن همراه شما ارسال شد. لطفاً کد دریافتی را در کادر زیر وارد کنید ",-1)])),_:1,__:[2]}),l($,null,{default:c(()=>[l(Ie,{onSubmit:Ve(()=>{},["prevent"])},{default:c(()=>[l(Re,null,{default:c(()=>[l(F,{cols:"12"},{default:c(()=>[l(je,{modelValue:s(m),"onUpdate:modelValue":a[1]||(a[1]=u=>E(m)?m.value=u:null),style:{direction:"ltr"},disabled:s(V),type:"number",class:"pa-0",onFinish:h},null,8,["modelValue","disabled"])]),_:1}),l(F,{cols:"12"},{default:c(()=>[l(_e,{loading:s(V),disabled:s(V),block:"",type:"submit"},{default:c(()=>a[3]||(a[3]=[j(" تأیید ",-1)])),_:1,__:[3]},8,["loading","disabled"])]),_:1}),l(F,null,{default:c(()=>[l(F,{cols:"12"},{default:c(()=>[i("div",ze,[i("span",Ue,R(s(I).minutes)+":"+R(s(I).seconds),1),a[4]||(a[4]=i("span",{class:"me-1"},"تا درخواست دوباره",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])],64)}}}),dt=me(He,[["__scopeId","data-v-5ae98224"]]);export{dt as default};
