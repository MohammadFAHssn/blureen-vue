import{j as L}from"./index-CxTrkPBr.js";import{$ as k}from"./api-CRnz60WE.js";import{M as O,bJ as D,r as H,Y as E,H as M,a as S,f as p,o as d,e as t,b as a,aH as Y,n as o,bv as F,bO as j,bj as x,v as C,x as J,am as U,c as N}from"./index-Bvm1mU2Q.js";import{V as $}from"./VRow-yH5PVQoc.js";import{V as P}from"./VCol-VeZ2dyXK.js";import{V as y,b as z,c as A}from"./VCard-DgLDzmB3.js";import{V as R}from"./VCardText-A2h27jHu.js";import{V as q}from"./VDialog-D_t5A8Yw.js";import{V as G}from"./VContainer-TAAszh-8.js";import"./index-CvOPxmL5.js";import"./useLogout-BQOYZFXX.js";/* empty css              */import"./createSimpleFunctional-BZNIwSl2.js";import"./VOverlay-BPadrcFc.js";import"./dialog-transition-BLsRpjJQ.js";const K={key:1},Q={__name:"health-certificate",setup(W){const g=D({isImageDialogVisible:!1}),i=D({fetchingHealthCertificateImage:!1,downloadingHealthCertificate:!1}),V="https://blureen.afgc.ir/storage",f=H(""),n=H(""),h=E(()=>f.value);async function b(l=null){i.fetchingHealthCertificateImage=!0,n.value="";try{const e=await k("/hse/health-certificate/user/image",{params:{year:l}});n.value=e.data??e}catch(e){console.error(e),n.value=""}finally{i.fetchingHealthCertificateImage=!1}}async function T(){if(n.value){i.downloadingHealthCertificate=!0;try{const l=await k("/hse/health-certificate/user/image/download",{params:{year:h.value},responseType:"blob"}),e=l.data??l,s=l.headers??(l==null?void 0:l.headers)??{},r=s["content-type"]??s["Content-Type"]??"application/octet-stream",B=new Blob([e],{type:r}),v=URL.createObjectURL(B);let c=`health-certificate-${h.value||"latest"}.jpg`;const w=s["content-disposition"]??s["Content-Disposition"];if(w){const u=/filename\*?=(?:UTF-8'')?["']?([^;"']+)["']?/i.exec(w);if(u&&u[1])try{c=decodeURIComponent(u[1])}catch{c=u[1]}}if(!c||c==="")try{const _=new URL(n.value,window.location.origin).pathname.split("/"),I=_[_.length-1];I&&(c=I)}catch{console.error("error in filename")}const m=document.createElement("a");m.href=v,m.download=c,document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(v)}catch(l){console.error(l)}finally{i.downloadingHealthCertificate=!1}}}return M(async()=>{const l=new Date,e=L.toJalaali(l.getFullYear(),l.getMonth()+1,l.getDate()).jy;f.value=e,await b(e)}),(l,e)=>{const s=S("PersianDatetimePicker");return d(),p(G,null,{default:t(()=>[a($,{justify:"center"},{default:t(()=>[a(P,{cols:"12",sm:"6",md:"4"},{default:t(()=>[a(Y,null,{default:t(()=>[a(s,{modelValue:o(f),"onUpdate:modelValue":e[0]||(e[0]=r=>F(f)?f.value=r:null),type:"year",simple:"",label:"دوره",onChange:e[1]||(e[1]=()=>b(o(h)))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a($,{justify:"center"},{default:t(()=>[a(P,{cols:"12",sm:"6",md:"4"},{default:t(()=>[o(i).fetchingHealthCertificateImage?(d(),p(y,{key:0,class:"text-center"},{default:t(()=>[a(R,null,{default:t(()=>[a(j,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):o(n)?(d(),p(y,{key:1,class:"text-center"},{default:t(()=>[a(x,{src:`${o(V)}/${o(n)}`,cover:"",height:"100%",class:"cursor-pointer",onClick:e[2]||(e[2]=r=>o(g).isImageDialogVisible=!0)},null,8,["src"]),a(z,null,{default:t(()=>[C(J(o(h)),1)]),_:1}),a(U,{color:"primary",variant:"flat",class:"mb-2",disabled:o(i).fetchingHealthCertificateImage||o(i).downloadingHealthCertificate,onClick:T},{default:t(()=>[o(i).downloadingHealthCertificate?(d(),p(j,{key:0,indeterminate:"",size:"18"})):(d(),N("div",K," دانلود "))]),_:1},8,["disabled"])]),_:1})):(d(),p(y,{key:2,class:"text-center"},{default:t(()=>[...e[5]||(e[5]=[C(" تصویر در دسترس نیست ",-1)])]),_:1}))]),_:1})]),_:1}),a(q,{modelValue:o(g).isImageDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=r=>o(g).isImageDialogVisible=r),width:"1000"},{default:t(()=>[a(y,null,{default:t(()=>[a(R,{class:"text-center"},{default:t(()=>[a(x,{src:`${o(V)}/${o(n)}`},null,8,["src"])]),_:1}),a(A,{class:"justify-center"},{default:t(()=>[a(U,{onClick:e[3]||(e[3]=r=>o(g).isImageDialogVisible=!1)},{default:t(()=>[...e[6]||(e[6]=[C(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},ue=O(Q,[["__scopeId","data-v-09eaa282"]]);export{ue as default};
