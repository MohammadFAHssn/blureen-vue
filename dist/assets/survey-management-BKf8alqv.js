import{_ as G,V as I}from"./VFab-C6uOjiSE.js";import{r as M}from"./validators-CT5dUf4l.js";import{r as d,f as b,o as D,e as s,b as l,d as j,bx as U,n as r,bq as E,am as x,v as k,M as $,bL as A,bM as Y,a as q,m as R,x as T,bN as B}from"./index-B2A7Sa9b.js";import{_ as H}from"./AppTextField-B5lnsokW.js";import{_ as N}from"./DialogCloseBtn-lRN6XNlK.js";import{V as O}from"./VCard-Bsc_93cL.js";import{V as z}from"./VCardText-DXKYBdeZ.js";import{V as P}from"./VForm-CQZ9q6K5.js";import{V as L,a as w}from"./VRow-oFw-TnNH.js";import{V as K}from"./VDialog-jzGWIXGn.js";import{u as J,V as Q}from"./VLayout-B2PDuM3R.js";import{u as W}from"./useApi-CR0_M8tr.js";import{c as X}from"./createUrl-3Fsu3BUH.js";import{$ as h}from"./api-DF3aQ1IH.js";import{V as Z}from"./VSnackbar-D82GW9Nj.js";import"./helpers-4BKJjDfb.js";import"./VTextField-7oVpQ4pI.js";import"./VCounter-TR6arsJv.js";import"./VField-B50gNKV5.js";import"./VOverlay-Bn9aD4vk.js";import"./createSimpleFunctional-CEOQY3Sn.js";/* empty css              */import"./dialog-transition-Cq0iRQez.js";import"./useLogout-_1uCg_3h.js";const ee={__name:"SurveyCreateDialog",props:{isDialogVisible:{type:Boolean,required:!0},loading:{type:Boolean,required:!0}},emits:["submit","update:isDialogVisible"],setup(v,{emit:a}){const n=v,c=a,m=d(""),u=d(""),y=d();function S(){var o;(o=y.value)==null||o.validate().then(({valid:i})=>{i&&c("submit",{title:m.value,porslineId:u.value})})}function C(){c("update:isDialogVisible",!1)}function g(o){c("update:isDialogVisible",o)}return(o,i)=>{const _=N,V=H;return D(),b(K,{width:o.$vuetify.display.smAndDown?"auto":900,"model-value":n.isDialogVisible,"onUpdate:modelValue":g},{default:s(()=>[l(_,{onClick:i[0]||(i[0]=f=>g(!1))}),l(O,null,{default:s(()=>[l(z,null,{default:s(()=>[i[5]||(i[5]=j("h4",{class:"text-h5 text-center mb-2"}," افزودن نظرسنجی جدید ",-1)),l(P,{ref_key:"refVForm",ref:y,class:"mt-6","validate-on":"submit lazy",onSubmit:U(S,["prevent"])},{default:s(()=>[l(L,null,{default:s(()=>[l(w,{cols:"12",md:"6"},{default:s(()=>[l(V,{modelValue:r(m),"onUpdate:modelValue":i[1]||(i[1]=f=>E(m)?m.value=f:null),label:"عنوان نظرسنجی",rules:["requiredValidator"in o?o.requiredValidator:r(M)]},null,8,["modelValue","rules"])]),_:1}),l(w,{cols:"12",md:"6"},{default:s(()=>[l(V,{modelValue:r(u),"onUpdate:modelValue":i[2]||(i[2]=f=>E(u)?u.value=f:null),label:"شناسه نظرسنجی",rules:["requiredValidator"in o?o.requiredValidator:r(M)]},null,8,["modelValue","rules"])]),_:1}),l(w,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:s(()=>[l(x,{type:"submit",disabled:v.loading,loading:v.loading},{default:s(()=>[...i[3]||(i[3]=[k(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),l(x,{color:"secondary",variant:"tonal",onClick:C},{default:s(()=>[...i[4]||(i[4]=[k(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},te={style:{"block-size":"100%"}},ae={__name:"survey-management",setup(v){const a=A({hasError:!1,errorMessage:"",isSurveyDeleteDialogVisible:!1}),n=A({createSurvey:!1,fetchSurveys:!1,deleteSurveys:!1}),c=d([]),m=d([]),u=d(null),{theme:y}=J();function S(e){u.value=e.api,u.value.setGridOption("rowData",o())}const C=d(e=>String(e.data.id)),g=d([{headerName:"تاریخ ایجاد",field:"createdAt",valueFormatter:e=>Y(e.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"عنوان نظرسنجی",field:"title",editable:!0},{headerName:"شناسه نظرسنجی",field:"porslineId"},{headerName:"وضعیت",field:"active",cellRenderer:"Active",cellStyle:{display:"flex","align-items":"center"},filterParams:{valueFormatter:e=>e.value===1?"فعال":"غیرفعال"}},{headerName:"عملیات",field:"actions",cellRendererSelector:()=>({component:"Actions",params:{onEditClick:e=>{u.value.setGridOption("rowData",o()),u.value.setFocusedCell(e.rowIndex,"title"),setTimeout(()=>{u.value.startEditingCell({rowIndex:e.rowIndex,colKey:"title"})},10),e.setDataValue("actions",{...e.data.actions,editable:{...e.data.actions.editable,mode:"edit"}})},onSaveClick:e=>{f({id:e.data.id,title:e.data.title})},onCancelClick:()=>{u.value.setGridOption("rowData",o())},onDeleteClick:e=>{m.value=[e],a.isSurveyDeleteDialogVisible=!0},onActivityChange:(e,t)=>{f({id:e.data.id,active:t.target.checked})}}})}]);function o(){var e;return(e=c.value)==null?void 0:e.map(t=>({id:t.id,createdAt:Y(t.created_at).format("jYYYY-jMM-jDD HH:mm:ss"),title:t.title,porslineId:t.porsline_id,active:t.active,actions:{editable:{status:!0,mode:"view",PrimaryValue:{title:t.title}},deletable:!0,activable:!0}}))}async function i(){n.fetchSurveys=!0;try{const{data:e,error:t}=await W(X("/survey/survey"));if(n.fetchSurveys=!1,t.value)throw t.value;c.value=e.value.data,u.value.setGridOption("rowData",o())}catch(e){console.error("Error fetching surveys:",e),a.hasError=!0,a.errorMessage=e.message||"خطا در دریافت نظرسنجی‌ها"}}i();async function _(e){n.createSurvey=!0;try{await h("/survey/survey/create",{method:"POST",body:{title:e.title,porsline_id:e.porslineId},onResponseError({response:t}){a.hasError=!0,a.errorMessage=t._data.message||"خطا در ایجاد نظرسنجی"}}),a.isSurveyCreateDialogVisible=!1}catch(t){console.error(t)}finally{n.createSurvey=!1,i()}}async function V(){n.deleteSurveys=!0;try{await h("/survey/survey",{method:"DELETE",body:{ids:[m.value[0].data.id]},onResponseError({response:e}){n.deleteSurveys=!1,a.hasError=!0,a.errorMessage=e._data.message||"خطا در حذف نظرسنجی"}}),n.deleteSurveys=!1,a.isSurveyDeleteDialogVisible=!1,i()}catch(e){console.error(e)}}async function f(e){try{await h("/survey/survey/update",{method:"POST",body:{...e},onResponseError({response:t}){a.hasError=!0,a.errorMessage=t._data.message||"خطا در بروزرسانی نظرسنجی"}})}catch(t){console.error(t)}finally{i()}}return(e,t)=>{const F=q("AgGridVue");return D(),b(Q,{class:"app-layout"},{default:s(()=>[l(Z,{modelValue:r(a).hasError,"onUpdate:modelValue":t[0]||(t[0]=p=>r(a).hasError=p),timeout:2e3,location:"center",variant:"outlined",color:"error"},{default:s(()=>[k(T(r(a).errorMessage),1)]),_:1},8,["modelValue"]),j("section",te,[l(F,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":r(g),"get-row-id":r(C),"suppress-click-edit":!0,loading:r(n).fetchSurveys,"enable-rtl":"","row-numbers":"",pagination:"",theme:r(y),onGridReady:S},null,8,["column-defs","get-row-id","loading","theme"])]),r(a).isSurveyCreateDialogVisible?(D(),b(ee,{key:0,"is-dialog-visible":r(a).isSurveyCreateDialogVisible,"onUpdate:isDialogVisible":t[1]||(t[1]=p=>r(a).isSurveyCreateDialogVisible=p),loading:r(n).createSurvey,onSubmit:_},null,8,["is-dialog-visible","loading"])):R("",!0),r(a).isSurveyDeleteDialogVisible?(D(),b(G,{key:1,"is-dialog-visible":r(a).isSurveyDeleteDialogVisible,"onUpdate:isDialogVisible":t[2]||(t[2]=p=>r(a).isSurveyDeleteDialogVisible=p),title:"آیا از حذف این نظرسنجی اطمینان دارید؟",loading:r(n).deleteSurveys,onConfirm:V},null,8,["is-dialog-visible","loading"])):R("",!0),l(B,null,{default:s(()=>[l(I,{app:"",icon:"tabler-plus",size:"x-large",onClick:t[3]||(t[3]=p=>r(a).isSurveyCreateDialogVisible=!0)})]),_:1})]),_:1})}}},Me=$(ae,[["__scopeId","data-v-f6716b25"]]);export{Me as default};
