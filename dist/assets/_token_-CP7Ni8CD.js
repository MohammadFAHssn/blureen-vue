import{r as de}from"./validators-CT5dUf4l.js";import{au as ke,a5 as Ie,c5 as ce,aC as Ce,Y as M,r as w,a6 as Re,a$ as Fe,H as Me,w as z,aY as Ue,aa as Ae,bc as De,b as t,d as V,F as U,s as ee,K as fe,c6 as Ee,y as _e,at as te,a8 as $e,a7 as Ne,bH as He,bU as me,bb as ze,c as O,o as v,f as q,m as K,n,bV as Oe,i as oe,e as l,A as qe,am as pe,an as ve,M as Be,j as Ge,k as Le,bJ as Ve,c4 as Qe,aD as je,v as f,x as y,a2 as ae,bv as Ye,c7 as Je,bw as Ke,al as We,a1 as Xe}from"./index-DcXQA0pX.js";import{V as ne}from"./VLabel-JPDpXGoP.js";import{u as Ze}from"./VTextField-BEyi0wLz.js";import{V as et}from"./VCounter-B_Mw6fuH.js";import{V as be,m as tt}from"./VField-DCMZ-Xzj.js";import{V as xe,m as at}from"./VInput-Dl-rhPEY.js";import{u as lt}from"./form-KKZTlx8P.js";import{f as ot}from"./VOverlay-DacJXWvn.js";import{_ as nt}from"./AppTextField-CP76Yxqs.js";import{$ as rt}from"./api-B3XcKdan.js";import{u as st}from"./useApi-ayh-Jxa7.js";import{c as ut}from"./createUrl-CKObRz9w.js";import{V as ye}from"./VSnackbar-D6Cdp5fG.js";import{a as R,V as B}from"./VRow-CvexyRMo.js";import{V as it,a as dt,b as ct,d as ft}from"./VList-Ckp9K_-v.js";import{V as le,a as mt,b as pt}from"./VCard-D2YnYE4f.js";import{V as F}from"./VCardText-COqqMUXU.js";import{a as ge,V as J}from"./VRadioGroup-HrVHz0MZ.js";import{V as vt}from"./VDivider-Cvj79vsu.js";import{V as Vt}from"./VForm-B3ZYgJ_G.js";import"./helpers-4BKJjDfb.js";import"./useLogout-Cm8XbVne.js";/* empty css              */import"./createSimpleFunctional-B7tEoKAB.js";import"./VSelectionControl-CHkYRr_V.js";const bt=Ie({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...at(),...tt()},"VTextarea"),xt=ke()({name:"VTextarea",directives:{vIntersect:ce},inheritAttrs:!1,props:bt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0,"update:rows":e=>!0},setup(e,I){let{attrs:g,emit:b,slots:c}=I;const i=Ce(e,"modelValue"),{isFocused:p,focus:A,blur:D}=lt(e),{onIntersect:d}=Ze(e),m=M(()=>typeof e.counterValue=="function"?e.counterValue(i.value):(i.value||"").toString().length),G=M(()=>{if(g.maxlength)return g.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),L=w(),E=w(),Q=Re(""),$=w(),h=M(()=>e.persistentPlaceholder||p.value||e.active);function r(){var s;$.value!==document.activeElement&&((s=$.value)==null||s.focus()),p.value||A()}function a(s){r(),b("click:control",s)}function x(s){b("mousedown:control",s)}function S(s){s.stopPropagation(),r(),te(()=>{i.value="",He(e["onClick:clear"],s)})}function o(s){var T;const _=s.target;if(i.value=_.value,(T=e.modelModifiers)!=null&&T.trim){const H=[_.selectionStart,_.selectionEnd];te(()=>{_.selectionStart=H[0],_.selectionEnd=H[1]})}}const u=w(),C=w(Number(e.rows)),W=M(()=>["plain","underlined"].includes(e.variant));Fe(()=>{e.autoGrow||(C.value=Number(e.rows))});function N(){e.autoGrow&&te(()=>{if(!u.value||!E.value)return;const s=getComputedStyle(u.value),_=getComputedStyle(E.value.$el),T=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),H=u.value.scrollHeight,j=parseFloat(s.lineHeight),X=Math.max(parseFloat(e.rows)*j+T,parseFloat(_.getPropertyValue("--v-input-control-height"))),Z=parseFloat(e.maxRows)*j+T||1/0,k=Ne(H??0,X,Z);C.value=Math.floor((k-T)/j),Q.value=$e(k)})}Me(N),z(i,N),z(()=>e.rows,N),z(()=>e.maxRows,N),z(()=>e.density,N),z(C,s=>{b("update:rows",s)});let P;return z(u,s=>{s?(P=new ResizeObserver(N),P.observe(u.value)):P==null||P.disconnect()}),Ue(()=>{P==null||P.disconnect()}),Ae(()=>{const s=!!(c.counter||e.counter||e.counterValue),_=!!(s||c.details),[T,H]=De(g),{modelValue:j,...X}=xe.filterProps(e),Z={...be.filterProps(e),"onClick:clear":S};return t(xe,ee({ref:L,modelValue:i.value,"onUpdate:modelValue":k=>i.value=k,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":W.value},e.class],style:e.style},T,X,{centerAffix:C.value===1&&!W.value,focused:p.value}),{...c,default:k=>{let{id:Y,isDisabled:re,isDirty:se,isReadonly:we,isValid:he,hasDetails:Se}=k;return t(be,ee({ref:E,style:{"--v-textarea-control-height":Q.value},onClick:a,onMousedown:x,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Z,{id:Y.value,active:h.value||se.value,centerAffix:C.value===1&&!W.value,dirty:se.value||e.dirty,disabled:re.value,focused:p.value,details:Se.value,error:he.value===!1}),{...c,default:Pe=>{let{props:{class:ue,...ie}}=Pe;return V(U,null,[e.prefix&&V("span",{class:"v-text-field__prefix"},[e.prefix]),fe(V("textarea",ee({ref:$,class:ue,value:i.value,onInput:o,autofocus:e.autofocus,readonly:we.value,disabled:re.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:r,onBlur:D},ie,H),null),[[ce,{handler:d},null,{once:!0}]]),e.autoGrow&&fe(V("textarea",{class:_e([ue,"v-textarea__sizer"]),id:`${ie.id}-sizer`,"onUpdate:modelValue":Te=>i.value=Te,ref:u,readonly:!0,"aria-hidden":"true"},null),[[Ee,i.value]]),e.suffix&&V("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:_?k=>{var Y;return V(U,null,[(Y=c.details)==null?void 0:Y.call(c,k),s&&V(U,null,[V("span",null,null),t(et,{active:e.persistentCounter||p.value,value:m.value,max:G.value,disabled:e.disabled},c.counter)])])}:void 0})}),ot({},L,E,$)}}),yt=Object.assign({name:"AppTextarea",inheritAttrs:!1},{__name:"AppTextarea",setup(e){const I=M(()=>{const c=me().id,i=ze();return c?`app-textarea-${c}`:i}),g=M(()=>me().label);return(b,c)=>(v(),O("div",{class:_e(["app-textarea flex-grow-1",b.$attrs.class])},[n(g)?(v(),q(ne,{key:0,for:n(I),class:"mb-1 text-body-2",text:n(g)},null,8,["for","text"])):K("",!0),t(xt,pe(ve({...b.$attrs,class:null,label:void 0,variant:"outlined",id:n(I)})),Oe({_:2},[oe(b.$slots,(i,p)=>({name:p,fn:l(A=>[qe(b.$slots,p,pe(ve(A||{})))])}))]),1040)],2))}}),gt={key:0,class:"layout-page-content"},_t={class:"text-wrap mb-2"},wt={class:"text-h6"},ht={__name:"[token]",async setup(e){let I,g;const b=Ge(),c=Le(),i=w(null),p=w(null),A=w([]),D=w(0),d=Ve({hasError:!1,errorMessage:"",isSuccessful:!1,HaveTenderBidsBeenSent:[],isSendTenderBidPending:[]}),m=Ve({paymentTerms:"cash",creditDescription:"",invoiceType:"taxInvoice"});let G=null;function L(){D.value=Math.max(0,i.value.tenderExpiresAt-Math.floor(Date.now()/1e3)),G=setInterval(()=>{D.value--,D.value<=0&&c.replace({name:"login-supplier"})},1e3)}function E(r,a){return a<=1?"#28a745":`hsl(${120-r/(a-1)*120}, 100%, 50%)`}async function Q(r){const{id:a,bidPrice:x,bidQuantity:S,bidDescription:o}=r;if(!(!x||!S)){d.isSendTenderBidPending[a]=!0;try{await rt("/commerce/tender/submit-bid",{method:"POST",body:{id:a,bid_price:x,bid_quantity:S,bid_description:o||"",payment_terms:m.paymentTerms,payment_terms_description:m.paymentTerms==="credit"?m.creditDescription:"",invoice_type:m.invoiceType},onResponseError({response:u}){d.hasError=!0,d.errorMessage=u._data.message||"خطا در ارسال پیشنهاد"}}),d.HaveTenderBidsBeenSent[a]=!0,d.isSuccessful=!0}catch(u){console.error(u)}finally{d.isSendTenderBidPending[a]=!1}}}async function $(){try{const{data:r,error:a}=await st(ut(`/commerce/tender/get-by-token?token=${b.params.token}`));if(a.value)throw a.value;i.value=r.value.data,p.value=r.value.data.supplier,A.value=r.value.data.tenderBids||[],L()}catch(r){d.hasError=!0,d.errorMessage=r.message||"خطا در دریافت اطلاعات مناقصه",setTimeout(()=>{c.replace({name:"login-supplier"})},2e3)}}[I,g]=Qe(()=>$()),await I,g();const h=M(()=>{const r=D.value,a=Math.floor(r/86400),x=Math.floor(r%86400/3600),S=Math.floor(r%3600/60),o=r%60;return{days:a,hours:x.toString().padStart(2,"0"),minutes:S.toString().padStart(2,"0"),seconds:o.toString().padStart(2,"0")}});return je(()=>{clearInterval(G)}),(r,a)=>{const x=nt,S=yt;return v(),O(U,null,[t(ye,{modelValue:n(d).hasError,"onUpdate:modelValue":a[0]||(a[0]=o=>n(d).hasError=o),timeout:"2000",location:"center",variant:"flat",color:"error"},{default:l(()=>[f(y(n(d).errorMessage)+"، در حال انتقال به پنل تأمین‌کننده ... ",1)]),_:1},8,["modelValue"]),t(ye,{modelValue:n(d).isSuccessful,"onUpdate:modelValue":a[1]||(a[1]=o=>n(d).isSuccessful=o),timeout:"1500",location:"center",variant:"flat",color:"success"},{default:l(()=>[...a[5]||(a[5]=[f(" ارسال شد! ",-1)])]),_:1},8,["modelValue"]),n(i)?(v(),O("main",gt,[t(B,null,{default:l(()=>[t(R,null,{default:l(()=>[V("div",_t,[a[6]||(a[6]=f(" مدیریت محترم شرکت/فروشگاه ",-1)),V("span",wt,y(n(p).name),1)]),a[7]||(a[7]=V("div",{class:"text-body-1"}," لیست کالاهای مورد نیاز مجموعه کارخانجات شیشه اردکان به شرح زیر می‌باشد. ",-1)),a[8]||(a[8]=V("div",{class:"text-body-1"}," لطفاً قیمت‌های پیشنهادی خود را ارائه دهید. ",-1))]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(it,{style:{"background-color":"rgb(var(--v-theme-background))"}},{default:l(()=>[t(dt,null,{prepend:l(()=>[t(Ye,{color:"warning",variant:"tonal",rounded:"",icon:"tabler-stopwatch"})]),default:l(()=>[t(ct,{class:"font-weight-medium"},{default:l(()=>[...a[9]||(a[9]=[f(" مدت زمان باقی‌مانده تا پایان مناقصه: ",-1)])]),_:1}),t(ft,{class:"text-body-1"},{default:l(()=>[n(h).days>0?(v(),q(ae,{key:0},{default:l(()=>[f(y(n(h).days)+" روز و "+y(n(h).hours)+" ساعت ",1)]),_:1})):(v(),q(ae,{key:1},{default:l(()=>[f(y(n(h).hours)+":"+y(n(h).minutes)+":"+y(n(h).seconds),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(R,{cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(F,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>[...a[10]||(a[10]=[f(" شرایط پرداخت ",-1)])]),_:1}),t(ge,{modelValue:n(m).paymentTerms,"onUpdate:modelValue":a[2]||(a[2]=o=>n(m).paymentTerms=o),inline:""},{default:l(()=>[t(J,{label:"نقدی",value:"cash"}),t(J,{label:"شرایطی",value:"credit"})]),_:1},8,["modelValue"]),n(m).paymentTerms==="credit"?(v(),q(x,{key:0,modelValue:n(m).creditDescription,"onUpdate:modelValue":a[3]||(a[3]=o=>n(m).creditDescription=o),type:"text",placeholder:"توضیحات"},null,8,["modelValue"])):K("",!0)]),_:1}),t(vt),t(F,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>[...a[11]||(a[11]=[f(" نوع فاکتور ",-1)])]),_:1}),t(ge,{modelValue:n(m).invoiceType,"onUpdate:modelValue":a[4]||(a[4]=o=>n(m).invoiceType=o),inline:""},{default:l(()=>[t(J,{label:"فاکتور رسمی",value:"taxInvoice"}),t(J,{label:"فاکتور فروشگاهی",value:"commercialInvoice"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(B,null,{default:l(()=>[t(Je,{group:""},{default:l(()=>[(v(!0),O(U,null,oe(n(A).filter(o=>!n(d).HaveTenderBidsBeenSent[o.id]),o=>(v(),q(R,{key:o.id,cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(mt,null,{default:l(()=>[t(pt,{class:"custom-v-card-title"},{default:l(()=>[f(y(o.tenderProduct.product.name)+" ",1),o.tenderProduct.brand?(v(),O(U,{key:0},[f(" ("+y(o.tenderProduct.brand.name)+") ",1)],64)):K("",!0)]),_:2},1024)]),_:2},1024),t(F,null,{default:l(()=>[f(y(o.tenderProduct.purchaseExpertDescription),1)]),_:2},1024),t(F,null,{default:l(()=>[t(le,{variant:"outlined"},{default:l(()=>[t(F,null,{default:l(()=>[...a[12]||(a[12]=[f(" قیمت‌های پیشنهادی از سایر تأمین‌کنندگان (تومان): ",-1)])]),_:1}),t(F,{class:"d-flex flex-wrap gap-x-4 gap-y-2"},{default:l(()=>[(v(!0),O(U,null,oe(o.bidOfOtherSuppliers,(u,C)=>(v(),q(ae,{key:u.supplierId,variant:u.supplierId===n(p).id?"flat":"outlined",color:E(C,o.bidOfOtherSuppliers.length)},{default:l(()=>[f(y(u.bidPrice),1)]),_:2},1032,["variant","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),t(F,null,{default:l(()=>[t(Vt,{"validate-on":"submit lazy",onSubmit:Ke(u=>Q(o),["prevent"])},{default:l(()=>[t(B,null,{default:l(()=>[t(R,{cols:"12"},{default:l(()=>[t(x,{modelValue:o.bidPrice,"onUpdate:modelValue":u=>o.bidPrice=u,label:"قیمت",type:"number","prepend-inner-icon":"tabler-coin",suffix:"تومان",rules:["requiredValidator"in r?r.requiredValidator:n(de)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(R,{cols:"12"},{default:l(()=>[t(x,{modelValue:o.bidQuantity,"onUpdate:modelValue":u=>o.bidQuantity=u,label:"تعداد",type:"number","prepend-inner-icon":"tabler-scale",suffix:o.tenderProduct.product.counting_unit.UntName,placeholder:`مقدار مورد نیاز: ${o.tenderProduct.quantityRequired}`,rules:["requiredValidator"in r?r.requiredValidator:n(de)]},null,8,["modelValue","onUpdate:modelValue","suffix","placeholder","rules"])]),_:2},1024),t(R,{cols:"12"},{default:l(()=>[t(S,{modelValue:o.bidDescription,"onUpdate:modelValue":u=>o.bidDescription=u,label:"توضیحات",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(R,{cols:"12"},{default:l(()=>[t(We,{type:"submit",loading:n(d).isSendTenderBidPending[o.id],disabled:!o.bidPrice||!o.bidQuantity},{default:l(()=>[t(Xe,{icon:"tabler-send"}),a[13]||(a[13]=f("ارسال ",-1))]),_:2},1032,["loading","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):K("",!0)],64)}}},Kt=Be(ht,[["__scopeId","data-v-15becc96"]]);export{Kt as default};
