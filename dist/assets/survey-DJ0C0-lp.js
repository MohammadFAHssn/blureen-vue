import{u as x}from"./useApi-_Ac5YbRv.js";import{c as b}from"./createUrl-KnNem5TG.js";import{$ as C}from"./api-C2gbrVEF.js";import{V as w}from"./VSnackbar-BrbKflsR.js";import{a as E,V as I}from"./VRow-2DGINcT-.js";import{V as B,b as M,c as $}from"./VCard-CGnFAbwV.js";import{bH as m,r as v,c,o as n,b as l,e as a,v as p,x as y,n as i,F as _,i as T,f as d,am as S}from"./index-BjMeilJt.js";import"./useLogout-CpIhXAAT.js";import"./VOverlay-DKwWkzvN.js";/* empty css              */import"./createSimpleFunctional-BN4KE2Gh.js";import"./VCardText-Dzp4rHEe.js";const A={key:0},F={key:1},K={__name:"survey",setup(L){const t=m({hasError:!1,errorMessage:""}),s=m({fetchSurveys:!1,participateInSurvey:!1}),f=v([]),u=v("");async function k(){s.fetchSurveys=!0;try{const{data:o,error:e}=await x(b("/survey/survey?filter[active]=1"));if(s.fetchSurveys=!1,e.value)throw e.value;f.value=o.value.data}catch(o){console.error("Error fetching surveys:",o),t.hasError=!0,t.errorMessage=o.message||"خطا در دریافت نظرسنجی‌ها"}}k();async function V(o){s.participateInSurvey=!0;try{const e=await C("/survey/survey/participate",{method:"POST",body:{porslineId:o},onResponseError({response:r}){s.participateInSurvey=!1,t.hasError=!0,t.errorMessage=r._data.message||"خطا در شرکت در نظرسنجی"}});s.participateInSurvey=!1,u.value=e.data}catch(e){console.error(e)}}function h(){window.open(u.value,"_blank","noopener,noreferrer")}return(o,e)=>(n(),c(_,null,[l(w,{modelValue:i(t).hasError,"onUpdate:modelValue":e[0]||(e[0]=r=>i(t).hasError=r),timeout:2e3,location:"center",variant:"outlined",color:"error"},{default:a(()=>[p(y(i(t).errorMessage),1)]),_:1},8,["modelValue"]),l(I,null,{default:a(()=>[(n(!0),c(_,null,T(i(f),r=>(n(),d(E,{key:r.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:a(()=>[l(B,null,{default:a(()=>[l(M,{class:"text-center mb-5 text-wrap"},{default:a(()=>[p(y(r.title),1)]),_:2},1024),l($,{class:"justify-center"},{default:a(()=>[i(u)?(n(),d(S,{key:0,variant:"elevated",color:"success",onClick:g=>h(r.porsline_id)},{default:a(()=>[...e[1]||(e[1]=[p(" شروع ",-1)])]),_:2},1032,["onClick"])):(n(),d(S,{key:1,variant:"elevated",disabled:i(s).participateInSurvey,onClick:g=>V(r.porsline_id)},{default:a(()=>[i(s).participateInSurvey?(n(),c("span",A,"در حال ساخت لینک")):(n(),c("span",F,"دریافت لینک نظرسنجی"))]),_:2},1032,["disabled","onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))}};export{K as default};
