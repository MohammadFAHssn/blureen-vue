import{_ as M}from"./AreYouSureDialog-CCOIcmER.js";import{$ as V}from"./api-B9aYCsOm.js";import{V as N}from"./VSnackbar-CyP0ExQa.js";import{V as k}from"./VCol-BtPIBuv3.js";import{V as p,b as A,c as O}from"./VCard-a6caRL8S.js";import{bx as D,r as y,bB as E,f,o as l,e as s,b as r,c as b,m as U,n as a,v as c,x,bC as F,F as L,i as P,d as R,b6 as $,am as I}from"./index-BRcc4XA0.js";import{V as z}from"./VContainer-CK1SzMCJ.js";import{V as J}from"./VRow-DuNPxdKR.js";import{V as q}from"./VAlert-7Z4EVuAa.js";import{V as H}from"./VDialog-D6lwnvbS.js";import{V as K}from"./VCardText-CK9ceg1n.js";import{V as Q}from"./VLayout-CSgv0s85.js";import"./index-CvOPxmL5.js";import"./useLogout-C-eg2eyz.js";import"./VOverlay-Cmb_ffnQ.js";/* empty css              */import"./createSimpleFunctional-BiP4K-1P.js";import"./dialog-transition-DnuBdUzz.js";const W={key:1,class:"flex-grow-1 overflow-y-auto pb-8"},X={key:0,class:"d-flex justify-center align-center h-100"},Y={class:"d-flex flex-column justify-center align-center flex-grow-1 pa-3"},pe={__name:"birthday-user",async setup(Z){let m,u;const C="https://blureen.afgc.ir/storage",i=D({hasError:!1,errorMessage:"",isBirthdayGiftChooseDialogVisible:!1,isImageDialogVisible:!1}),n=D({fetchingBirthdayGifts:!1,chooseBirthdayGift:!1}),g=y([]),d=y(null),_=y(null),v=y("");async function B(){var o;n.fetchingBirthdayGifts=!0;try{const t=await V("/birthday/gift/get-actives",{method:"GET"});g.value=((o=t==null?void 0:t.data)==null?void 0:o.birthdayGifts)||[]}catch(t){i.hasError=!0,i.errorMessage=t.message||"خطا در دریافت هدایا"}finally{n.fetchingBirthdayGifts=!1}}async function S(){var t;const o=(t=_.value)==null?void 0:t.id;if(o){n.chooseBirthdayGift=!0;try{await V("/birthday/user/choose/",{method:"POST",body:JSON.stringify({id:o}),onResponseError({response:e}){var h,w;i.hasError=!0,i.errorMessage=((h=e._data)==null?void 0:h.error)||Object.values(((w=e._data)==null?void 0:w.errors)||{}).flat().join(" | ")||"خطا در انتخاب هدیه"}})}catch(e){console.error(e)}finally{n.chooseBirthdayGift=!1,i.isBirthdayGiftChooseDialogVisible=!1,await B(),await G()}}}async function G(){try{const o=await V("/birthday/user/check",{method:"GET"});d.value=(o==null?void 0:o.data)??null}catch(o){i.hasError=!0,i.errorMessage=o.message||"خطا در بررسی دسترسی"}}function T(o){_.value=o,i.isBirthdayGiftChooseDialogVisible=!0}function j(o){v.value=`${C}/${o.image}`,i.isImageDialogVisible=!0}return[m,u]=E(()=>G()),await m,u(),d.value!==null&&([m,u]=E(()=>B()),await m,u()),(o,t)=>(l(),f(Q,{class:"pa-4 d-flex flex-column h-100"},{default:s(()=>[r(N,{modelValue:a(i).hasError,"onUpdate:modelValue":t[0]||(t[0]=e=>a(i).hasError=e),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:s(()=>[c(x(a(i).errorMessage),1)]),_:1},8,["modelValue"]),a(d)===null?(l(),f(k,{key:0},{default:s(()=>[r(p,{variant:"text"},{default:s(()=>[...t[4]||(t[4]=[c(" در حال حاضر شما اجازه مشاهده یا انتخاب هدیه را ندارید. ",-1)])]),_:1})]),_:1})):(l(),b("div",W,[a(n).fetchingBirthdayGifts?(l(),b("div",X,[r(F,{indeterminate:"",color:"primary",size:"64"})])):a(g).length?(l(),f(z,{key:1,fluid:""},{default:s(()=>[r(J,null,{default:s(()=>[(l(!0),b(L,null,P(a(g),e=>(l(),f(k,{key:e.id,cols:"12",sm:"6",md:"4",lg:"2",class:"d-flex"},{default:s(()=>[r(p,{class:"d-flex flex-column text-center",width:"100%"},{default:s(()=>[r($,{src:`${a(C)}/${e.image}`,cover:"",height:"200",class:"flex-sm-grow-0 flex-sm-shrink-0 cursor-pointer",width:"100%","min-width":"120",onClick:h=>j(e)},null,8,["src","onClick"]),R("div",Y,[r(A,{class:"text-center text-wrap mb-2"},{default:s(()=>[c(x(e.name),1)]),_:2},1024),r(I,{color:e.id===a(d)?"success":e.amount>0?"primary":"error",variant:"flat",disabled:e.amount<=0||e.id===a(d),class:"mb-2",onClick:h=>e.amount>0&&T(e)},{default:s(()=>[c(x(e.id===a(d)?"هدیه شما":e.amount>0?"انتخاب هدیه":"ناموجود"),1)]),_:2},1032,["color","disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(l(),f(q,{key:2,type:"info",variant:"tonal",class:"text-center mt-8"},{default:s(()=>[...t[5]||(t[5]=[c(" هیچ هدیه‌ای یافت نشد. ",-1)])]),_:1}))])),a(i).isBirthdayGiftChooseDialogVisible?(l(),f(M,{key:2,"is-dialog-visible":a(i).isBirthdayGiftChooseDialogVisible,"onUpdate:isDialogVisible":t[1]||(t[1]=e=>a(i).isBirthdayGiftChooseDialogVisible=e),title:"آیا از انتخاب این هدیه اطمینان دارید؟",loading:a(n).chooseBirthdayGift,onConfirm:S},null,8,["is-dialog-visible","loading"])):U("",!0),r(H,{modelValue:a(i).isImageDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>a(i).isImageDialogVisible=e),width:"500",transition:"dialog-bottom-transition"},{default:s(()=>[r(p,null,{default:s(()=>[r(K,{class:"text-center"},{default:s(()=>[r($,{src:a(v)},null,8,["src"])]),_:1}),r(O,{class:"justify-center"},{default:s(()=>[r(I,{onClick:t[2]||(t[2]=e=>a(i).isImageDialogVisible=!1)},{default:s(()=>[...t[6]||(t[6]=[c(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{pe as default};
