import{_ as N}from"./AreYouSureDialog-B9RWGnwS.js";import{$ as p}from"./api-DBPDguTV.js";import{M as T,bH as D,r as h,bI as x,f as w,o,e as r,b as l,c as n,m as E,n as i,v as _,x as V,bL as U,F as j,i as z,y as L,d as g,am as $}from"./index-DTc9oTBd.js";import{V as O}from"./VSnackbar-DlA8AIe3.js";import{V as A}from"./VDialog-kz7CdGUf.js";import{V as F,c as P}from"./VCard-DDZkIN-W.js";import{V as H}from"./VCardText-CKjhCyJ8.js";import{V as J}from"./VLayout-9TIO3TFA.js";import"./useLogout-CmanHLvZ.js";import"./VOverlay-DVMXWeF1.js";import"./dialog-transition-DtBUAAt7.js";import"./createSimpleFunctional-BKtNzXxU.js";const R={key:0,class:"no-access-message"},q={key:1,class:"gift-grid-container"},K={key:0,class:"loading-container"},Q={key:1,class:"gift-grid"},W=["src","onClick"],X={class:"gift-info"},Y={class:"gift-name"},Z={key:0,style:{color:"#5abe5f","font-size":"0.9rem","margin-top":"0.5rem"}},ee={key:2,class:"text-center"},te=["src"],ae={__name:"birthday-user",async setup(ie){let c,f;const b="http://172.16.20.20:8000/storage/",a=D({hasError:!1,errorMessage:"",isBirthdayGiftChooseDialogVisible:!1,isImageDialogVisible:!1}),d=D({fetchingBirthdayGifts:!1,chooseBirthdayGift:!1}),y=h([]),m=h(null),v=h(null),C=h("");async function B(){var s;d.fetchingBirthdayGifts=!0;try{const t=await p("/birthday/gift/get-actives",{method:"GET"});y.value=((s=t==null?void 0:t.data)==null?void 0:s.birthdayGifts)||[]}catch(t){a.hasError=!0,a.errorMessage=t.message||"خطا در دریافت هدایا"}finally{d.fetchingBirthdayGifts=!1}}async function I(){var t;const s=(t=v.value)==null?void 0:t.id;if(s){d.chooseBirthdayGift=!0;try{await p("/birthday/user/choose/",{method:"POST",body:JSON.stringify({id:s}),onResponseError({response:e}){var u,k;a.hasError=!0,a.errorMessage=((u=e._data)==null?void 0:u.error)||Object.values(((k=e._data)==null?void 0:k.errors)||{}).flat().join(" | ")||"خطا در انتخاب هدیه"}})}catch(e){console.error(e)}finally{d.chooseBirthdayGift=!1,a.isBirthdayGiftChooseDialogVisible=!1,await B(),await G()}}}async function G(){try{const s=await p("/birthday/user/check",{method:"GET"});m.value=(s==null?void 0:s.data)??null}catch(s){a.hasError=!0,a.errorMessage=s.message||"خطا در بررسی دسترسی"}}function S(s){v.value=s,a.isBirthdayGiftChooseDialogVisible=!0}function M(s){C.value=`${b}/${s.image}`,a.isImageDialogVisible=!0}return[c,f]=x(()=>B()),await c,f(),[c,f]=x(()=>G()),await c,f(),(s,t)=>(o(),w(J,{class:"app-layout pa-4"},{default:r(()=>[l(O,{modelValue:i(a).hasError,"onUpdate:modelValue":t[0]||(t[0]=e=>i(a).hasError=e),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:r(()=>[_(V(i(a).errorMessage),1)]),_:1},8,["modelValue"]),i(m)===null?(o(),n("div",R," در حال حاضر شما اجازه مشاهده یا انتخاب هدیه را ندارید. ")):(o(),n("div",q,[i(d).fetchingBirthdayGifts?(o(),n("div",K,[l(U,{indeterminate:"",color:"primary",size:"64"})])):i(y).length?(o(),n("div",Q,[(o(!0),n(j,null,z(i(y),e=>(o(),n("div",{key:e.id,class:L(["gift-card",{"selected-gift":i(m)===e.id}])},[g("img",{src:`${i(b)}/${e.image}`,alt:"gift image",class:"gift-image",onClick:u=>M(e)},null,8,W),g("div",X,[g("p",Y,V(e.name),1)]),l($,{color:e.amount>0?"primary":"error",variant:"flat",disabled:e.amount<=0,onClick:u=>e.amount>0&&S(e)},{default:r(()=>[_(V(e.amount>0?"انتخاب هدیه":"ناموجود"),1)]),_:2},1032,["color","disabled","onClick"]),i(m)===e.id?(o(),n("span",Z," هدیه شما ")):E("",!0)],2))),128))])):(o(),n("p",ee," هیچ هدیه‌ای یافت نشد. "))])),i(a).isBirthdayGiftChooseDialogVisible?(o(),w(N,{key:2,"is-dialog-visible":i(a).isBirthdayGiftChooseDialogVisible,"onUpdate:isDialogVisible":t[1]||(t[1]=e=>i(a).isBirthdayGiftChooseDialogVisible=e),title:"آیا از انتخاب این هدیه اطمینان دارید؟",loading:i(d).chooseBirthdayGift,onConfirm:I},null,8,["is-dialog-visible","loading"])):E("",!0),l(A,{modelValue:i(a).isImageDialogVisible,"onUpdate:modelValue":t[3]||(t[3]=e=>i(a).isImageDialogVisible=e),width:"500",transition:"dialog-bottom-transition"},{default:r(()=>[l(F,null,{default:r(()=>[l(H,{class:"text-center"},{default:r(()=>[g("img",{src:i(C),alt:"gift preview",style:{"max-width":"100%","max-height":"70vh","border-radius":"8px"}},null,8,te)]),_:1}),l(P,{class:"justify-center"},{default:r(()=>[l($,{color:"primary",variant:"tonal",onClick:t[2]||(t[2]=e=>i(a).isImageDialogVisible=!1)},{default:r(()=>[...t[4]||(t[4]=[_(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ye=T(ae,[["__scopeId","data-v-d1f01202"]]);export{ye as default};
