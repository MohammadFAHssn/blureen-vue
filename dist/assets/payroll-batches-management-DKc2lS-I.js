import{V as ee,a as Re,b as xe,c as Ae}from"./VCard-DRrxs1yK.js";import{f as _,o as R,e as f,b as s,d as D,x as ae,al as S,v as x,au as te,a5 as le,ak as $e,aC as oe,bF as ie,Y as h,bG as L,r as V,Z as Y,a6 as ne,w as Ee,aa as re,bc as ze,F as T,s as z,y as se,a2 as Me,at as Ne,bH as Te,U as je,a as ue,bw as Ye,bq as J,n as v,a9 as Ge,a_ as Ue,b4 as qe,a$ as Oe,K as He,L as Le,bE as Je,J as Ke,bC as Ze,aS as Xe,b6 as Qe,bx as We,bI as ea,M as aa,bJ as K,bK as Z,m as X,bL as ta}from"./index-DCB_bfED.js";import{V as de}from"./VDialog-BxytcgLd.js";import{r as la}from"./validators-CT5dUf4l.js";import{_ as oa}from"./DialogCloseBtn-iCV6H8H_.js";import{V as ia}from"./VCardText-CkMpDJXe.js";import{V as na}from"./VForm-D-AmFgMY.js";import{V as ra,a as j}from"./VRow-BNqkKfJI.js";import{V as G,m as sa}from"./VInput-BLoGNLgN.js";import{V as Q,m as ua}from"./VField-C1oxvExB.js";import{u as da}from"./form-DqXAVUfE.js";import{f as ca}from"./VOverlay-BEXuEyWe.js";import{V as fa}from"./VCounter-CWlhzDgT.js";import{u as ma,V as pa}from"./VLayout-Be6sLA0C.js";import{u as va}from"./useApi-lDR9a_oa.js";import{c as ya}from"./createUrl-CuxlHcfy.js";import{$ as W}from"./api-CVtvh055.js";import{V as ga}from"./VSnackbar-4QlJyYAh.js";import"./createSimpleFunctional-Dli-MMR-.js";import"./dialog-transition-XxJTDxVB.js";import"./helpers-4BKJjDfb.js";/* empty css              */import"./VLabel-yRdgYaYv.js";import"./useLogout-awGQq6F9.js";const ba={class:"text-h6 mb-2 text-wrap"},ha={__name:"AreYouSureDialog",props:{isDialogVisible:{type:Boolean,required:!0},title:{type:String,required:!0},loading:{type:Boolean,required:!0}},emits:["update:isDialogVisible","confirm"],setup(e,{emit:l}){const u=e,c=l;function r(n){c("update:isDialogVisible",n)}return(n,i)=>(R(),_(de,{"model-value":u.isDialogVisible,width:n.$vuetify.display.smAndDown?"auto":400,"onUpdate:modelValue":r},{default:f(()=>[s(ee,null,{default:f(()=>[s(Re,{class:"text-center"},{default:f(()=>[s(xe,null,{default:f(()=>[D("h6",ba,ae(u.title),1)]),_:1})]),_:1}),s(Ae,{class:"justify-center"},{default:f(()=>[s(S,{loading:u.loading,color:"success",variant:"text",onClick:i[0]||(i[0]=d=>c("confirm"))},{default:f(()=>[...i[2]||(i[2]=[x(" بله ",-1)])]),_:1},8,["loading"]),s(S,{color:"secondary",variant:"text",onClick:i[1]||(i[1]=d=>n.$emit("update:isDialogVisible",!1))},{default:f(()=>[...i[3]||(i[3]=[x(" خیر ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value","width"]))}};function Va(){function e(u){var r,n;return[...((r=u.dataTransfer)==null?void 0:r.items)??[]].filter(i=>i.kind==="file").map(i=>i.webkitGetAsEntry()).filter(Boolean).length>0||[...((n=u.dataTransfer)==null?void 0:n.files)??[]].length>0}async function l(u){var n,i;const c=[],r=[...((n=u.dataTransfer)==null?void 0:n.items)??[]].filter(d=>d.kind==="file").map(d=>d.webkitGetAsEntry()).filter(Boolean);if(r.length)for(const d of r){const B=await ce(d,fe(".",d));c.push(...B.map(P=>P.file))}else c.push(...((i=u.dataTransfer)==null?void 0:i.files)??[]);return c}return{handleDrop:l,hasFilesOrFolders:e}}function ce(e){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((u,c)=>{e.isFile?e.file(n=>u([{file:n,path:l}]),c):e.isDirectory&&e.createReader().readEntries(async n=>{const i=[];for(const d of n)i.push(...await ce(d,fe(l,d)));u(i)})})}function fe(e,l){return l.isDirectory?`${e}/${l.name}`:e}const Da=le({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...sa({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>ie(e).every(l=>l!=null&&typeof l=="object")},...ua({clearable:!0})},"VFileInput"),Ba=te()({name:"VFileInput",inheritAttrs:!1,props:Da(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{attrs:u,emit:c,slots:r}=l;const{t:n}=$e(),i=oe(e,"modelValue",e.modelValue,t=>ie(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:d,focus:B,blur:P}=da(e),C=h(()=>typeof e.showSize!="boolean"?e.showSize:void 0),m=h(()=>(i.value??[]).reduce((t,p)=>{let{size:F=0}=p;return t+F},0)),w=h(()=>L(m.value,C.value)),o=h(()=>(i.value??[]).map(t=>{const{name:p="",size:F=0}=t;return e.showSize?`${p} (${L(F,C.value)})`:p})),a=h(()=>{var p;const t=((p=i.value)==null?void 0:p.length)??0;return e.showSize?n(e.counterSizeString,t,w.value):n(e.counterString,t)}),g=V(),b=V(),y=V(),A=Y(()=>d.value||e.active),U=h(()=>["plain","underlined"].includes(e.variant)),$=ne(!1),{handleDrop:me,hasFilesOrFolders:pe}=Va();function M(){var t;y.value!==document.activeElement&&((t=y.value)==null||t.focus()),d.value||B()}function ve(t){var p;(p=y.value)==null||p.click()}function ye(t){c("mousedown:control",t)}function ge(t){var p;(p=y.value)==null||p.click(),c("click:control",t)}function be(t){t.stopPropagation(),M(),Ne(()=>{i.value=[],Te(e["onClick:clear"],t)})}function he(t){t.preventDefault(),t.stopImmediatePropagation(),$.value=!0}function Ve(t){t.preventDefault(),$.value=!1}async function De(t){if(t.preventDefault(),t.stopImmediatePropagation(),$.value=!1,!y.value||!pe(t))return;const p=new DataTransfer;for(const F of await me(t))p.items.add(F);y.value.files=p.files,y.value.dispatchEvent(new Event("change",{bubbles:!0}))}return Ee(i,t=>{(!Array.isArray(t)||!t.length)&&y.value&&(y.value.value="")}),re(()=>{const t=!!(r.counter||e.counter),p=!!(t||r.details),[F,Be]=ze(u),{modelValue:Sa,...Pe}=G.filterProps(e),Ce={...Q.filterProps(e),"onClick:clear":be};return s(G,z({ref:g,modelValue:e.multiple?i.value:i.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":$.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":U.value},e.class],style:e.style,"onClick:prepend":ve},F,Pe,{centerAffix:!U.value,focused:d.value}),{...r,default:N=>{let{id:E,isDisabled:I,isDirty:q,isReadonly:O,isValid:ke,hasDetails:we}=N;return s(Q,z({ref:b,prependIcon:e.prependIcon,onMousedown:ye,onClick:ge,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Ce,{id:E.value,active:A.value||q.value,dirty:q.value||e.dirty,disabled:I.value,focused:d.value,details:we.value,error:ke.value===!1,onDragover:he,onDrop:De}),{...r,default:Fe=>{var H;let{props:{class:Se,...Ie}}=Fe;return D(T,null,[D("input",z({ref:y,type:"file",readonly:O.value,disabled:I.value,multiple:e.multiple,name:e.name,onClick:k=>{k.stopPropagation(),O.value&&k.preventDefault(),M()},onChange:k=>{if(!k.target)return;const _e=k.target;i.value=[..._e.files??[]]},onDragleave:Ve,onFocus:M,onBlur:P},Ie,Be),null),D("div",{class:se(Se)},[!!((H=i.value)!=null&&H.length)&&!e.hideInput&&(r.selection?r.selection({fileNames:o.value,totalBytes:m.value,totalBytesReadable:w.value}):e.chips?o.value.map(k=>s(Me,{key:k,size:"small",text:k},null)):o.value.join(", "))])])}})},details:p?N=>{var E,I;return D(T,null,[(E=r.details)==null?void 0:E.call(r,N),t&&D(T,null,[D("span",null,null),s(fa,{active:!!((I=i.value)!=null&&I.length),value:a.value,disabled:e.disabled},r.counter)])])}:void 0})}),ca({},g,b,y)}}),Pa={__name:"PayrollBatchCreateDialog",props:{isDialogVisible:{type:Boolean,required:!0},loading:{type:Boolean,required:!0}},emits:["submit","update:isDialogVisible"],setup(e,{emit:l}){const u=e,c=l,r=je("constants"),n=V(null),i=V(),d=V(null),B=[o=>{if(!o.length)return!0;const a=o[0].name.split(".").pop().toLowerCase();return a!=="xlsx"&&a!=="xls"?"لطفا یک فایل اکسل معتبر انتخاب کنید!":o[0].size>r.MAX_FILE_SIZE?"حجم فایل باید کمتر از 5 مگابایت باشد!":!0}],P=[()=>!!n.value||"لطفا دوره فیش را انتخاب کنید!"];function C(){var o;(o=i.value)==null||o.validate().then(({valid:a})=>{a&&c("submit",{payrollBatchDate:n.value,payrollBatchFile:d.value})})}function m(){c("update:isDialogVisible",!1)}function w(o){c("update:isDialogVisible",o)}return(o,a)=>{const g=oa,b=ue("PersianDatetimePicker");return R(),_(de,{width:o.$vuetify.display.smAndDown?"auto":900,"model-value":u.isDialogVisible,"onUpdate:modelValue":w},{default:f(()=>[s(g,{onClick:a[0]||(a[0]=y=>w(!1))}),s(ee,null,{default:f(()=>[s(ia,null,{default:f(()=>[a[6]||(a[6]=D("h4",{class:"text-h5 text-center mb-2"}," افزودن فیش حقوقی جدید ",-1)),s(na,{ref_key:"refVForm",ref:i,class:"mt-6","validate-on":"submit lazy",onSubmit:Ye(C,["prevent"])},{default:f(()=>[s(ra,null,{default:f(()=>[s(j,{cols:"12",md:"6"},{default:f(()=>[s(G,{rules:P,disabled:e.loading},{default:f(()=>[s(b,{modelValue:v(n),"onUpdate:modelValue":a[1]||(a[1]=y=>J(n)?n.value=y:null),disabled:e.loading,type:"year-month",simple:"",label:"دوره فیش"},null,8,["modelValue","disabled"])]),_:1},8,["disabled"])]),_:1}),s(j,{cols:"12",md:"6"},{default:f(()=>[s(Ba,{modelValue:v(d),"onUpdate:modelValue":a[2]||(a[2]=y=>J(d)?d.value=y:null),disabled:e.loading,label:"فایل اکسل",accept:".xlsx, .xls",rules:["requiredValidator"in o?o.requiredValidator:v(la),...B]},null,8,["modelValue","disabled","rules"])]),_:1}),s(j,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:f(()=>[s(S,{type:"submit",disabled:e.loading,loading:e.loading,onClick:a[3]||(a[3]=y=>{var A;return(A=v(i))==null?void 0:A.validate()})},{default:f(()=>[...a[4]||(a[4]=[x(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),s(S,{color:"secondary",variant:"tonal",onClick:m},{default:f(()=>[...a[5]||(a[5]=[x(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},Ca=le({app:Boolean,appear:Boolean,extended:Boolean,layout:Boolean,offset:Boolean,modelValue:{type:Boolean,default:!0},...We(ea({active:!0}),["location"]),...Qe(),...Xe(),...Ze({transition:"fab-transition"})},"VFab"),ka=te()({name:"VFab",props:Ca(),emits:{"update:modelValue":e=>!0},setup(e,l){let{slots:u}=l;const c=oe(e,"modelValue"),r=ne(56),n=V(),{resizeRef:i}=Ge(m=>{m.length&&(r.value=m[0].target.clientHeight)}),d=Y(()=>e.app||e.absolute),B=h(()=>{var m;return d.value?((m=e.location)==null?void 0:m.split(" ").shift())??"bottom":!1}),P=h(()=>{var m;return d.value?((m=e.location)==null?void 0:m.split(" ")[1])??"end":!1});Ue(()=>e.app,()=>{const m=qe({id:e.name,order:h(()=>parseInt(e.order,10)),position:B,layoutSize:h(()=>e.layout?r.value+24:0),elementSize:h(()=>r.value+24),active:h(()=>e.app&&c.value),absolute:Y(()=>e.absolute)});Oe(()=>{n.value=m.layoutItemStyles.value})});const C=V();return re(()=>{const m=S.filterProps(e);return D("div",{ref:C,class:se(["v-fab",{"v-fab--absolute":e.absolute,"v-fab--app":!!e.app,"v-fab--extended":e.extended,"v-fab--offset":e.offset,[`v-fab--${B.value}`]:d.value,[`v-fab--${P.value}`]:d.value},e.class]),style:Ke([e.app?{...n.value}:{height:e.absolute?"100%":"inherit"},e.style])},[D("div",{class:"v-fab__container"},[s(Je,{appear:e.appear,transition:e.transition},{default:()=>[He(s(S,z({ref:i},m,{active:void 0,location:void 0}),u),[[Le,e.active]])]})])])}),{}}}),wa={style:{"block-size":"100%"}},Fa={__name:"payroll-batches-management",setup(e){const l=K({hasError:!1,errorMessage:"",isPayrollBatchDeleteDialogVisible:!1}),u=K({createPayrollBatch:!1,fetchingPayrollBatches:!1,deletePayrollBatches:!1}),c=V([]),r=V([]),n=V(null),{theme:i}=ma();function d(o){n.value=o.api,n.value.setGridOption("loading",!0)}const B=V([{headerName:"ماه",field:"monthName"},{headerName:"سال",field:"year"},{headerName:"بارگذاری توسط",field:"uploadedBy"},{headerName:"تاریخ بارگذاری",field:"createdAt",valueFormatter:o=>Z(o.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"نام فایل بارگذاری شده",field:"fileName"},{headerName:"عملیات",field:"actions",cellRendererSelector:o=>({component:"Actions",params:{onDeleteClick:a=>{r.value=[a],l.isPayrollBatchDeleteDialogVisible=!0}}})}]),P=h(()=>{var o;return(o=c.value)==null?void 0:o.map(a=>({id:a.id,monthName:a.month_name,year:a.year,uploadedBy:`${a.uploaded_by.first_name} ${a.uploaded_by.last_name}`,createdAt:Z(a.created_at).format("jYYYY-jMM-jDD HH:mm:ss"),fileName:a.filename,actions:{deletable:!0}}))});async function C(){var o,a;u.fetchingPayrollBatches=!0,(o=n.value)==null||o.setGridOption("loading",!0);try{const{data:g,error:b}=await va(ya("/payroll/payroll-batch",{query:{"fields[uploaded_bies]":"id,first_name,last_name",include:"uploadedBy"}}));if(u.fetchingPayrollBatches=!1,(a=n.value)==null||a.setGridOption("loading",!1),b.value)throw b.value;c.value=g.value.data}catch(g){console.error("Error fetching payrollBatches:",g),l.hasError=!0,l.errorMessage=g.message||"خطا در دریافت فیش‌های حقوقی"}}C();async function m(o){const a=new FormData;a.append("month",Number(o.payrollBatchDate.split("/")[1])),a.append("year",Number(o.payrollBatchDate.split("/")[0])),a.append("file",o.payrollBatchFile),u.createPayrollBatch=!0;try{await W("/payroll/payroll-batch/create",{method:"POST",body:a,onResponseError({response:g}){l.hasError=!0,l.errorMessage=g._data.message||"خطا در ایجاد فیش حقوقی"}}),l.isPayrollBatchCreateDialogVisible=!1}catch(g){console.error(g)}finally{u.createPayrollBatch=!1,C()}}async function w(){u.deletePayrollBatches=!0;try{await W("/payroll/payroll-batch",{method:"DELETE",body:{ids:[r.value[0].data.id]},onResponseError({response:o}){u.deletePayrollBatches=!1,l.hasError=!0,l.errorMessage=o._data.message||"خطا در حذف فیش حقوقی"}}),u.deletePayrollBatches=!1,l.isPayrollBatchDeleteDialogVisible=!1,c.value=c.value.filter(o=>o.id!==r.value[0].data.id)}catch(o){console.error(o)}}return(o,a)=>{const g=ue("AgGridVue");return R(),_(pa,{class:"app-layout"},{default:f(()=>[s(ga,{modelValue:v(l).hasError,"onUpdate:modelValue":a[0]||(a[0]=b=>v(l).hasError=b),timeout:2e3,location:"center",variant:"outlined",color:"error"},{default:f(()=>[x(ae(v(l).errorMessage),1)]),_:1},8,["modelValue"]),D("section",wa,[s(g,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":v(B),"row-data":v(P),"enable-rtl":"","row-numbers":"",pagination:"",theme:v(i),onGridReady:d},null,8,["column-defs","row-data","theme"])]),v(l).isPayrollBatchCreateDialogVisible?(R(),_(Pa,{key:0,"is-dialog-visible":v(l).isPayrollBatchCreateDialogVisible,"onUpdate:isDialogVisible":a[1]||(a[1]=b=>v(l).isPayrollBatchCreateDialogVisible=b),loading:v(u).createPayrollBatch,onSubmit:m},null,8,["is-dialog-visible","loading"])):X("",!0),v(l).isPayrollBatchDeleteDialogVisible?(R(),_(ha,{key:1,"is-dialog-visible":v(l).isPayrollBatchDeleteDialogVisible,"onUpdate:isDialogVisible":a[2]||(a[2]=b=>v(l).isPayrollBatchDeleteDialogVisible=b),title:"آیا از حذف این فیش اطمینان دارید؟",loading:v(u).deletePayrollBatches,onConfirm:w},null,8,["is-dialog-visible","loading"])):X("",!0),s(ta,null,{default:f(()=>[s(ka,{app:"",icon:"tabler-plus",size:"x-large",onClick:a[3]||(a[3]=b=>v(l).isPayrollBatchCreateDialogVisible=!0)})]),_:1})]),_:1})}}},Wa=aa(Fa,[["__scopeId","data-v-8eda01aa"]]);export{Wa as default};
