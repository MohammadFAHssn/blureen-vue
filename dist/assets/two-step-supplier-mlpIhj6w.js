import{av as ee,a6 as te,aS as ae,aE as oe,aD as le,al as ne,Y as F,r as y,b4 as se,cQ as re,cR as ue,b5 as ie,w as P,b1 as de,Z as S,au as H,ab as ce,bJ as fe,d as i,J as pe,b as l,F as J,y as K,s as j,ci as me,cx as ve,aI as he,aZ as ge,cD as M,M as ye,bC as I,j as be,k as Ve,a as we,c as _e,o as xe,e as c,v as L,x as A,n as s,bq as q,O as $,I as z,bx as ke,am as Ce}from"./index-CTn1zpMl.js";import{V as N}from"./VNodeRenderer-CGnuqPSk.js";import{u as Se}from"./useAbility-Dd2meWiH.js";import{$ as Ie}from"./api-CIiSBdAt.js";import{V as Re}from"./VSnackbar-BIzAdlyD.js";import{a as Ae,b as De,V as Fe}from"./VCard-DXyMAqZ9.js";import{V as U}from"./VCardText-Bf9VcR3P.js";import{V as Be}from"./VForm-Cik7SX7A.js";import{V as Te,a as D}from"./VRow-CET45aX5.js";import{V as Pe,m as Ne}from"./VField-ByrHga6n.js";import{V as Oe}from"./VOverlay-D193HQRA.js";import"./useLogout-cMquD6Tt.js";import"./createSimpleFunctional-BLD9Lq1U.js";/* empty css              */const Ee=`<svg width="180" height="180" viewBox="0 0 181 181" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="1.30469" y="1.44312" width="178" height="178" rx="19" stroke="currentColor" stroke-opacity="0.16" stroke-width="2" stroke-dasharray="8 8" />\r
<rect x="22.8047" y="22.9431" width="135" height="135" rx="10" fill="currentColor" fill-opacity="0.08" />\r
</svg>\r
`,je=`<svg width="239" height="234" viewBox="0 0 239 234" fill="none" xmlns="http://www.w3.org/2000/svg">\r
<rect x="88.5605" y="0.700195" width="149" height="149" rx="19.5" stroke="currentColor" stroke-opacity="0.16" />\r
<rect x="0.621094" y="33.761" width="200" height="200" rx="10" fill="currentColor" fill-opacity="0.08" />\r
</svg>\r
`,Me=te({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...ge(),...he(),...ve(Ne({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Le=ee()({name:"VOtpInput",props:Me(),emits:{finish:t=>!0,"update:focused":t=>!0,"update:modelValue":t=>!0},setup(t,_){let{attrs:b,emit:B,slots:m}=_;const{dimensionStyles:V}=ae(t),{isFocused:x,focus:k,blur:C}=oe(t),f=le(t,"modelValue","",e=>e==null?[]:String(e).split(""),e=>e.join("")),{t:R}=ne(),h=F(()=>Number(t.length)),d=F(()=>Array(h.value).fill(0)),a=y(-1),v=y(),u=y([]),w=F(()=>u.value[a.value]);let T=!1;se(()=>t.autofocus,()=>{const e=re();e.run(()=>{const{intersectionRef:o,isIntersecting:r}=ue();ie(()=>{o.value=u.value[0]}),P(r,p=>{var n;p&&((n=o.value)==null||n.focus(),e.stop())})})});function O(){if(E(w.value.value)){w.value.value="";return}if(T)return;const e=f.value.slice(),o=w.value.value;e[a.value]=o;let r=null;a.value>f.value.length?r=f.value.length+1:a.value+1!==h.value&&(r="next"),f.value=e,r&&M(v.value,r)}function Z(){T=!1,O()}function Q(e){const o=f.value.slice(),r=a.value;let p=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(e.key)&&(e.preventDefault(),e.key==="ArrowLeft"?p="prev":e.key==="ArrowRight"?p="next":["Backspace","Delete"].includes(e.key)&&(o[a.value]="",f.value=o,a.value>0&&e.key==="Backspace"?p="prev":requestAnimationFrame(()=>{var n;(n=u.value[r])==null||n.select()})),requestAnimationFrame(()=>{p!=null&&M(v.value,p)}))}function Y(e,o){var n,g;o.preventDefault(),o.stopPropagation();const r=((n=o==null?void 0:o.clipboardData)==null?void 0:n.getData("Text").trim().slice(0,h.value))??"",p=r.length-1===-1?e:r.length-1;E(r)||(f.value=r.split(""),(g=u.value)==null||g[p].focus())}function G(){f.value=[]}function W(e,o){k(),a.value=o}function X(){C(),a.value=-1}function E(e){return t.type==="number"&&/[^0-9]/g.test(e)}return de({VField:{color:S(()=>t.color),bgColor:S(()=>t.color),baseColor:S(()=>t.baseColor),disabled:S(()=>t.disabled),error:S(()=>t.error),variant:S(()=>t.variant)}},{scoped:!0}),P(f,e=>{e.length===h.value&&(a.value=h.value-1,B("finish",e.join("")))},{deep:!0}),P(a,e=>{e<0||H(()=>{var o;(o=u.value[e])==null||o.select()})}),ce(()=>{var r;const[e,o]=fe(b);return i("div",j({class:["v-otp-input",{"v-otp-input--divided":!!t.divider},t.class],style:[t.style]},e),[i("div",{ref:v,class:"v-otp-input__content",style:pe([V.value])},[d.value.map((p,n)=>i(J,null,[t.divider&&n!==0&&i("span",{class:"v-otp-input__divider"},[t.divider]),l(Pe,{focused:x.value&&t.focusAll||a.value===n,key:n},{...m,loader:void 0,default:()=>i("input",{ref:g=>u.value[n]=g,"aria-label":R(t.label,n+1),autofocus:n===0&&t.autofocus,autocomplete:"one-time-code",class:K(["v-otp-input__field"]),disabled:t.disabled,inputmode:t.type==="number"?"numeric":"text",min:t.type==="number"?0:void 0,maxlength:n===0?h.value:"1",placeholder:t.placeholder,type:t.type==="number"?"text":t.type,value:f.value[n],onInput:O,onFocus:g=>W(g,n),onBlur:X,onKeydown:Q,onCompositionstart:()=>T=!0,onCompositionend:Z,onPaste:g=>Y(n,g)},null)})])),i("input",j({class:"v-otp-input-input",type:"hidden"},o,{value:f.value.join("")}),null),l(Oe,{contained:!0,contentClass:"v-otp-input__loader",modelValue:!!t.loading,persistent:!0},{default:()=>{var p;return[((p=m.loader)==null?void 0:p.call(m))??l(me,{color:typeof t.loading=="boolean"?void 0:t.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(r=m.default)==null?void 0:r.call(m)])])}),{blur:()=>{var e;(e=u.value)==null||e.some(o=>o.blur())},focus:()=>{var e;(e=u.value)==null||e[0].focus()},reset:G,isFocused:x}}}),qe={class:"auth-wrapper d-flex align-center justify-center pa-4"},$e={class:"position-relative my-sm-16"},ze={class:"app-logo"},Ue={class:"app-logo-title"},He={class:"d-flex justify-center align-center flex-wrap"},Je={class:"me-1"},Ke=Object.assign({beforeRouteEnter(t,_,b){if(I("otpExpiresAt").value<Math.floor(Date.now()/1e3))return b({name:"login-supplier"});b()}},{__name:"two-step-supplier",setup(t){const _=be(),b=Ve(),B=Se(),m=y(""),V=y(!1),x=y({other:void 0}),k=y(!1),C=y(I("otpExpiresAt").value-Math.floor(Date.now()/1e3)),f=setInterval(()=>{C.value-=1,C.value<=0&&(clearInterval(f),C.value=0,b.replace("/login-supplier"))},1e3),R=F(()=>{const d=C.value,a=Math.floor(d%3600/60),v=d%60;return{minutes:a.toString().padStart(2,"0"),seconds:v.toString().padStart(2,"0")}});async function h(){V.value=!0;try{const d=await Ie("/verify-supplier-otp",{method:"POST",body:{mobileNumber:_.query.mobileNumber,otpCode:m.value},onResponseError({response:w}){V.value=!1,w._data.errors?x.value=w._data.errors:(x.value.other=w._data.message,k.value=!0)}}),{accessToken:a,userData:v,userAbilityRules:u}=d;I("userAbilityRules").value=u,B.update(u),I("userData").value=v,I("accessToken").value=a,await H(()=>{b.replace(_.query.to?String(_.query.to):"/")})}catch(d){console.error(d)}}return(d,a)=>{const v=we("RouterLink");return xe(),_e(J,null,[l(Re,{modelValue:s(k),"onUpdate:modelValue":a[0]||(a[0]=u=>q(k)?k.value=u:null),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:c(()=>[L(A(s(x).other),1)]),_:1},8,["modelValue"]),i("div",qe,[i("div",$e,[l(s(N),{nodes:("h"in d?d.h:s($))("div",{innerHTML:s(je)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),l(s(N),{nodes:("h"in d?d.h:s($))("div",{innerHTML:s(Ee)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),l(Fe,{class:K(["auth-card",d.$vuetify.display.smAndUp?"pa-6":"pa-0"]),"max-width":"460"},{default:c(()=>[l(Ae,{class:"justify-center"},{default:c(()=>[l(De,null,{default:c(()=>[l(v,{to:"/"},{default:c(()=>[i("div",ze,[l(s(N),{nodes:s(z).app.logo},null,8,["nodes"]),i("h1",Ue,A(s(z).app.title),1)])]),_:1})]),_:1})]),_:1}),l(U,null,{default:c(()=>[...a[2]||(a[2]=[i("h4",{class:"text-h4 mb-1"}," احراز هویت دو مرحله‌ای ",-1),i("p",{class:"mb-1"}," کد تأیید به تلفن همراه شما ارسال شد. لطفاً کد دریافتی را در کادر زیر وارد کنید ",-1)])]),_:1}),l(U,null,{default:c(()=>[l(Be,{onSubmit:ke(()=>{},["prevent"])},{default:c(()=>[l(Te,null,{default:c(()=>[l(D,{cols:"12"},{default:c(()=>[l(Le,{modelValue:s(m),"onUpdate:modelValue":a[1]||(a[1]=u=>q(m)?m.value=u:null),style:{direction:"ltr"},disabled:s(V),type:"number",class:"pa-0",onFinish:h},null,8,["modelValue","disabled"])]),_:1}),l(D,{cols:"12"},{default:c(()=>[l(Ce,{loading:s(V),disabled:s(V),block:"",type:"submit"},{default:c(()=>[...a[3]||(a[3]=[L(" تأیید ",-1)])]),_:1},8,["loading","disabled"])]),_:1}),l(D,null,{default:c(()=>[l(D,{cols:"12"},{default:c(()=>[i("div",He,[i("span",Je,A(s(R).minutes)+":"+A(s(R).seconds),1),a[4]||(a[4]=i("span",{class:"me-1"},"تا درخواست دوباره",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])],64)}}}),ut=ye(Ke,[["__scopeId","data-v-5ae98224"]]);export{ut as default};
