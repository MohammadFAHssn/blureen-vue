import{r as de}from"./validators-B6WRw6sG.js";import{an as we,a2 as Se,aw as Pe,Y as R,r as w,a3 as Te,aV as ke,G as Ie,w as O,aS as Ce,a7 as Fe,b6 as Re,b as t,q as ee,b2 as te,a5 as Me,a4 as Ue,F as M,J as ce,as as De,c2 as Ae,c3 as Ee,bK as fe,bL as $e,c as z,o as V,f as H,l as K,m as n,bM as Ne,h as oe,e as l,z as ze,bN as me,bO as pe,x as He,i as Oe,j as qe,c4 as ve,bY as Be,ax as Ge,t as f,v as y,d as Y,c5 as Le,bp as Qe,ah as je,$ as Ye}from"./index-CICszNDy.js";import{u as Je,V as ne}from"./form-DP4kTFIs.js";import{a as Ke}from"./VTextField-Di-aN2e7.js";import{f as We,m as Xe,V as Ze}from"./VField-Cg_ApCzd.js";import{V as Ve,m as et}from"./VInput-BQJkaL18.js";import{f as tt}from"./VOverlay-VIOFEwcR.js";import{I as at}from"./VImg-TV0XvCl7.js";import{_ as lt}from"./AppTextField-BtCWgZbn.js";import{$ as ot}from"./api-B2429s3R.js";import{u as nt}from"./useApi-DazJ7zrl.js";import{c as rt}from"./createUrl-DBdSN-1y.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as be}from"./VSnackbar-DfwYf6bB.js";import{V as C}from"./VCol-COW2noId.js";import{V as q}from"./VRow-43dtblY_.js";import{V as it,a as ut,b as dt,d as ct}from"./VList-TcnSw3ef.js";import{V as ae}from"./VChip-D3lJj4hY.js";import{V as ft}from"./VAvatar-BOZvtgvW.js";import{V as le,a as mt,b as pt}from"./VCard-X2fl1T8w.js";import{V as F}from"./VCardText-iTExjpbg.js";import{a as xe,V as J}from"./VRadioGroup-yOv8gyee.js";import{V as vt}from"./VDivider-CAFUm_wM.js";import{V as Vt}from"./VForm-BBV8S5de.js";import"./helpers-CUpzJZ2r.js";import"./index-9rIf2CJL.js";/* empty css              */import"./createSimpleFunctional-nQRmjaiY.js";import"./VSelectionControl-BAAbfv2n.js";const bt=Se({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...et(),...Xe()},"VTextarea"),xt=we()({name:"VTextarea",directives:{Intersect:at},inheritAttrs:!1,props:bt(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,I){let{attrs:_,emit:g,slots:c}=I;const u=Pe(e,"modelValue"),{isFocused:v,focus:U,blur:D}=Je(e),d=R(()=>typeof e.counterValue=="function"?e.counterValue(u.value):(u.value||"").toString().length),m=R(()=>{if(_.maxlength)return _.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function B(s,x){var p,h;!e.autofocus||!s||(h=(p=x[0].target)==null?void 0:p.focus)==null||h.call(p)}const G=w(),A=w(),L=Te(""),E=w(),S=R(()=>e.persistentPlaceholder||v.value||e.active);function r(){var s;E.value!==document.activeElement&&((s=E.value)==null||s.focus()),v.value||U()}function a(s){r(),g("click:control",s)}function b(s){g("mousedown:control",s)}function P(s){s.stopPropagation(),r(),te(()=>{u.value="",Ee(e["onClick:clear"],s)})}function o(s){var p;const x=s.target;if(u.value=x.value,(p=e.modelModifiers)!=null&&p.trim){const h=[x.selectionStart,x.selectionEnd];te(()=>{x.selectionStart=h[0],x.selectionEnd=h[1]})}}const i=w(),$=w(+e.rows),W=R(()=>["plain","underlined"].includes(e.variant));ke(()=>{e.autoGrow||($.value=+e.rows)});function N(){e.autoGrow&&te(()=>{if(!i.value||!A.value)return;const s=getComputedStyle(i.value),x=getComputedStyle(A.value.$el),p=parseFloat(s.getPropertyValue("--v-field-padding-top"))+parseFloat(s.getPropertyValue("--v-input-padding-top"))+parseFloat(s.getPropertyValue("--v-field-padding-bottom")),h=i.value.scrollHeight,Q=parseFloat(s.lineHeight),X=Math.max(parseFloat(e.rows)*Q+p,parseFloat(x.getPropertyValue("--v-input-control-height"))),Z=parseFloat(e.maxRows)*Q+p||1/0,k=Ue(h??0,X,Z);$.value=Math.floor((k-p)/Q),L.value=Me(k)})}Ie(N),O(u,N),O(()=>e.rows,N),O(()=>e.maxRows,N),O(()=>e.density,N);let T;return O(i,s=>{s?(T=new ResizeObserver(N),T.observe(i.value)):T==null||T.disconnect()}),Ce(()=>{T==null||T.disconnect()}),Fe(()=>{const s=!!(c.counter||e.counter||e.counterValue),x=!!(s||c.details),[p,h]=Re(_),{modelValue:Q,...X}=Ve.filterProps(e),Z=We(e);return t(Ve,ee({ref:G,modelValue:u.value,"onUpdate:modelValue":k=>u.value=k,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":W.value},e.class],style:e.style},p,X,{centerAffix:$.value===1&&!W.value,focused:v.value}),{...c,default:k=>{let{id:j,isDisabled:re,isDirty:se,isReadonly:ye,isValid:ge}=k;return t(Ze,ee({ref:A,style:{"--v-textarea-control-height":L.value},onClick:a,onMousedown:b,"onClick:clear":P,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Z,{id:j.value,active:S.value||se.value,centerAffix:$.value===1&&!W.value,dirty:se.value||e.dirty,disabled:re.value,focused:v.value,error:ge.value===!1}),{...c,default:_e=>{let{props:{class:ie,...ue}}=_e;return t(M,null,[e.prefix&&t("span",{class:"v-text-field__prefix"},[e.prefix]),ce(t("textarea",ee({ref:E,class:ie,value:u.value,onInput:o,autofocus:e.autofocus,readonly:ye.value,disabled:re.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:r,onBlur:D},ue,h),null),[[De("intersect"),{handler:B},null,{once:!0}]]),e.autoGrow&&ce(t("textarea",{class:[ie,"v-textarea__sizer"],id:`${ue.id}-sizer`,"onUpdate:modelValue":he=>u.value=he,ref:i,readonly:!0,"aria-hidden":"true"},null),[[Ae,u.value]]),e.suffix&&t("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:x?k=>{var j;return t(M,null,[(j=c.details)==null?void 0:j.call(c,k),s&&t(M,null,[t("span",null,null),t(Ke,{active:e.persistentCounter||v.value,value:d.value,max:m.value,disabled:e.disabled},c.counter)])])}:void 0})}),tt({},G,A,E)}}),yt=Object.assign({name:"AppTextarea",inheritAttrs:!1},{__name:"AppTextarea",setup(e){const I=R(()=>{const c=fe().id,u=$e();return c?`app-textarea-${c}`:u}),_=R(()=>fe().label);return(g,c)=>(V(),z("div",{class:He(["app-textarea flex-grow-1",g.$attrs.class])},[n(_)?(V(),H(ne,{key:0,for:n(I),class:"mb-1 text-body-2",text:n(_)},null,8,["for","text"])):K("",!0),t(xt,me(pe({...g.$attrs,class:null,label:void 0,variant:"outlined",id:n(I)})),Ne({_:2},[oe(g.$slots,(u,v)=>({name:v,fn:l(U=>[ze(g.$slots,v,me(pe(U||{})))])}))]),1040)],2))}}),gt={key:0,class:"layout-page-content"},_t={class:"text-wrap mb-2"},ht={class:"text-h6"},wt={__name:"[token]",async setup(e){let I,_;const g=Oe(),c=qe(),u=w(null),v=w(null),U=w([]),D=w(0),d=ve({hasError:!1,errorMessage:"",isSuccessful:!1,HaveTenderBidsBeenSent:[],isSendTenderBidPending:[]}),m=ve({paymentTerms:"cash",creditDescription:"",invoiceType:"taxInvoice"});let B=null;const G=()=>{D.value=Math.max(0,u.value.tenderExpiresAt-Math.floor(Date.now()/1e3)),B=setInterval(()=>{D.value--,D.value<=0&&c.replace({name:"login-supplier"})},1e3)},A=(r,a)=>a<=1?"#28a745":`hsl(${120-r/(a-1)*120}, 100%, 50%)`,L=async r=>{const{id:a,bidPrice:b,bidQuantity:P,bidDescription:o}=r;if(!(!b||!P)){d.isSendTenderBidPending[a]=!0;try{await ot("/commerce/tender/submit-bid",{method:"POST",body:{id:a,bid_price:b,bid_quantity:P,bid_description:o||"",payment_terms:m.paymentTerms,payment_terms_description:m.paymentTerms==="credit"?m.creditDescription:"",invoice_type:m.invoiceType},onResponseError({response:i}){d.hasError=!0,d.errorMessage=i._data.message||"خطا در ارسال پیشنهاد"}}),d.HaveTenderBidsBeenSent[a]=!0,d.isSuccessful=!0}catch(i){console.error(i)}finally{d.isSendTenderBidPending[a]=!1}}},E=async()=>{try{const{data:r,error:a}=await nt(rt("/commerce/tender/get-by-token?token="+g.params.token));if(a.value)throw a.value;u.value=r.value.data,v.value=r.value.data.supplier,U.value=r.value.data.tenderBids||[],G()}catch(r){d.hasError=!0,d.errorMessage=r.message||"خطا در دریافت اطلاعات مناقصه",setTimeout(()=>{c.replace({name:"login-supplier"})},2e3)}};[I,_]=Be(()=>E()),await I,_();const S=R(()=>{const r=D.value,a=Math.floor(r/86400),b=Math.floor(r%86400/3600),P=Math.floor(r%3600/60),o=r%60;return{days:a,hours:b.toString().padStart(2,"0"),minutes:P.toString().padStart(2,"0"),seconds:o.toString().padStart(2,"0")}});return Ge(()=>{clearInterval(B)}),(r,a)=>{const b=lt,P=yt;return V(),z(M,null,[t(be,{modelValue:n(d).hasError,"onUpdate:modelValue":a[0]||(a[0]=o=>n(d).hasError=o),timeout:"2000",location:"center",variant:"flat",color:"error"},{default:l(()=>[f(y(n(d).errorMessage)+"، در حال انتقال به پنل تأمین‌کننده ... ",1)]),_:1},8,["modelValue"]),t(be,{modelValue:n(d).isSuccessful,"onUpdate:modelValue":a[1]||(a[1]=o=>n(d).isSuccessful=o),timeout:"1500",location:"center",variant:"flat",color:"success"},{default:l(()=>a[5]||(a[5]=[f(" ارسال شد! ")])),_:1},8,["modelValue"]),n(u)?(V(),z("main",gt,[t(q,null,{default:l(()=>[t(C,null,{default:l(()=>[Y("div",_t,[a[6]||(a[6]=f(" مدیریت محترم شرکت/فروشگاه ")),Y("span",ht,y(n(v).name),1)]),a[7]||(a[7]=Y("div",{class:"text-body-1"}," لیست کالاهای مورد نیاز مجموعه کارخانجات شیشه اردکان به شرح زیر می‌باشد. ",-1)),a[8]||(a[8]=Y("div",{class:"text-body-1"}," لطفاً قیمت‌های پیشنهادی خود را ارائه دهید. ",-1))]),_:1})]),_:1}),t(q,null,{default:l(()=>[t(it,{style:{"background-color":"rgb(var(--v-theme-background))"}},{default:l(()=>[t(ut,null,{prepend:l(()=>[t(ft,{color:"warning",variant:"tonal",rounded:"",icon:"tabler-stopwatch"})]),default:l(()=>[t(dt,{class:"font-weight-medium"},{default:l(()=>a[9]||(a[9]=[f(" مدت زمان باقی‌مانده تا پایان مناقصه: ")])),_:1}),t(ct,{class:"text-body-1"},{default:l(()=>[n(S).days>0?(V(),H(ae,{key:0},{default:l(()=>[f(y(n(S).days)+" روز و "+y(n(S).hours)+" ساعت ",1)]),_:1})):(V(),H(ae,{key:1},{default:l(()=>[f(y(n(S).hours)+":"+y(n(S).minutes)+":"+y(n(S).seconds),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}),t(q,null,{default:l(()=>[t(C,{cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(F,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>a[10]||(a[10]=[f(" شرایط پرداخت ")])),_:1}),t(xe,{modelValue:n(m).paymentTerms,"onUpdate:modelValue":a[2]||(a[2]=o=>n(m).paymentTerms=o),inline:""},{default:l(()=>[t(J,{label:"نقدی",value:"cash"}),t(J,{label:"شرایطی",value:"credit"})]),_:1},8,["modelValue"]),n(m).paymentTerms==="credit"?(V(),H(b,{key:0,modelValue:n(m).creditDescription,"onUpdate:modelValue":a[3]||(a[3]=o=>n(m).creditDescription=o),type:"text",placeholder:"توضیحات"},null,8,["modelValue"])):K("",!0)]),_:1}),t(vt),t(F,{class:"custom-v-card-text"},{default:l(()=>[t(ne,{class:"mb-2"},{default:l(()=>a[11]||(a[11]=[f(" نوع فاکتور ")])),_:1}),t(xe,{modelValue:n(m).invoiceType,"onUpdate:modelValue":a[4]||(a[4]=o=>n(m).invoiceType=o),inline:""},{default:l(()=>[t(J,{label:"فاکتور رسمی",value:"taxInvoice"}),t(J,{label:"فاکتور فروشگاهی",value:"commercialInvoice"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(q,null,{default:l(()=>[t(Le,{group:""},{default:l(()=>[(V(!0),z(M,null,oe(n(U).filter(o=>!n(d).HaveTenderBidsBeenSent[o.id]),o=>(V(),H(C,{key:o.id,cols:"12",md:"6",lg:"4"},{default:l(()=>[t(le,null,{default:l(()=>[t(mt,null,{default:l(()=>[t(pt,{class:"custom-v-card-title"},{default:l(()=>[f(y(o.tenderProduct.product.name)+" ",1),o.tenderProduct.brand?(V(),z(M,{key:0},[f(" ("+y(o.tenderProduct.brand.name)+") ",1)],64)):K("",!0)]),_:2},1024)]),_:2},1024),t(F,null,{default:l(()=>[f(y(o.tenderProduct.purchaseExpertDescription),1)]),_:2},1024),t(F,null,{default:l(()=>[t(le,{variant:"outlined"},{default:l(()=>[t(F,null,{default:l(()=>a[12]||(a[12]=[f(" قیمت‌های پیشنهادی از سایر تأمین‌کنندگان (تومان): ")])),_:1}),t(F,{class:"d-flex flex-wrap gap-x-4 gap-y-2"},{default:l(()=>[(V(!0),z(M,null,oe(o.bidOfOtherSuppliers,(i,$)=>(V(),H(ae,{key:i.supplierId,variant:i.supplierId===n(v).id?"flat":"outlined",color:A($,o.bidOfOtherSuppliers.length)},{default:l(()=>[f(y(i.bidPrice),1)]),_:2},1032,["variant","color"]))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),t(F,null,{default:l(()=>[t(Vt,{"validate-on":"submit lazy",onSubmit:Qe(i=>L(o),["prevent"])},{default:l(()=>[t(q,null,{default:l(()=>[t(C,{cols:"12"},{default:l(()=>[t(b,{modelValue:o.bidPrice,"onUpdate:modelValue":i=>o.bidPrice=i,label:"قیمت",type:"number","prepend-inner-icon":"tabler-coin",suffix:"تومان",rules:["requiredValidator"in r?r.requiredValidator:n(de)]},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(C,{cols:"12"},{default:l(()=>[t(b,{modelValue:o.bidQuantity,"onUpdate:modelValue":i=>o.bidQuantity=i,label:"تعداد",type:"number","prepend-inner-icon":"tabler-scale",suffix:o.tenderProduct.product.counting_unit.UntName,placeholder:`مقدار مورد نیاز: ${o.tenderProduct.quantityRequired}`,rules:["requiredValidator"in r?r.requiredValidator:n(de)]},null,8,["modelValue","onUpdate:modelValue","suffix","placeholder","rules"])]),_:2},1024),t(C,{cols:"12"},{default:l(()=>[t(P,{modelValue:o.bidDescription,"onUpdate:modelValue":i=>o.bidDescription=i,label:"توضیحات",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(C,{cols:"12"},{default:l(()=>[t(je,{type:"submit",loading:n(d).isSendTenderBidPending[o.id],disabled:!o.bidPrice||!o.bidQuantity},{default:l(()=>[t(Ye,{icon:"tabler-send"}),a[13]||(a[13]=f("ارسال "))]),_:2},1032,["loading","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onSubmit"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):K("",!0)],64)}}},Zt=st(wt,[["__scopeId","data-v-d9213ae8"]]);export{Zt as default};
