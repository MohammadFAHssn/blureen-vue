import{ax as Ee,a6 as Le,al as _e,r as _,a7 as A,aA as Te,ct as Be,aF as H,bU as Ne,Y as C,aq as Ke,Z as Oe,w as T,aw as X,cu as Ue,ab as ze,b as f,d as D,a1 as ee,cv as $e,F as J,s as w,bB as qe,a2 as le,cw as He,J as Je,y as Ze,b3 as We,v as Ye,aJ as je,bg as Ge,cy as ae,aS as Qe,cZ as te}from"./index-Cs98bBAa.js";import{u as Xe,a as el,b as ll,m as al}from"./VSelect-ByWh6cKq.js";import{V as ue,m as tl}from"./VTextField-DMCAZL5S.js";import{u as ul,h as nl,m as ol}from"./filter-BLdPJHZ-.js";import{e as il,V as sl,a as ne,c as rl}from"./VList-BzdNhFNS.js";import{V as cl}from"./VMenu-Dok9ZRJ8.js";import{V as vl}from"./VDivider-B7kv0KrX.js";import{V as dl}from"./VCheckboxBtn-CO7hlbAT.js";const fl=Le({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...ol({filterKeys:["title"]}),...al(),...Ge(tl({modelValue:null,role:"combobox"}),["validationValue","dirty"])},"VAutocomplete"),Cl=Ee()({name:"VAutocomplete",props:fl(),emits:{"update:focused":l=>!0,"update:search":l=>!0,"update:modelValue":l=>!0,"update:menu":l=>!0},setup(l,oe){let{slots:t}=oe;const{t:ie}=_e(),g=_(),k=A(!1),V=A(!0),B=A(!1),Z=_(),N=_(),s=A(-1),I=A(null),{items:K,transformIn:se,transformOut:re}=il(l),{textColorClasses:ce,textColorStyles:ve}=Te(()=>{var e;return(e=g.value)==null?void 0:e.color}),{InputIcon:de}=Be(l),r=H(l,"search",""),u=H(l,"modelValue",[],e=>se(e===null?[null]:Ne(e)),e=>{const a=re(e);return l.multiple?a:a[0]??null}),fe=C(()=>typeof l.counterValue=="function"?l.counterValue(u.value):typeof l.counterValue=="number"?l.counterValue:u.value.length),F=Ke(l),{filteredItems:O,getMatches:me}=ul(l,K,()=>I.value??(V.value?"":r.value)),S=C(()=>l.hideSelected&&I.value===null?O.value.filter(e=>!u.value.some(a=>a.value===e.value)):O.value),W=Oe(()=>l.closableChips&&!F.isReadonly.value&&!F.isDisabled.value),M=C(()=>!!(l.chips||t.chip)),P=C(()=>M.value||!!t.selection),pe=C(()=>u.value.map(e=>e.props.value)),R=C(()=>S.value.find(e=>e.type==="item"&&!e.props.disabled)),U=C(()=>{var a;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&r.value===((a=R.value)==null?void 0:a.title))&&S.value.length>0&&!V.value&&!B.value}),E=C(()=>l.hideNoData&&!S.value.length||F.isReadonly.value||F.isDisabled.value),z=H(l,"menu"),c=C({get:()=>z.value,set:e=>{var a;z.value&&!e&&((a=Z.value)!=null&&a.Î¨openChildren.size)||e&&E.value||(z.value=e)}}),{menuId:he,ariaExpanded:ge,ariaControls:Ve}=Xe(l,c),$=_(),ye=el($,g);function be(e){l.openOnClear&&(c.value=!0),r.value=""}function ke(){E.value||(c.value=!0)}function Ce(e){E.value||(k.value&&(e.preventDefault(),e.stopPropagation()),c.value=!c.value)}function we(e){var a;(ae(e)||e.key==="Backspace")&&((a=g.value)==null||a.focus())}function Se(e){var v,p,o,m,y;if(F.isReadonly.value)return;const a=(v=g.value)==null?void 0:v.selectionStart,i=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(c.value=!0),["Escape"].includes(e.key)&&(c.value=!1),U.value&&["Enter","Tab"].includes(e.key)&&R.value&&!u.value.some(d=>{let{value:n}=d;return n===R.value.value})&&x(R.value),e.key==="ArrowDown"&&U.value&&((p=$.value)==null||p.focus("next")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&P.value&&u.value.length>0&&!r.value)return x(u.value[0],!1);if(~s.value){e.preventDefault();const d=s.value;x(u.value[s.value],!1),s.value=d>=i-1?i-2:d}else e.key==="Backspace"&&!r.value&&(s.value=i-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(s.value<0&&a&&a>0)return;const d=s.value>-1?s.value-1:i-1;if(u.value[d])s.value=d;else{const n=((o=r.value)==null?void 0:o.length)??null;s.value=-1,(m=g.value)==null||m.setSelectionRange(n,n)}}else if(e.key==="ArrowRight"){if(s.value<0)return;const d=s.value+1;u.value[d]?s.value=d:(s.value=-1,(y=g.value)==null||y.setSelectionRange(0,0))}else~s.value&&ae(e)&&(s.value=-1)}function xe(e){if(te(g.value,":autofill")||te(g.value,":-webkit-autofill")){const a=K.value.find(i=>i.title===e.target.value);a&&x(a)}}function Ie(){var e;l.eager&&((e=N.value)==null||e.calculateVisibleItems())}function Fe(){var e;k.value&&(V.value=!0,(e=g.value)==null||e.focus()),I.value=null}function Ae(e){k.value=!0,setTimeout(()=>{B.value=!0})}function De(e){B.value=!1}function Pe(e){(e==null||e===""&&!l.multiple&&!P.value)&&(u.value=[])}const q=A(!1);function x(e){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const i=u.value.findIndex(p=>(l.valueComparator||Qe)(p.value,e.value)),v=a??!~i;if(~i){const p=v?[...u.value,e]:[...u.value];p.splice(i,1),u.value=p}else v&&(u.value=[...u.value,e]);l.clearOnSelect&&(r.value="")}else{const i=a!==!1;u.value=i?[e]:[],I.value=V.value?"":r.value??"",r.value=i&&!P.value?e.title:"",X(()=>{c.value=!1,V.value=!0})}}return T(k,(e,a)=>{var i;e!==a&&(e?(q.value=!0,r.value=l.multiple||P.value?"":String(((i=u.value.at(-1))==null?void 0:i.props.title)??""),V.value=!0,X(()=>q.value=!1)):(!l.multiple&&r.value==null&&(u.value=[]),c.value=!1,!V.value&&r.value&&(I.value=r.value),r.value="",s.value=-1))}),T(r,e=>{!k.value||q.value||(e&&(c.value=!0),V.value=!e)}),T(c,e=>{if(!l.hideSelected&&e&&u.value.length&&V.value){const a=S.value.findIndex(i=>u.value.some(v=>i.value===v.value));Ue&&window.requestAnimationFrame(()=>{var i;a>=0&&((i=N.value)==null||i.scrollToIndex(a))})}e&&(I.value=null)}),T(K,(e,a)=>{c.value||k.value&&!a.length&&e.length&&(c.value=!0)}),ze(()=>{const e=!!(!l.hideNoData||S.value.length||t["prepend-item"]||t["append-item"]||t["no-data"]),a=u.value.length>0,i=ue.filterProps(l);return f(ue,w({ref:g},i,{modelValue:r.value,"onUpdate:modelValue":[v=>r.value=v,Pe],focused:k.value,"onUpdate:focused":v=>k.value=v,validationValue:u.externalValue,counterValue:fe.value,dirty:a,onChange:xe,class:["v-autocomplete",`v-autocomplete--${l.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":c.value,"v-autocomplete--chips":!!l.chips,"v-autocomplete--selection-slot":!!P.value,"v-autocomplete--selecting-index":s.value>-1},l.class],style:l.style,readonly:F.isReadonly.value,placeholder:a?void 0:l.placeholder,"onClick:clear":be,"onMousedown:control":ke,onKeydown:Se,"aria-expanded":ge.value,"aria-controls":Ve.value}),{...t,default:v=>{let{id:p}=v;return D(J,null,[f(cl,w({id:he.value,ref:Z,modelValue:c.value,"onUpdate:modelValue":o=>c.value=o,activator:"parent",contentClass:"v-autocomplete__content",disabled:E.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Ie,onAfterLeave:Fe},l.menuProps),{default:()=>[e&&f(sl,w({ref:$,filterable:!0,selected:pe.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:o=>o.preventDefault(),onKeydown:we,onFocusin:Ae,onFocusout:De,tabindex:"-1",selectable:!0,"aria-live":"polite","aria-labelledby":`${p.value}-label`,"aria-multiselectable":l.multiple,color:l.itemColor??l.color},ye,l.listProps),{default:()=>{var o,m,y;return[(o=t["prepend-item"])==null?void 0:o.call(t),!S.value.length&&!l.hideNoData&&(((m=t["no-data"])==null?void 0:m.call(t))??f(ne,{key:"no-data",title:ie(l.noDataText)},null)),f(ll,{ref:N,renderless:!0,items:S.value,itemKey:"value"},{default:d=>{var j,G,Q;let{item:n,index:b,itemRef:h}=d;const Y=w(n.props,{ref:h,key:n.value,active:U.value&&n===R.value?!0:void 0,onClick:()=>x(n,null),"aria-posinset":b+1,"aria-setsize":S.value.length});return n.type==="divider"?((j=t.divider)==null?void 0:j.call(t,{props:n.raw,index:b}))??f(vl,w(n.props,{key:`divider-${b}`}),null):n.type==="subheader"?((G=t.subheader)==null?void 0:G.call(t,{props:n.raw,index:b}))??f(rl,w(n.props,{key:`subheader-${b}`}),null):((Q=t.item)==null?void 0:Q.call(t,{item:n,index:b,props:Y}))??f(ne,w(Y,{role:"option"}),{prepend:L=>{let{isSelected:Re}=L;return D(J,null,[l.multiple&&!l.hideSelected?f(dl,{key:n.value,modelValue:Re,ripple:!1,tabindex:"-1","aria-hidden":!0,onClick:Me=>Me.preventDefault()},null):void 0,n.props.prependAvatar&&f(qe,{image:n.props.prependAvatar},null),n.props.prependIcon&&f(ee,{icon:n.props.prependIcon},null)])},title:()=>{var L;return V.value?n.title:nl("v-autocomplete",n.title,(L=me(n))==null?void 0:L.title)}})}}),(y=t["append-item"])==null?void 0:y.call(t)]}})]}),u.value.map((o,m)=>{function y(h){h.stopPropagation(),h.preventDefault(),x(o,!1)}const d=w(le.filterProps(o.props),{"onClick:close":y,onKeydown(h){h.key!=="Enter"&&h.key!==" "||(h.preventDefault(),h.stopPropagation(),y(h))},onMousedown(h){h.preventDefault(),h.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0}),n=M.value?!!t.chip:!!t.selection,b=n?He(M.value?t.chip({item:o,index:m,props:d}):t.selection({item:o,index:m})):void 0;if(!(n&&!b))return D("div",{key:o.value,class:Ze(["v-autocomplete__selection",m===s.value&&["v-autocomplete__selection--selected",ce.value]]),style:Je(m===s.value?ve.value:{})},[M.value?t.chip?f(We,{key:"chip-defaults",defaults:{VChip:{closable:W.value,size:"small",text:o.title}}},{default:()=>[b]}):f(le,w({key:"chip",closable:W.value,size:"small",text:o.title,disabled:o.props.disabled},d),null):b??D("span",{class:"v-autocomplete__selection-text"},[o.title,l.multiple&&m<u.value.length-1&&D("span",{class:"v-autocomplete__selection-comma"},[Ye(",")])])])})])},"append-inner":function(){var m,y;for(var v=arguments.length,p=new Array(v),o=0;o<v;o++)p[o]=arguments[o];return D(J,null,[(m=t["append-inner"])==null?void 0:m.call(t,...p),l.menuIcon?f(ee,{class:"v-autocomplete__menu-icon",color:(y=g.value)==null?void 0:y.fieldIconColor,icon:l.menuIcon,onMousedown:Ce,onClick:$e,"aria-hidden":!0,tabindex:"-1"},null):void 0,l.appendInnerIcon&&f(de,{key:"append-icon",name:"appendInner",color:p[0].iconColor.value},null)])}})}),je({isFocused:k,isPristine:V,menu:c,search:r,filteredItems:O,select:x},g)}});export{Cl as V};
