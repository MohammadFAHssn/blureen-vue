import{g as E,bN as F,M as J,bI as k,r as x,Y as O,H as M,a as N,c as D,o as d,b as t,e as a,aF as S,n as l,bq as Y,f as h,bK as j,be as H,v as C,x as q,am as U}from"./index-B_AKHj9V.js";import{$}from"./api-BnEhiIQQ.js";import{a as P,V as R}from"./VRow-CZCJls4y.js";import{V as y,b as z,c as A}from"./VCard-CkXbTLzc.js";import{V as T}from"./VCardText-D-nb_MHt.js";import{V as K}from"./VDialog-B2a8ffWH.js";import"./useLogout-BEP9g-oj.js";/* empty css              */import"./createSimpleFunctional-CQJZFYhB.js";import"./VOverlay-DvC-zOaM.js";import"./dialog-transition-gK_jCzDe.js";var G=F();const Q=E(G),W={class:"flex-grow-1 overflow-y-auto pb-8"},X={key:1},Z={__name:"health-certificate",setup(ee){const p=k({isImageDialogVisible:!1}),i=k({fetchingHealthCertificateImage:!1,downloadingHealthCertificate:!1}),b="https://blureen.afgc.ir/storage",f=x(""),s=x(""),g=O(()=>f.value);async function V(o=null){i.fetchingHealthCertificateImage=!0,s.value="";try{const e=await $("/hse/health-certificate/user/image",{params:{year:o}});s.value=e.data??e}catch(e){console.error(e),s.value=""}finally{i.fetchingHealthCertificateImage=!1}}async function B(){if(s.value){i.downloadingHealthCertificate=!0;try{const o=await $("/hse/health-certificate/user/image/download",{params:{year:g.value},responseType:"blob"}),e=o.data??o,r=o.headers??(o==null?void 0:o.headers)??{},n=r["content-type"]??r["Content-Type"]??"application/octet-stream",L=new Blob([e],{type:n}),v=URL.createObjectURL(L);let c=`health-certificate-${g.value||"latest"}.jpg`;const w=r["content-disposition"]??r["Content-Disposition"];if(w){const u=/filename\*?=(?:UTF-8'')?["']?([^;"']+)["']?/i.exec(w);if(u&&u[1])try{c=decodeURIComponent(u[1])}catch{c=u[1]}}if(!c||c==="")try{const _=new URL(s.value,window.location.origin).pathname.split("/"),I=_[_.length-1];I&&(c=I)}catch{console.error("error in filename")}const m=document.createElement("a");m.href=v,m.download=c,document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(v)}catch(o){console.error(o)}finally{i.downloadingHealthCertificate=!1}}}return M(async()=>{const o=new Date,e=Q.toJalaali(o.getFullYear(),o.getMonth()+1,o.getDate()).jy;f.value=e,await V(e)}),(o,e)=>{const r=N("PersianDatetimePicker");return d(),D("div",W,[t(R,{justify:"center"},{default:a(()=>[t(P,{cols:"12",sm:"6",md:"4"},{default:a(()=>[t(S,null,{default:a(()=>[t(r,{modelValue:l(f),"onUpdate:modelValue":e[0]||(e[0]=n=>Y(f)?f.value=n:null),type:"year",simple:"",label:"دوره",onChange:e[1]||(e[1]=()=>V(l(g)))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(R,{justify:"center"},{default:a(()=>[t(P,{cols:"12",sm:"6",md:"4"},{default:a(()=>[l(i).fetchingHealthCertificateImage?(d(),h(y,{key:0,class:"text-center"},{default:a(()=>[t(T,null,{default:a(()=>[t(j,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):l(s)?(d(),h(y,{key:1,class:"text-center"},{default:a(()=>[t(H,{src:`${l(b)}/${l(s)}`,cover:"",height:"100%",class:"cursor-pointer",onClick:e[2]||(e[2]=n=>l(p).isImageDialogVisible=!0)},null,8,["src"]),t(z,null,{default:a(()=>[C(q(l(g)),1)]),_:1}),t(U,{color:"primary",variant:"flat",class:"mb-2",disabled:l(i).fetchingHealthCertificateImage||l(i).downloadingHealthCertificate,onClick:B},{default:a(()=>[l(i).downloadingHealthCertificate?(d(),h(j,{key:0,indeterminate:"",size:"18"})):(d(),D("div",X," دانلود "))]),_:1},8,["disabled"])]),_:1})):(d(),h(y,{key:2,class:"text-center"},{default:a(()=>[...e[5]||(e[5]=[C(" تصویر در دسترس نیست ",-1)])]),_:1}))]),_:1})]),_:1}),t(K,{modelValue:l(p).isImageDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=n=>l(p).isImageDialogVisible=n),width:"1000"},{default:a(()=>[t(y,null,{default:a(()=>[t(T,{class:"text-center"},{default:a(()=>[t(H,{src:`${l(b)}/${l(s)}`},null,8,["src"])]),_:1}),t(A,{class:"justify-center"},{default:a(()=>[t(U,{onClick:e[3]||(e[3]=n=>l(p).isImageDialogVisible=!1)},{default:a(()=>[...e[6]||(e[6]=[C(" بستن ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},me=J(Z,[["__scopeId","data-v-f397e537"]]);export{me as default};
