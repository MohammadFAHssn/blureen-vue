import{_ as G}from"./AreYouSureDialog-Dk0bMC_x.js";import{r as E}from"./validators-DkGyzL9w.js";import{r as d,f as b,o as D,e as s,b as o,d as j,bC as I,n as r,bv as M,am as x,v as k,M as T,bL as A,bS as Y,a as U,m as R,x as $,bT as q}from"./index-Dm4B9_0-.js";import{_ as B}from"./AppTextField-clZV3tSp.js";import{_ as H}from"./DialogCloseBtn-vONhhOJj.js";import{V as O}from"./VCard-Dj7WXuw6.js";import{V as z}from"./VCardText-BSCPyE0Q.js";import{V as N}from"./VForm-DsfaYP_h.js";import{V as L}from"./VRow-C7TEFL9o.js";import{V as w}from"./VCol-CSnOMSHN.js";import{V as P}from"./VDialog-DsRrJxVq.js";import{u as K}from"./useAGGridTheme-PB2Em-c4.js";import{u as J}from"./useApi-D79UcwZL.js";import{c as Q}from"./createUrl-DdpnELgs.js";import{$ as h}from"./api-BIyuXVfG.js";import{V as W}from"./VSnackbar-BG1Ft9Sj.js";import{V as X}from"./VFab-DNhIVOS4.js";import{V as Z}from"./VLayout-BHxB6cW6.js";import"./helpers-4BKJjDfb.js";import"./VTextField-DCWJ1Wwu.js";import"./autofocus-Dx46V2Yr.js";import"./VCounter-ouqYFfls.js";import"./VField-BdXq9f4Z.js";import"./VOverlay-Cd68iWhq.js";import"./createSimpleFunctional-BFmVM770.js";/* empty css              */import"./dialog-transition-DS6mz8Nk.js";import"./useLogout-CaZQHfpA.js";const ee={__name:"SurveyCreateDialog",props:{isDialogVisible:{type:Boolean,required:!0},loading:{type:Boolean,required:!0}},emits:["submit","update:isDialogVisible"],setup(v,{emit:a}){const n=v,p=a,m=d(""),u=d(""),y=d();function S(){var l;(l=y.value)==null||l.validate().then(({valid:i})=>{i&&p("submit",{title:m.value,porslineId:u.value})})}function C(){p("update:isDialogVisible",!1)}function g(l){p("update:isDialogVisible",l)}return(l,i)=>{const _=H,V=B;return D(),b(P,{width:l.$vuetify.display.smAndDown?"auto":900,"model-value":n.isDialogVisible,"onUpdate:modelValue":g},{default:s(()=>[o(_,{onClick:i[0]||(i[0]=f=>g(!1))}),o(O,null,{default:s(()=>[o(z,null,{default:s(()=>[i[5]||(i[5]=j("h4",{class:"text-h5 text-center mb-2"}," افزودن نظرسنجی جدید ",-1)),o(N,{ref_key:"refVForm",ref:y,class:"mt-6","validate-on":"submit lazy",onSubmit:I(S,["prevent"])},{default:s(()=>[o(L,null,{default:s(()=>[o(w,{cols:"12",md:"6"},{default:s(()=>[o(V,{modelValue:r(m),"onUpdate:modelValue":i[1]||(i[1]=f=>M(m)?m.value=f:null),label:"عنوان نظرسنجی",rules:["requiredValidator"in l?l.requiredValidator:r(E)]},null,8,["modelValue","rules"])]),_:1}),o(w,{cols:"12",md:"6"},{default:s(()=>[o(V,{modelValue:r(u),"onUpdate:modelValue":i[2]||(i[2]=f=>M(u)?u.value=f:null),label:"شناسه نظرسنجی",rules:["requiredValidator"in l?l.requiredValidator:r(E)]},null,8,["modelValue","rules"])]),_:1}),o(w,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:s(()=>[o(x,{type:"submit",disabled:v.loading,loading:v.loading},{default:s(()=>[...i[3]||(i[3]=[k(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),o(x,{color:"secondary",variant:"tonal",onClick:C},{default:s(()=>[...i[4]||(i[4]=[k(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},te={style:{"block-size":"100%"}},ae={__name:"survey-management",setup(v){const a=A({hasError:!1,errorMessage:"",isSurveyDeleteDialogVisible:!1}),n=A({createSurvey:!1,fetchSurveys:!1,deleteSurveys:!1}),p=d([]),m=d([]),u=d(null),{theme:y}=K();function S(e){u.value=e.api,u.value.setGridOption("rowData",l())}const C=d(e=>String(e.data.id)),g=d([{headerName:"تاریخ ایجاد",field:"createdAt",valueFormatter:e=>Y(e.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"عنوان نظرسنجی",field:"title",editable:!0},{headerName:"شناسه نظرسنجی",field:"porslineId"},{headerName:"وضعیت",field:"active",cellRenderer:"Active",cellStyle:{display:"flex","align-items":"center"},filterParams:{valueFormatter:e=>e.value===1?"فعال":"غیرفعال"}},{headerName:"عملیات",field:"actions",cellRendererSelector:()=>({component:"Actions",params:{onEditClick:e=>{u.value.setGridOption("rowData",l()),u.value.setFocusedCell(e.rowIndex,"title"),setTimeout(()=>{u.value.startEditingCell({rowIndex:e.rowIndex,colKey:"title"})},10),e.setDataValue("actions",{...e.data.actions,editable:{...e.data.actions.editable,mode:"edit"}})},onSaveClick:e=>{f({id:e.data.id,title:e.data.title})},onCancelClick:()=>{u.value.setGridOption("rowData",l())},onDeleteClick:e=>{m.value=[e],a.isSurveyDeleteDialogVisible=!0},onActivityChange:(e,t)=>{f({id:e.data.id,active:t.target.checked})}}})}]);function l(){var e;return(e=p.value)==null?void 0:e.map(t=>({id:t.id,createdAt:Y(t.created_at).format("jYYYY-jMM-jDD HH:mm:ss"),title:t.title,porslineId:t.porsline_id,active:t.active,actions:{editable:{status:!0,mode:"view"},deletable:!0,activable:!0}}))}async function i(){n.fetchSurveys=!0;try{const{data:e,error:t}=await J(Q("/survey/survey"));if(n.fetchSurveys=!1,t.value)throw t.value;p.value=e.value.data,u.value.setGridOption("rowData",l())}catch(e){console.error("Error fetching surveys:",e),a.hasError=!0,a.errorMessage=e.message||"خطا در دریافت نظرسنجی‌ها"}}i();async function _(e){n.createSurvey=!0;try{await h("/survey/survey/create",{method:"POST",body:{title:e.title,porsline_id:e.porslineId},onResponseError({response:t}){a.hasError=!0,a.errorMessage=t._data.message||"خطا در ایجاد نظرسنجی"}}),a.isSurveyCreateDialogVisible=!1}catch(t){console.error(t)}finally{n.createSurvey=!1,i()}}async function V(){n.deleteSurveys=!0;try{await h("/survey/survey",{method:"DELETE",body:{ids:[m.value[0].data.id]},onResponseError({response:e}){n.deleteSurveys=!1,a.hasError=!0,a.errorMessage=e._data.message||"خطا در حذف نظرسنجی"}}),n.deleteSurveys=!1,a.isSurveyDeleteDialogVisible=!1,i()}catch(e){console.error(e)}}async function f(e){try{await h("/survey/survey/update",{method:"POST",body:{...e},onResponseError({response:t}){a.hasError=!0,a.errorMessage=t._data.message||"خطا در بروزرسانی نظرسنجی"}})}catch(t){console.error(t)}finally{i()}}return(e,t)=>{const F=U("AgGridVue");return D(),b(Z,{class:"app-layout"},{default:s(()=>[o(W,{modelValue:r(a).hasError,"onUpdate:modelValue":t[0]||(t[0]=c=>r(a).hasError=c),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:s(()=>[k($(r(a).errorMessage),1)]),_:1},8,["modelValue"]),j("section",te,[o(F,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":r(g),"get-row-id":r(C),"suppress-click-edit":!0,loading:r(n).fetchSurveys,"enable-rtl":"","row-numbers":"",pagination:"",theme:r(y),onGridReady:S},null,8,["column-defs","get-row-id","loading","theme"])]),r(a).isSurveyCreateDialogVisible?(D(),b(ee,{key:0,"is-dialog-visible":r(a).isSurveyCreateDialogVisible,"onUpdate:isDialogVisible":t[1]||(t[1]=c=>r(a).isSurveyCreateDialogVisible=c),loading:r(n).createSurvey,onSubmit:_},null,8,["is-dialog-visible","loading"])):R("",!0),r(a).isSurveyDeleteDialogVisible?(D(),b(G,{key:1,"is-dialog-visible":r(a).isSurveyDeleteDialogVisible,"onUpdate:isDialogVisible":t[2]||(t[2]=c=>r(a).isSurveyDeleteDialogVisible=c),title:"آیا از حذف این نظرسنجی اطمینان دارید؟",loading:r(n).deleteSurveys,onConfirm:V},null,8,["is-dialog-visible","loading"])):R("",!0),o(q,null,{default:s(()=>[o(X,{app:"",icon:"tabler-plus",size:"x-large",onClick:t[3]||(t[3]=c=>r(a).isSurveyCreateDialogVisible=!0)})]),_:1})]),_:1})}}},Ye=T(ae,[["__scopeId","data-v-b801b720"]]);export{Ye as default};
