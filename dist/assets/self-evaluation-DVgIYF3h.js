import{u as $}from"./useApi-C0U3KwO4.js";import{c as I}from"./createUrl-BQ_aSO3H.js";import{$ as J}from"./api-CRnz60WE.js";import{M as H,bJ as g,r as K,Y as x,bN as W,c as u,o as l,b as o,f as v,m as w,e as i,v as p,x as _,n as s,d as f,bO as j,F as V,i as k,y as X,a2 as Z,am as q}from"./index-Bvm1mU2Q.js";import{V as N}from"./VSnackbar-ChqeJZ8E.js";import{V as C}from"./VCol-VeZ2dyXK.js";import{V as E,b as ee}from"./VCard-DgLDzmB3.js";import{V as S}from"./VRow-yH5PVQoc.js";import{V as T}from"./VDivider-COLnkK8R.js";import{V as te}from"./VCardText-A2h27jHu.js";import{V as B}from"./VAlert-DVPKNrvN.js";import{V as ae}from"./VRating-WPn3_WON.js";import{a as se,V as re}from"./VRadioGroup-CTaa63OT.js";import{V as le}from"./VCheckbox-CHyo6Mkb.js";import{V as oe}from"./VTextarea-CTvrGhwY.js";import{V as ie}from"./VContainer-TAAszh-8.js";import"./useLogout-BQOYZFXX.js";import"./index-CvOPxmL5.js";import"./VOverlay-BPadrcFc.js";/* empty css              */import"./createSimpleFunctional-BZNIwSl2.js";import"./VCheckboxBtn-Cj-_HUQb.js";import"./autofocus-CLJDdjex.js";import"./VCounter-myTCGZzg.js";import"./VField-DEsQcr7P.js";const ne={class:"text-center"},de={key:0,class:"d-flex justify-center py-10"},ue={key:1,class:"text-center py-10 text-medium-emphasis"},ce={key:2},me={class:"d-flex align-center mb-4 flex-wrap gap-3"},fe={class:"d-flex align-center justify-space-between flex-wrap gap-3 mb-3"},pe={class:"text-body-1 font-weight-medium"},_e={key:0,class:"question-input d-flex align-center flex-wrap gap-4"},ye={key:1,class:"question-input"},ve={key:2,class:"question-input"},Ve={class:"d-flex flex-column gap-2"},he={key:3,class:"question-input"},be={key:4,class:"text-error text-caption mt-3 mb-0"},ge={class:"d-flex flex-wrap gap-4 align-center justify-space-between"},xe={class:"text-body-2 text-medium-emphasis"},we="سوالات عمومی",ke={__name:"self-evaluation",async setup(Ee){let A,M;const d=g({hasError:!1,errorMessage:"",hasSuccess:!1,successMessage:""}),y=g({fetchQuestions:!1,evaluate:!1}),h=g({submitted:!1}),m=K([]),n=g({}),F=x(()=>{const t=new Map;return m.value.forEach(e=>{var r;const a=((r=e==null?void 0:e.category)==null?void 0:r.name)||we;t.has(a)||t.set(a,[]),t.get(a).push(e)}),Array.from(t.entries()).map(([e,a])=>({name:e,questions:a}))}),U=x(()=>m.value.reduce((t,e)=>t+(b(e)?1:0),0)),Q=x(()=>m.value.length?Math.round(U.value/m.value.length*100):0),z=x(()=>m.value.length?m.value.every(t=>b(t)):!1);function O(t=[]){Object.keys(n).forEach(e=>{delete n[e]}),t.forEach(e=>{e.question_type_id===3?n[e.id]=[]:e.question_type_id===2||e.question_type_id===1?n[e.id]=null:n[e.id]=""})}function b(t){const e=n[t.id];switch(t.question_type_id){case 1:return typeof e=="number"&&e>=1&&e<=10;case 2:return typeof e=="number"&&e>0;case 3:return Array.isArray(e)&&e.length>0;default:return!!e}}function P(t){return h.submitted&&!b(t)}function G(){return m.value.map(t=>{const e={question_id:t.id,question_type_id:t.question_type_id},a=n[t.id];return t.question_type_id===1?e.score=a:t.question_type_id===2?e.option_id=a:t.question_type_id===3?e.option_ids=a:e.answer=a,e})}async function D(){if(h.submitted=!0,!z.value)return;const t={answers:G()};await L(t)&&(d.hasSuccess=!0,d.successMessage="خودارزیابی شما با موفقیت ثبت شد.",h.submitted=!1)}async function R(){var t;y.fetchQuestions=!0;try{const{data:e,error:a}=await $(I("/evaluation/evaluation-question/self-evaluation"));if(a.value)throw a.value;const r=((t=e.value)==null?void 0:t.data)||[];m.value=r,O(r)}catch(e){console.error("Error fetching questions:",e),d.hasError=!0,d.errorMessage=e.message||"خطا در دریافت سوالات خودارزیابی"}finally{y.fetchQuestions=!1}}async function L(t){y.evaluate=!0;let e=!1;try{return await J("/evaluation/self-evaluation/create",{method:"POST",body:t,onResponseError({response:a}){var r;e=!0,d.hasError=!0,d.errorMessage=((r=a==null?void 0:a._data)==null?void 0:r.message)||"خطا در ثبت خودارزیابی"}}),R(),!e}catch(a){return console.error(a),d.hasError=!0,d.errorMessage=(a==null?void 0:a.message)||"خطا در ثبت خودارزیابی",!1}finally{y.evaluate=!1}}return[A,M]=W(()=>R()),await A,M(),(t,e)=>(l(),u(V,null,[o(N,{modelValue:s(d).hasError,"onUpdate:modelValue":e[0]||(e[0]=a=>s(d).hasError=a),timeout:2500,location:"center",variant:"flat",color:"error"},{default:i(()=>[p(_(s(d).errorMessage),1)]),_:1},8,["modelValue"]),o(N,{modelValue:s(d).hasSuccess,"onUpdate:modelValue":e[1]||(e[1]=a=>s(d).hasSuccess=a),timeout:2500,location:"center",variant:"flat",color:"success"},{default:i(()=>[p(_(s(d).successMessage),1)]),_:1},8,["modelValue"]),s(m).length?s(m).length?(l(),v(ie,{key:1,class:"py-6"},{default:i(()=>[o(S,{justify:"center"},{default:i(()=>[o(C,{cols:"12",md:"11",lg:"10",xl:"8"},{default:i(()=>[o(E,{class:"elevation-2"},{default:i(()=>[o(ee,{class:"d-flex align-center justify-space-between flex-wrap gap-4"},{default:i(()=>[e[4]||(e[4]=f("div",null,[f("div",{class:"text-h6 font-weight-semibold mb-1"}," فرم خودارزیابی "),f("div",{class:"text-body-2 text-medium-emphasis text-wrap"}," لطفاً به تمام سوالات زیر با دقت و صداقت پاسخ دهید. ")],-1)),f("div",ne,[e[3]||(e[3]=f("div",{class:"text-caption text-medium-emphasis mb-1"}," درصد تکمیل ",-1)),o(j,{size:64,width:6,color:"primary","model-value":s(Q)},{default:i(()=>[p(_(s(Q))+"% ",1)]),_:1},8,["model-value"])])]),_:1}),o(T),o(te,null,{default:i(()=>[o(B,{type:"info",variant:"tonal",border:"start",class:"mb-6"},{default:i(()=>[...e[5]||(e[5]=[p(" پاسخ‌های شما فقط برای بهبود شرایط کاری و شناخت بهتر نیازهای کارکنان شرکت استفاده می‌شود. نمره کامل این بخش با تکمیل کامل فرم برای شما ثبت خواهد شد. تمامی نظرات شما محرمانه هستند و در اختیار سرشیفت، سرپرست یا مدیر قرار نخواهند گرفت. ",-1)])]),_:1}),s(y).fetchQuestions?(l(),u("div",de,[o(j,{color:"primary",indeterminate:"",size:"56"})])):s(m).length?(l(),u("div",ce,[(l(!0),u(V,null,k(s(F),a=>(l(),u("div",{key:a.name,class:"mb-8"},[f("div",me,[o(E,{class:"text-subtitle-1 font-weight-bold pa-2",color:"primary",variant:"tonal"},{default:i(()=>[p(_(a.name),1)]),_:2},1024),o(T,{class:"flex-grow-1"})]),o(S,null,{default:i(()=>[(l(!0),u(V,null,k(a.questions,r=>(l(),v(C,{key:r.id,cols:"12"},{default:i(()=>[o(E,{class:X(["mb-4 pa-4 question-card",{"border-success":b(r)}]),variant:"outlined"},{default:i(()=>[f("div",fe,[f("div",pe,_(r.question_text),1)]),r.question_type_id===1?(l(),u("div",_e,[o(ae,{modelValue:s(n)[r.id],"onUpdate:modelValue":c=>s(n)[r.id]=c,length:10,color:"amber","active-color":"amber",size:21,density:"comfortable",hover:""},null,8,["modelValue","onUpdate:modelValue"]),s(n)[r.id]?(l(),v(Z,{key:0,variant:"flat",color:"warning",size:"small"},{default:i(()=>[p(_(s(n)[r.id])+"/10 ",1)]),_:2},1024)):w("",!0)])):r.question_type_id===2?(l(),u("div",ye,[o(se,{modelValue:s(n)[r.id],"onUpdate:modelValue":c=>s(n)[r.id]=c,"hide-details":""},{default:i(()=>[(l(!0),u(V,null,k(r.options,c=>(l(),v(re,{key:c.id,label:c.option_title,value:c.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):r.question_type_id===3?(l(),u("div",ve,[f("div",Ve,[(l(!0),u(V,null,k(r.options,c=>(l(),v(le,{key:c.id,modelValue:s(n)[r.id],"onUpdate:modelValue":Y=>s(n)[r.id]=Y,label:c.option_title,value:c.id,"hide-details":""},null,8,["modelValue","onUpdate:modelValue","label","value"]))),128))])])):(l(),u("div",he,[o(oe,{modelValue:s(n)[r.id],"onUpdate:modelValue":c=>s(n)[r.id]=c,rows:"3","auto-grow":"","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),P(r)?(l(),u("p",be," لطفاً به این سوال پاسخ دهید. ")):w("",!0)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:2},1024)]))),128)),s(h).submitted&&!s(z)?(l(),v(B,{key:0,type:"error",variant:"tonal",border:"start",class:"mb-4"},{default:i(()=>[...e[6]||(e[6]=[p(" لطفاً قبل از ثبت، به تمام سوالات پاسخ دهید. ",-1)])]),_:1})):w("",!0),f("div",ge,[f("div",xe,_(s(U))+" از "+_(s(m).length)+" سوال پاسخ داده شده است. ",1),o(q,{color:"primary",size:"large",loading:s(y).evaluate,disabled:s(y).evaluate,onClick:D},{default:i(()=>[...e[7]||(e[7]=[p(" ثبت خودارزیابی ",-1)])]),_:1},8,["loading","disabled"])])])):(l(),u("div",ue," در حال حاضر سوالی برای پاسخگویی وجود ندارد. "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):w("",!0):(l(),v(S,{key:0},{default:i(()=>[o(C,null,{default:i(()=>[o(E,{variant:"text"},{default:i(()=>[...e[2]||(e[2]=[p(" ارزیابی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})]),_:1}))],64))}},Xe=H(ke,[["__scopeId","data-v-5a2b47f5"]]);export{Xe as default};
