import{aw as F,a6 as z,ab as J,b as t,d as _,J as L,y as j,aY as Y,ad as K,aA as ee,aT as ae,ay as te,aD as le,aS as se,ar as oe,a7 as ne,Y as O,b3 as ie,bi as re,b1 as I,a9 as D,bJ as ue,aX as de,au as ce,at as me,b0 as fe,M as ve,r as U,w as ge,f as q,o as V,e as l,am as P,a1 as be,v as x,x as y,c as T,F as N,i as $,n,m as X,bu as ye,bK as B,bL as Ve,H as he}from"./index-BvJigIpw.js";import{V as R,c as G,b as _e}from"./VCard-Cd7cW3W3.js";import{V as xe}from"./VCardText-nVdlyo38.js";import{V as pe}from"./VContainer-x87Ii06y.js";import{V as A}from"./VRow-BvKqyXVz.js";import{V as M}from"./VCol-CTdjSQ9l.js";import{V as Ee}from"./VRating-p6jWzavN.js";import{V as ke}from"./VDivider-DGUo17xS.js";import{V as W}from"./VDialog-BtfKObJO.js";import{u as H}from"./useApi-DbF863LE.js";import{c as Q}from"./createUrl-buDdObyr.js";import{$ as Ce}from"./api-Dw2OgN7d.js";import{V as Te}from"./VSnackbar-DkKbxq--.js";import{V as we}from"./VSpacer-DAXkQUYD.js";import"./createSimpleFunctional-D2thUb_F.js";/* empty css              */import"./VOverlay-B0GUTohQ.js";import"./dialog-transition-E-LjJdU_.js";import"./useLogout-D4XAr6IQ.js";const Se=z({text:String,...K(),...Y()},"VToolbarTitle"),Z=F()({name:"VToolbarTitle",props:Se(),setup(e,p){let{slots:a}=p;return J(()=>{const i=!!(a.default||a.text||e.text);return t(e.tag,{class:j(["v-toolbar-title",e.class]),style:L(e.style)},{default:()=>{var c;return[i&&_("div",{class:"v-toolbar-title__placeholder"},[a.text?a.text():e.text,(c=a.default)==null?void 0:c.call(a)])]}})}),{}}}),Be=[null,"prominent","default","comfortable","compact"],qe=z({absolute:Boolean,collapse:Boolean,collapsePosition:{type:String,default:"start"},color:String,density:{type:String,default:"default",validator:e=>Be.includes(e)},extended:{type:Boolean,default:null},extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...fe(),...K(),...me(),...ce(),...Y({tag:"header"}),...de()},"VToolbar"),Pe=F()({name:"VToolbar",props:qe(),setup(e,p){var b;let{slots:a}=p;const{backgroundColorClasses:i,backgroundColorStyles:c}=ee(()=>e.color),{borderClasses:v}=ae(e),{elevationClasses:k}=te(e),{roundedClasses:E}=le(e),{themeClasses:h}=se(e),{rtlClasses:u}=oe(),m=ne(e.extended===null?!!((b=a.extension)!=null&&b.call(a)):e.extended),d=O(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),g=O(()=>m.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return ie({VBtn:{variant:"text"}}),J(()=>{var s;const r=!!(e.title||a.title),o=!!(a.image||e.image),f=(s=a.extension)==null?void 0:s.call(a);return m.value=e.extended===null?!!f:e.extended,t(e.tag,{class:j(["v-toolbar",`v-toolbar--collapse-${e.collapsePosition}`,{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},i.value,v.value,k.value,E.value,h.value,u.value,e.class]),style:L([c.value,e.style])},{default:()=>[o&&_("div",{key:"image",class:"v-toolbar__image"},[a.image?t(I,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},a.image):t(re,{key:"image-img",cover:!0,src:e.image},null)]),t(I,{defaults:{VTabs:{height:D(d.value)}}},{default:()=>{var C,w,S;return[_("div",{class:"v-toolbar__content",style:{height:D(d.value)}},[a.prepend&&_("div",{class:"v-toolbar__prepend"},[(C=a.prepend)==null?void 0:C.call(a)]),r&&t(Z,{key:"title",text:e.title},{text:a.title}),(w=a.default)==null?void 0:w.call(a),a.append&&_("div",{class:"v-toolbar__append"},[(S=a.append)==null?void 0:S.call(a)])])]}}),t(I,{defaults:{VTabs:{height:D(g.value)}}},{default:()=>[t(ue,null,{default:()=>[m.value&&_("div",{class:"v-toolbar__extension",style:{height:D(g.value)}},[f])]})]})]})}),{contentHeight:d,extensionHeight:g}}}),Re={class:"text-h6 font-weight-bold mb-4 text-primary"},De={class:"text-body-1 mb-3"},Oe={class:"d-flex align-center justify-start"},Ne={key:0,class:"mr-3 text-body-2 font-weight-medium"},Me={__name:"EvaluationDialog",props:{modelValue:{type:Boolean,required:!0},evaluatee:{type:Object,required:!0},questions:{type:Array,required:!0},loading:{type:Boolean,default:!1},initialRatings:{type:Object,default:null}},emits:["update:modelValue","save"],setup(e,{emit:p}){const a=e,i=p,c=O({get:()=>a.modelValue,set:m=>i("update:modelValue",m)}),v=U({});function k(){const m={};a.questions&&a.questions.length>0&&a.questions.forEach(d=>{d.questions.forEach(g=>{var o;const b=g.id,r=((o=a.initialRatings)==null?void 0:o[b])??0;m[b]=r})}),v.value=m}ge([()=>a.questions,()=>a.initialRatings],()=>{k()},{immediate:!0});const E=O(()=>Object.values(v.value).every(m=>m>0));function h(){const m=[];Object.entries(v.value).forEach(([d,g])=>{m.push({evaluatee_id:a.evaluatee.id,question_id:Number(d),score:g})}),i("save",m)}function u(){k(),c.value=!1}return(m,d)=>(V(),q(W,{modelValue:n(c),"onUpdate:modelValue":d[0]||(d[0]=g=>ye(c)?c.value=g:null),fullscreen:"",scrim:!1,transition:"dialog-bottom-transition"},{default:l(()=>[t(R,null,{default:l(()=>[t(Pe,{color:"primary",dark:""},{default:l(()=>[t(P,{icon:"",dark:"",onClick:u},{default:l(()=>[t(be,null,{default:l(()=>[...d[1]||(d[1]=[x("mdi-close",-1)])]),_:1})]),_:1}),t(Z,null,{default:l(()=>[x(y(e.evaluatee.user.personnel_code)+" - "+y(e.evaluatee.user.first_name)+" "+y(e.evaluatee.user.last_name)+" ("+y(e.evaluatee.user.profile.cost_center.name)+") ",1)]),_:1})]),_:1}),t(xe,{class:"pa-6"},{default:l(()=>[t(pe,null,{default:l(()=>[t(A,null,{default:l(()=>[t(M,{cols:"12"},{default:l(()=>[(V(!0),T(N,null,$(e.questions,g=>(V(),T("div",{key:g.id,class:"mb-8"},[_("div",Re,y(g.name),1),t(A,null,{default:l(()=>[(V(!0),T(N,null,$(g.questions,b=>(V(),q(M,{key:b.id,cols:"12",md:"6"},{default:l(()=>[t(R,{variant:"outlined",class:j(["pa-4",{"border-success":n(v)[b.id]>0}])},{default:l(()=>[_("div",De,y(b.question_text),1),_("div",Oe,[t(Ee,{modelValue:n(v)[b.id],"onUpdate:modelValue":r=>n(v)[b.id]=r,length:10,color:"amber","active-color":"amber",size:23,hover:""},null,8,["modelValue","onUpdate:modelValue"]),n(v)[b.id]>0?(V(),T("span",Ne,y(n(v)[b.id])+"/10 ",1)):X("",!0)])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t(ke),t(G,{class:"pa-4 justify-end"},{default:l(()=>[t(P,{variant:"outlined",color:"error",disabled:e.loading,onClick:u},{default:l(()=>[...d[2]||(d[2]=[x(" انصراف ",-1)])]),_:1},8,["disabled"]),t(P,{variant:"elevated",color:"success",loading:e.loading,disabled:!n(E)||e.loading,onClick:h},{default:l(()=>[...d[3]||(d[3]=[x(" ذخیره ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},je=ve(Me,[["__scopeId","data-v-5ac0cccb"]]),la={__name:"peer-evaluation",async setup(e){let p,a;const i=B({hasError:!1,errorMessage:"",dialog:!1}),c=B({fetchEvaluatees:!1,fetchQuestions:!1,evaluate:!1}),v=U([]),k=U([]),E=B({}),h=B({}),u=B({isOpen:!1,selectedEvaluatee:null});async function m(){c.fetchEvaluatees=!0;try{const{data:r,error:o}=await H(Q("/evaluation/evaluatee/by-evaluator"));if(c.fetchEvaluatees=!1,o.value)throw o.value;v.value=r.value.data,v.value.forEach(f=>{f&&typeof f.id<"u"&&(Object.prototype.hasOwnProperty.call(f,"is_evaluated")?E[f.id]=!!f.is_evaluated:E[f.id]===void 0&&(E[f.id]=!1))})}catch(r){console.error("Error fetching evaluatees:",r),i.hasError=!0,i.errorMessage=r.message||"خطا در دریافت ارزیابی‌شونده‌ها"}}async function d(){c.fetchQuestions=!0;try{const{data:r,error:o}=await H(Q("/evaluation/evaluation-question/actives"));if(c.fetchQuestions=!1,o.value)throw o.value;k.value=r.value.data}catch(r){console.error("Error fetching questions:",r),i.hasError=!0,i.errorMessage=r.message||"خطا در دریافت سوالات ارزیابی"}}async function g(r){var o,f;c.evaluate=!0;try{let s=!1;if(await Ce("/evaluation/evaluation-score/create",{method:"POST",body:{results:r},onResponseError({response:C}){i.hasError=!0,i.errorMessage=C._data.message||"خطا در ارزیابی",s=!0}}),!s){if(((o=u.selectedEvaluatee)==null?void 0:o.id)!==void 0&&(E[u.selectedEvaluatee.id]=!0),((f=u.selectedEvaluatee)==null?void 0:f.id)!==void 0){const C=u.selectedEvaluatee.id,w={};r.forEach(S=>{w[S.question_id]=S.score}),h[C]=w}u.isOpen=!1,u.selectedEvaluatee=null}}catch(s){console.error(s),i.hasError=!0,i.errorMessage=(s==null?void 0:s.message)||"خطا در ارزیابی"}finally{c.evaluate=!1}}function b(r){u.selectedEvaluatee=r,u.isOpen=!0}return[p,a]=Ve(()=>m()),await p,a(),d(),he(()=>{i.dialog=!0}),(r,o)=>{var f;return V(),T(N,null,[t(Te,{modelValue:n(i).hasError,"onUpdate:modelValue":o[0]||(o[0]=s=>n(i).hasError=s),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:l(()=>[x(y(n(i).errorMessage),1)]),_:1},8,["modelValue"]),t(W,{modelValue:n(i).dialog,"onUpdate:modelValue":o[2]||(o[2]=s=>n(i).dialog=s),"max-width":"400",persistent:""},{default:l(()=>[t(R,{"prepend-icon":"mdi-map-marker",text:"در صورت خروج از صفحه، موارد ارزیابی‌شده ثبت نهایی شده و از لیست حذف می‌شوند!",title:"توجه"},{actions:l(()=>[t(we),t(P,{onClick:o[1]||(o[1]=s=>n(i).dialog=!1)},{default:l(()=>[...o[4]||(o[4]=[x(" باشه ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(u).selectedEvaluatee?(V(),q(je,{key:0,modelValue:n(u).isOpen,"onUpdate:modelValue":o[3]||(o[3]=s=>n(u).isOpen=s),evaluatee:n(u).selectedEvaluatee,questions:n(k),"initial-ratings":n(h)[(f=n(u).selectedEvaluatee)==null?void 0:f.id]||null,loading:n(c).evaluate,onSave:g},null,8,["modelValue","evaluatee","questions","initial-ratings","loading"])):X("",!0),t(A,null,{default:l(()=>[n(v).length===0?(V(),q(M,{key:0},{default:l(()=>[t(R,{variant:"text"},{default:l(()=>[...o[5]||(o[5]=[x(" ارزیابی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(V(!0),T(N,{key:1},$(n(v),s=>(V(),q(M,{key:s.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:l(()=>[t(R,{class:j({"border-success":!!n(h)[s.id]})},{default:l(()=>[t(_e,{class:"text-center mb-5 text-wrap"},{default:l(()=>[x(y(s.user.personnel_code)+" - "+y(s.user.first_name)+" "+y(s.user.last_name)+" ("+y(s.user.profile.cost_center.name)+") ",1)]),_:2},1024),t(G,{class:"justify-center"},{default:l(()=>[t(P,{variant:"elevated",color:n(h)[s.id]?"warning":"success",onClick:C=>b(s)},{default:l(()=>[x(y(n(h)[s.id]?"ویرایش ارزیابی":"شروع ارزیابی"),1)]),_:2},1032,["color","onClick"])]),_:2},1024)]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})],64)}}};export{la as default};
