import{_ as De,V as Be}from"./VFab-C6uOjiSE.js";import{r as Pe}from"./validators-CT5dUf4l.js";import{av as Ce,a6 as ke,al as we,aD as Fe,bH as W,aE as Ie,Y as w,bI as q,r as h,Z as Re,a7 as Se,w as _e,ab as Ae,bJ as Ee,aF as j,b as u,d as V,F as x,s as z,y as Me,a2 as Ne,aG as xe,aH as ze,au as $e,bK as je,U as Te,a as ee,f as A,o as E,e as y,bx as Ye,bq as O,n as c,am as L,v as T,M as Ue,bL as Z,bM as J,m as K,x as Ge,bN as He}from"./index-B2A7Sa9b.js";import{_ as qe}from"./DialogCloseBtn-lRN6XNlK.js";import{V as Oe}from"./VCard-Bsc_93cL.js";import{V as Le}from"./VCardText-DXKYBdeZ.js";import{V as Ze}from"./VForm-CQZ9q6K5.js";import{V as Je,a as $}from"./VRow-oFw-TnNH.js";import{V as X,m as Ke}from"./VField-B50gNKV5.js";import{V as Xe}from"./VCounter-TR6arsJv.js";import{V as Qe}from"./VDialog-jzGWIXGn.js";import{u as We,V as ea}from"./VLayout-B2PDuM3R.js";import{u as aa}from"./useApi-CR0_M8tr.js";import{c as la}from"./createUrl-3Fsu3BUH.js";import{$ as Q}from"./api-DF3aQ1IH.js";import{V as ta}from"./VSnackbar-D82GW9Nj.js";import"./helpers-4BKJjDfb.js";import"./createSimpleFunctional-CEOQY3Sn.js";/* empty css              */import"./VOverlay-Bn9aD4vk.js";import"./dialog-transition-Cq0iRQez.js";import"./useLogout-_1uCg_3h.js";function oa(){function e(i){var n,d;return[...((n=i.dataTransfer)==null?void 0:n.items)??[]].filter(r=>r.kind==="file").map(r=>r.webkitGetAsEntry()).filter(Boolean).length>0||[...((d=i.dataTransfer)==null?void 0:d.files)??[]].length>0}async function o(i){var d,r;const m=[],n=[...((d=i.dataTransfer)==null?void 0:d.items)??[]].filter(s=>s.kind==="file").map(s=>s.webkitGetAsEntry()).filter(Boolean);if(n.length)for(const s of n){const D=await ae(s,le(".",s));m.push(...D.map(B=>B.file))}else m.push(...((r=i.dataTransfer)==null?void 0:r.files)??[]);return m}return{handleDrop:o,hasFilesOrFolders:e}}function ae(e){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return new Promise((i,m)=>{e.isFile?e.file(d=>i([{file:d,path:o}]),m):e.isDirectory&&e.createReader().readEntries(async d=>{const r=[];for(const s of d)r.push(...await ae(s,le(o,s)));i(r)})})}function le(e,o){return o.isDirectory?`${e}/${o.name}`:e}const ra=ke({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...ze({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>W(e).every(o=>o!=null&&typeof o=="object")},...Ke({clearable:!0})},"VFileInput"),na=Ce()({name:"VFileInput",inheritAttrs:!1,props:ra(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,o){let{attrs:i,emit:m,slots:n}=o;const{t:d}=we(),r=Fe(e,"modelValue",e.modelValue,t=>W(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:s,focus:D,blur:B}=Ie(e),P=w(()=>typeof e.showSize!="boolean"?e.showSize:void 0),F=w(()=>(r.value??[]).reduce((t,f)=>{let{size:k=0}=f;return t+k},0)),C=w(()=>q(F.value,P.value)),l=w(()=>(r.value??[]).map(t=>{const{name:f="",size:k=0}=t;return e.showSize?`${f} (${q(k,P.value)})`:f})),a=w(()=>{var f;const t=((f=r.value)==null?void 0:f.length)??0;return e.showSize?d(e.counterSizeString,t,C.value):d(e.counterString,t)}),g=h(),v=h(),p=h(),R=Re(()=>s.value||e.active),Y=w(()=>["plain","underlined"].includes(e.variant)),S=Se(!1),{handleDrop:te,hasFilesOrFolders:oe}=oa();function M(){var t;p.value!==document.activeElement&&((t=p.value)==null||t.focus()),s.value||D()}function re(t){var f;(f=p.value)==null||f.click()}function ne(t){m("mousedown:control",t)}function ie(t){var f;(f=p.value)==null||f.click(),m("click:control",t)}function se(t){t.stopPropagation(),M(),$e(()=>{r.value=[],je(e["onClick:clear"],t)})}function ue(t){t.preventDefault(),t.stopImmediatePropagation(),S.value=!0}function de(t){t.preventDefault(),S.value=!1}async function ce(t){if(t.preventDefault(),t.stopImmediatePropagation(),S.value=!1,!p.value||!oe(t))return;const f=new DataTransfer;for(const k of await te(t))f.items.add(k);p.value.files=f.files,p.value.dispatchEvent(new Event("change",{bubbles:!0}))}return _e(r,t=>{(!Array.isArray(t)||!t.length)&&p.value&&(p.value.value="")}),Ae(()=>{const t=!!(n.counter||e.counter),f=!!(t||n.details),[k,fe]=Ee(i),{modelValue:da,...me}=j.filterProps(e),pe={...X.filterProps(e),"onClick:clear":se};return u(j,z({ref:g,modelValue:e.multiple?r.value:r.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":S.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":Y.value},e.class],style:e.style,"onClick:prepend":re},k,me,{centerAffix:!Y.value,focused:s.value}),{...n,default:N=>{let{id:_,isDisabled:I,isDirty:U,isReadonly:G,isValid:ye,hasDetails:ve}=N;return u(X,z({ref:v,prependIcon:e.prependIcon,onMousedown:ne,onClick:ie,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},pe,{id:_.value,active:R.value||U.value,dirty:U.value||e.dirty,disabled:I.value,focused:s.value,details:ve.value,error:ye.value===!1,onDragover:ue,onDrop:ce}),{...n,default:ge=>{var H;let{props:{class:he,...be}}=ge;return V(x,null,[V("input",z({ref:p,type:"file",readonly:G.value,disabled:I.value,multiple:e.multiple,name:e.name,onClick:b=>{b.stopPropagation(),G.value&&b.preventDefault(),M()},onChange:b=>{if(!b.target)return;const Ve=b.target;r.value=[...Ve.files??[]]},onDragleave:de,onFocus:M,onBlur:B},be,fe),null),V("div",{class:Me(he)},[!!((H=r.value)!=null&&H.length)&&!e.hideInput&&(n.selection?n.selection({fileNames:l.value,totalBytes:F.value,totalBytesReadable:C.value}):e.chips?l.value.map(b=>u(Ne,{key:b,size:"small",text:b},null)):l.value.join(", "))])])}})},details:f?N=>{var _,I;return V(x,null,[(_=n.details)==null?void 0:_.call(n,N),t&&V(x,null,[V("span",null,null),u(Xe,{active:!!((I=r.value)!=null&&I.length),value:a.value,disabled:e.disabled},n.counter)])])}:void 0})}),xe({},g,v,p)}}),ia={__name:"PayrollBatchCreateDialog",props:{isDialogVisible:{type:Boolean,required:!0},loading:{type:Boolean,required:!0}},emits:["submit","update:isDialogVisible"],setup(e,{emit:o}){const i=e,m=o,n=Te("constants"),d=h(null),r=h(),s=h(null),D=[l=>{if(!l.length)return!0;const a=l[0].name.split(".").pop().toLowerCase();return a!=="xlsx"&&a!=="xls"?"لطفا یک فایل اکسل معتبر انتخاب کنید!":l[0].size>n.MAX_FILE_SIZE?"حجم فایل باید کمتر از 5 مگابایت باشد!":!0}],B=[()=>!!d.value||"لطفا دوره فیش را انتخاب کنید!"];function P(){var l;(l=r.value)==null||l.validate().then(({valid:a})=>{a&&m("submit",{payrollBatchDate:d.value,payrollBatchFile:s.value})})}function F(){m("update:isDialogVisible",!1)}function C(l){m("update:isDialogVisible",l)}return(l,a)=>{const g=qe,v=ee("PersianDatetimePicker");return E(),A(Qe,{width:l.$vuetify.display.smAndDown?"auto":900,"model-value":i.isDialogVisible,"onUpdate:modelValue":C},{default:y(()=>[u(g,{onClick:a[0]||(a[0]=p=>C(!1))}),u(Oe,null,{default:y(()=>[u(Le,null,{default:y(()=>[a[6]||(a[6]=V("h4",{class:"text-h5 text-center mb-2"}," افزودن فیش حقوقی جدید ",-1)),u(Ze,{ref_key:"refVForm",ref:r,class:"mt-6","validate-on":"submit lazy",onSubmit:Ye(P,["prevent"])},{default:y(()=>[u(Je,null,{default:y(()=>[u($,{cols:"12",md:"6"},{default:y(()=>[u(j,{rules:B,disabled:e.loading},{default:y(()=>[u(v,{modelValue:c(d),"onUpdate:modelValue":a[1]||(a[1]=p=>O(d)?d.value=p:null),disabled:e.loading,type:"year-month",simple:"",label:"دوره فیش"},null,8,["modelValue","disabled"])]),_:1},8,["disabled"])]),_:1}),u($,{cols:"12",md:"6"},{default:y(()=>[u(na,{modelValue:c(s),"onUpdate:modelValue":a[2]||(a[2]=p=>O(s)?s.value=p:null),disabled:e.loading,label:"فایل اکسل",accept:".xlsx, .xls",rules:["requiredValidator"in l?l.requiredValidator:c(Pe),...D]},null,8,["modelValue","disabled","rules"])]),_:1}),u($,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:y(()=>[u(L,{type:"submit",disabled:e.loading,loading:e.loading,onClick:a[3]||(a[3]=p=>{var R;return(R=c(r))==null?void 0:R.validate()})},{default:y(()=>[...a[4]||(a[4]=[T(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),u(L,{color:"secondary",variant:"tonal",onClick:F},{default:y(()=>[...a[5]||(a[5]=[T(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},sa={style:{"block-size":"100%"}},ua={__name:"payroll-batches-management",setup(e){const o=Z({hasError:!1,errorMessage:"",isPayrollBatchDeleteDialogVisible:!1,isPayrollBatchCreateDialogVisible:!1}),i=Z({createPayrollBatch:!1,fetchingPayrollBatches:!1,deletePayrollBatches:!1}),m=h([]),n=h([]),d=h(null),{theme:r}=We();function s(l){d.value=l.api}const D=h([{headerName:"ماه",field:"monthName"},{headerName:"سال",field:"year"},{headerName:"بارگذاری توسط",field:"uploadedBy"},{headerName:"تاریخ بارگذاری",field:"createdAt",valueFormatter:l=>J(l.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"نام فایل بارگذاری شده",field:"fileName"},{headerName:"عملیات",field:"actions",cellRendererSelector:l=>({component:"Actions",params:{onDeleteClick:a=>{n.value=[a],o.isPayrollBatchDeleteDialogVisible=!0}}})}]),B=w(()=>{var l;return(l=m.value)==null?void 0:l.map(a=>({id:a.id,monthName:a.month_name,year:a.year,uploadedBy:`${a.uploaded_by.first_name} ${a.uploaded_by.last_name}`,createdAt:J(a.created_at).format("jYYYY-jMM-jDD HH:mm:ss"),fileName:a.filename,actions:{deletable:!0}}))});async function P(){i.fetchingPayrollBatches=!0;try{const{data:l,error:a}=await aa(la("/payroll/payroll-batch",{query:{"fields[uploaded_bies]":"id,first_name,last_name",include:"uploadedBy"}}));if(i.fetchingPayrollBatches=!1,a.value)throw a.value;m.value=l.value.data}catch(l){console.error("Error fetching payrollBatches:",l),o.hasError=!0,o.errorMessage=l.message||"خطا در دریافت فیش‌های حقوقی"}}P();async function F(l){const a=new FormData;a.append("month",Number(l.payrollBatchDate.split("/")[1])),a.append("year",Number(l.payrollBatchDate.split("/")[0])),a.append("file",l.payrollBatchFile),i.createPayrollBatch=!0;try{await Q("/payroll/payroll-batch/create",{method:"POST",body:a,onResponseError({response:g}){o.hasError=!0,o.errorMessage=g._data.message||"خطا در ایجاد فیش حقوقی"}}),o.isPayrollBatchCreateDialogVisible=!1}catch(g){console.error(g)}finally{i.createPayrollBatch=!1,P()}}async function C(){i.deletePayrollBatches=!0;try{await Q("/payroll/payroll-batch",{method:"DELETE",body:{ids:[n.value[0].data.id]},onResponseError({response:l}){i.deletePayrollBatches=!1,o.hasError=!0,o.errorMessage=l._data.message||"خطا در حذف فیش حقوقی"}}),i.deletePayrollBatches=!1,o.isPayrollBatchDeleteDialogVisible=!1,m.value=m.value.filter(l=>l.id!==n.value[0].data.id)}catch(l){console.error(l)}}return(l,a)=>{const g=ee("AgGridVue");return E(),A(ea,{class:"app-layout"},{default:y(()=>[u(ta,{modelValue:c(o).hasError,"onUpdate:modelValue":a[0]||(a[0]=v=>c(o).hasError=v),timeout:2e3,location:"center",variant:"outlined",color:"error"},{default:y(()=>[T(Ge(c(o).errorMessage),1)]),_:1},8,["modelValue"]),V("section",sa,[u(g,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":c(D),"row-data":c(B),loading:c(i).fetchingPayrollBatches,"enable-rtl":"","row-numbers":"",pagination:"",theme:c(r),onGridReady:s},null,8,["column-defs","row-data","loading","theme"])]),c(o).isPayrollBatchCreateDialogVisible?(E(),A(ia,{key:0,"is-dialog-visible":c(o).isPayrollBatchCreateDialogVisible,"onUpdate:isDialogVisible":a[1]||(a[1]=v=>c(o).isPayrollBatchCreateDialogVisible=v),loading:c(i).createPayrollBatch,onSubmit:F},null,8,["is-dialog-visible","loading"])):K("",!0),c(o).isPayrollBatchDeleteDialogVisible?(E(),A(De,{key:1,"is-dialog-visible":c(o).isPayrollBatchDeleteDialogVisible,"onUpdate:isDialogVisible":a[2]||(a[2]=v=>c(o).isPayrollBatchDeleteDialogVisible=v),title:"آیا از حذف این فیش اطمینان دارید؟",loading:c(i).deletePayrollBatches,onConfirm:C},null,8,["is-dialog-visible","loading"])):K("",!0),u(He,null,{default:y(()=>[u(Be,{app:"",icon:"tabler-plus",size:"x-large",onClick:a[3]||(a[3]=v=>c(o).isPayrollBatchCreateDialogVisible=!0)})]),_:1})]),_:1})}}},Ea=Ue(ua,[["__scopeId","data-v-0de73b66"]]);export{Ea as default};
