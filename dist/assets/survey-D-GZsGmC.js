import{u as x}from"./useApi-BFS_5-m-.js";import{c as b}from"./createUrl-CvArCOk3.js";import{$ as C}from"./api-BpzQvrkM.js";import{V as w}from"./VSnackbar-COKGjvVx.js";import{a as E,V as I}from"./VRow-DVRzdfpy.js";import{V as B,b as M,d as $}from"./VCard-5xQ4WrbW.js";import{bL as m,r as v,c as u,o as n,b as l,e as a,v as p,x as y,n as i,F as _,i as L,f as d,am as S}from"./index-EjeWiJuh.js";import"./useLogout-BaMaxrWu.js";import"./VOverlay-DN2bQKAa.js";/* empty css              */import"./createSimpleFunctional-BaeuI8ZE.js";import"./VCardText-DL0O16Ub.js";const T={key:0},A={key:1},K={__name:"survey",setup(F){const t=m({hasError:!1,errorMessage:""}),s=m({fetchSurveys:!1,participateInSurvey:!1}),f=v([]),c=v("");async function k(){s.fetchSurveys=!0;try{const{data:o,error:e}=await x(b("/survey/survey?filter[active]=1"));if(s.fetchSurveys=!1,e.value)throw e.value;f.value=o.value.data}catch(o){console.error("Error fetching surveys:",o),t.hasError=!0,t.errorMessage=o.message||"خطا در دریافت نظرسنجی‌ها"}}k();async function V(o){s.participateInSurvey=!0;try{const e=await C("/survey/survey/participate",{method:"POST",body:{porslineId:o},onResponseError({response:r}){s.participateInSurvey=!1,t.hasError=!0,t.errorMessage=r._data.message||"خطا در شرکت در نظرسنجی"}});s.participateInSurvey=!1,c.value=e.data}catch(e){console.error(e)}}function h(){window.open(c.value,"_blank","noopener,noreferrer")}return(o,e)=>(n(),u(_,null,[l(w,{modelValue:i(t).hasError,"onUpdate:modelValue":e[0]||(e[0]=r=>i(t).hasError=r),timeout:2e3,location:"center",variant:"outlined",color:"error"},{default:a(()=>[p(y(i(t).errorMessage),1)]),_:1},8,["modelValue"]),l(I,null,{default:a(()=>[(n(!0),u(_,null,L(i(f),r=>(n(),d(E,{key:r.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:a(()=>[l(B,null,{default:a(()=>[l(M,{class:"text-center mb-5 text-wrap"},{default:a(()=>[p(y(r.title),1)]),_:2},1024),l($,{class:"justify-center"},{default:a(()=>[i(c)?(n(),d(S,{key:0,variant:"elevated",color:"success",onClick:g=>h(r.porsline_id)},{default:a(()=>[...e[1]||(e[1]=[p(" شروع ",-1)])]),_:2},1032,["onClick"])):(n(),d(S,{key:1,variant:"elevated",disabled:i(s).participateInSurvey,onClick:g=>V(r.porsline_id)},{default:a(()=>[i(s).participateInSurvey?(n(),u("span",T,"در حال ساخت لینک")):(n(),u("span",A,"دریافت لینک نظرسنجی"))]),_:2},1032,["disabled","onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))}};export{K as default};
