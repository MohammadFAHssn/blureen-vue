import{an as J,a2 as W,aG as X,aw as Z,bi as ee,Y as p,r as y,aQ as te,w as N,a7 as ae,aV as le,b as a,F as $,q as P,aY as oe,cL as ne,aN as se,b$ as j,bd as H,bh as A,i as re,j as ue,a as ie,c as de,o as ce,d as h,e as i,t as L,v as F,m as n,b8 as M,M as O,H as E,be as me,ah as fe,x as pe}from"./index-BQkSm9aJ.js";import{V as I}from"./VNodeRenderer-DomfuLEn.js";import{u as ve}from"./useAbility-DZvY3aWq.js";import{$ as he}from"./api-CbpbTlri.js";import{V as ye}from"./VSnackbar-CI8HKX9R.js";import{a as be,b as ge,V as Ve}from"./VCard-C7Q2WV66.js";import{V as q}from"./VCardText-CdD6Hxvs.js";import{V as we}from"./VForm-DKngTQJO.js";import{V as xe}from"./VRow-vEiKo3Km.js";import{V as B}from"./VCol-Bkwki2b6.js";import{V as _e,m as ke}from"./VField-BG0Qcs78.js";import{V as Ce}from"./VOverlay-D_A1g7yG.js";import{u as Se,m as Ae}from"./form-B2xQCXwT.js";import"./index-9rIf2CJL.js";import"./createSimpleFunctional-DpuZtB2f.js";import"./VAvatar-CJ6tG1pq.js";import"./VImg-Dri1EQo2.js";import"./transition-CrWt5LlP.js";/* empty css              */const Re=`<svg width="180" height="180" viewBox="0 0 181 181" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="1.30469" y="1.44312" width="178" height="178" rx="19" stroke="currentColor" stroke-opacity="0.16" stroke-width="2" stroke-dasharray="8 8" />
<rect x="22.8047" y="22.9431" width="135" height="135" rx="10" fill="currentColor" fill-opacity="0.08" />
</svg>
`,Fe=`<svg width="239" height="234" viewBox="0 0 239 234" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect x="88.5605" y="0.700195" width="149" height="149" rx="19.5" stroke="currentColor" stroke-opacity="0.16" />
<rect x="0.621094" y="33.761" width="200" height="200" rx="10" fill="currentColor" fill-opacity="0.08" />
</svg>
`,Be=W({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...se(),...Ae(),...ne(ke({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),De=J()({name:"VOtpInput",props:Be(),emits:{finish:e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,w){let{attrs:b,emit:D,slots:c}=w;const{dimensionStyles:g}=X(e),{isFocused:x,focus:_,blur:k}=Se(e),d=Z(e,"modelValue","",t=>t==null?[]:String(t).split(""),t=>t.join("")),{t:R}=ee(),C=p(()=>Number(e.length)),r=p(()=>Array(C.value).fill(0)),l=y(-1),v=y(),u=y([]),V=p(()=>u.value[l.value]);function U(){if(T(V.value.value)){V.value.value="";return}const t=d.value.slice(),o=V.value.value;t[l.value]=o;let m=null;l.value>d.value.length?m=d.value.length+1:l.value+1!==C.value&&(m="next"),d.value=t,m&&j(v.value,m)}function z(t){const o=d.value.slice(),m=l.value;let f=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(t.key)&&(t.preventDefault(),t.key==="ArrowLeft"?f="prev":t.key==="ArrowRight"?f="next":["Backspace","Delete"].includes(t.key)&&(o[l.value]="",d.value=o,l.value>0&&t.key==="Backspace"?f="prev":requestAnimationFrame(()=>{var s;(s=u.value[m])==null||s.select()})),requestAnimationFrame(()=>{f!=null&&j(v.value,f)}))}function K(t,o){var f,s;o.preventDefault(),o.stopPropagation();const m=((f=o==null?void 0:o.clipboardData)==null?void 0:f.getData("Text").slice(0,C.value))??"";T(m)||(d.value=m.split(""),(s=u.value)==null||s[t].blur())}function Y(){d.value=[]}function G(t,o){_(),l.value=o}function Q(){k(),l.value=-1}function T(t){return e.type==="number"&&/[^0-9]/g.test(t)}return te({VField:{color:p(()=>e.color),bgColor:p(()=>e.color),baseColor:p(()=>e.baseColor),disabled:p(()=>e.disabled),error:p(()=>e.error),variant:p(()=>e.variant)}},{scoped:!0}),N(d,t=>{t.length===C.value&&D("finish",t.join(""))},{deep:!0}),N(l,t=>{t<0||H(()=>{var o;(o=u.value[t])==null||o.select()})}),ae(()=>{var m;const[t,o]=le(b);return a("div",P({class:["v-otp-input",{"v-otp-input--divided":!!e.divider},e.class],style:[e.style]},t),[a("div",{ref:v,class:"v-otp-input__content",style:[g.value]},[r.value.map((f,s)=>a($,null,[e.divider&&s!==0&&a("span",{class:"v-otp-input__divider"},[e.divider]),a(_e,{focused:x.value&&e.focusAll||l.value===s,key:s},{...c,loader:void 0,default:()=>a("input",{ref:S=>u.value[s]=S,"aria-label":R(e.label,s+1),autofocus:s===0&&e.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],disabled:e.disabled,inputmode:e.type==="number"?"numeric":"text",min:e.type==="number"?0:void 0,maxlength:"1",placeholder:e.placeholder,type:e.type==="number"?"text":e.type,value:d.value[s],onInput:U,onFocus:S=>G(S,s),onBlur:Q,onKeydown:z,onPaste:S=>K(s,S)},null)})])),a("input",P({class:"v-otp-input-input",type:"hidden"},o,{value:d.value.join("")}),null),a(Ce,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!e.loading,persistent:!0},{default:()=>{var f;return[((f=c.loader)==null?void 0:f.call(c))??a(oe,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(m=c.default)==null?void 0:m.call(c)])])}),{blur:()=>{var t;(t=u.value)==null||t.some(o=>o.blur())},focus:()=>{var t;(t=u.value)==null||t[0].focus()},reset:Y,isFocused:x}}}),Ie={class:"auth-wrapper d-flex align-center justify-center pa-4"},Te={class:"position-relative my-sm-16"},Ne={class:"app-logo"},Pe={class:"app-logo-title"},je={class:"d-flex justify-center align-center flex-wrap"},Le={class:"me-1"},lt=Object.assign({beforeRouteEnter(e,w,b){if(A("otpExpiresAt").value<Math.floor(Date.now()/1e3))return b({name:"login-supplier"});b()}},{__name:"two-step-supplier",setup(e){const w=re(),b=ue(),D=ve(),c=y(""),g=y(!1),x=y({other:void 0}),_=y(!1),k=y(A("otpExpiresAt").value-Math.floor(Date.now()/1e3)),d=setInterval(()=>{k.value-=1,k.value<=0&&(clearInterval(d),k.value=0,b.replace("/login-supplier"))},1e3),R=p(()=>{const r=k.value,l=Math.floor(r%3600/60),v=r%60;return{minutes:l.toString().padStart(2,"0"),seconds:v.toString().padStart(2,"0")}}),C=async()=>{g.value=!0;try{const r=await he("/verify-supplier-otp",{method:"POST",body:{mobileNumber:w.query.mobileNumber,otpCode:c.value},onResponseError({response:V}){g.value=!1,V._data.errors?x.value=V._data.errors:(x.value.other=V._data.message,_.value=!0)}}),{accessToken:l,userData:v,userAbilityRules:u}=r;A("userAbilityRules").value=u,D.update(u),A("userData").value=v,A("accessToken").value=l,await H(()=>{b.replace(w.query.to?String(w.query.to):"/")})}catch(r){console.error(r)}};return(r,l)=>{const v=ie("RouterLink");return ce(),de($,null,[a(ye,{modelValue:n(_),"onUpdate:modelValue":l[0]||(l[0]=u=>M(_)?_.value=u:null),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:i(()=>[L(F(n(x).other),1)]),_:1},8,["modelValue"]),h("div",Ie,[h("div",Te,[a(n(I),{nodes:("h"in r?r.h:n(O))("div",{innerHTML:n(Fe)}),class:"text-primary auth-v1-top-shape d-none d-sm-block"},null,8,["nodes"]),a(n(I),{nodes:("h"in r?r.h:n(O))("div",{innerHTML:n(Re)}),class:"text-primary auth-v1-bottom-shape d-none d-sm-block"},null,8,["nodes"]),a(Ve,{class:pe(["auth-card",r.$vuetify.display.smAndUp?"pa-6":"pa-0"]),"max-width":"460"},{default:i(()=>[a(be,{class:"justify-center"},{default:i(()=>[a(ge,null,{default:i(()=>[a(v,{to:"/"},{default:i(()=>[h("div",Ne,[a(n(I),{nodes:n(E).app.logo},null,8,["nodes"]),h("h1",Pe,F(n(E).app.title),1)])]),_:1})]),_:1})]),_:1}),a(q,null,{default:i(()=>l[2]||(l[2]=[h("h4",{class:"text-h4 mb-1"}," احراز هویت دو مرحله‌ای ",-1),h("p",{class:"mb-1"}," کد تأیید به تلفن همراه شما ارسال شد. لطفاً کد دریافتی را در کادر زیر وارد کنید ",-1)])),_:1}),a(q,null,{default:i(()=>[a(we,{onSubmit:me(()=>{},["prevent"])},{default:i(()=>[a(xe,null,{default:i(()=>[a(B,{cols:"12"},{default:i(()=>[a(De,{modelValue:n(c),"onUpdate:modelValue":l[1]||(l[1]=u=>M(c)?c.value=u:null),style:{direction:"ltr"},disabled:n(g),type:"number",class:"pa-0",onFinish:C},null,8,["modelValue","disabled"])]),_:1}),a(B,{cols:"12"},{default:i(()=>[a(fe,{loading:n(g),disabled:n(g),block:"",type:"submit"},{default:i(()=>l[3]||(l[3]=[L(" تأیید ")])),_:1},8,["loading","disabled"])]),_:1}),a(B,null,{default:i(()=>[a(B,{cols:"12"},{default:i(()=>[h("div",je,[h("span",Le,F(n(R).minutes)+":"+F(n(R).seconds),1),l[4]||(l[4]=h("span",{class:"me-1"},"تا درخواست دوباره",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])])])],64)}}});export{lt as default};
