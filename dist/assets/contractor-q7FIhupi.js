import{r as F}from"./validators-BQd4MaJQ.js";import{r as c,f as M,o as S,e as n,b as r,d as H,bC as x,n as s,bv as N,am as k,v as w,M as E,bJ as B,bK as C,Y as G,a as R,m as $,x as q,bL as T}from"./index-Bvm1mU2Q.js";import{_ as U}from"./DialogCloseBtn-aurEs4Gw.js";import{V as O}from"./VCard-DgLDzmB3.js";import{V as z}from"./VCardText-A2h27jHu.js";import{V as L}from"./VForm-DjZ-ZeHl.js";import{V as P}from"./VRow-yH5PVQoc.js";import{V as y}from"./VCol-VeZ2dyXK.js";import{V as h}from"./VTextField-CDXaFlOx.js";import{V as I}from"./VDialog-D_t5A8Yw.js";import{u as J}from"./useAGGridTheme-b1P1Y_4w.js";import{$ as j}from"./api-CRnz60WE.js";import{V as K}from"./VSnackbar-ChqeJZ8E.js";import{V as Q}from"./VFab-C4AYONAe.js";import{V as W}from"./VLayout-DOMx_LOv.js";import"./helpers-CcX6MmOA.js";import"./createSimpleFunctional-BZNIwSl2.js";/* empty css              */import"./autofocus-CLJDdjex.js";import"./VCounter-myTCGZzg.js";import"./VField-DEsQcr7P.js";import"./VOverlay-BPadrcFc.js";import"./dialog-transition-BLsRpjJQ.js";import"./index-CvOPxmL5.js";import"./useLogout-BQOYZFXX.js";const X={__name:"ContractorCreateDialog",props:{isDialogVisible:{type:Boolean,required:!0},loading:{type:Boolean,required:!0}},emits:["submit","update:isDialogVisible"],setup(f,{emit:o}){const u=f,V=o,p=c(null),m=c(null),g=c(null),v=c();function D(){var d;(d=v.value)==null||d.validate().then(({valid:t})=>{t&&V("submit",{contractorFirstName:p.value,contractorLastName:m.value,description:g.value})})}function Y(){V("update:isDialogVisible",!1)}function b(d){V("update:isDialogVisible",d)}return(d,t)=>{const a=U;return S(),M(I,{width:d.$vuetify.display.smAndDown?"auto":900,"model-value":u.isDialogVisible,"onUpdate:modelValue":b},{default:n(()=>[r(a,{onClick:t[0]||(t[0]=e=>b(!1))}),r(O,null,{default:n(()=>[r(z,null,{default:n(()=>[t[7]||(t[7]=H("h4",{class:"text-h5 text-center mb-2"}," افزودن پیمانکار ",-1)),r(L,{ref_key:"refVForm",ref:v,class:"mt-6","validate-on":"submit lazy",onSubmit:x(D,["prevent"])},{default:n(()=>[r(P,null,{default:n(()=>[r(y,{cols:"12",md:"6"},{default:n(()=>[r(h,{modelValue:s(p),"onUpdate:modelValue":t[1]||(t[1]=e=>N(p)?p.value=e:null),rules:["requiredValidator"in d?d.requiredValidator:s(F)],disabled:f.loading,label:"نام"},null,8,["modelValue","rules","disabled"])]),_:1}),r(y,{cols:"12",md:"6"},{default:n(()=>[r(h,{modelValue:s(m),"onUpdate:modelValue":t[2]||(t[2]=e=>N(m)?m.value=e:null),rules:["requiredValidator"in d?d.requiredValidator:s(F)],disabled:f.loading,label:"نام خانوادگی"},null,8,["modelValue","rules","disabled"])]),_:1}),r(y,{cols:"12",md:"12"},{default:n(()=>[r(h,{modelValue:s(g),"onUpdate:modelValue":t[3]||(t[3]=e=>N(g)?g.value=e:null),disabled:f.loading,label:"توضیحات - اختیاری"},null,8,["modelValue","disabled"])]),_:1}),r(y,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:n(()=>[r(k,{type:"submit",disabled:f.loading,loading:f.loading,onClick:t[4]||(t[4]=e=>{var i;return(i=s(v))==null?void 0:i.validate()})},{default:n(()=>[...t[5]||(t[5]=[w(" ذخیره ",-1)])]),_:1},8,["disabled","loading"]),r(k,{color:"secondary",variant:"tonal",onClick:Y},{default:n(()=>[...t[6]||(t[6]=[w(" انصراف ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},Z={style:{"block-size":"100%"}},ee={__name:"contractor",setup(f){const o=B({hasError:!1,errorMessage:"",isContractorCreateDialogVisible:!1}),u=B({fetchingsContractors:!1,createContractor:!1,changeStatus:!1}),V=c([]),p=c([]),m=c(null),{theme:g}=J();function v(a){m.value=a.api,m.value.setGridOption("loading",!0)}const D=c([{headerName:"نام",field:"fullName"},{headerName:"توضیحات",field:"description"},{headerName:"وضعیت",field:"status",cellRenderer:"Active",cellStyle:{display:"flex","align-items":"center"},filterParams:{valueFormatter:a=>a.value===1?"فعال":"غیرفعال"}},{headerName:"ایجاد شده توسط",field:"createdBy"},{headerName:"آخرین ویرایش توسط",field:"editedBy"},{headerName:"تاریخ ایجاد",field:"createdAt",valueFormatter:a=>C(a.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"تاریخ آخرین ویرایش",field:"updatedAt",valueFormatter:a=>C(a.value,"jYYYY-jMM-jDD HH:mm:ss").format("jYYYY/jMM/jD HH:mm:ss")},{headerName:"عملیات",field:"actions",cellRendererSelector:a=>({component:"Actions",params:{onStatusClick:e=>{p.value=[e],t()}}})}]),Y=G(()=>{var a;return(a=V.value)==null?void 0:a.map(e=>{var i,l;return{id:e.id,fullName:e.fullName,description:e.description,status:e.status,createdBy:((i=e.createdBy)==null?void 0:i.fullName)||"--",editedBy:((l=e.editedBy)==null?void 0:l.fullName)||"--",createdAt:C(e.createdAt).format("jYYYY-jMM-jDD HH:mm:ss"),updatedAt:C(e.updatedAt).format("jYYYY-jMM-jDD HH:mm:ss"),actions:{status:!0}}})});async function b(){var a,e,i;u.fetchingsContractors=!0,(a=m.value)==null||a.setGridOption("loading",!0);try{const l=await j("/contractor",{method:"GET"});V.value=((e=l==null?void 0:l.data)==null?void 0:e.contractors)||[]}catch(l){console.error("Error fetching contractors:",l),o.hasError=!0,o.errorMessage=l.message||"خطا در دریافت پیمانکاران"}finally{u.fetchingsContractors=!1,(i=m.value)==null||i.setGridOption("loading",!1)}}b();async function d(a){const e=new FormData;e.append("first_name",a.contractorFirstName),e.append("last_name",a.contractorLastName),a.description&&e.append("description",a.description),u.createContractor=!0;try{await j("/contractor",{method:"POST",body:e,onResponseError({response:i}){var l,A;if(o.hasError=!0,(l=i._data)!=null&&l.errors){const _=Object.values(i._data.errors).flat().join(" | ");o.errorMessage=_}else o.errorMessage=((A=i._data)==null?void 0:A.message)||"خطا در ایجاد پیمانکار"}}),o.isContractorCreateDialogVisible=!1}catch(i){console.error(i)}finally{u.createContractor=!1,b()}}async function t(){const a=p.value[0].data.id;u.changeStatus=!0;try{await j(`/contractor/status/${a}`,{method:"POST",onResponseError({response:e}){u.changeStatus=!1,o.hasError=!0,o.errorMessage=e._data.message||"خطا در تغییر وضعیت"}}),u.changeStatus=!1,b()}catch(e){console.error(e)}}return(a,e)=>{const i=R("AgGridVue");return S(),M(W,{class:"app-layout"},{default:n(()=>[r(K,{modelValue:s(o).hasError,"onUpdate:modelValue":e[0]||(e[0]=l=>s(o).hasError=l),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:n(()=>[w(q(s(o).errorMessage),1)]),_:1},8,["modelValue"]),H("section",Z,[r(i,{style:{"block-size":"100%","inline-size":"100%"},"column-defs":s(D),"row-data":s(Y),"enable-rtl":"","row-numbers":"",pagination:"",theme:s(g),onGridReady:v},null,8,["column-defs","row-data","theme"])]),s(o).isContractorCreateDialogVisible?(S(),M(X,{key:0,"is-dialog-visible":s(o).isContractorCreateDialogVisible,"onUpdate:isDialogVisible":e[1]||(e[1]=l=>s(o).isContractorCreateDialogVisible=l),loading:s(u).createContractor,onSubmit:d},null,8,["is-dialog-visible","loading"])):$("",!0),r(T,null,{default:n(()=>[r(Q,{app:"",icon:"tabler-plus",size:"x-large",onClick:e[2]||(e[2]=l=>s(o).isContractorCreateDialogVisible=!0)})]),_:1})]),_:1})}}},Me=E(ee,[["__scopeId","data-v-72eb65cd"]]);export{Me as default};
