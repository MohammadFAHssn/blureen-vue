import{u as w}from"./useApi-CgYLtS9W.js";import{c as E}from"./createUrl-C9tlDqVN.js";import{$ as B}from"./api-CRoQWPgd.js";import{V as I}from"./VSnackbar-BHwzSFyE.js";import{V as m}from"./VCol-kk-UGOPB.js";import{V as v,b as M,c as $}from"./VCard-CjoHPk1c.js";import{bL as y,r as _,c as u,o as i,b as l,e as a,v as p,x as S,n as o,f as d,F as k,i as L,m as V,am as g}from"./index-Cs98bBAa.js";import{V as N}from"./VRow-BcN_aC2d.js";import"./useLogout-C9d8jl3q.js";import"./VOverlay-Bu8mYysY.js";/* empty css              */import"./createSimpleFunctional-BiF6kVdu.js";import"./VCardText-CSxqD_3A.js";const T={key:0},A={key:1},W={__name:"survey",setup(F){const n=y({hasError:!1,errorMessage:""}),s=y({fetchSurveys:!1,participateInSurvey:[]}),f=_([]),c=_([]);async function h(){s.fetchSurveys=!0;try{const{data:e,error:r}=await w(E("/survey/survey?filter[active]=1"));if(s.fetchSurveys=!1,r.value)throw r.value;f.value=e.value.data}catch(e){console.error("Error fetching surveys:",e),n.hasError=!0,n.errorMessage=e.message||"خطا در دریافت نظرسنجی‌ها"}}h();async function x(e){s.participateInSurvey[e]=!0;try{const r=await B("/survey/survey/participate",{method:"POST",body:{porslineId:e},onResponseError({response:t}){s.participateInSurvey[e]=!1,n.hasError=!0,n.errorMessage=t._data.message||"خطا در شرکت در نظرسنجی"}});s.participateInSurvey[e]=!1,c.value[e]=r.data}catch(r){console.error(r)}}function C(e){window.open(c.value[e],"_blank","noopener,noreferrer")}return(e,r)=>(i(),u(k,null,[l(I,{modelValue:o(n).hasError,"onUpdate:modelValue":r[0]||(r[0]=t=>o(n).hasError=t),timeout:2e3,location:"center",variant:"flat",color:"error"},{default:a(()=>[p(S(o(n).errorMessage),1)]),_:1},8,["modelValue"]),l(N,null,{default:a(()=>[o(f).length===0?(i(),d(m,{key:0},{default:a(()=>[l(v,{variant:"text"},{default:a(()=>[...r[1]||(r[1]=[p(" نظرسنجی فعالی وجود ندارد. ",-1)])]),_:1})]),_:1})):(i(!0),u(k,{key:1},L(o(f),t=>(i(),d(m,{key:t.id,cols:"12",sm:"12",md:"6",lg:"4",xl:"3",xxl:"3"},{default:a(()=>[l(v,null,{default:a(()=>[l(M,{class:"text-center mb-5 text-wrap"},{default:a(()=>[p(S(t.title),1)]),_:2},1024),l($,{class:"justify-center"},{default:a(()=>[o(c)[t.porsline_id]?(i(),d(g,{key:0,variant:"elevated",color:"success",onClick:b=>C(t.porsline_id)},{default:a(()=>[...r[2]||(r[2]=[p(" شروع ",-1)])]),_:1},8,["onClick"])):o(c)[t.porsline_id]?V("",!0):(i(),d(g,{key:1,variant:"elevated",disabled:o(s).participateInSurvey[t.porsline_id],onClick:b=>x(t.porsline_id)},{default:a(()=>[o(s).participateInSurvey[t.porsline_id]?(i(),u("span",T,"در حال ساخت لینک")):o(s).participateInSurvey[t.porsline_id]?V("",!0):(i(),u("span",A,"دریافت لینک نظرسنجی"))]),_:2},1032,["disabled","onClick"]))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})],64))}};export{W as default};
